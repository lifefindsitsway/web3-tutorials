# DeFi è¯¾ç¨‹ï¼ˆ2024 ç‰ˆï¼‰å­¦ä¹ ç¬”è®°

> æœ¬æ–‡æ˜¯æˆ‘ 2024 å¹´åœ¨ B ç«™å­¦ä¹ æ¢åŸ¹åˆ©è€å¸ˆçš„å…¬å¼€è¯¾ç¨‹ã€ŠDeFi è¯¾ç¨‹ï¼ˆ2024ç‰ˆï¼‰ã€‹æ—¶æ•´ç†çš„å­¦ä¹ ç¬”è®°ã€‚è¯¾ç¨‹ä»¥ Uniswap ä¸ºæ ¸å¿ƒï¼Œç³»ç»Ÿæ¢³ç†äº† DeFi é¢†åŸŸçš„å…³é”®æ¦‚å¿µä¸åè®®åŸç†ï¼Œæ¶µç›–ç¨³å®šå¸ã€å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ã€å€Ÿè´·åè®®ç­‰ä¸»é¢˜ã€‚ç¬”è®°ä¸­ä¿ç•™äº†è¯¾å ‚è¦ç‚¹ã€æ¡ˆä¾‹åˆ†æä»¥åŠæˆ‘ä¸ªäººçš„ä¸€äº›è¡¥å……è¯´æ˜ï¼Œå¸Œæœ›å¯¹åŒæ ·åœ¨å­¦ä¹  DeFi çš„æœ‹å‹æœ‰æ‰€å¸®åŠ©ã€‚
>

**ğŸ“¢ è¯¾ç¨‹æ›´æ–°æç¤º**ï¼šè¯¥è¯¾ç¨‹ 2025 å¹´å·²æ¨å‡ºæœ€æ–°ç‰ˆâ€”â€”[ã€ŠUniswap ä¸“é¢˜ï¼šä»V1åˆ°V4ã€‹](https://space.bilibili.com/220951871/lists/5076602)ï¼Œè®²è§£å†…å®¹æ›´ä¸ºè¯¦ç»†ï¼Œé‡ç‚¹ä»‹ç»äº† Uniswap V3 çš„æœºåˆ¶åŸç†ï¼Œæ¨èæ„Ÿå…´è¶£çš„è¯»è€…å…³æ³¨ã€‚

è¯¾ç¨‹è§†é¢‘ï¼šhttps://space.bilibili.com/220951871/lists/2824381

è¯¾ç¨‹å¹»ç¯ç‰‡å’Œè®²ä¹‰ï¼šhttps://github.com/liangpeili

## ç¬¬ 1 è¯¾ - DeFi è¯¾ç¨‹ç®€ä»‹

**åŒºå—é“¾åº”ç”¨çš„å¸¸è§åˆ†ç±»ï¼š**

- DeFiï¼šUniswap/AAVE/Curve/DAI/Compound ç­‰ï¼›
- GameFiï¼šä» CryptoKitties å¼€å§‹ï¼›
- SocialFiï¼šnostr/Damus/friend.techï¼›
- å›½å†…ç›®å‰æ”¿ç­–ï¼šå» Fi ç•™ blockï¼ŒæœåŠ¡å®ä½“ç»æµï¼›

**CeFi çš„ä¸»è¦ç»„æˆæœºæ„ä¸èŒèƒ½ï¼š**

- ä¸­å¤®é“¶è¡Œï¼šå‘è¡Œæ³•å®šè´§å¸ï¼›
- å•†ä¸šé“¶è¡Œï¼šå­˜æ¬¾ã€ç»“ç®—ã€ä¿¡è´·ç­‰ï¼›
- ä¿é™©å…¬å¸ï¼šé£é™©è½¬ç§»ä¸åˆ†æ•£ï¼›
- è¯åˆ¸å…¬å¸ï¼šè¯åˆ¸ä¹°å–ã€äº¤æ˜“ï¼Œè¯åˆ¸æ‰¿é”€ç­‰ï¼›
- é“¶ç›‘ä¼šã€è¯ç›‘ä¼šå’Œä¿ç›‘ä¼šï¼›
- å›½å®¶é‡‘èç›‘ç£ç®¡ç†æ€»å±€ï¼›

**CeFi çš„ç‰¹ç‚¹ï¼š**

- é›†ä¸­çš„è´¦æˆ·ç®¡ç†ï¼›
- äº¤æ˜“å®¡æŸ¥ä¸ç›‘æ§ï¼›
- åŸºäºå¯¹æœºæ„çš„ä¿¡ä»»ï¼›
- æ‰‹ç»­è´¹ä½œä¸ºä¸»è¦åˆ©æ¶¦æ¥æºï¼›
- ä¸é€æ˜æ€§/ä¿¡æ¯å·®ï¼›

ç©·äººæ­»äº P2Pã€ä¸­äº§æ­»äºç†è´¢ï¼Œå¯Œäººæ­»äºä¿¡æ‰˜ã€‚

**DeFi èƒ½åšä»€ä¹ˆï¼š**

- å…¨çƒæ”¯ä»˜ï¼›
- äº¤æ˜“ï¼›
- ç†è´¢ï¼›
- å€Ÿæ¬¾ï¼›
- è´·æ¬¾ï¼›
- è¡ç”Ÿå“ï¼›

**DeFi çš„ç‰¹ç‚¹ï¼š**

- è´¦å·ä¸ªäººç®¡ç†ï¼šNot your keys, not your coinsï¼›
- æ— éœ€è®¸å¯ï¼›
- å¼€æºå¯éªŒè¯ï¼›
- å¯ç¼–ç¨‹æ€§ï¼›

> æ³¨æ„ï¼šç›®å‰å›½å†…å¹¶æ²¡æœ‰åšçº¯ DeFi çš„æ”¿ç­–ç©ºé—´ã€‚

**è¯¾ç¨‹å®‰æ’ï¼š**

- ä»¥ Uniswap ä¸ºæ ¸å¿ƒï¼Œæ¢³ç† DeFi é¢†åŸŸçš„ä¸Šä¸‹æ¸¸äº§å“åŠå…¶åŸç†ï¼›
- ä»ç¨³å®šå¸å…¥æ‰‹ï¼Œé€æ­¥ä»‹ç»å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ Uniswap çš„æ ¸å¿ƒé€»è¾‘ï¼Œè¿›è€Œæ‰©å±•åˆ°å…¶ä»–é¢†åŸŸ DeFi äº§å“ï¼ˆå¦‚å€Ÿè´·ç­‰ï¼‰å’Œç®—æ³•ï¼›
- ç†è®ºè¯¾ 24 å­¦æ—¶ + å®éªŒè¯¾ 8 å­¦æ—¶ï¼›
- ã€ŠåŒºå—é“¾åº”ç”¨ç³»ç»Ÿå¼€å‘å®è·µã€‹32 å­¦æ—¶ï¼›

> æ¢è€å¸ˆçš„ä¸€ä¸ªå°é‡å¿ƒï¼šæŠŠè¿™ä¸ªè¯¾ç¨‹åšæˆä¸­æ–‡åœˆé‡Œæœ€å¥½çš„ã€‚

## ç¬¬ 2 è¯¾ - ç¨³å®šå¸ï¼šUSDT/USDC/BUSD

**è´§å¸çš„æ¼”åŒ–ï¼š**

- å®ç‰©è´§å¸ï¼›
- é‡‘å±è´§å¸ï¼›
- åŸºäºé»„é‡‘ç­‰è´µé‡‘å±æŠµæŠ¼çš„æ³•å®šè´§å¸ï¼›
- åŸºäºä¿¡ç”¨çš„æ³•å®šè´§å¸ï¼›
- ç”µå­è´§å¸ï¼›
- æ•°å­—è´§å¸ï¼Ÿ

é€šè´§è†¨èƒ€æœ‰åˆ©äºç»æµå‘å±•ï¼Œè€Œé€šè´§ç´§ç¼©ä¸åˆ©äºã€‚

**ç¨³å®šå¸ï¼šæ²Ÿé€šèµ›åšç©ºé—´å’Œç°å®ä¸–ç•Œçš„æ¡¥æ¢**

- åŠ å¯†è´§å¸çš„æ³¢åŠ¨å¤ªå¤§ï¼›
- ç›¸æ¯”åŠ å¯†è´§å¸ï¼Œäººä»¬æ›´ç›¸ä¿¡æ³•å¸ï¼›
- åœ¨åŠ å¯†è´§å¸ä¸–ç•Œï¼Œä¹Ÿéœ€è¦ä»·å€¼é”šå®šï¼›

**ç¨³å®šå¸çš„ç±»å‹ï¼š**

- åŸºäºæ³•å¸é”šå®šçš„ç¨³å®šå¸ï¼šUSDT/USDC/BUSD ç­‰ï¼›
- åŸºäºåŠ å¯†èµ„äº§è¶…é¢æŠµæŠ¼çš„ç¨³å®šå¸ï¼šDAIï¼›
- åŸºäºç®—æ³•çš„ç¨³å®šå¸ï¼ˆç®—æ³•ç¨³å®šå¸ï¼‰ï¼šUST/Frax ç­‰ï¼›

**åŸºäºæ³•å¸æŠµæŠ¼çš„ç¨³å®šå¸ -- USDT**

- ç¨³å®šå¸å¸‚å€¼æ’åç¬¬ä¸€ï¼›
- ç”± Tether å‘è¡Œï¼›
- ä¸­å¿ƒåŒ–ç®¡ç†ï¼›

https://tether.to

There are five steps in the lifecycle of Tether tokensï¼š

1. ä¸€ä¸ªç»è¿‡ KYC è®¤è¯çš„ä¸ªäººæˆ–æœºæ„å¯ä»¥å……å€¼æ³•å¸åˆ° Tether å…¬å¸æŒæœ‰çš„é“¶è¡Œè´¦æˆ·ä¸­ï¼›
2. Tether å…¬å¸å‘è¡Œ USDT åˆ°è¿™ä¸ªç”¨æˆ·æˆ–å…¬å¸æä¾›çš„åœ°å€ï¼ŒTether å…¬å¸è½¬ç»™ç”¨æˆ·çš„æ•°é‡å’Œç”¨æˆ·å……å€¼ç»™ Tether å…¬å¸é“¶è¡Œè´¦æˆ·çš„æ•°é‡ä¸€æ ·ï¼›
3. ç”¨æˆ·æŒæœ‰ USDT å°±å¯ä»¥æ‹¿è¿™ä¸ªå»å‚ä¸é“¾ä¸Šäº§å“ï¼Œæ¯”å¦‚è¯´å­˜å‚¨ã€ç†è´¢ã€äº¤æ¢ç­‰ï¼›
4. ç”¨æˆ·å¦‚æœä¸æƒ³å†æŒæœ‰ USDT äº†ï¼Œå¯ä»¥åœ¨ tether.to ä¸Šè½¬å›å»ï¼›
5. Tether å…¬å¸æŠŠæ³•å¸ä»è‡ªå·±å…¬å¸è½¬åˆ°ç”¨æˆ·çš„é“¶è¡Œè´¦æˆ·ä¸Šï¼Œå¹¶é”€æ¯é“¾ä¸Šå¯¹åº”æ•°é‡çš„ USDTï¼›

> ğŸ’¡ Tether å…¬å¸å°†è¿‘ 100 äººï¼Œ2023 å¹´ç¬¬å››å­£åº¦å‡€åˆ©æ¶¦è¿‘ 200 äº¿äººæ°‘å¸ï¼›åŒæœŸçš„å°ç±³å…¬å¸å‘˜å·¥è¶…è¿‡ 3 ä¸‡äººï¼Œå‡€åˆ©æ¶¦è¿‘ 49 äº¿äººæ°‘å¸ã€‚

åŒºå—é“¾å…¬å¸è·Ÿäº’è”ç½‘å…¬å¸çš„åŒºåˆ«ï¼šåŒºå—é“¾å…¬å¸ä¸éœ€è¦å¾ˆå¤šäººï¼Œé‚£å®ƒéœ€è¦ä»€ä¹ˆæ ·çš„äººï¼Ÿåœ¨è¿™ä¸ªè¡Œä¸šå¾…ä¸‹å»çš„æ”¶ç›Šæ˜¯äº’è”ç½‘çš„å¾ˆå¤šå€ã€‚

![https://www.techflowpost.com/newsletter/detail_45129.html](../../assets/images/defi_course_2024_edition/1.png)

![img](../../assets/images/defi_course_2024_edition/2.png)

**åŸºäºæ³•å¸æŠµæŠ¼çš„ç¨³å®šå¸ -- USDC**

- ç¨³å®šå¸å¸‚å€¼æ’åç¬¬äºŒï¼›
- ç”± Circle ç®¡ç†å’Œå‘è¡Œï¼›

**åŸºäºæ³•å¸æŠµæŠ¼çš„ç¨³å®šå¸ -- BUSD**

- Paxos å‘è¡Œçš„ç¾å…ƒç¨³å®šå¸ï¼›
- å—çº½çº¦é‡‘èæœåŠ¡å±€ NYDFS çš„ç›‘ç®¡ï¼›
- ç”¨äº† Binance çš„å“ç‰Œï¼›
- å¯ä»¥ 1:1 è´­ä¹°å’Œèµå›ï¼›
- 100% çš„ç¾å…ƒæˆ–è€…ç¾å…ƒç°é‡‘ç­‰ä»·ç‰©æ”¯æ’‘ï¼›
- ä»…åœ¨ä»¥å¤ªåŠå‘è¡Œï¼›
- 2023 å¹´ 2 æœˆä»½åœæ­¢å‘è¡Œï¼›

## ç¬¬ 3 è¯¾ - ç¨³å®šå¸ï¼šDAI/AMPL

**åŸºäºåŠ å¯†èµ„äº§è¶…é¢æŠµæŠ¼çš„ç¨³å®šå¸ -- DAI**

- DAI æ˜¯ Maker Protocol çš„ä¸»è¦äº§å“ï¼›
- Maker Protocol ç”± MakerDAO ç®¡ç†ï¼›
- MKR æ˜¯ MakerDAO çš„æ²»ç†ä»£å¸ï¼›

![4](../../assets/images/defi_course_2024_edition/3.png)

![img](../../assets/images/defi_course_2024_edition/4.png)

![5](../../assets/images/defi_course_2024_edition/5.png)

**DAI çš„ä¾›åº”é‡æ§åˆ¶ï¼š**

- è´·æ¬¾åˆ©ç‡ï¼šStability Fee
- å­˜æ¬¾åˆ©ç‡ï¼šDAI Saving Rateï¼ˆDSRï¼‰
- å¦‚æœ 1 DAI = 0.99 USDï¼Œæé«˜åˆ©ç‡ï¼›
- å¦‚æœ 1 DAI = 1.01 USDï¼Œé™ä½åˆ©ç‡ï¼›

![6](../../assets/images/defi_course_2024_edition/6.png)

> MakerDAO çš„å‘˜å·¥æ•°æ¯” Tether æ›´å°‘ã€‚

è¯¾åæ€è€ƒï¼šç ”ç©¶ DAI çš„ç›ˆåˆ©æ–¹å¼ï¼Œä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¹ˆé«˜çš„æ”¶å…¥ï¼Ÿï¼ˆè¿™ç±»é—®é¢˜æ˜¯åŒºå—é“¾é¡¹ç›®åˆ›ä¸šä¸€ä¸ªæ¯”è¾ƒå¥½çš„æ€è€ƒåˆ‡å…¥ç‚¹ï¼‰

**æ¡ˆä¾‹åˆ†æ**

- å‡è®¾ 1 ETH = 2000 USDï¼Œè´¨æŠ¼äº† 5 ä¸ª ETH åˆ° Maker Vaultï¼ŒæŒ‰ç…§ 150% çš„è¶…é¢æŠµæŠ¼ç‡ï¼Œæœ€å¤šå¯ä»¥å€Ÿå‡º 10000 / 150% = 6666.67 ä¸ª DAIã€‚ä¿é™©èµ·è§ï¼Œç”¨æˆ·å€Ÿå‡º 5000 DAIï¼Œå…¶ä½™ 1666.67 ä¸ºç¼“å†²åŒºã€‚
- æƒ…å½¢ 1ï¼šETH æ¶¨ä»·åˆ° 3000 USDã€‚æ­¤æ—¶ 5 ETH = 15000 USDï¼ŒåŸºäº 150% çš„æŠµæŠ¼ç‡ï¼Œç”¨æˆ·æœ€å¤šå¯ä»¥å€Ÿå‡º 10000 DAIã€‚
- æƒ…å½¢ 2ï¼šETH è·Œåˆ° 1500 USDï¼Œæ­¤æ—¶ 5 ETH = 7500 USDï¼Œ7500 USD / 5000 DAI = 150%ã€‚ç”¨æˆ·é¢ä¸´ä¸‰ä¸ªé€‰æ‹©ï¼š
    - å¾€ Maker Vault è´¨æŠ¼æ›´å¤šçš„ ETHï¼›
    - è¿˜å› 5000 DAI + Stability Feeï¼Œæ‹¿å› 5 ä¸ª ETHï¼›
    - è¿˜å›éƒ¨åˆ† DAI + Stability Feeï¼Œå¢åŠ è‡ªå·±çš„ç¼“å†²åŒºï¼›

**DAI çš„é˜²æŠ¤ç½‘ä¹‹ä¸€ â€”â€”Collateral Auction**

- æƒ…å½¢ 3ï¼šETH è·Œåˆ° 1200 USDï¼Œæ­¤æ—¶ 5 ETH = 6000 USDï¼Œè§¦å‘æ¸…ç®—ï¼ŒKeeper ä»‹å…¥æ¸…ç®—æµç¨‹ï¼›
- 5 ä¸ª ETH æŒ‰ç…§å¸‚ä»·æŠ˜æ‰£ 3% è¿›è¡Œæ‹å–ï¼Œæ¯æ¬¡å¢åŠ  0.5%ï¼Œç›´åˆ°æ‹å–æˆåŠŸï¼›
- Keeper ä½¿ç”¨ DAI æ¥ç«æ‹ï¼Œä»·é«˜è€…å¾—ï¼›
- æ‰£é™¤ 5000 DAI + Penalty Fee ç­‰è´¹ç”¨ï¼Œå…¶ä½™ ETH è¿”å›ç»™ç”¨æˆ·ï¼›

**DAI çš„é˜²æŠ¤ç½‘ä¹‹äºŒâ€”â€”Maker Buffer**

- Stability Fee / Penalty Fee ç­‰ç¼“æ…¢ç§¯æ”’ï¼›
- æƒ…å½¢ 4ï¼šETH è·Œåˆ° 900 USDï¼Œæ­¤æ—¶ 5 ETH = 4500 USDï¼Œæ‹å–åçš„ç¼ºå£ä¸º 500 USDï¼›
- ä» Maker Buffer æ”¯ä»˜ 500 DAIï¼Œå¼¥è¡¥ç¼ºå£ï¼›

**DAI çš„é˜²æŠ¤ç½‘ä¹‹ä¸‰â€”â€”Debt Auction**

- æƒ…å½¢ 5ï¼šETH è·Œåˆ° 900 USDï¼Œæ­¤æ—¶ 5 ETH = 4500 USDï¼Œæ‹å–åçš„ç¼ºå£ä¸º 500 USDï¼Œè€Œ Maker Buffer é‡Œåªæœ‰ 100 DAIï¼Œèµ„é‡‘ç¼ºå£ä¸º 400 USDã€‚
- å¢å‘ MKR è¿›è¡Œæ‹å–ï¼›
- ç”¨æˆ·ä½¿ç”¨ DAI å‚ä¸æ‹å–ï¼Œæ‹å–å¾—åˆ°çš„ DAI æ¥å¼¥è¡¥ç¼ºå£ï¼›
- è¿™æ˜¯ä¸€ç§å¯¹ç¤¾åŒºæ²»ç†çš„æƒ©ç½šæ–¹å¼ï¼›

å¢å‘ MKR ä½¿å¾—å¸çš„ä»·å€¼è¢«ç¨€é‡Šã€‚

**Decentralized Autonomous Organization (DAO)**

- ä¸€ç§æ–°å‹çš„ç»„ç»‡å½¢å¼
- å‘è¡Œæ²»ç† Token
- æ²»ç† Token ä»£è¡¨æŠ•ç¥¨æƒ
- ç¤¾åŒºå…±æ²»ã€å…±å»ºã€å…±äº«

**MakerDAO çš„è¿è¡Œæœºåˆ¶**

- ææ¡ˆé˜¶æ®µ

    - 1. å‘èµ·ææ¡ˆï¼šä»»ä½• MKR æŒæœ‰äººéƒ½å¯ä»¥å‘èµ·æ–°ææ¡ˆï¼›
    - 2. åœ¨ MakerDAO ç¤¾åŒºè®¨è®ºï¼›
    - 3. æäº¤ä¼˜åŒ–åçš„ææ¡ˆï¼›
    - 4. Risk Team å¯¹å…¶è¿›è¡Œé£é™©è¯„ä¼°ï¼›

- æŠ•ç¥¨é˜¶æ®µ

    - ä¸€ä¸ª MKR Token è¡¨ç¤ºä¸€ä¸ªæŠ•ç¥¨æƒï¼Œå¯ä»¥ä»£ç†ï¼›
    - æŠ•ç¥¨æœŸä¸€èˆ¬æŒç»­ 7 å¤©ï¼›
    - æ ¹æ®æŠ•ç¥¨ç»“æœå†³å®šæ˜¯å¦é€šè¿‡ï¼›ï¼ˆ4% åŒæ„ï¼‰

**Surplus Auction**

- Maker Buffer Limit
- è¶…å‡ºé™åˆ¶åçš„ DAI ç”¨æ¥æ‹å–è´­ä¹° MKR
- é”€æ¯ MKR
- ä¸€ç§ç¤¾åŒºæ²»ç†çš„å¥–åŠ±æ–¹å¼

ç”¨æˆ·å‚ä¸ä¸€äº›åè®®çš„è´¨æŠ¼ï¼Œå¯ä»¥ç”¨æ¥åŠ æ æ†ï¼Œä¾‹å¦‚æœ‰ 1 ETHï¼Œå€Ÿå‡ºæ¥ä¸€äº›å¸æ‹¿æ¥ä¹° ETHï¼Œå†æŠŠä¹°æ¥çš„ ETH æ”¾è¿›å»å€Ÿé’±ï¼Œä¾æ¬¡é‡å¤ã€‚

> ğŸ’¡ åœ¨å­¦ä¹ ä¸€ç§æ–°çš„åè®®æ—¶ï¼Œéƒ½è¦æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼šä¸ºä»€ä¹ˆåˆ«äººæ„¿æ„æ¥å‚ä¸ä½ çš„åè®®ï¼Ÿ

![7](../../assets/images/defi_course_2024_edition/7.png)

**æ€»ç»“ï¼š**

- ç¨³å®šå¸è¯ç”Ÿçš„åŸå› ï¼›
- ç¨³å®šå¸çš„ç±»å‹ï¼šUSDT/USDC/BUSD/DAI/AMPLï¼›
- USDT çš„ä¸­å¿ƒæ€§ï¼›
- DAI çš„è¿è¡ŒåŸç†ï¼›
- Maker Protocol ä¸­çš„æ¸…ç®—ï¼›
- AMPL çš„è¿è¡ŒåŸç†ï¼›

## ç¬¬ 4 è¯¾ - ERC4626

**Vault**

- èµ„äº§çš„ç®¡ç†ã€åˆ†çº¢
- ç”¨æˆ·å……å€¼æŸé¡¹èµ„äº§ï¼Œè·å–æŸä¸ªå‡­è¯
- è¯¥å‡­è¯ä½œä¸ºåˆ†çº¢ã€é€€å‡ºçš„ä¾æ®
- Yield Farming / å€Ÿè´· / è´¨æŠ¼ç­‰

https://eips.ethereum.org/EIPS/eip-4626

> ğŸ’¡ å»ºè®®ç ”ç©¶ ERC20 ææ¡ˆçš„åŸå§‹å†…å®¹ã€‚

EIP ä»æƒ³æ³•åˆ°è½åœ°çš„æµç¨‹ï¼š

1. äº§ç”Ÿä¸€ä¸ªæƒ³æ³•ï¼›
2. æå‡º Proposalï¼›
3. è®¨è®ºé€šè¿‡åæ­£å¼æˆä¸ºæ ‡å‡†ï¼›
4. ç¬¬ä¸‰æ–¹åº“ï¼ˆä¾‹å¦‚ OpenZeppelinï¼‰æ ¹æ®è¿™ä¸ªæ ‡å‡†å»å®ç°ï¼›
5. å¼€å‘è€…ä½¿ç”¨ã€‚

## ç¬¬ 5 è¯¾ - ERC4626ï¼ˆäºŒï¼‰

æœ¬èŠ‚è¯¾ç®€ç•¥è¿‡äº†ä¸€é ERC4626 çš„å®ç°ç»†èŠ‚ï¼Œæ­¤å¤„çœç•¥ã€‚

## ç¬¬ 6 & 7 è¯¾ - å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€

DeFi é¢†åŸŸçš„ä¸‰å¤§æ”¯æŸ±ï¼šç¨³å®šå¸ã€äº¤æ˜“æ‰€ã€å€Ÿè´·ã€‚

**äº¤æ˜“æ‰€ï¼š**

- è¯åˆ¸äº¤æ˜“æ‰€
- æœŸè´§äº¤æ˜“æ‰€
- åŠ å¯†èµ„äº§äº¤æ˜“æ‰€

    - ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€
    - å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€

2017 å¹´ 9 æœˆ 4 æ—¥ï¼Œä¸ƒéƒ¨é—¨è”åˆå‘å¸ƒã€Šå…³äºé˜²èŒƒä»£å¸å‘è¡Œèèµ„é£é™©çš„å…¬å‘Šã€‹ï¼Œç„¶å Binance å‡ºæµ·äº†ï¼Œä½†æ˜¯ OKX æ€»éƒ¨å´è¿˜åœ¨åŒ—äº¬ï¼Œç”šè‡³å‘è¡Œäº† OKX tokenã€‚

ä» 2020 å¹´å¼€å§‹æœ‰ DEX è¿™ä¸ªèµ›é“ã€‚

**ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€çš„ä¸šåŠ¡æ¨¡å¼â€”â€”ä»¥å¸å®‰ä¸ºä¾‹**

- **äº¤æ˜“è´¹**ï¼šäº¤æ˜“æ‰€é€šè¿‡æä¾›ä¹°å–åŠ å¯†è´§å¸çš„å¹³å°æ¥æ”¶å–äº¤æ˜“è´¹ç”¨ã€‚æœ‰äº›äº¤æ˜“æ‰€è¿˜æä¾›é«˜çº§äº¤æ˜“é€‰é¡¹ï¼Œå¦‚æ æ†äº¤æ˜“ï¼Œè¿™é€šå¸¸ä¼šå¸¦æ¥æ›´é«˜çš„è´¹ç”¨ï¼›
- **ä¸Šå¸è´¹**ï¼šé¡¹ç›®æ–¹å›¢é˜Ÿåé¢éƒ½ä¼šå»æ‰¾äº¤æ˜“æ‰€ä¸Šå¸ï¼Œç„¶è€Œä¸Šå¸éœ€è¦ç¼´çº³ä¸€ç¬”æ•°é¢ä¸å°çš„ä¸Šå¸è´¹ï¼›
- **é‡åŒ–äº¤æ˜“**ï¼šç”¨æˆ·åœ¨äº¤æ˜“æ‰€ä¸­ï¼Œä¸€èˆ¬æ•°å­—èµ„äº§éƒ½æ˜¯æš‚æ—¶å­˜æ”¾åœ¨äº¤æ˜“æ‰€ï¼ŒåŸºæœ¬ä¸Šäº¤æ˜“æ‰€æŒæ¡æ‰€æœ‰ç­¹ç å¯ä»¥é€‰æ‹©åšå¤šæˆ–è€…åšç©ºï¼Œäº¤æ˜“æ‰€å¯ä»¥å»èµšå–å·®ä»·ï¼Œè€Œç”¨æˆ·æå¸å‡ºå»ä¹Ÿèƒ½èµšå–æ‰‹ç»­è´¹ï¼›
- **åŸç”Ÿä»£å¸**ï¼›

> ğŸ’¡ æ¢è€å¸ˆä¸¾äº†ä¸ªä¾‹å­ï¼šè‡ªå·±äº†è§£åˆ°çš„ä¸€ä¸ªé¡¹ç›®ï¼Œ2017 å¹´å·¦å³ä¸ºäº†ä¸Šå‰ä¸‰çš„äº¤æ˜“æ‰€ï¼Œä¸Šå¸è´¹ä¸º 1100 ä¸‡äººæ°‘å¸ï¼ˆè´­ä¹°äº¤æ˜“æ‰€å‘è¡Œçš„åŸç”Ÿä»£å¸ï¼Œå‚ä¸æŠ•ç¥¨ç«é€‰ï¼‰ã€‚é¡¹ç›®æ–¹å®‰å…¨å®¡è®¡è¦èŠ±é’±ï¼Œä¸Šäº¤æ˜“æ‰€ä¹Ÿè¦èŠ±é’±ï¼Œè€Œä¸”è¿˜å¾—é€šè¿‡å†…éƒ¨å…³ç³»ï¼Œç†Ÿäººæ‰è¡Œã€‚äº¤æ˜“æ‰€ç‰¹åˆ«èµšé’±ã€‚

![8](../../assets/images/defi_course_2024_edition/8.png)

**ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€çš„äº¤æ˜“æ¨¡å¼â€”â€”è®¢å•ç°¿æ¨¡å¼**

- ä¸­å¤®é™ä»·è®¢å•ç°¿ï¼ˆCLOBï¼‰å°±æ˜¯ä¸€æœ¬ç”±å‡ºä»·å’ŒæŠ¥ä»·ç»„æˆçš„å®Œå…¨é€æ˜è´¦æœ¬ï¼Œä»æœ€ä¼˜ä»·å¼€å§‹ä¾æ¬¡æ’åºï¼ˆä¸¤è¾¹åˆ†åˆ«æ˜¯å‚ä¸è€…æ„¿æ„ä¹°/å–çš„ä»·æ ¼ï¼‰ã€‚
- æ‰€æœ‰çš„å‚ä¸è€…éƒ½èƒ½çœ‹åˆ°æ‰€æœ‰çš„æŠ¥ä»·å’Œå‡ºä»·ï¼Œä»–ä»¬ä¹Ÿå¯ä»¥å‚ä¸å…¶ä¸­ã€‚
- è®¢å•ç°¿ä¸­ä¸¤è¾¹çš„ç¬¬ä¸€è¡Œï¼Œå³æ˜¯æœ€ä¼˜çš„æŠ¥ä»·/å‡ºä»·ã€‚

**è®¢å•ç°¿æ¨¡å¼çš„ä¼˜åŠ£**

ä¼˜åŠ¿ï¼š

- é€æ˜çš„æµåŠ¨æ€§
- åšå¸‚å•†å¯è‡ªç”±å‡ºå…¥
- åšå¸‚å•†å¯ä»¥è‡ªç”±å†³å®šä»·æ ¼ä¸æ•°é‡

åŠ£åŠ¿ï¼š

- å†·å¯åŠ¨é—®é¢˜ï¼ˆå¾ˆéš¾ç»™å‡ºåˆå§‹æµåŠ¨æ€§ï¼‰
- å¯¹éæµåŠ¨æ€§èµ„äº§ä¸åˆ©
- å¦‚æœæ˜¯é“¾ä¸Šäº¤æ˜“æ‰€ï¼Œåˆ™å¯¹é“¾çš„ TPS çš„è¦æ±‚å¾ˆé«˜

äº¤æ˜“æ‰€åˆšå¼€å§‹çš„æ—¶å€™éœ€è¦å¾ˆå¤§çš„èµ„é‡‘é‡ï¼Œç”¨æˆ·ç©çš„é¡ºç•…ï¼Œæ‰ä¼šå¸å¼•æ›´å¤šç”¨æˆ·è¿‡æ¥ã€‚

æ—©æœŸå»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ä½¿ç”¨è®¢å•ç°¿çš„æ¨¡å¼ï¼Œä½†ç”±äºé“¾ä¸Š TPS å¤ªä½ï¼Œæ²¡æœ‰å‘å±•èµ·æ¥ã€‚

![9](../../assets/images/defi_course_2024_edition/9.png)

**é“¾ä¸Šäº¤æ˜“æ–¹æ¡ˆï¼šè‡ªåŠ¨åšå¸‚å•†**

- å‡ºç°åŸå› ï¼šä»¥å¤ªåŠçš„ TPS å¯¹äºæ”¯æ’‘é“¾ä¸Šè®¢å•ç°¿çš„å®æ—¶æ›´æ–°æ¥è¯´å¤ªä½äº†ã€‚åé¢æ¡ˆä¾‹ï¼šSolana é“¾ç”±äºå…¶ 60K çš„ TPSï¼Œå…¶ä¸Šæœ‰è®¸å¤šè®¢å•ç°¿æ¨¡å¼çš„äº¤æ˜“æ‰€ã€‚
- äº¤æ˜“æ‰€é‡Œæ²¡æœ‰è®¢å•ç°¿ï¼Œåªæœ‰ä¸€ç³»åˆ—é¢„è®¾çš„å‡½æ•°ï¼Œä¸ºå„ç±»è´§å¸çš„äº’ç›¸äº¤æ¢æ¥å®šä»·ã€‚
- è¿™äº›é¢„è®¾çš„å‡½æ•°ï¼ˆä¾‹å¦‚ x*y=kï¼‰åŸºäºä¸¤ç§è´§å¸åœ¨å„è‡ªæµåŠ¨æ€§æ± ä¸­çš„ä¾›ç»™å˜åŒ–ç‡æ¥è®¾å®šä»·æ ¼ã€‚åœ¨æŸä¸ªè´§å¸çš„æµåŠ¨æ€§æ± å†…ï¼Œä»»ä½•äººéƒ½èƒ½å¤Ÿæä¾›è¯¥ç§è´§å¸ä»¥å¢åŠ å…¶æµåŠ¨æ€§ï¼Œä»è€Œè·å¾—æ”¶ç›Šã€‚

![10](../../assets/images/defi_course_2024_edition/10.png)

ä¸¤ä¸ªä»£å¸æ•°é‡çš„ä¹˜ç§¯ç­‰äºä¸€ä¸ªå¸¸é‡ã€‚

Vaultï¼šæ”¾ä¸€äº›å¸è¿›å»ï¼Œè¿”å›ä¸€ä¸ª shareï¼Œè¡¨ç¤ºæ”¾è¿›å»çš„å‡­è¯ã€‚

ç”¨æˆ·å°†æµåŠ¨æ€§æ”¾åˆ°ä¸€ä¸ªäº¤æ˜“æ± é‡Œï¼Œäº¤æ˜“æ± ä¼šç»™ç”¨æˆ·å‘è¡Œä¸€ä¸ªæ–°çš„ Tokenï¼Œå« Liquidity Provider Tokenï¼ˆLPTï¼‰ã€‚

åªè¦æœ‰ä»·å·®ï¼Œå°±æœ‰å¥—åˆ©ç©ºé—´ï¼Œå°±ä¼šè¢«å¥—åˆ©æœºå™¨äººåƒæ‰ã€‚

![11](../../assets/images/defi_course_2024_edition/11.png)

![12](../../assets/images/defi_course_2024_edition/12.png)

**DEX çš„å»ä¸­å¿ƒåŒ–ï¼š**

- ä»»ä½•äººéƒ½å¯ä»¥æ·»åŠ æµåŠ¨æ€§ï¼Œæˆä¸º LPï¼Œå¹¶æ‹¿åˆ° LP Tokenï¼›
- LP åœ¨ä»»æ„æ—¶é—´å¯ä»¥ç§»é™¤æµåŠ¨æ€§å¹¶é”€æ¯ LP Tokenï¼Œæ‹¿å›è‡ªå·±æ·»åŠ çš„ Tokenï¼›
- ç”¨æˆ·å¯ä»¥ä½¿ç”¨éå®˜æ–¹çš„å‰ç«¯é¡µé¢æ¥è¿›è¡Œäº¤æ˜“ï¼›
- äº¤æ˜“æ—¶æ”¶å–ä¸€å®šæ‰‹ç»­è´¹ï¼Œå¹¶ä¸”åˆ†é…ç»™ LPT Holderï¼›

æä¾› LP å¯èƒ½äºæŸï¼Œéœ€è¦æ‰¿æ‹…æ— å¸¸æŸå¤±çš„é£é™©ã€‚

**è‡ªåŠ¨åŒ–åšå¸‚æ¨¡å¼çš„ä¼˜åŠ£ï¼š**

- **ä¼˜åŠ¿ï¼š**

    - å¯¹äºæ–°çš„ä»£å¸ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å†·å¯åŠ¨
    - å»ä¸­å¿ƒåŒ–
    - ä»£å¸äº¤æ¢å¯ç»„åˆæ€§å¾ˆé«˜

- **åŠ£åŠ¿ï¼š**

    - æ‰€æœ‰ä»·æ ¼ç‚¹çš„ç»Ÿä¸€æµåŠ¨æ€§ï¼ˆåœ¨ Uniswap V3 ä¸­å·²è§£å†³ï¼‰
    - æ»‘ç‚¹é¢‘ç¹
    - æ³¢åŠ¨æ€§å¤§ï¼Œç»å¸¸æœ‰å¾ˆå¤§çš„æ— å¸¸æŸå¤±ï¼ˆæµåŠ¨æ€§æä¾›è€…åœ¨å¹³å‡è¡¨ç°ä¸Šæ˜¯ç›ˆåˆ©çš„ï¼‰

![13](../../assets/images/defi_course_2024_edition/13.png)

éœ€è¦ç†è§£çš„æ˜¯ï¼Œå¦‚ä½•åŸºäº x*y=k è¿™ä¸ªå…¬å¼æ¥å®Œæˆæ·»åŠ æµåŠ¨æ€§ã€Swapã€ç§»é™¤æµåŠ¨æ€§è¿™ä¸‰ä¸ªæ“ä½œä»¥åŠé‡Œé¢çš„ä¸€äº›è®¡ç®—ç»†èŠ‚ã€‚å†™ä¸€ä¸ª CPAMM åˆçº¦ï¼ŒToken å¦‚ä½•æä¾›ï¼Œæä¾› Token ä¹‹åå¦‚ä½•æŠŠ share è¿”å›ç»™ç”¨æˆ·ï¼Œå…·ä½“æ€ä¹ˆè®¡ç®—ï¼Œswap æ˜¯æ€ä¹ˆç®—çš„ï¼Œç§»é™¤æµåŠ¨æ€§æ˜¯æ€ä¹ˆç®—çš„ã€‚

æ·»åŠ æµåŠ¨æ€§ä¼šä¸ä¼šå½±å“ä»·æ ¼ï¼Ÿ

![14](../../assets/images/defi_course_2024_edition/14.png)

![15](../../assets/images/defi_course_2024_edition/15.png)

![16](../../assets/images/defi_course_2024_edition/16.png)

æˆ‘ä»¬å¸Œæœ›æµåŠ¨æ€§çš„ä½“ç°å’Œæ·»åŠ çš„æ•°é‡æˆä¸€ä¸ªçº¿æ€§å…³ç³»ã€‚

![17](../../assets/images/defi_course_2024_edition/17.png)

![18](../../assets/images/defi_course_2024_edition/18.png)

![19](../../assets/images/defi_course_2024_edition/19.png)

![20](../../assets/images/defi_course_2024_edition/20.png)

å¦‚æœæ± å­å¾ˆæµ…ï¼Œå°±ä¼šäº§ç”Ÿå¾ˆé«˜çš„æ»‘ç‚¹ã€‚

### ChatGPT è¡¥å……ï¼šä¸ºä»€ä¹ˆéœ€è¦é“¾ä¸Šè‡ªåŠ¨åšå¸‚å•†ï¼Ÿ

åœ¨ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ï¼ˆBinanceã€Coinbase ç­‰ï¼‰ä¸­ä½¿ç”¨è®¢å•ç°¿æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼éœ€è¦ï¼š

- **é«˜é¢‘è®¢å•æ›´æ–°**ï¼šä¹°æ–¹å’Œå–æ–¹ä¸æ–­åœ°æŒ‚å‡ºä¹°å…¥å’Œå–å‡ºè®¢å•ï¼›
- **å¼ºå¤§çš„æ’®åˆå¼•æ“**ï¼šä¸€ä¸ªé«˜é€Ÿã€ä¸­å¿ƒåŒ–çš„æœåŠ¡å™¨æ¥å®æ—¶åŒ¹é…è¿™äº›ä¹°å•å’Œå–å•ï¼›
- **åšå¸‚å•†**ï¼šä¸“ä¸šçš„æœºæ„æˆ–ä¸ªäººæä¾›æµåŠ¨æ€§ï¼Œé€šè¿‡ä¸æ–­æŠ¥ä»·æ¥ç¼©å°ä¹°å–ä»·å·®ï¼Œè®©å¸‚åœºæ›´é«˜æ•ˆï¼›

å¦‚æœç›´æ¥æŠŠè®¢å•ç°¿æ¬åˆ°åŒºå—é“¾ä¸Šï¼ˆå³é“¾ä¸Šè®¢å•ç°¿ï¼‰ï¼Œä¼šé‡åˆ°ä¸€äº›é—®é¢˜ï¼š

ï¼ˆ1ï¼‰æ€§èƒ½ç“¶é¢ˆä¸é«˜æ˜‚æˆæœ¬ï¼šåŒºå—é“¾ï¼ˆå°¤å…¶æ˜¯æ—©æœŸçš„ä»¥å¤ªåŠï¼‰é€Ÿåº¦æ…¢ã€ååé‡ä½ï¼Œæ¯ä¸€ç¬”æŒ‚å•ã€æ’¤å•ã€åŒ¹é…äº¤æ˜“éƒ½éœ€è¦æ”¯ä»˜ Gas è´¹ï¼Œå¹¶éœ€è¦å…¨ç½‘èŠ‚ç‚¹ç¡®è®¤ã€‚è®¢å•ç°¿éœ€è¦ä¸æ–­åœ°æŒ‚å•ã€æ’¤å•ã€ä¿®æ”¹è®¢å•ã€æ’®åˆäº¤æ˜“ï¼Œæ¯ä¸€ç¬”äº¤æ˜“éƒ½éœ€è¦æ”¯ä»˜ Gas è´¹ï¼Œä¸€æ—¦ç½‘ç»œæ‹¥å µï¼ŒGas è´¹é£™å‡ï¼›

ï¼ˆ2ï¼‰åŒºå—é“¾å»¶è¿Ÿé«˜ï¼šä¸­å¿ƒåŒ–äº¤æ˜“æ‰€çš„æ’®åˆå»¶è¿Ÿæ˜¯å¾®ç§’çº§ï¼Œè€Œé“¾ä¸Šçš„äº¤æ˜“å»¶è¿Ÿè¿œæ— æ³•è¾¾åˆ° CEX æ°´å¹³ï¼Œé«˜å»¶è¿Ÿ + æ— æ³•å®æ—¶æ’®åˆ â†’ è®¢å•æ·±åº¦ä¼šå˜å¾—éå¸¸å·®ï¼›

ï¼ˆ3ï¼‰é“¾ä¸Šè®¢å•ç°¿æ˜“è¢« MEV æŠ¢è·‘ï¼šé“¾ä¸Šè®¢å•ç°¿çš„è®¢å•éƒ½æ˜¯å…¬å¼€çš„ï¼ŒMEV bot å¯ä»¥çœ‹åˆ°ä½ çš„è®¢å•å¹¶ç›´æ¥æŠ¢è·‘ï¼Œå¯¼è‡´ç”¨æˆ·æŒç»­å—åˆ°æŸå¤±ï¼Œè¿™ä¼šè®©è®¢å•ç°¿ä½“éªŒæå·®ï¼›

ï¼ˆ4ï¼‰å°å‹é•¿å°¾ä»£å¸æ²¡æœ‰åšå¸‚å•†ï¼šåœ¨ä¸­å¿ƒåŒ–äº¤æ˜“ä¸­ï¼Œä¸“ä¸šåšå¸‚å•†è´Ÿè´£æŒ‚ä¹°å•/å–å•ç»´æŒæ·±åº¦ï¼Œä¾èµ–äºé«˜é¢‘äº¤æ˜“å’Œå¤æ‚çš„ç®—æ³•ã€‚é“¾ä¸Šæ“ä½œæˆæœ¬é«˜ï¼Œæ²¡æœ‰äººä¼šä¸»åŠ¨ç»™æ–°ä»£å¸æŒ‚å•åšæ·±åº¦ï¼Œå¯¼è‡´æ·±åº¦å·®ã€æ»‘ç‚¹å·¨å¤§ã€æ— æ³•äº¤æ˜“ï¼Œæ— æ³•å®ç°"äººäººå¯å‘å¸"çš„å»ä¸­å¿ƒåŒ–ç”Ÿæ€ã€‚

ç›´æ¥å°†ä¼ ç»Ÿé‡‘èçš„è®¢å•ç°¿æ¨¡å¼å¤åˆ¶åˆ°åŒºå—é“¾ä¸Šï¼Œåœ¨æŠ€æœ¯å’Œç»æµä¸Šéƒ½æ˜¯ä¸å¯è¡Œçš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå…¨æ–°çš„ã€ä¸ºåŒºå—é“¾åŸç”Ÿè®¾è®¡çš„äº¤æ˜“æ¨¡å¼ã€‚

AMM çš„ç†å¿µéå¸¸ç®€å•ä½†é©å‘½æ€§ï¼š**è®©æµåŠ¨æ€§æ± ï¼ˆLiquidity Poolï¼‰è‡ªåŠ¨æŠ¥ä»·ï¼Œæ— éœ€è®¢å•ç°¿æˆ–åšå¸‚å•†ã€‚**

ä¾‹å¦‚ Uniswap çš„ x*y=k æ¨¡å‹ï¼š

- ç”¨æˆ·æŠŠ Token A å’Œ Token B å­˜è¿›æ± å­
- æ± å­ç”¨å…¬å¼è‡ªåŠ¨ç»™å‡ºä»·æ ¼
- å’Œæ± å­äº¤æ˜“å³å¯ï¼Œä¸éœ€è¦å¯¹æ‰‹ç›˜

AMM æœ¬è´¨ä¸Šï¼š

- **ç”¨ç®—æ³•æä¾›æµåŠ¨æ€§**
- **ç”¨ä»£å¸æ± å­æ›¿ä»£è®¢å•ç°¿**
- **ç”¨ LPï¼ˆæµåŠ¨æ€§æä¾›è€…ï¼‰æ›¿ä»£ä¸“ä¸šåšå¸‚å•†**

## ç¬¬ 8 è¯¾ - Uniswap ç®€ä»‹

![21](../../assets/images/defi_course_2024_edition/21.png)

On Path Independenceï¼šhttps://vitalik.eth.limo/general/2017/06/22/marketmakers.html

A Short History of Uniswapï¼šhttps://blog.uniswap.org/uniswap-history

Uniswap Whitepaper V1ï¼šhttps://hackmd.io/@HaydenAdams/HJ9jLsfTz

**Uniswap V1ï¼š**

- 2018 å¹´ 11 æœˆ 2 æ—¥å‘å¸ƒï¼›
- ä½¿ç”¨ Vyper è¯­è¨€ç¼–å†™ï¼›
- ä»…æ”¯æŒ ERC20-ETH ç›´æ¥äº’æ¢æˆ–è€…é€šè¿‡ ETH è¿›è¡Œäº’æ¢ï¼ˆChained-swapï¼‰ï¼›
- åˆçº¦åœ°å€ï¼šhttps://github.com/Uniswap/v1-contracts/tree/master/contracts

![22](../../assets/images/defi_course_2024_edition/22.png)

Vitalik çš„"On Path Independence"æ˜¯ 2017 å¹´ 6 æœˆä»½å‘è¡¨çš„ï¼Œ2018 å¹´ 11 æœˆæ‰æœ‰äººæ­£å¼åœ°ç”¨äº”å…­ç™¾è¡Œä»£ç æŠŠæ–‡ç« çš„ä¸»è¦æ€æƒ³å®ç°å‡ºæ¥ã€‚ç°åœ¨è§‰å¾—å¾ˆç®€å•ï¼Œä½†å›å¤´çœ‹çš„è¯ï¼Œä¹Ÿä¸å¤ªå®¹æ˜“ã€‚å¥½æ¯”ä¸‡æœ‰å¼•åŠ›å…¬å¼ï¼Œç°åœ¨çœ‹å¾ˆç®€å•ï¼Œä½†å‰äººå‘ç°è¿™ä¸ªå…¬å¼ç”¨äº†å‡ ç™¾å¹´ã€‚

Uniswap v2 Overviewï¼šhttps://blog.uniswap.org/uniswap-v2ã€March 23, 2020ã€‘

**Uniswap V2ï¼š**

- 2020 å¹´ 5 æœˆå‘å¸ƒï¼›
- å¢åŠ  ERC20 - ERC20 ç›´æ¥äº’æ¢ï¼›
- å¢åŠ  Flash Swapï¼›
- å¢åŠ  Oracleï¼›
- æ”¹è¿›æ‰‹ç»­è´¹æ”¶å–æ–¹å¼ï¼›
- å¼•çˆ†äº† DeFi èµ›é“ï¼›
- 2020 å¹´ 9 æœˆï¼Œå‘è¡Œæ²»ç†ä»£å¸ UNIï¼›

2020 å¹´ 5 æœˆä»½ Uniswap V2 å‘å¸ƒï¼Œå¼•çˆ†äº† DeFi èµ›é“ã€‚

Sushi å…‹éš† Uniswap æºç ï¼ŒYield Farmingï¼Œå¸è¡€æ”»å‡»ï¼Œå¯¼è‡´ Uniswap ç©ºæŠ• UNIã€‚

> ğŸ’¡ åŒºå—é“¾åœˆï¼Œä¸è¦å…‰å…³æ³¨æŠ€æœ¯å’Œäº§å“é€»è¾‘ï¼Œä»…ä»…åªæ˜¯å…«å¦å°±å¯ä»¥å‘ç°å¾ˆå¤šç´ æï¼Œæ¯ä¸€ä¸ªæ–°é—»èƒŒåéƒ½æœ‰æ•…äº‹ã€‚

**Uniswap V2 çš„æ ¸å¿ƒåˆçº¦**

- Uniswap V2 Core

    - UniswapV2Pair.sol
    - UniswapV2Factory.sol

- Uniswap V2 Periphery

    - Router contract
    - Library contract

**Uniswap vs SushiSwap**

- 2020 å¹´ 8 æœˆ 28 æ—¥ï¼ŒSushiSwap å‘å¸ƒï¼›
- SushiSwap fork äº† Uniswapï¼Œå¹¶ä¸”åšäº†ä¸€äº›æ”¹è¿›ï¼›
- SushiSwap å¢åŠ äº†å¥–åŠ±ç³»ç»Ÿï¼Œä» Uniswap å¸å¼•èµ°è®¸å¤šæµåŠ¨æ€§ï¼›
- ä½œä¸ºå›å‡»ï¼Œ2020 å¹´ 9 æœˆ Uniswap å®£å¸ƒå‘è¡Œ UNI ä½œä¸ºæ²»ç†ä»£å¸ï¼›

Introducing Uniswap v3ï¼šhttps://blog.uniswap.org/uniswap-v3ã€March 23, 2021ã€‘

**Uniswap V3**

- 2021 å¹´ 3 æœˆï¼ŒUniswap V3 å‘å¸ƒï¼›
- ä¸»è¦ç‰¹æ€§ï¼š

    - å¢åŠ é›†ä¸­æµåŠ¨æ€§ï¼›
    - ä¼˜åŒ–æ‰‹ç»­è´¹è®¾ç½®ï¼›
    - LPT æ”¹æˆåŸºäº NFT çš„ Liquidity Tokenï¼›
    - æ”¹è¿›å¼€æºåè®®ï¼›

V2 çš„æµåŠ¨æ€§æ²¡æœ‰é›†ä¸­ï¼Œä»»ä½•ä»·æ ¼éƒ½è¦†ç›–ï¼Œä½†å…¶å®ä¸€ä¸ª Token çš„æ³¢åŠ¨é€šå¸¸åªå±€é™äºä¸€ä¸ªèŒƒå›´ï¼Œåœ¨èŒƒå›´ä¹‹å¤–åšæµåŠ¨æ€§æ˜¯æµªè´¹çš„ã€‚

V2 ä¸­æ·»åŠ æµåŠ¨æ€§è·å¾—çš„ share æ˜¯ ERC20 ç‰ˆæœ¬ï¼Œåœ¨ V3 ä¸­æ˜¯ NFTã€‚æœ‰äº†é›†ä¸­æµåŠ¨æ€§åï¼Œæ¯ä¸ªäººæ·»åŠ çš„ä»·æ ¼èŒƒå›´å¯èƒ½ä¸ä¸€æ ·ï¼Œä¾‹å¦‚ A æ·»åŠ  ETH æµåŠ¨æ€§çš„åŒºé—´æ˜¯ 2800~3200\$ï¼Œè€Œ B æ˜¯ 3600~4000\$ã€‚

V2 æºç è¢«å…‹éš†æŠ„è¢­ï¼ŒV3 æºç åè®®ä¸å…è®¸å…‹éš†å•†ç”¨ï¼Œæœ‰æ•ˆæœŸ 2 å¹´ã€‚

Our Vision for Uniswap v4ï¼šhttps://blog.uniswap.org/uniswap-v4ã€June 13, 2023ã€‘

ã€è¡¥å……ã€‘UNIficationï¼šhttps://blog.uniswap.org/unificationã€November 10, 2025ã€‘

**Uniswap V4**

- 2023 å¹´ 6 æœˆ 23 æ—¥å‘å¸ƒä»£ç è‰æ¡ˆï¼›
- æ–°å¢ä¸»è¦ç‰¹æ€§ï¼š

    - Hook
    - Singleton Pool Manager Design
    - Reintroduction of Native ETH
    - Flash Accounting

- ç›®æ ‡ï¼šæ›´å¿«ã€æ›´çœ Gas Feeï¼Œå®¹æ˜“é›†æˆï¼›æˆä¸º DeFi é¢†åŸŸçš„åŸºç¡€è®¾æ–½ï¼›

Hook çš„åº”ç”¨ä¸¾ä¾‹ï¼šåœ¨æ¯ä¸€æ¬¡ swap å‰éªŒè¯ KYCï¼›åƒè‚¡ç¥¨äº¤æ˜“æ‰€ä¸€æ ·è®¾ç½®äº¤æ˜“æ—¶é—´é™åˆ¶ï¼ˆèŠ‚å‡æ—¥ã€å‘¨æœ«åœç›˜ï¼‰ã€‚

åœ¨ V2 ä¸­åªæ”¯æŒ ERC20 ä¹‹é—´çš„è½¬æ¢ï¼ŒETH ä¸å…¶ä»– ERC20 Token çš„è½¬æ¢éƒ½éœ€è¦å…ˆæ¢æˆ WETHï¼ˆå³ ETH çš„ ERC20 ç‰ˆæœ¬ï¼‰ï¼ŒV4 ä¸­æŠŠåŸç”Ÿ ETH æ‹‰å›æ¥äº†ã€‚

DeFi é¢†åŸŸæœ‰å¾ˆå¤šä¸œè¥¿å¯ä»¥åƒæ­ç§¯æœ¨ä¸€æ ·å åŠ ï¼ŒæŠŠåˆ«äººåšå¥½çš„ä¸œè¥¿ä½œä¸ºè‡ªå·±åº”ç”¨çš„ä¸€ä¸ªæ¨¡å—ã€‚Uniswap V4 å°±æƒ³å¾€è¿™æ–¹é¢å‘å±•ï¼Œæˆä¸º DeFi é¢†åŸŸçš„åŸºç¡€è®¾æ–½ã€‚

Pancakeswap æ˜¯ BSC ä¸Šæœ€å¤§çš„ DEXã€‚

**Uniswap VS Binance**

- æ— é¡»å®åè®¤è¯
- ä»£ç å¼€æº
- ä¸Šå¸ä¸æ”¶è´¹
- ç”¨æˆ·è‡ªå·±ç®¡ç†èµ„é‡‘ï¼Œä¸ç”¨æ‰˜ç®¡åˆ°äº¤æ˜“æ‰€
- ç¤¾åŒºæ²»ç†

Not your keys, not your coins.

## ç¬¬ 9 è¯¾ - Uniswap V2 çš„æ‰‹ç»­è´¹è®¡ç®—

Uniswap V2 Whitepaperï¼šhttps://uniswap.org/whitepaper.pdf

åœ¨ Uniswap V1 ä¸­ï¼Œæ¯ä¸€ç¬”äº¤æ˜“å°±æ‰£ä¸€ä¸ªæ‰‹ç»­è´¹ã€‚

> ğŸ’¡ æ¢è€å¸ˆæåˆ°ç™½çš®ä¹¦ä¸­çš„ Chapter 2.4 èŠ‚æœ‰ç‚¹éš¾ç†è§£ã€‚

**é€šè¿‡å¢å‘ share çš„æ–¹å¼æŠŠæ‰‹ç»­è´¹ç»™é¡¹ç›®æ–¹**

![23](../../assets/images/defi_course_2024_edition/23.png)

é€šè¿‡ä½¿ $S_1$ å¢å€¼çš„æ–¹å¼æŠŠæ‰‹ç»­è´¹ç»™ LP

![24](../../assets/images/defi_course_2024_edition/24.png)

**é¡¹ç›®æ–¹æƒ³åˆ†èµ°æ‰‹ç»­è´¹é‡Œçš„ä¸€å®šæ¯”ä¾‹**

![25](../../assets/images/defi_course_2024_edition/25.png)

![26](../../assets/images/defi_course_2024_edition/26.png)



| æ–¹å¼                     | è°æ‹¿èµ° swap äº§ç”Ÿçš„ä»·å€¼å¢åŠ ï¼Ÿ   | share æ˜¯å¦å¢å‘ï¼Ÿ | Uniswap æ˜¯å¦é‡‡ç”¨ï¼Ÿ       |
| ------------------------ | ------------------------------ | ---------------- | ------------------------ |
| 1. å¢å‘ share â†’ ç»™é¡¹ç›®æ–¹ | é¡¹ç›®æ–¹æ‹¿æ‰‹ç»­è´¹ï¼ˆprotocol feeï¼‰ | æ˜¯ï¼Œmint LPT     | âœ”ï¼ˆV2 feeTo æ¨¡å¼ï¼‰       |
| 2. Sâ‚ å¢å€¼ â†’ ç»™ LP       | å…¨éƒ¨æ‰‹ç»­è´¹ç»™ LP                | å¦               | âœ”ï¼ˆé»˜è®¤æ—  protocol feeï¼‰ |
| 3. æŠ½èµ° Ï† æ¯”ä¾‹           | Ï† ç»™é¡¹ç›®æ–¹ï¼Œ1âˆ’Ï† ç»™ LP          | æ˜¯               | âœ”ï¼ˆV2 æ”¯æŒ Ï† = 1/6ï¼‰     |

ä¸‰è€…æ˜¯åŒä¸€å¥—æ•°å­¦ï¼Œç”¨ä¸åŒè§†è§’è¡¨è¾¾ã€‚

å‚è€ƒèµ„æ–™ï¼š[How Uniswap V2 computes the mintFee](https://www.rareskills.io/post/uniswap-v2-mintfee)

> ğŸ’¡ æ”¶å–æ‰‹ç»­è´¹ä¸æ˜¯åœ¨ swap æ—¶æ”¶ï¼Œè€Œæ˜¯åœ¨æ·»åŠ å’Œç§»é™¤æµåŠ¨æ€§æ—¶æ”¶ï¼Œå¸¦æ¥ shares æ€»é‡çš„ mint æˆ–è€… burnã€‚

## ç¬¬ 10 è¯¾ - Uniswap V2 é‡Œçš„ TWAP

> æœ¬èŠ‚è¯¾ç¨‹åŒ…å«è¾ƒå¤šä»£ç æ¼”ç¤ºã€‚

Uniswap V2 é“¾ä¸Šä»·æ ¼é¢„è¨€æœº

ã€GPT-4oã€‘TWAPï¼ˆTime-Weighted Average Priceï¼Œæ—¶é—´åŠ æƒå¹³å‡ä»·æ ¼ï¼‰æ˜¯ Uniswap V2 ä¸­å¼•å…¥çš„ä¸€ç§æœºåˆ¶ï¼Œä¸ºäº†è§£å†³å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ä¸­ç¬æ—¶ä»·æ ¼æ˜“å—æ“çºµçš„å®‰å…¨éšæ‚£ï¼Œé€šè¿‡æ—¶é—´åŠ æƒå¹³å‡ä»·æ ¼æ¥æä¾›æ›´ç¨³å®šçš„ä»·æ ¼æ•°æ®ã€‚å®ƒå¤§å¤§é™ä½äº†çŸ­æœŸä»·æ ¼æ“çºµçš„é£é™©ï¼Œå¹¶ä¸º DeFi åè®®æä¾›äº†ä¸€ä¸ªæ›´åŠ å¯é çš„ä»·æ ¼é¢„è¨€æœºã€‚

**(1) ä¸ºä»€ä¹ˆè¦å¼•å…¥ TWAPï¼Ÿ**

åœ¨å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ï¼ˆå¦‚ Uniswapï¼‰ä¸Šï¼Œç¬æ—¶ä»·æ ¼æ˜¯ç”±æµåŠ¨æ€§æ± ä¸­ä»£å¸çš„ä¾›éœ€å…³ç³»å†³å®šçš„ã€‚å› æ­¤ï¼Œåœ¨æ²¡æœ‰ TWAP ä¹‹å‰ï¼Œè¿™ç§ç¬æ—¶ä»·æ ¼å¯ä»¥åœ¨çŸ­æ—¶é—´å†…è¢«æ“çºµè€…å½±å“ï¼Œä½¿å¾— DeFi åè®®åœ¨ä¾èµ– Uniswap çš„ä»·æ ¼é¢„è¨€æœºæ—¶å­˜åœ¨å®‰å…¨éšæ‚£ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœæŸä¸ªåè®®åŸºäº Uniswap ä¸Šçš„å³æ—¶ä»·æ ¼æ¥æ¸…ç®—å€Ÿæ¬¾æˆ–æ‰§è¡Œå¥—åˆ©äº¤æ˜“ï¼Œé‚£ä¹ˆæ”»å‡»è€…å¯èƒ½é€šè¿‡ä¸€ä¸ªçŸ­æš‚çš„ã€å¤§è§„æ¨¡çš„äº¤æ˜“ç¬é—´æ”¹å˜æ± ä¸­çš„ä»·æ ¼ï¼Œä»è€Œä½¿åè®®è¯¯ä»¥ä¸ºä»·æ ¼å‘ç”Ÿäº†å¤§å¹…æ³¢åŠ¨ï¼Œè¿™ç§æ”»å‡»è¢«ç§°ä¸º"é—ªç”µè´·ä»·æ ¼æ“çºµæ”»å‡»"ï¼ˆflash loan price manipulationï¼‰ã€‚

ä¸ºäº†é˜²æ­¢è¿™ç§é—®é¢˜ï¼ŒUniswap V2 å¼•å…¥äº† TWAP æœºåˆ¶ï¼Œé€šè¿‡è®¡ç®—ä¸€ä¸ªæ—¶é—´æ®µå†…çš„å¹³å‡ä»·æ ¼æ¥æä¾›æ›´å¯é çš„ä»·æ ¼ä¿¡æ¯ã€‚è¿™æ ·ï¼Œåè®®å¯ä»¥ä¾èµ–è¿™ä¸ªå¹³å‡ä»·æ ¼ï¼Œè€Œä¸æ˜¯ç¬æ—¶çš„å¸‚åœºä»·æ ¼ï¼Œä»è€Œå¤§å¤§å‡å°‘äº†çŸ­æ—¶é—´å†…ä»·æ ¼æ³¢åŠ¨å¸¦æ¥çš„é£é™©ã€‚

**(2) TWAP å·¥ä½œåŸç†**

Uniswap V2 çš„ TWAP æ˜¯åŸºäºç´¯ç§¯ä»·æ ¼çš„æœºåˆ¶æ¥å®ç°çš„ã€‚æ¯ä¸ªäº¤æ˜“å¯¹çš„ä»·æ ¼ä¼šåœ¨æ¯ä¸ªåŒºå—å†…æ›´æ–°ä¸€æ¬¡ï¼Œè¿™ä¸ªä»·æ ¼åŸºäºæ± ä¸­çš„ä»£å¸æ•°é‡ï¼ˆX å’Œ Yï¼‰çš„æ¯”å€¼ã€‚

å…·ä½“æ¥è¯´ï¼ŒUniswap V2 è¿½è¸ªä¸¤ä¸ªä»£å¸å¯¹ä¹‹é—´ä»·æ ¼çš„ç´¯ç§¯å€¼ï¼š

1. æ¯ä¸ªåŒºå—ç»“æŸæ—¶ï¼ŒUniswap ä¼šè®°å½•å½“å‰çš„ä»·æ ¼ä¹˜ä»¥è‡ªä¸Šæ¬¡æ›´æ–°ä»¥æ¥ç»è¿‡çš„æ—¶é—´ï¼Œå¹¶å°†å…¶ç´¯ç§¯ã€‚
2. ç´¯ç§¯ä»·æ ¼éšç€æ¯ä¸ªåŒºå—ä¸æ–­å¢é•¿ï¼Œå› æ­¤è®¡ç®—ä»·æ ¼çš„æ—¶é—´è¶Šé•¿ï¼Œç´¯ç§¯çš„ä»·æ ¼å€¼å°±è¶Šå¤§ã€‚

ä¸ºäº†è®¡ç®—æŸä¸€æ—¶é—´æ®µçš„å¹³å‡ä»·æ ¼ï¼ˆå³ TWAPï¼‰ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤ï¼š

1. è®°å½•å¼€å§‹æ—¶é—´çš„ç´¯ç§¯ä»·æ ¼ã€‚
2. è®°å½•ç»“æŸæ—¶é—´çš„ç´¯ç§¯ä»·æ ¼ã€‚
3. ç”¨ç»“æŸæ—¶é—´çš„ç´¯ç§¯ä»·æ ¼å‡å»å¼€å§‹æ—¶é—´çš„ç´¯ç§¯ä»·æ ¼ï¼Œç„¶åé™¤ä»¥æ—¶é—´å·®ï¼ˆåŒºå—æ•°ï¼‰ï¼Œå¾—å‡ºè¿™æ®µæ—¶é—´å†…çš„å¹³å‡ä»·æ ¼ã€‚

é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒUniswap V2 è®©ç”¨æˆ·èƒ½å¤ŸåŸºäºåŒºå—é“¾çš„å†å²æ•°æ®è®¡ç®—ä»»æ„æ—¶é—´æ®µçš„åŠ æƒå¹³å‡ä»·æ ¼ï¼Œè€Œä¸æ˜¯ä¾èµ–ç¬æ—¶ä»·æ ¼ã€‚

ç¤ºä¾‹ï¼šå‡è®¾æŸä¸ªäº¤æ˜“å¯¹æ˜¯ ETH/DAIï¼Œæˆ‘ä»¬æƒ³è¦åœ¨è¿‡å» 6 å°æ—¶å†…è®¡ç®— ETH çš„æ—¶é—´åŠ æƒå¹³å‡ä»·æ ¼ã€‚å‡è®¾æ¯ä¸ªåŒºå—çš„å¹³å‡å‡ºå—æ—¶é—´ä¸º 15 ç§’ï¼Œå› æ­¤ 6 å°æ—¶å¤§çº¦åŒ…å« 1440 ä¸ªåŒºå—ã€‚

1. åœ¨åŒºå—é«˜åº¦ `N` å¤„ï¼Œæˆ‘ä»¬è®°å½•ä¸‹ ETH/DAI çš„ç´¯ç§¯ä»·æ ¼ `P1`ã€‚
2. 6 å°æ—¶åï¼Œåœ¨åŒºå—é«˜åº¦ `N + 1440` å¤„ï¼Œæˆ‘ä»¬è®°å½•ä¸‹æ–°çš„ç´¯ç§¯ä»·æ ¼ `P2`ã€‚
3. TWAP çš„è®¡ç®—å…¬å¼ä¸ºï¼š$TWAP = \frac{P2 - P1}{1440}$ 

è¿™ä¸ªç»“æœå°±æ˜¯è¿‡å» 6 å°æ—¶å†… ETH/DAI çš„æ—¶é—´åŠ æƒå¹³å‡ä»·æ ¼ã€‚

**(3) å¯èƒ½å¯¼è‡´çš„é—®é¢˜**

1. **å»¶è¿Ÿæ€§**ï¼šTWAP æ˜¯ä¸€ä¸ªå†å²ä»·æ ¼çš„å¹³å‡å€¼ï¼Œå› æ­¤å®ƒæ— æ³•å¿«é€Ÿåæ˜ å‡ºå¸‚åœºçš„ç¬æ—¶å˜åŒ–ã€‚åœ¨ä»·æ ¼å‰§çƒˆæ³¢åŠ¨æ—¶ï¼ˆå¦‚å¸‚åœºçªç„¶å´©ç›˜æˆ–å¤§å¹…ä¸Šæ¶¨ï¼‰ï¼ŒTWAP å¯èƒ½æ— æ³•æä¾›åŠæ—¶çš„å¸‚åœºä»·æ ¼ã€‚è¿™æ„å‘³ç€ä¾èµ– TWAP çš„åè®®å¯èƒ½åœ¨æç«¯æƒ…å†µä¸‹åšå‡ºé”™è¯¯å†³ç­–ï¼Œå› ä¸ºä»·æ ¼æ»åã€‚
2. **è®¡ç®—å¤æ‚åº¦**ï¼šå¯¹äºè¾ƒé•¿æ—¶é—´çš„ TWAP è®¡ç®—ï¼Œå°¤å…¶æ˜¯å½“éœ€è¦è·¨è¶Šå¤šä¸ªåŒºå—æ—¶ï¼Œå¯èƒ½éœ€è¦è¯»å–å¤§é‡çš„é“¾ä¸Šæ•°æ®ï¼Œå¢åŠ äº†è®¡ç®—æˆæœ¬ã€‚è¿™å¯¹äºé«˜é¢‘äº¤æ˜“æˆ–ä¾èµ–é¢‘ç¹ä»·æ ¼æ›´æ–°çš„åè®®æ¥è¯´ï¼Œå¯èƒ½å¹¶ä¸é€‚ç”¨ã€‚
3. **æ”»å‡»å¯èƒ½æ€§**ï¼šè™½ç„¶ TWAP è§£å†³äº†çŸ­æœŸå†…çš„ä»·æ ¼æ“çºµé—®é¢˜ï¼Œä½†æ”»å‡»è€…ä»å¯èƒ½é€šè¿‡é•¿æ—¶é—´çš„èµ„é‡‘æ“æ§å½±å“ TWAPã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å¤šä¸ªåŒºå—å†…ä¸æ–­è°ƒæ•´æ± ä¸­çš„ä»£å¸æ•°é‡ï¼Œå½±å“ç´¯ç§¯ä»·æ ¼ï¼Œä»è€Œé€æ­¥æ”¹å˜ TWAP å€¼ã€‚è¿™ç§æ”»å‡»éœ€è¦æ›´å¤§çš„èµ„æœ¬å’Œæ›´é•¿çš„æ—¶é—´ï¼Œä½†å¹¶ä¸æ˜¯ä¸å¯èƒ½ã€‚
4. **ä»·æ ¼æ“æ§çš„æ½œåœ¨çª—å£**ï¼šTWAP è™½ç„¶èƒ½é˜²æ­¢å•ä¸ªç¬é—´çš„ä»·æ ¼æ“æ§ï¼Œä½†åœ¨ä¸€å®šæ—¶é—´çª—å£å†…ï¼Œæ”»å‡»è€…ä»æœ‰å¯èƒ½å½±å“ä»·æ ¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ”»å‡»è€…çŸ¥é“æŸä¸ªåè®®å°†åœ¨æœªæ¥æŸä¸ªæ—¶é—´ç‚¹ä¾èµ– TWAP è¿›è¡Œç»“ç®—æˆ–æ¸…ç®—æ“ä½œï¼Œä»–ä»¬å¯ä»¥åœ¨ TWAP è®¡ç®—çš„å…³é”®æ—¶é—´çª—å£å†…å½±å“ä»·æ ¼ï¼Œé€ æˆä¸€å®šæ—¶é—´æ®µå†…çš„ä»·æ ¼åå·®ï¼Œä»è€Œå®ç°åˆ©ç›Šæœ€å¤§åŒ–ã€‚

![27](../../assets/images/defi_course_2024_edition/27.png)

![28](../../assets/images/defi_course_2024_edition/28.png)

![29](../../assets/images/defi_course_2024_edition/29.png)

https://github.com/Uniswap/v2-core/blob/master/contracts/UniswapV2Pair.sol

![https://docs.uniswap.org/contracts/v2/concepts/core-concepts/oracles](../../assets/images/defi_course_2024_edition/30.png)

> ğŸ’¡ Uniswap V2 æ˜¯ä½¿ç”¨ Solidity 0.6.6 ç‰ˆæœ¬ç¼–å†™çš„ã€‚

Uniswap ä¸­æ²¡æœ‰å®ç°ä¸Šé¢è®¡ç®—"$T_k$ -> $T_n$ çš„ AP"å…¬å¼ä¸­çš„åˆ†æ¯éƒ¨åˆ†ï¼Œå› ä¸ºä¸å¯èƒ½è®°ä½è¿‡å»æ‰€æœ‰æ—¶é—´çš„ priceï¼ˆæ¯æ¬¡æ›´æ–°éƒ½éœ€è¦èŠ± Gasï¼ŒUniswap ä¸ä¼šå»è®°å½•è¿™ä¸ªäº‹æƒ…ï¼‰ï¼Œå¦‚æœéœ€è¦ TWAPï¼Œé‚£å°±éœ€è¦è‡ªå·±åšä¸€ä¸ªå¿«ç…§ï¼ˆsnapshotï¼‰ã€‚

ï¼ˆè¯¾å ‚ä»£ç æ¼”ç¤ºéƒ¨åˆ†çœç•¥ï¼‰v2-twap.sol å¤§æ¦‚ 90 è¡Œä»£ç ï¼ŒTokenA.solã€TokenB.sol

**ã€è¯¾ç¨‹å®éªŒã€‘TWAP å®éªŒ**ï¼šè‡ªå·±éƒ¨ç½² Uniswap V2 åˆçº¦ï¼Œå®ç° TWAPã€‚

> ğŸ’¡ Fixed Point æ˜¯ Uniswap è‡ªå·±ç‹¬åˆ›çš„ä¸€ä¸ªæ•°æ®ç±»å‹ï¼ŒUQ112.112 æ ¼å¼ã€‚

åˆ†åˆ«éƒ¨ç½² TokenAã€TokenBï¼Œå„è‡ªå‘è¡Œ 1e26 ä¸ªï¼Œé€šè¿‡ UniswapV2Router02.sol åˆçº¦æ“ä½œã€‚

## ç¬¬ 11 è¯¾ - Uniswap é‡Œçš„ Flash Swap

![31](../../assets/images/defi_course_2024_edition/31.png)

> ğŸ’¡ Flash Swap æ˜¯ DeFi æ‰æœ‰çš„ä¸œè¥¿ï¼Œä¼ ç»Ÿé‡‘èæ²¡æœ‰è¿™ç±»æœºåˆ¶ã€‚

ã€GPT-4oã€‘Flash Swap å…è®¸ç”¨æˆ·"å…ˆå€Ÿä»£å¸å†ä»˜æ¬¾"ï¼Œè€Œè¿™ç¬”ä»˜æ¬¾åªåœ¨äº¤æ˜“çš„æœ€åæ—¶åˆ»è¿›è¡Œã€‚å¦‚æœç”¨æˆ·æ— æ³•å¿è¿˜å€Ÿå‡ºçš„ä»£å¸ï¼Œé‚£ä¹ˆäº¤æ˜“å°†å›æ»šï¼Œä¹‹å‰å‘ç”Ÿçš„æ‰€æœ‰æ“ä½œéƒ½å°†è¢«æ’¤é”€ã€‚

æ ¸å¿ƒä»£ç ä½äº https://github.com/Uniswap/v2-core/blob/master/contracts/UniswapV2Pair.sol åˆçº¦çš„ `swap()` å‡½æ•°ã€‚

è¯¾å ‚æ¼”ç¤ºçš„ FlashSwap.solï¼šhttps://github.com/liangpeili/defi-2024/tree/main/Flash_swap

è¯¾å¤–é˜…è¯»ï¼š[Flash Loans and how to hack them: a walk through of ERC 3156](https://www.rareskills.io/post/erc-3156)

Flash Loan å’Œ Flash Swap æœ¬è´¨ä¸Šæ˜¯ä¸€å›äº‹ï¼ˆåœ¨ä¸€ç¬”äº¤æ˜“é‡Œå®Œæˆå€Ÿå’Œè¿˜ï¼‰ã€‚

## ç¬¬ 12 è¯¾ - Uniswap V2 çš„æ— å¸¸æŸå¤±è®¡ç®—

![32](../../assets/images/defi_course_2024_edition/32.png)

![33](../../assets/images/defi_course_2024_edition/33.png)

![34](../../assets/images/defi_course_2024_edition/34.png)

åš LPï¼Œæ— è®º Token æ˜¯æ¶¨ä»·è¿˜æ˜¯é™ä»·éƒ½ä¼šå¯¼è‡´èµ„äº§æ¯”ä¸åš LP è¦å°‘ä¸€äº›ï¼Œè¿™ä¸ªå°±å«æ— å¸¸æŸå¤±ï¼ˆImpermanent Lossï¼‰ã€‚é‚£ä¸ºä»€ä¹ˆè¿˜è¦åš LP å‘¢ï¼Ÿ

![35](../../assets/images/defi_course_2024_edition/35.png)

![36](../../assets/images/defi_course_2024_edition/36.png)

![https://docs.uniswap.org/contracts/v2/concepts/advanced-topics/understanding-returns](../../assets/images/defi_course_2024_edition/37.png)

> Ivan Kuznetsovã€ŠProgramming DeFi: Uniswap V2ã€‹ ç³»åˆ—æ•™ç¨‹ï¼š
>
> https://jeiwan.net/posts/programming-defi-uniswapv2-1/
>
> https://jeiwan.net/posts/programming-defi-uniswapv2-2/
>
> https://jeiwan.net/posts/programming-defi-uniswapv2-3/
>
> https://jeiwan.net/posts/programming-defi-uniswapv2-4/
>

## ç¬¬ 13 è¯¾ - Staking Reward åŸç†åŠå®ç°

> è¿™å ‚è¯¾è´¨é‡å¾ˆé«˜ï¼Œéœ€è¦ç”¨å¿ƒå»ç†è§£ã€‚

![38](../../assets/images/defi_course_2024_edition/38.png)

é¡¹ç›®æ–¹è®¾å®šå¥½æ—¶é—´å‘¨æœŸä»¥åŠå¥–åŠ±æ€»é‡ã€‚

![39](../../assets/images/defi_course_2024_edition/39.png)

![40](../../assets/images/defi_course_2024_edition/40.png)

![41](../../assets/images/defi_course_2024_edition/41.png)

![42](../../assets/images/defi_course_2024_edition/42.png)

å¦‚æœæœ‰ä¸€ä¸‡ä¸ªç”¨æˆ·ï¼Œç”¨æ™ºèƒ½åˆçº¦æ¥è¡¨ç¤ºä¹‹åï¼Œä¸å¯èƒ½æ¯ç§’é’Ÿæ›´æ–°ä¸€æ¬¡ä½™é¢ã€‚è´¨æŠ¼å’Œè§£é™¤è´¨æŠ¼æ“ä½œéƒ½ä¸æ˜¯é«˜é¢‘æ“ä½œï¼Œå…³é”®åœ¨äºèƒ½å¦å†™æˆæ—¶é—´å¤æ‚åº¦ä¸ºçº¿æ€§çš„æ™ºèƒ½åˆçº¦ç®—æ³•ã€‚

![43](../../assets/images/defi_course_2024_edition/43.png)

æŸä¸ªæ—¶é—´æ®µå†…ï¼Œå•ä½ Token è´¨æŠ¼å¾—åˆ°çš„å¥–åŠ±â€”â€”å³ Reward Per Tokenã€‚

ç”¨æˆ· u ä»ç¬¬ k åˆ° n ç§’ä¹‹é—´å¾—åˆ°çš„å¥–åŠ± = è´¨æŠ¼çš„æ•°é‡ Ã—ï¼ˆå•ä½æ•°é‡ä» 0 åˆ° n çš„å¥–åŠ± - å•ä½æ•°é‡ä» 0 åˆ° k çš„å¥–åŠ±ï¼‰

![44](../../assets/images/defi_course_2024_edition/44.png)

èƒ½å¦åŒ–ç®€ rnï¼Ÿ

![45](../../assets/images/defi_course_2024_edition/45.png)

![46](../../assets/images/defi_course_2024_edition/46.png)

å¯¹æ•´ä¸ªé¡¹ç›®æ¥è¯´ï¼Œåªéœ€è¦è®°å½•å‡ ä¸ªå€¼å°±è¡Œäº†ã€‚

![47](../../assets/images/defi_course_2024_edition/47.png)

å›¾ç‰‡æ¥æºï¼š[Staking Rewards - Math, Examples and Algorithm | DeFi](https://www.youtube.com/watch?v=iNZWMj4USUM)

æ¨è Youtuber @smartcontractprogrammer çš„ [DeFi ç³»åˆ—è§†é¢‘](https://www.youtube.com/playlist?list=PLO5VPQH6OWdX-Rh7RonjZhOd9pb9zOnHW)ï¼Œæ˜¯å¾ˆèµçš„ä¸€ä¸ªè‹±æ–‡è§†é¢‘è®²è§£ç³»åˆ—ã€‚

è®¡ç®— r(B, 5, 11) å’Œ r(C, 6, 13)

![48](../../assets/images/defi_course_2024_edition/48.png)

StakingReward.sol ä»£ç æ¼”ç¤ºï¼ˆçº¦ä¸€ç™¾æ¥è¡Œä»£ç ï¼‰ã€‚

## ç¬¬ 14 è¯¾ - Uniswap V3 ç®€ä»‹

Uniswap V3 ç™½çš®ä¹¦ï¼šhttps://app.uniswap.org/whitepaper-v3.pdf

Introducing Uniswap v3ï¼šhttps://blog.uniswap.org/uniswap-v3ã€March 23, 2021ã€‘

2021å¹´5æœˆï¼ŒUniswap V3å‘å¸ƒï¼Œä¸»è¦ç‰¹æ€§ï¼š

- å¢åŠ é›†ä¸­æµåŠ¨æ€§
- ä¼˜åŒ–æ‰‹ç»­è´¹è®¾ç½®
- TWAP ä¼˜åŒ–
- æ”¹è¿›å¼€æºåè®®

V3 å¼€æºè®¸å¯è¯è¦æ±‚çš„ä¸¤å¹´ä»£ç ä¿æŠ¤æœŸåœ¨ 2023 å¹´åˆ°æœŸäº†ã€‚

Uniswap V2 èµ„é‡‘åˆ©ç”¨æ•ˆç‡ä½ï¼Œåš LP é£é™©å¾ˆå¤§ã€‚

å¦‚æœä»£å¸ä»·æ ¼å‰§çƒˆæ³¢åŠ¨ï¼Œç”¨æˆ·æ‰¿å—æ— å¸¸æŸå¤±çš„é£é™©è¾ƒå¤§ï¼Œæ‰€ä»¥å¯¹äºæ³¢åŠ¨å‰§çƒˆçš„ Token æ¥è¯´ï¼Œåº”è¯¥æ”¶å–æ›´é«˜çš„æ‰‹ç»­è´¹æ¥å¼¥è¡¥ LP çš„æŸå¤±ã€‚

V3 çš„æ ¸å¿ƒæ”¹è¿›ï¼šåœ¨æŸä¸ªä»·æ ¼èŒƒå›´ä¹‹å†…å»åšæµåŠ¨æ€§ã€‚

![49](../../assets/images/defi_course_2024_edition/49.png)

Uniswap æŸ¥çœ‹æµåŠ¨æ€§åœ°å€ï¼šhttps://app.uniswap.org/explore/pools

Uniswap V3 å› ä¸ºæœ‰é›†ä¸­æµåŠ¨æ€§çš„å¼•å…¥ï¼Œæ¯ä¸ªç”¨æˆ·å¯ä»¥é€‰æ‹©åœ¨è‡ªå·±è®¤å¯çš„ä¸€ä¸ªä»·æ ¼åŒºé—´å»åšæµåŠ¨æ€§ï¼Œæœ€åç»¼åˆçš„ç»“æœå°±å¦‚ä¸‹æ‰€ç¤ºï¼š

![50](../../assets/images/defi_course_2024_edition/50.png)

å¾ˆå¤šç”¨æˆ·è®¤ä¸ºä»¥å¤ªåŠè¿˜ä¼šå†æ¶¨ï¼Œæ‰€ä»¥å°±æå‰åˆ°æœªæ¥è¿™ä¸ªä»·æ ¼åŒºé—´å†…å»åšæµåŠ¨æ€§ã€‚ç”¨æˆ·åšæµåŠ¨æ€§è¢«äº¤æ˜“ä½¿ç”¨åˆ°äº†æ‰èƒ½èµšæ‰‹ç»­è´¹ã€‚

æ€è€ƒé—®é¢˜ï¼š

ï¼ˆ1ï¼‰åœ¨ ETH ä»·æ ¼é«˜çš„ä½ç½®åŸ‹ä¼äº†ä¸€ä¸ªå•å­ï¼Œåªéœ€è¦æä¾› ETHï¼Œä¸ºä»€ä¹ˆï¼Ÿ

ï¼ˆ2ï¼‰åœ¨ ETH ä»·æ ¼ä½çš„ä½ç½®åŸ‹ä¼äº†ä¸€ä¸ªå•å­ï¼Œåªéœ€è¦æä¾› USDTï¼Œä¸ºä»€ä¹ˆï¼Ÿ

ï¼ˆ3ï¼‰Uniswap V3 å› ä¸ºæä¾›äº† Range Order è®¢å•ï¼Œç”¨æˆ·å¯ä»¥æŠŠå®ƒä½œä¸ºé™ä»·è®¢å•å»ä½¿ç”¨ï¼Œæ€ä¹ˆç†è§£ï¼Ÿ

Uniswap V3 å¯ä»¥åœ¨åŒä¸€ä¸ª Pool ä¸­æä¾›å¤šä¸ªä»·æ ¼èŒƒå›´ä¹‹å†…çš„æµåŠ¨æ€§ã€‚

![ä»¥å¤ªåŠå®˜æ–¹ç»™çš„æ¡ˆä¾‹](../../assets/images/defi_course_2024_edition/51.png)

![52](../../assets/images/defi_course_2024_edition/52.png)

æ‰‹ç»­è´¹çš„æ”¶å–ï¼š

- é’ˆå¯¹ä¸åŒçš„äº¤æ˜“å¯¹ï¼Œè®¾ç½®ä¸åŒçš„æ¢¯åº¦
  - 0.01%, 0.05%, 0.30% å’Œ 1.00%
- ç®¡ç†è´¹å¯ä»¥æ”¶å–æ‰‹ç»­è´¹çš„10%-25%

https://docs.uniswap.org/concepts/protocol/range-orders

ã€GPT-4o è¡¥å……ã€‘

åŒºé—´è®¢å•ï¼ˆRange Ordersï¼‰æ˜¯ Uniswap V3 ä¸­çš„ä¸€ç§æ–°å‹äº¤æ˜“æ–¹å¼ï¼Œå…è®¸æµåŠ¨æ€§æä¾›è€…ï¼ˆLPï¼‰é€šè¿‡åœ¨ç‰¹å®šä»·æ ¼åŒºé—´å†…æä¾›æµåŠ¨æ€§æ¥å®ç°ç±»ä¼¼é™ä»·å•ï¼ˆLimit Orderï¼‰çš„æ•ˆæœã€‚

ä¼ ç»Ÿçš„é™ä»·å• vs åŒºé—´è®¢å•ï¼š

- **ä¼ ç»Ÿé™ä»·å•**ï¼šæ¯”å¦‚ä½ æƒ³ä»¥æŸä¸ªç‰¹å®šçš„ä»·æ ¼ä¹°å…¥æˆ–å–å‡ºæŸä¸ªèµ„äº§ï¼Œä½ è®¾ç½®ä¸€ä¸ªé™ä»·å•ï¼Œå½“å¸‚åœºä»·æ ¼è¾¾åˆ°ä½ çš„é™ä»·æ—¶ï¼Œäº¤æ˜“ä¼šè‡ªåŠ¨å®Œæˆã€‚
- **Uniswap V3 çš„åŒºé—´è®¢å•**ï¼šç”¨æˆ·å°†å¾…äº¤æ˜“èµ„äº§è®¾ç½®åœ¨ç‰¹å®šçš„ä»·æ ¼åŒºé—´å†…ï¼Œå½“å¸‚åœºä»·æ ¼è¾¾åˆ°è¯¥åŒºé—´æ—¶è‡ªåŠ¨å®Œæˆäº¤æ¢ï¼Œç±»ä¼¼é™ä»·å•çš„æ•ˆæœã€‚è€Œä¸” Uniswap V3 çš„åŒºé—´è®¢å•ä¸éœ€è¦ç­‰å¾…å¦ä¸€æ–¹æ¥ä¸‹å•äº¤æ˜“ï¼Œè€Œæ˜¯ç›´æ¥ä¸æµåŠ¨æ€§æ± ï¼ˆAMMï¼‰è¿›è¡Œäº¤æ˜“ã€‚

Uniswap V3 é€šè¿‡å¼•å…¥åŒºé—´è®¢å•å’Œé›†ä¸­æµåŠ¨æ€§ï¼Œä½¿å¾—ç”¨æˆ·èƒ½å¤Ÿåƒåœ¨ä¼ ç»Ÿäº¤æ˜“æ‰€ä¸­è®¾ç½®é™ä»·å•ä¸€æ ·ï¼Œå®ç°ç‰¹å®šä»·æ ¼åŒºé—´å†…çš„èµ„äº§äº¤æ˜“ã€‚

## ç¬¬ 15 è¯¾ - Uniswap V3 çš„é›†ä¸­æµåŠ¨æ€§

å®é™…ä¸Šåªéœ€è¦æä¾› x_real å’Œ y_real çš„ä¸¤ä¸ª Tokenï¼Œå°±å¯ä»¥ç»´æŒä»·æ ¼ Pc åœ¨ Pa å’Œ Pb ä¹‹é—´æ³¢åŠ¨ã€‚

è™šæ‹ŸæµåŠ¨æ€§ï¼šé™å®šèŒƒå›´åï¼Œé€šè¿‡æä¾›æ›´å°‘çš„ LPï¼Œå°±å¯ä»¥è¾¾åˆ°åœ¨ Uniswap V2 é‡Œé¢æ›´å¤šçš„ LP çš„æ•ˆæœã€‚

![53](../../assets/images/defi_course_2024_edition/53.png)

![54](../../assets/images/defi_course_2024_edition/54.png)

![55](../../assets/images/defi_course_2024_edition/55.png)

Uniswap V3 çš„æ¨¡æ‹Ÿå™¨ï¼šå¯ä»¥æ¨¡æ‹Ÿä¸åŒçš„ä»·æ ¼æµåŠ¨æ€§ã€ä¸åŒä»·æ ¼èŒƒå›´ï¼Œå’Œ V2 è¿›è¡Œå¯¹æ¯”ã€‚

https://www.desmos.com/calculator/6si0vmgwhc?lang=zh-CN

![56](../../assets/images/defi_course_2024_edition/56.png)

![57](../../assets/images/defi_course_2024_edition/57.png)

![58](../../assets/images/defi_course_2024_edition/58.png)

## ç¬¬ 16 è¯¾ - Uniswap V3 çš„æµåŠ¨æ€§è®¡ç®—

![59](../../assets/images/defi_course_2024_edition/59.png)

## ç¬¬ 17 è¯¾ - Uniswap V3 çš„æ— å¸¸æŸå¤±è®¡ç®—

ï¼ˆæœ¬èŠ‚ç¬”è®°å¾…è¡¥å……ï¼‰

## ç¬¬ 18 è¯¾ - Uniswap V4 ç®€ä»‹

ï¼ˆæœ¬èŠ‚ç¬”è®°å¾…è¡¥å……ï¼‰

## ç¬¬ 19 è¯¾ - å»ä¸­å¿ƒåŒ–å€Ÿè´·

ï¼ˆæœ¬èŠ‚ç¬”è®°å¾…è¡¥å……ï¼‰
