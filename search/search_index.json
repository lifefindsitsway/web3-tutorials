{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"]},"docs":[{"location":"","title":"Welcome to My Blog","text":"<p>Hi! Nice to see you! I'm a Web3 developer.</p> <ul> <li>X (Twitter)\uff1a@lifefind_itsway</li> <li>Github\uff1aLifefindsitsway</li> <li>Notion Page\uff1aWeb3 Tutorials</li> </ul> File Name Description Crypto Laws \u6574\u7406 Crypto \u9886\u57df\u7684\u6cd5\u5f8b\u6cd5\u89c4\u4fe1\u606f\u3001\u53f8\u6cd5\u6848\u4f8b Blockchain &amp; Crypto &amp; Web3 \u6574\u7406 Blockchain &amp; Crypto &amp; Web3 \u76f8\u5173\u8d44\u6599 DeFi &amp; DAPP Development Tutorials DAPP\u3001DeFi \u76f8\u5173\u8d44\u6599 Web3 Entrepreneurship Web3 \u521b\u4e1a\u76f8\u5173 Meme Meme \u4f18\u8d28\u8d44\u6599"},{"location":"changelog/","title":"\u66f4\u65b0\u65e5\u5fd7","text":"<ul> <li>2025-11-25\uff1a\u53d1\u8868\u300aSolidity \u5730\u5740\u7c7b\u578b &amp; \u5e38\u89c1\u7528\u6cd5\u5168\u653b\u7565\u300b</li> <li>2025-11-20\uff1a\u53d1\u8868\u300a\u4e3a\u4ec0\u4e48\u4ee5\u592a\u574a\u5730\u5740\u662f 20 \u5b57\u8282\uff1f\u4ece\u79c1\u94a5\u5230\u5730\u5740\u7684\u5168\u89e3\u6790\u300b</li> <li>2024-07-10\uff1a\u53d1\u8868\u300aUniswap V2 \u4ef7\u683c\u7cbe\u5ea6\u89e3\u6790\u300b</li> </ul>"},{"location":"blockchain/address_251125/","title":"Solidity \u5730\u5740\u7c7b\u578b & \u5e38\u89c1\u7528\u6cd5\u5168\u653b\u7565","text":""},{"location":"blockchain/address_251125/#1-solidity","title":"1. Solidity \u5730\u5740\u7c7b\u578b","text":"<p>\u5730\u5740\u7c7b\u578b\uff08<code>address</code>\uff09\u7528\u4e8e\u5b58\u50a8\u4e00\u4e2a 20 \u5b57\u8282\u7684\u503c\uff08\u4ee5\u592a\u574a\u5730\u5740\u7684\u5927\u5c0f\uff09\u3002\u5b83\u4e0d\u4ec5\u4ec5\u662f\u4e00\u4e2a\u5b58\u50a8\u5355\u4f4d\uff0c\u8fd8\u63d0\u4f9b\u4e86\u4e0e\u4ee5\u592a\u574a\u8d26\u6237\u4ea4\u4e92\u7684\u591a\u79cd\u65b9\u5f0f\uff0c\u5bf9\u4e8e\u7f16\u5199\u667a\u80fd\u5408\u7ea6\u81f3\u5173\u91cd\u8981\u3002</p> <p>\u6ce8\uff1a\u8fd9\u4e9b\u8d26\u6237\u53ef\u4ee5\u662f\u5916\u90e8\u8d26\u6237\uff08\u7531\u7528\u6237\u63a7\u5236\u7684\u8d26\u6237\uff0c\u62e5\u6709\u79c1\u94a5\uff09\u6216\u5408\u7ea6\u8d26\u6237\uff08\u7531\u5408\u7ea6\u4ee3\u7801\u63a7\u5236\u7684\u8d26\u6237\uff09\u3002</p> <p>Solidity \u4e2d\u6709\u4e24\u79cd\u5730\u5740\u7c7b\u578b\uff1a</p> <ul> <li>address\uff1a\u666e\u901a\u5730\u5740\uff0c\u4e0d\u80fd\u63a5\u6536 ETH\uff0c\u5373\u4e0d\u80fd\u8c03\u7528 <code>transfer</code> / <code>send</code> / <code>call{value: ...}</code> \u7b49\u65b9\u6cd5\uff1b</li> <li>address payable\uff1a\u80fd\u63a5\u6536 ETH\uff0c\u652f\u6301\u8c03\u7528 <code>transfer</code> / <code>send</code> / <code>call{value: ...}</code> \u7b49\u65b9\u6cd5\uff1b</li> </ul> <p>\u6ce8\uff1a\u4e0e ETH \u76f8\u5173\u7684\u64cd\u4f5c\uff08\u8f6c\u8d26\u3001\u6536\u6b3e\uff09\uff0c\u90fd\u5fc5\u987b\u4f7f\u7528 address payable\u3002</p> <p>\u5bf9\u4e8e <code>address</code> \u7c7b\u578b\uff0c\u5e38\u7528\u7684\u5c5e\u6027\u5305\u62ec\uff1a</p> <ul> <li><code>balance</code>\uff1a\u83b7\u53d6\u5730\u5740\u4e2d\u7684 ETH \u4f59\u989d\uff1b</li> <li><code>code</code>\uff08Solidity ^0.8.0\uff09\uff1a\u83b7\u53d6\u5730\u5740\u4e2d\u5b58\u50a8\u7684\u5408\u7ea6\u4ee3\u7801\uff08\u5982\u679c\u6709\u7684\u8bdd\uff09\uff0c\u6b64\u5c5e\u6027\u5728 Solidity 0.8.0 \u4ee5\u540e\u7248\u672c\u4e2d\u65b0\u589e\uff1b</li> <li><code>codehash</code>\uff08Solidity ^0.8.0\uff09\uff1a\u83b7\u53d6\u5730\u5740\u7684\u5408\u7ea6\u4ee3\u7801\u7684\u54c8\u5e0c\u503c\uff08\u5982\u679c\u5730\u5740\u4e3a\u5408\u7ea6\u5730\u5740\uff09\uff0c\u5982\u679c\u5730\u5740\u662f\u5916\u90e8\u8d26\u6237\u6216\u5408\u7ea6\u4e2d\u6ca1\u6709\u4ee3\u7801\uff0c\u5219\u8fd4\u56de\u96f6\u54c8\u5e0c\uff1b</li> </ul> <p>\u5bf9\u4e8e <code>address payable</code> \u7c7b\u578b\uff0c\u9664 <code>address</code> \u7c7b\u578b\u7684\u5c5e\u6027\u5916\uff0c\u8fd8\u5305\u62ec\u4e09\u79cd\u4e0e ETH \u8f6c\u8d26\u76f8\u5173\u7684\u65b9\u6cd5\uff1a</p> <ul> <li><code>transfer(uint256 amount)</code>\uff1a\u56fa\u5b9a 2300 gas \u4f9b\u5bf9\u65b9 fallback/receive \u4f7f\u7528\uff0c\u5931\u8d25\u4f1a\u76f4\u63a5 <code>revert</code>\uff0c\u65b0\u7248\u672c\u91cc\u56e0\u4e3a gas \u653f\u7b56\u4e0d\u7a33\u5b9a\uff0c\u5b98\u65b9\u5df2\u7ecf\u4e0d\u63a8\u8350\u7528 <code>transfer</code> \u548c <code>send</code> \u4e86\uff1b</li> <li><code>send(uint256 amount) returns (bool)</code>\uff1a2300 gas \u9650\u5236\uff0c\u8fd4\u56de\u4e00\u4e2a\u5e03\u5c14\u503c\u8868\u793a\u6210\u529f\u4e0e\u5426\uff0c\u4e0d\u4f1a\u5728\u5931\u8d25\u65f6 <code>revert</code>\uff0c\u81ea\u5df1\u51b3\u5b9a\u8981\u4e0d\u8981 <code>require</code>\uff1b</li> <li><code>call(bytes memory data) returns (bool, bytes memory)</code>\uff1a\u5411\u5730\u5740\u53d1\u9001 ETH\uff0c\u53ef\u540c\u65f6\u8c03\u7528\u5176\u5408\u7ea6\u51fd\u6570\uff0c\u8fd4\u56de\u4e00\u4e2a\u5e03\u5c14\u503c\u8868\u793a\u6210\u529f\u4e0e\u5426\u548c\u8fd4\u56de\u6570\u636e\u3002</li> </ul> \u51fd\u6570 \u662f\u5426\u63a8\u8350 \u5931\u8d25\u662f\u5426 revert Gas \u9650\u5236 <code>transfer</code> \u274c \u4e0d\u63a8\u8350 \u2714\ufe0f \u81ea\u52a8 revert 2300 gas <code>send</code> \u274c \u4e0d\u63a8\u8350 \u274c \u8fd4\u56de false 2300 gas <code>call{value:...}</code> \u2714\ufe0f \u63a8\u8350\u6807\u51c6 \u274c \u9700\u624b\u52a8 require \u65e0\u9650\u5236 <p>\u9700\u8981\u8f6c\u8d26\u65f6\uff0c\u5efa\u8bae\u4f7f\u7528 <code>call</code> \u65b9\u6cd5\uff0c\u56e0\u4e3a <code>transfer</code> \u4e0e <code>send</code> \u65b9\u6cd5\u5b58\u5728 Gas \u9650\u5236\uff08\u53ea\u63d0\u4f9b2300 Gas\uff0c\u8fd9\u8db3\u4ee5\u8bb0\u5f55\u4e8b\u4ef6\uff0c\u4f46\u4e0d\u8db3\u4ee5\u8fdb\u884c\u66f4\u590d\u6742\u7684\u64cd\u4f5c\uff09\uff0c\u800c <code>call</code> \u6bd4\u8f83\u7075\u6d3b\u3002</p>"},{"location":"blockchain/address_251125/#2","title":"2. \u5730\u5740\u4e0e\u5916\u90e8\u5408\u7ea6\u4ea4\u4e92\uff08\u63a5\u53e3\u7c7b\u578b\u8f6c\u6362\uff09","text":""},{"location":"blockchain/address_251125/#21","title":"2.1 \u4e3a\u4ec0\u4e48\u8f6c\u6362\u6210\u63a5\u53e3\u7c7b\u578b\uff1f","text":"<p>\u4ee5\u592a\u574a\u4e16\u754c\u91cc\uff1a</p> <ul> <li>\u6bcf\u4e2a\u5408\u7ea6 = \u4e00\u6bb5\u90e8\u7f72\u5728\u94fe\u4e0a\u7684\u4ee3\u7801</li> <li>\u6bcf\u4e2a\u5408\u7ea6 = \u4e00\u4e2a\u72ec\u7acb\u7684\u5730\u5740\uff08address\uff09</li> </ul> <p>\u4f46 <code>address</code> \u672c\u8d28\u53ea\u662f 20 \u5b57\u8282\u6570\u5b57\uff0c\u5e76\u6ca1\u6709\u201c\u51fd\u6570\u4fe1\u606f\u201d\uff0c\u56e0\u6b64\uff1a</p> <p>\u274c address \u4e0d\u77e5\u9053\u8fd9\u4e2a\u5730\u5740\u5bf9\u5e94\u54ea\u79cd\u5408\u7ea6</p> <p>\u274c address \u4e0d\u77e5\u9053\u91cc\u9762\u6709\u54ea\u4e9b\u51fd\u6570</p> <p>\u274c address \u4e0d\u80fd\u76f4\u63a5\u8c03\u7528 transfer\u3001approve\u3001swap \u7b49\u51fd\u6570</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>address token = 0x...;\ntoken.transfer(to, amount); // \u274c \u7f16\u8bd1\u9519\u8bef\n</code></pre> <p>\u56e0\u4e3a <code>address</code> \u7c7b\u578b\u6ca1\u6709 <code>transfer</code> \u65b9\u6cd5\u3002</p> <p>Solidity \u662f\u5f3a\u7c7b\u578b\u8bed\u8a00\uff0c\u5fc5\u987b\u660e\u786e\u544a\u8bc9\u5b83\uff1a\u8fd9\u4e2a address \u662f\u4ec0\u4e48\u7c7b\u578b\u7684\u5408\u7ea6\uff01</p> <p>\u6240\u4ee5\u6211\u4eec\u624d\u9700\u8981\uff1a</p> <p>\u2705 \u5148\u5b9a\u4e49\u63a5\u53e3\uff08Interface\uff09\u2014\u2014\u63cf\u8ff0\u5408\u7ea6\u51fd\u6570</p> <p>\u2705 \u518d\u628a <code>address</code> \u5f3a\u5236\u8f6c\u6362\u6210\u63a5\u53e3\u7c7b\u578b</p> <p>\u2705 \u6700\u540e\u7528\u63a5\u53e3\u6765\u8c03\u7528\u51fd\u6570</p>"},{"location":"blockchain/address_251125/#22","title":"2.2 \u5730\u5740\u8f6c\u63a5\u53e3\u5e76\u8c03\u7528\u51fd\u6570\uff08\u6838\u5fc3\u8bed\u6cd5\uff09","text":"<p>\u5178\u578b\u5199\u6cd5\uff1a<code>IERC20(tokenAddress).transfer(to, amount)</code></p> <p>\u4ee3\u7801\u542b\u4e49\uff1a</p> <ol> <li><code>tokenAddress</code> \u2014\u2014 \u8fd9\u662f ERC20 \u5408\u7ea6\u90e8\u7f72\u5728\u94fe\u4e0a\u7684\u5730\u5740\uff1b</li> <li><code>IERC20(tokenAddress)</code> \u2014\u2014 \u544a\u8bc9 Solidity\uff1a\u6309 ERC20 \u63a5\u53e3\u7684\u89c4\u8303\u8bbf\u95ee\u8fd9\u4e2a <code>address</code>\uff1b</li> <li><code>.transfer(...)</code> \u2014\u2014 \u7f16\u8bd1\u5668\u68c0\u67e5\u53c2\u6570\u7c7b\u578b\u3001\u8fd4\u56de\u503c\uff1b</li> <li>\u7f16\u8bd1\u540e\u6267\u884c\u4f4e\u7ea7 call\uff08ABI \u7f16\u7801\uff0cEVM \u6267\u884c\uff09\uff1b</li> </ol>"},{"location":"blockchain/address_251125/#23-address","title":"2.3 \u6700\u5e38\u7528\u573a\u666f\uff1a\u628a address \u50a8\u5b58\u8d77\u6765\uff0c\u7136\u540e\u4ea4\u4e92","text":"<p>\u4f8b\u5982 DEX\u3001Vault\u3001Staking \u5408\u7ea6\u90fd\u8fd9\u4e48\u5199\uff1a</p> <pre><code>contract Test {\n  address public token; // \u4fdd\u5b58\u4ee3\u5e01\u5408\u7ea6\u5730\u5740\n\n  function setToken(address _token) external {\n    token = _token;\n  }\n\n  function transferOut(address to, uint256 amount) external {\n    // address \u2192 IERC20\n    bool ok = IERC20(token).transfer(to, amount);\n    require(ok, \"transfer failed\");\n  }\n}\n</code></pre> <p>\u4e3a\u4ec0\u4e48\u4e0d\u80fd\u76f4\u63a5\u7528 <code>address</code>\uff1f\u56e0\u4e3a <code>address</code> \u6ca1\u6709 <code>transfer</code> \u51fd\u6570\u3002</p>"},{"location":"blockchain/address_251125/#24","title":"2.4 \u5b89\u5168\u6ce8\u610f\u4e8b\u9879","text":"<p>1\uff09\u786e\u4fdd\u8f6c\u6362\u7684 <code>address</code> \u662f\u671f\u671b\u7684\u5408\u7ea6\u5730\u5740</p> <p>\u5982\u679c\u7528\u6237\u4f20\u5165\u6076\u610f\u5730\u5740\uff1a<code>IERC20(fakeAddress).transfer(...)</code>\uff0c\u4f1a\u8c03\u5230\u9519\u8bef\u903b\u8f91 \u6216 fallback\uff0c\u89e6\u53d1\u6076\u610f\u4ee3\u7801\u3002</p> <p>\u6240\u4ee5\u5e38\u89c1\u505a\u6cd5\uff1a</p> <ul> <li>\u2714 \u767d\u540d\u5355\uff1b</li> <li>\u2714 constructor \u91cc\u5199\u6b7b\u5730\u5740\uff1b</li> <li>\u2714 \u4f7f\u7528 immutable \u5e38\u91cf\uff1b</li> <li>\u2714 \u4ec5 owner \u53ef\u4fee\u6539 token \u5730\u5740\uff1b</li> </ul> <p>2\uff09\u4f7f\u7528 <code>try/catch</code>\uff08\u9002\u5408\u5916\u90e8\u5408\u7ea6\u4e0d\u7a33\u5b9a\u65f6\uff09</p> <pre><code>try IERC20(token).transfer(to, amount) returns (bool ok) {\n  require(ok, \"failed\");\n} catch {\n  revert(\"token call failed\");\n}\n</code></pre> <p>3\uff09\u6c38\u8fdc\u4e0d\u8981\u7528 <code>address</code> \u518d\u53bb\u8c03\u7528\u672a\u77e5\u5408\u7ea6\u7684 send/transfer\uff08\u65e7\u5199\u6cd5\uff09</p> <p>\u65e7\u5199\u6cd5\u6709\u98ce\u9669\uff1a<code>payable(addr).transfer(amount);</code> // \u53ef\u80fd\u5931\u8d25</p> <p>\u6539\u7528\uff1a</p> <pre><code>(bool ok,) = payable(addr).call{value: amount}(\"\");\nrequire(ok);\n</code></pre> <p>\u603b\u7ed3\uff1a</p> \u6b65\u9aa4 \u76ee\u7684 \ud83d\udd39 \u5199\u63a5\u53e3 Interface \u544a\u8bc9 Solidity \u8fd9\u4e2a\u5408\u7ea6\u6709\u54ea\u4e9b\u51fd\u6570 \ud83d\udd39 \u7528 <code>IERC20(tokenAddress)</code> \u628a address \u8f6c\u6210\u63a5\u53e3\u7c7b\u578b \ud83d\udd39 \u7528\u63a5\u53e3\u8bbf\u95ee\u51fd\u6570 \u5b89\u5168\u3001\u7c7b\u578b\u68c0\u67e5\u3001\u81ea\u52a8 ABI \u7f16\u7801 \ud83d\udd39 \u7528\u5730\u5740\u4fdd\u5b58\u5408\u7ea6\u5730\u5740 \u5408\u7ea6\u95f4\u4ea4\u4e92"},{"location":"blockchain/address_251125/#3","title":"3. \u5730\u5740 + \u6620\u5c04 / \u6570\u7ec4\uff1a\u8bb0\u8d26 &amp; \u5173\u7cfb","text":""},{"location":"blockchain/address_251125/#31","title":"3.1 \u5730\u5740 + \u6620\u5c04","text":"<p><code>mapping(address =&gt; uint256)</code> \u662f\u6700\u5e38\u89c1\u7684\u7528\u6cd5\u4e4b\u4e00\uff0c\u4f8b\u5982 ERC20 \u7684\u4f59\u989d\u8868\uff1a</p> <pre><code>mapping(address =&gt; uint256) public balanceOf;\n\nfunction mint(uint256 amount) external {\n    balanceOf[msg.sender] += amount;\n}\n</code></pre> <p>\u591a\u5c42 mapping\uff08\u6bd4\u5982 allowance\uff09\uff1a</p> <pre><code>mapping(address =&gt; mapping(address =&gt; uint256)) public allowance;\n\nfunction approve(address spender, uint256 amount) external {\n    allowance[msg.sender][spender] = amount;\n}\n</code></pre> <p><code>mapping</code> \u91cc\u7684 key \u7528 <code>address</code> \u975e\u5e38\u81ea\u7136\uff0c\u800c\u4e14\u4f1a\u81ea\u52a8\u521d\u59cb\u5316\u4e3a 0\uff0c\u4e0d\u5b58\u5728\u5219\u8fd4\u56de\u9ed8\u8ba4\u503c\u3002</p>"},{"location":"blockchain/address_251125/#32","title":"3.2 \u5730\u5740 + \u6570\u7ec4","text":"<p><code>address[]</code>\uff0c\u6570\u7ec4\u91cc\u7684\u5143\u7d20\u53ef\u4ee5\u662f <code>address</code> \u6216 <code>address payable</code>\uff0c\u770b\u4f60\u8981\u4e0d\u8981\u7ed9\u4ed6\u4eec\u8f6c\u8d26\u3002</p> <p>\u6bd4\u5982\u8bb0\u5f55\u6240\u6709\u5b58\u6b3e\u8fc7\u7684\u7528\u6237\uff1a</p> <pre><code>address[] public users;\nmapping(address =&gt; bool) public hasDeposited;\n\nfunction deposit() external payable {\n    if (!hasDeposited[msg.sender]) {\n        hasDeposited[msg.sender] = true;\n        users.push(msg.sender);\n    }\n}\n</code></pre>"},{"location":"blockchain/address_251125/#4","title":"4. \u7279\u6b8a\u5730\u5740","text":"<p><code>msg.sender</code> \u2013 \u5f53\u524d\u5408\u7ea6\u7684\u8c03\u7528\u8005\uff0c\u53ef\u80fd\u662f\u5916\u90e8\u8d26\u6237\uff0c\u4e5f\u53ef\u80fd\u662f\u53e6\u4e00\u4e2a\u5408\u7ea6\u3002</p> <p><code>tx.origin</code> \u2013 \u4ea4\u6613\u6700\u539f\u59cb\u53d1\u8d77\u4eba\uff0c\u5bb9\u6613\u88ab\u300c\u4e2d\u95f4\u5408\u7ea6\u300d\u9a97\u8c03\u7528\uff0c\u5bfc\u81f4\u9493\u9c7c\u653b\u51fb\uff0c\u6743\u9650\u63a7\u5236\u7528 <code>msg.sender</code> \u5c31\u591f\u4e86\u3002</p> <p><code>address(this)</code> - \u5408\u7ea6\u81ea\u5df1\u7684\u5730\u5740\u3002</p>"},{"location":"blockchain/ethereum_address_size_251120/","title":"\u4e3a\u4ec0\u4e48\u4ee5\u592a\u574a\u5730\u5740\u662f 20 \u5b57\u8282\uff1f\u4ece\u79c1\u94a5\u5230\u5730\u5740\u7684\u5168\u89e3\u6790","text":""},{"location":"blockchain/ethereum_address_size_251120/#1","title":"1. \u4ee5\u592a\u574a\u5730\u5740\u591a\u5927\uff1f","text":"<p>\u4ee5\u592a\u574a\u5730\u5740\u5927\u5c0f\uff1a20 \u5b57\u8282\uff08bytes\uff09 = 160 \u4f4d\uff08bits\uff09\uff0c\u5bf9\u5916\u901a\u5e38\u5199\u6210\uff1a<code>0x</code> + 40 \u4e2a\u5341\u516d\u8fdb\u5236\u5b57\u7b26</p> <ul> <li>\u6bcf\u4e2a\u5341\u516d\u8fdb\u5236\u5b57\u7b26\u662f 4 bit</li> <li>40 \u00d7 4 = 160 bit = 20 byte</li> </ul> <p>\u4f8b\u5982\uff1a0x28816c4c4792467390c90e5b426f198570e29307\uff08CZ\u516c\u5f00\u5730\u5740\uff09\uff0c\u53bb\u6389 <code>0x</code>\uff0c\u5269\u4e0b\u7684 40 \u4e2a Hex \u5b57\u7b26\uff0c\u5c31\u662f 20 \u5b57\u8282\u7684\u4e8c\u8fdb\u5236\u5730\u5740\u3002</p>"},{"location":"blockchain/ethereum_address_size_251120/#2-20","title":"2. \u4ece\u5bc6\u94a5\u5230\u5730\u5740\uff1a\u4e3a\u4ec0\u4e48\u662f 20 \u5b57\u8282\uff1f","text":"<p>\u4ee5\u592a\u574a\u8d26\u6237\u7684\u751f\u6210\u6d41\u7a0b\uff08\u5916\u90e8\u8d26\u6237 EOA\uff09\u5927\u81f4\u662f\u8fd9\u6837\uff1a</p> <ol> <li>\u751f\u6210\u4e00\u4e2a \u79c1\u94a5\uff08256 bit \u968f\u673a\u6570\uff09\uff1b</li> <li>\u7528 secp256k1 \u692d\u5706\u66f2\u7ebf\u7b97\u51fa \u516c\u94a5\uff0864 \u5b57\u8282\uff1ax\u3001y \u5404 32 \u5b57\u8282\uff09\uff1b</li> <li>\u5bf9\u516c\u94a5\u505a\u4e00\u6b21 Keccak-256 \u54c8\u5e0c\uff1a\u5f97\u5230 32 \u5b57\u8282\uff1b</li> <li>\u53d6\u54c8\u5e0c\u7ed3\u679c\u7684\u540e 20 \u5b57\u8282\uff08\u53f3\u8fb9 20 \u5b57\u8282\uff09\uff0c\u4f5c\u4e3a\u5730\u5740\uff1b</li> </ol> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502          \u79c1\u94a5 Private Key             \u2502\n\u2502     256-bit \u968f\u673a\u6570\uff0832 \u5b57\u8282\uff09           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                      \u2502\n                      \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         \u516c\u94a5 Public Key               \u2502\n\u2502 secp256k1 \u692d\u5706\u66f2\u7ebf\u63a8\u5bfc\u51fa 64 \u5b57\u8282\u5750\u6807     \u2502\n\u2502  \u516c\u94a5 = (x: 32 bytes, y: 32 bytes)    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                      \u2502\n                      \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502      Keccak-256 \u54c8\u5e0c\uff0832 \u5b57\u8282\uff09        \u2502\n\u2502 hash = keccak256(uncompressed_pubkey)\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                      \u2502\n                      \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       \u53d6\u54c8\u5e0c\u7ed3\u679c\u7684\u6700\u540e 20 \u5b57\u8282           \u2502\n\u2502     \uff08\u53f3 20 \u5b57\u8282 = 160 bit\uff09           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                      \u2502\n                      \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         \u4ee5\u592a\u574a\u5730\u5740 Ethereum Address    \u2502\n\u2502   0x + 40 \u4f4d\u5341\u516d\u8fdb\u5236\u5b57\u7b26\uff08= 20\u5b57\u8282\uff09     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n</code></pre> <p>\u6240\u4ee5\u5730\u5740\u672c\u8d28\u4e0a\u662f\uff1a address = last_20_bytes( keccak256( public_key ) )</p> <p>\u95ee\u9898\uff1a\u4e3a\u4ec0\u4e48\u4e0d\u7528 32 \u5b57\u8282\uff0c\u975e\u8981\u622a\u65ad\u6210 20 \u5b57\u8282\uff1f</p> <p>\u7b80\u5355\u7406\u89e3\uff1a\u622a\u65ad\u4e00\u70b9 hash\uff0c\u5f53\u5730\u5740\u7528\uff0c\u591f\u7528 + \u597d\u7528 + \u8282\u7701\u8d44\u6e90\u3002</p> <p>\uff081\uff09\u77ed\u4e00\u70b9\uff0c\u65b9\u4fbf\u5c55\u793a\u4e0e\u8f93\u5165</p> <ul> <li> <p>32 \u5b57\u8282\u5730\u5740 \u2192 64 \u4e2a Hex \u5b57\u7b26</p> </li> <li> <p>20 \u5b57\u8282\u5730\u5740 \u2192 40 \u4e2a Hex \u5b57\u7b26</p> </li> </ul> <p>\u4ece\u524d\u7aef UI\u3001\u94b1\u5305\u663e\u793a\u3001\u7528\u6237\u590d\u5236\u7c98\u8d34\u7684\u4f53\u9a8c\u6765\u770b\uff0c40 \u4e2a\u5b57\u7b26\u5df2\u7ecf\u5f88\u957f\u4e86\uff0c64 \u4e2a\u66f4\u96be\u7528\u3002</p> <p>\uff082\uff09\u5b89\u5168\u6027\u4ecd\u7136\u8db3\u591f</p> <p>\u5730\u5740\u7a7a\u95f4\u6709 2\u00b9\u2076\u2070 \u2248 1.46 \u00d7 10\u2074\u2078 \u79cd\u53ef\u80fd\uff0c\u5373\u4f7f\u5168\u5730\u7403\u7b97\u529b\u7206\u70b8\u5f0f\u63d0\u9ad8\uff0c\u8981\u300c\u78b0\u649e\u300d\u4e00\u4e2a\u6307\u5b9a\u5730\u5740\u4e5f\u51e0\u4e4e\u4e0d\u53ef\u80fd\u3002</p> <p>\u771f\u6b63\u7684\u5b89\u5168\u6027\u74f6\u9888\u662f\uff1a\u79c1\u94a5\u662f\u5426\u771f\u7684\u968f\u673a &amp; \u662f\u5426\u88ab\u6cc4\u9732\uff0c\u800c\u4e0d\u662f\u300c\u5730\u5740\u591f\u4e0d\u591f\u957f\u300d\u3002</p> <p>\uff083\uff09\u5b58\u50a8\u7a7a\u95f4\u66f4\u5c0f</p> <p>\u72b6\u6001\u6811\uff08state trie\uff09\u3001\u4ea4\u6613\u7f16\u7801\u91cc\u5730\u5740\u8981\u5b58\u5f88\u591a\u6b21\uff0c20 \u5b57\u8282 \u00d7 N \u6b21\uff0c\u6bd4 32 \u5b57\u8282 \u00d7 N \u6b21\u7701\u7a7a\u95f4\u3001\u7701\u5e26\u5bbd\u3001\u7701\u5b58\u50a8\u3002</p>"},{"location":"blockchain/ethereum_address_size_251120/#3-solidity-address","title":"3. Solidity \u91cc\u7684 address \u5b9e\u9645\u5360\u591a\u5c11\u5b57\u8282\uff1f","text":"<p>\u8fd9\u91cc\u8981\u5206 \u201c\u6982\u5ff5\u4e0a\u7684\u5927\u5c0f\u201d \u548c \u201cEVM \u5b9e\u9645\u5b58\u50a8\u7684\u5927\u5c0f\u201d \u4e24\u5c42\u770b\u3002</p> <p>\u6982\u5ff5\u4e0a\uff1aaddress = 20 \u5b57\u8282</p> <p>\u5728 Solidity \u7c7b\u578b\u7cfb\u7edf\u91cc\uff1a</p> <pre><code>address         // 20 \u5b57\u8282\naddress payable // \u4e5f\u662f 20 \u5b57\u8282\uff0c\u53ea\u662f\u591a\u4e86\u8f6c\u8d26\u51fd\u6570\n</code></pre> <p>\u5b58\u50a8\u5728 EVM storage \u91cc\uff1a\u5360\u7528 32 \u5b57\u8282\u69fd\u4f4d</p> <p>EVM \u7684\u6700\u5c0f\u5b58\u50a8\u5355\u4f4d\u662f \u4e00\u4e2a storage slot = 32 \u5b57\u8282\uff08256 bit\uff09\uff0c\u5373\u4f7f\u53ea\u5b58\u4e00\u4e2a bool / uint8 / address\uff0c\u5b83\u9ed8\u8ba4\u4e5f\u5360\u7528\u4e00\u4e2a\u5b8c\u6574 32 \u5b57\u8282\u69fd\uff08\u9664\u975e\u7f16\u8bd1\u5668\u505a\u53d8\u91cf\u6253\u5305\uff09\u3002</p> <pre><code>contract Store {\n    address public owner;    // slot 0\uff0c\u5360 32 \u5b57\u8282\n    uint256 public value;    // slot 1\uff0c\u5360 32 \u5b57\u8282\n}\n</code></pre> <p>\u867d\u7136 address \u5b9e\u9645\u53ea\u7528\u6389 20 \u5b57\u8282\uff0c\u5176\u4f59 12 \u5b57\u8282\u662f\u586b\u5145\u7684\uff08\u901a\u5e38\u4e3a 0\uff09\uff0c\u4f46\uff1a</p> <ul> <li>\u5728 storage \u5c42\u9762\uff1a1 \u4e2a address = 1 \u4e2a slot = 32 \u5b57\u8282</li> <li>\u5728 \u8bed\u4e49\u5c42\u9762\uff1aaddress \u8fd8\u662f\u4ee3\u8868 20 \u5b57\u8282\u7684\u5730\u5740</li> </ul> <p>\u8fd9\u4e5f\u5c31\u662f\u4e3a\u4ec0\u4e48\u6709\u65f6\u5019\u8bb2\u300c\u5b58\u4e00\u4e2a\u5730\u5740\uff0cgas \u5f88\u8d35\u300d\uff0c\u56e0\u4e3a\u5b83\u4f1a\u89e6\u53d1\u4e00\u6b21 <code>SSTORE</code> \u5230\u65b0\u69fd\u4f4d\u3002</p> <p>\u5982\u679c\u53d8\u91cf\u6253\u5305\uff0c\u4f8b\u5982\uff1a</p> <pre><code>contract Packed {\n    address public owner;   // 20 bytes\n    uint96  public count;   // 12 bytes\n}\n</code></pre> <ul> <li>20 + 12 = 32 \u5b57\u8282</li> <li>\u7f16\u8bd1\u5668\u4f1a\u628a <code>owner</code> \u548c <code>count</code> \u585e\u8fdb\u540c\u4e00\u4e2a slot \u2192 \u4f9d\u7136\u662f 32 \u5b57\u8282\u4e00\u4e2a\u69fd\uff0c\u4f46\u5bb9\u7eb3\u4e86\u4e24\u4e2a\u5b57\u6bb5</li> </ul> <p>\u7ed3\u8bba\uff1a</p> <ul> <li>\u5355\u72ec\u770b\u7c7b\u578b\uff1aaddress = 20 bytes\uff1b</li> <li>\u5b58\u5728 storage\uff1a\u4e00\u822c\u5360 1 \u4e2a 32-byte slot\uff08\u9664\u975e packing\uff09\uff1b</li> </ul>"},{"location":"blockchain/ethereum_address_size_251120/#4-abi-calldata-memory","title":"4. \u5728 ABI / calldata / memory \u91cc\u7684\u5730\u5740\u5927\u5c0f","text":"<p>Solidity \u5bf9\u5916\u7f16\u7801\uff08ABI\uff09\u65f6\u5019\uff0c\u6709\u4e00\u4e2a\u89c4\u5219\uff1a\u6240\u6709\u503c\u7c7b\u578b\u6309 32 \u5b57\u8282\u5bf9\u9f50\u3002</p> <p>\u6240\u4ee5\u5728\u4ee5\u4e0b\u573a\u666f\u4e2d\uff1a</p> <ul> <li>\u51fd\u6570\u53c2\u6570\u7684 ABI \u7f16\u7801\uff08calldata\uff09\uff1b</li> <li>\u51fd\u6570\u8fd4\u56de\u503c\u7684 ABI \u7f16\u7801\uff1b</li> <li>event topics\uff08\u65e5\u5fd7\u91cc\uff09\uff1b</li> </ul> <p>\u4e00\u4e2a address \u901a\u5e38\u662f\u8fd9\u4e48\u8868\u793a\u7684\uff1a\u524d\u9762 12 \u5b57\u8282\u8865 0 + \u540e\u9762 20 \u5b57\u8282\u5730\u5740</p> <p>\u4f8b\u5982 CZ \u5730\u5740\uff1a0x28816c4c4792467390c90e5b426f198570e29307\uff0c\u5728 ABI \u7f16\u7801\u4e2d\uff0c\u4f1a\u88ab\u653e\u8fdb 32 \u5b57\u8282\uff1a</p> <pre><code>0x00000000000000000000000028816c4c4792467390c90e5b426f198570e29307\n  \u2191                       \u2191\n12 bytes 0              20 bytes address\n</code></pre> <p>\u7f16\u7801\u65f6\uff0c\u5360 32 \u5b57\u8282\uff08\u5bf9\u9f50\u5230 256 bit\uff09\uff0c\u8bed\u4e49\u4e0a\uff0c\u6709\u6548\u8f7d\u8377\u4ecd\u7136\u662f 20 \u5b57\u8282\u3002</p>"},{"location":"web3/defi/uniswap_v2_price_precision_240710/","title":"Uniswap V2 \u4ef7\u683c\u7cbe\u5ea6\u89e3\u6790","text":"<p>\u4ece DeFi \u5f00\u53d1\u8005\u7684\u89d2\u5ea6\uff0c\u6df1\u5165\u89e3\u6790 Uniswap V2 \u767d\u76ae\u4e66\u4e2d\u5173\u4e8e\u4ef7\u683c\u7cbe\u5ea6\u7684\u5185\u5bb9\u3002\u8fd9\u662f Uniswap V2 \u5de5\u7a0b\u8bbe\u8ba1\u7684\u7cbe\u534e\u4e4b\u4e00\uff0c\u4f53\u73b0\u4e86\u5728 EVM \u7ea6\u675f\u4e0b\u7684\u6781\u81f4\u4f18\u5316\u601d\u7ef4\u3002</p> <p>Uniswap V2 \u767d\u76ae\u4e66 2.2.1 \u8fd9\u7ae0\u8282\u4e3b\u8981\u5728\u56de\u7b54\u4e09\u4e2a\u95ee\u9898\uff1a</p> <ol> <li>\u94fe\u4e0a\u600e\u4e48\u8868\u793a\u201c\u4ef7\u683c\u201d\u8fd9\u79cd\u5c0f\u6570\uff1f</li> <li>\u4e3a\u4ec0\u4e48\u662f 112+112\uff0c\u8ddf 224 / 256 \u4f4d\u3001gas\u3001\u5b58\u50a8\u5e03\u5c40\u6709\u4ec0\u4e48\u5173\u7cfb\uff1f</li> <li>\u4e3a\u4ec0\u4e48\u8981\u628a\u65f6\u95f4\u6233\u538b\u6210 32 \u4f4d\u3001\u6ea2\u51fa\u4e4b\u540e\u600e\u4e48\u8fd8\u80fd\u6b63\u786e\u7b97 TWAP\uff1f</li> </ol>"},{"location":"web3/defi/uniswap_v2_price_precision_240710/#uq112112","title":"\u4e00\u3001UQ112.112 \u662f\u4ec0\u4e48\uff1f","text":""},{"location":"web3/defi/uniswap_v2_price_precision_240710/#11-q","title":"1.1 Q\u683c\u5f0f\u7684\u901a\u7528\u5b9a\u4e49","text":"<p><code>Qm.n</code> \u662f\u4e00\u79cd\u8868\u793a\u5b9a\u70b9\u6570\u7684\u683c\u5f0f\uff0c\u201cQ\u201d \u4ee3\u8868\u201c\u4e8c\u8fdb\u5236\u5c0f\u6570\u70b9\u4f4d\u7f6e\u201d\uff08binary point position\uff09\u3002\u5b83\u662f\u4e00\u79cd\u547d\u540d\u60ef\u4f8b\uff0c\u7528\u4e8e\u660e\u786e\u6307\u793a\u5728\u4e00\u4e2a\u6574\u6570\u4e2d\uff0c\u54ea\u91cc\u662f\u6574\u6570\u90e8\u5206\u548c\u5c0f\u6570\u90e8\u5206\u7684\u5206\u754c\u7ebf\u3002\u5176\u4e2d\uff1a</p> <ul> <li>m\uff1a\u4ee3\u8868\u6574\u6570\u90e8\u5206\uff08\u5728\u5c0f\u6570\u70b9\u5de6\u8fb9\uff09\u5360\u7528\u7684\u4f4d\u6570\uff1b</li> <li>n\uff1a\u4ee3\u8868\u5c0f\u6570\u90e8\u5206\uff08\u5728\u5c0f\u6570\u70b9\u53f3\u8fb9\uff09\u5360\u7528\u7684\u4f4d\u6570\uff1b</li> <li>\u603b\u6570\uff1a<code>m + n</code> \u4f4d\uff0c\u901a\u5e38\u5bf9\u5e94\u4e00\u4e2a\u6807\u51c6\u6574\u6570\u7c7b\u578b\uff08\u5982 int32, uint16 \u7b49\uff09\u3002</li> </ul>"},{"location":"web3/defi/uniswap_v2_price_precision_240710/#12","title":"1.2 \u4e3a\u4ec0\u4e48\u9700\u8981\u5b9a\u70b9\u6570\u683c\u5f0f\uff1f","text":"<p>Solidity\uff08\u4ee5\u53caEVM\uff09\u539f\u751f\u53ea\u652f\u6301\u6574\u6570\u8fd0\u7b97\uff0c\u6ca1\u6709\u6d6e\u70b9\u6570\u7c7b\u578b\uff0c\u4f46\u4ef7\u683c\u5929\u7136\u662f\u5c0f\u6570\uff0c\u4f8b\u5982\uff1a1 ETH = 3049.5 USDC\u3002</p> <p>\u4f20\u7edf\u65b9\u6848\u7684\u95ee\u9898\uff1a\u5982\u679c\u76f4\u63a5\u7528 <code>reserve_a / reserve_b</code> \u8ba1\u7b97\u4ef7\u683c\uff0cSolidity \u4f1a\u505a\u6574\u6570\u9664\u6cd5\uff0c\u4e22\u5931\u6240\u6709\u5c0f\u6570\u90e8\u5206\uff0c\u6bd4\u5982 <code>1 / 2000 = 0</code>\uff08\u6574\u6570\u9664\u6cd5\uff09\u3002</p> <p>Uniswap V2 \u7684\u89e3\u51b3\u65b9\u6848\uff1a\u4f7f\u7528\u5b9a\u70b9\u6570\uff08Fixed Point\uff09\u683c\u5f0f <code>UQ112.112</code>\u3002 <code>UQ112.112</code> \u662f<code>Qm.n</code> \u683c\u5f0f\u7684\u4e00\u4e2a\u53d8\u4f53\uff1a</p> <ul> <li>U\uff1a\u4ee3\u8868 Unsigned\uff08\u65e0\u7b26\u53f7\uff09\uff0c\u8fd9\u4e2a\u6570\u6c38\u8fdc\u662f\u6b63\u7684\uff0c\u56e0\u4e3a\u4ef7\u683c\u4e0d\u53ef\u80fd\u4e3a\u8d1f\uff1b</li> <li> <p>Q112.112\uff1a\u8868\u793a\u8fd9\u662f\u4e00\u4e2a\u5b9a\u70b9\u6570\uff0c\u5176\u4e2d\uff1a</p> </li> <li> <ul> <li>\u5c0f\u6570\u70b9\u5de6\u8fb9\u6709 112 \u4f4d\uff08\u7528\u4e8e\u8868\u793a\u6574\u6570\u90e8\u5206\uff09\uff1b</li> </ul> </li> <li>\u5c0f\u6570\u70b9\u53f3\u8fb9\u6709 112 \u4f4d\uff08\u7528\u4e8e\u8868\u793a\u5c0f\u6570\u90e8\u5206\uff09\uff1b</li> <li>\u603b\u8ba1 224 \u4f4d (<code>112 + 112</code>)\u3002</li> </ul> <p>Uniswap V2 \u767d\u76ae\u4e66\u539f\u6587\uff1a</p> <p>prices at a given moment are stored as UQ112.112 numbers, meaning that 112 fractional bits of precision are specified on either side of the decimal point, with no sign. These numbers have a range of [0, 2\u00b9\u00b9\u00b2 \u2212 1] and a precision of 1 / 2\u00b9\u00b9\u00b2. </p> <p>\u7ffb\u8bd1\u4e00\u4e0b\uff0c\u5c31\u662f\uff1a\u201c\u6211\u4eec\u6ca1\u6709\u6d6e\u70b9\u6570\uff0c\u53ea\u597d\u81ea\u5df1\u9020\u4e00\u4e2a\u4e8c\u8fdb\u5236\u5b9a\u70b9\u5c0f\u6570\u683c\u5f0f\uff1a\u628a\u4e00\u4e2a\u6570\u62c6\u6210\u4e24\u90e8\u5206\uff1a</p> <ul> <li>\u524d 112 \u4f4d\uff1a\u6574\u6570\u90e8\u5206\uff080 ~ 2\u00b9\u00b9\u00b2 \u2212 1\uff09</li> <li>\u540e 112 \u4f4d\uff1a\u5c0f\u6570\u90e8\u5206\uff08\u7cbe\u5ea6 2\u207b\u00b9\u00b9\u00b2\uff09</li> <li>\u4e0d\u5e26\u7b26\u53f7\uff08unsigned\uff09\uff0c\u53ea\u8868\u793a\u975e\u8d1f\u3002\u201d</li> </ul>"},{"location":"web3/defi/uniswap_v2_price_precision_240710/#13-0-2112-1","title":"1.3 \u8303\u56f4\u4e3a\u4ec0\u4e48\u662f [0, 2\u00b9\u00b9\u00b2 \u2212 1]\uff1f","text":"<p>\u8fd9\u91cc\u6307\u7684\u662f\u4ef7\u683c\u7684\u6574\u6570\u90e8\u5206\u7684\u8303\u56f4\uff0c\u4e0d\u662f\u6574\u4e2a 224 \u4f4d\u6570\u503c\u6574\u4f53\u7684\u8303\u56f4\u3002</p> <p>\u767d\u76ae\u4e66\u811a\u6ce8\u89e3\u91ca\u5f97\u5f88\u6e05\u695a\uff1aUniswap \u91cc\u8fd9\u4e2a UQ112.112 \u7684\u4ef7\u683c\u6c38\u8fdc\u6765\u81ea\u4e24\u4e2a uint112 \u50a8\u5907\u7684\u6bd4\u503c\uff1a</p> <p>UQ112.112 numbers in Uniswap are always generated from the ratio of two uint112s. The largest such ratio is (2\u00b9\u00b9\u00b2\u22121) / 1 = 2\u00b9\u00b9\u00b2 \u2212 1.</p> <p>\u5728 UniswapV2Pair.sol \u5408\u7ea6\u4e2d\uff0c<code>reserve0</code>\u3001<code>reserve1</code> \u88ab\u5b9a\u4e49\u4e3a <code>uint112</code> \u7c7b\u578b\uff0c\u6700\u5927\u4ef7\u683c\u60c5\u51b5\u662f\uff1a\u4e00\u8fb9\u50a8\u5907\u63a5\u8fd1 <code>2\u00b9\u00b9\u00b2\u22121</code>\uff0c\u53e6\u4e00\u8fb9\u63a5\u8fd1 1\uff0c\u6240\u4ee5\u4ef7\u683c\u6700\u5927 \u2248 <code>(2\u00b9\u00b9\u00b2\u22121) / 1 \u2248 2\u00b9\u00b9\u00b2\u22121</code>\u3002</p> <p>\u8865\u5145\uff1a\u50a8\u5907\u91d1 <code>reserve0</code>\u3001<code>reserve1</code> \u662f\u6574\u6570\u8ba1\u6570\uff08<code>uint112</code>\uff09\uff0c\u6ca1\u6709\u5c0f\u6570\u4f4d\uff0c\u8868\u793a\u6c60\u5b50\u91cc\u771f\u5b9e\u5b58\u5728\u7684 Token \u6570\u91cf\uff0c\u662f\u4e0d\u53ef\u518d\u7ec6\u5206\u7684\u6700\u5c0f\u5355\u4f4d\uff08wei\u3001\u6700\u5c0f ERC20 \u5355\u4f4d\uff09\uff0c\u7406\u8bba\u4e0a\u50a8\u5907\u6700\u5c0f\u80fd\u5230 1\uff0c\u6700\u5927\u4e3a <code>2\u00b9\u00b9\u00b2\u22121</code>\u3002</p> <p>\u8fd9\u4fdd\u8bc1\u4e86\u6574\u6570\u90e8\u5206\u6700\u591a\u9700\u8981 112 \u4f4d\u5c31\u591f\u4e86\uff080 ~ 2\u00b9\u00b9\u00b2\u22121\uff09\uff0c\u5c0f\u6570\u90e8\u5206\u518d\u7ed9 112 \u4f4d\uff0c\u6574\u4f53 224 \u4f4d\uff0c\u521a\u597d\u653e\u8fdb <code>uint224</code>\u3002</p> \u6982\u5ff5 \u503c\u8303\u56f4 \u6570\u636e\u7c7b\u578b \u7528\u9014 reserve0, reserve1 0 ~ 2\u00b9\u00b9\u00b2\u22121 uint112 \u50a8\u5907\u6570\u91cf\uff08\u6574\u6570\uff09 price = reserve1/reserve0 0 ~ 2\u00b9\u00b9\u00b2\u22121.xxx UQ112.112 \u4ef7\u683c\uff08\u5c0f\u6570 + \u9ad8\u7cbe\u5ea6\uff09 UQ112.112 \u5c0f\u6570\u4f4d 2\u207b\u00b9\u00b9\u00b2 \u5e95\u5c42\u4f4d\u79fb \u8868\u793a\u4ef7\u683c\u7684\u5c0f\u6570\u90e8\u5206 <p>\u7cbe\u5ea6\u4e0a\uff0c\u4e00\u4e2a UQ112.112 \u7684\u6700\u5c0f\u5355\u4f4d\u662f <code>1 / 2\u00b9\u00b9\u00b2</code>\uff0c\u5927\u7ea6 10\u207b\u00b3\u2074 \u91cf\u7ea7\uff0c\u8fdc\u8fdc\u6bd4 1e-18 \u8fd8\u7ec6\uff0c\u5bf9\u4e8e\u73b0\u5b9e\u4e2d token 18 decimals\u3001\u4ef7\u683c\u51e0\u4f4d\u5c0f\u6570\u7684\u5e94\u7528\uff0c\u8fd9\u4e2a\u7cbe\u5ea6\u5b8c\u5168\u591f\u7528\u4e14\u6d6a\u8d39\u4e00\u70b9\u6ca1\u5173\u7cfb\uff0c\u91cd\u70b9\u662f\u65b9\u4fbf\u6570\u5b66\u548c\u5b58\u50a8\u5e03\u5c40\u3002</p>"},{"location":"web3/defi/uniswap_v2_price_precision_240710/#112112","title":"\u4e8c\u3001 \u4e3a\u4ec0\u4e48\u662f 112+112\uff1f\u5b58\u50a8\u69fd\u7684\u7cbe\u5999\u8bbe\u8ba1","text":"<p>\u8fd9\u662f\u6574\u4e2a\u8bbe\u8ba1\u6700\u5de7\u5999\u7684\u5730\u65b9\uff0c\u6d89\u53ca\u5230Gas\u4f18\u5316\u548c\u5b58\u50a8\u5e03\u5c40\u3002</p> <p>EVM \u5b58\u50a8\u69fd\u57fa\u7840\uff1aEVM \u7684\u4e00\u4e2a\u5b58\u50a8\u69fd\uff08storage slot\uff09= 256\u4f4d\uff0c\u6bcf\u6b21 <code>SSTORE</code> \u64cd\u4f5c\uff08\u5199\u5165\u5b58\u50a8\uff09\u6d88\u8017\u5927\u91cf Gas\uff08~20,000 gas\uff09\uff0c\u6253\u5305\u5b58\u50a8\uff08packing\uff09\u53ef\u4ee5\u5728\u4e00\u4e2a\u69fd\u5185\u5b58\u591a\u4e2a\u53d8\u91cf\uff0c\u8282\u7701 Gas\u3002</p> <p>\u767d\u76ae\u4e66\u5173\u952e\u53e5\uff1a</p> <p>The UQ112.112 format was chosen for a pragmatic reason \u2014 because these numbers can be stored in a uint224, this leaves 32 bits of a 256 bit storage slot free. It also happens that the reserves, each stored in a uint112, also leave 32 bits free in a (packed) 256 bit storage slot.</p> <p>\u4ece\u4ee5\u592a\u574a\u5408\u7ea6\u5b58\u50a8\u89c6\u89d2\u6765\u770b\u5c31\u662f\uff1a</p> <ul> <li>\u50a8\u5907\u91d1\u5b58\u50a8\uff1a\u6bcf\u4e2a\u50a8\u5907\u91d1\uff08<code>uint112</code>\uff09\u7528\u4e86 112 \u4f4d\uff0c\u4e24\u4e2a <code>uint112</code> \u53ef\u4ee5\u7d27\u5bc6\u6253\u5305\u5728\u4e00\u4e2a 256 \u4f4d\u7684\u5b58\u50a8\u69fd\u91cc\uff0c\u7559\u4e0b <code>256 - 2*112 = 32</code> \u4f4d\u7a7a\u95f2\u3002</li> <li>\u4ef7\u683c\u5b58\u50a8\uff1a\u4ef7\u683c\u4f5c\u4e3a\u4e24\u4e2a <code>uint112</code> \u50a8\u5907\u91d1\u7684\u6bd4\u7387\uff0c\u81ea\u7136\u53ef\u4ee5\u8868\u793a\u4e3a\u4e00\u4e2a <code>UQ112.112</code> \u6570\uff0c\u5b83\u521a\u597d\u80fd\u88c5\u8fdb\u4e00\u4e2a <code>uint224</code>\uff08224\u4f4d\uff09\u3002</li> <li> <p>\u7a7a\u95f2\u4f4d\u7684\u5229\u7528\uff1a\u6838\u5fc3\u6765\u4e86\uff01\u90a3\u4e2a\u7a7a\u95f2\u7684 32 \u4f4d\uff08\u6765\u81ea\u50a8\u5907\u91d1\u5b58\u50a8\u69fd\uff09\u548c\u4ef7\u683c\u5b58\u50a8\u69fd\u672b\u5c3e\u7684 32 \u4f4d\uff0c\u88ab\u5de7\u5999\u5730\u7528\u6765\uff1a</p> </li> <li> <ul> <li>\u5b58\u50a8\u65f6\u95f4\u6233\uff08\u6a21 <code>2^32</code>\uff0c\u521a\u597d 32 \u4f4d\uff09\uff1b</li> </ul> </li> <li>\u5b58\u50a8\u4ef7\u683c\u7d2f\u52a0\u8fc7\u7a0b\u4e2d\u7684\u6ea2\u51fa\u4f4d\uff08\u56e0\u4e3a\u8fde\u7eed\u7d2f\u52a0\u53ef\u80fd\u8d85\u8fc7 224 \u4f4d\uff09\u3002</li> </ul> <p>\u5728\u4e0d\u652f\u6301\u6d6e\u70b9\u6570\u7684 EVM \u4e2d\uff0c\u7528\u6574\u6570\u8fd0\u7b97\u6765\u6a21\u62df\u9ad8\u7cbe\u5ea6\u7684\u5c0f\u6570\u8fd0\u7b97\uff0c\u540c\u65f6\u5b8c\u7f8e\u5951\u5408\u5b58\u50a8\u5e03\u5c40\uff0c\u5c06\u9884\u8a00\u673a\u66f4\u65b0\u7684 Gas \u6210\u672c\u964d\u81f3\u6700\u4f4e\uff08\u4ec5\u9996\u6b21\u4ea4\u6613\u589e\u52a0\u7ea6 15,000 gas\uff09\u3002</p>"},{"location":"web3/defi/uniswap_v2_price_precision_240710/#21-uniswap-v2","title":"2.1 Uniswap V2\u7684\u5b58\u50a8\u5e03\u5c40","text":"<p>\u5b9e\u9645\u4ee3\u7801\u7ed3\u6784\uff08\u7b80\u5316\u7248\uff09\uff1a</p> <pre><code>contract UniswapV2Pair {\n    uint112 private reserve0;           // 112\u4f4d\n    uint112 private reserve1;           // 112\u4f4d  \n    uint32  private blockTimestampLast; // 32\u4f4d\n    // \u603b\u5171: 112 + 112 + 32 = 256\u4f4d = 1\u4e2a\u5b58\u50a8\u69fd\uff01\n\n    uint224 public price0CumulativeLast; // 224\u4f4d\n    uint32  private overflowBits0;       // 32\u4f4d\uff08\u6ea2\u51fa\u90e8\u5206\uff09\n    // \u603b\u5171: 224 + 32 = 256\u4f4d = 1\u4e2a\u5b58\u50a8\u69fd\uff01\n\n    uint224 public price1CumulativeLast; // 224\u4f4d\n    uint32  private overflowBits1;       // 32\u4f4d\uff08\u6ea2\u51fa\u90e8\u5206\uff09\n    // \u603b\u5171: 224 + 32 = 256\u4f4d = 1\u4e2a\u5b58\u50a8\u69fd\uff01\n}\n</code></pre> <p>Solidity \u7684 storage packing \u89c4\u5219\uff1a\u5728\u540c\u4e00\u4e2a <code>slot(256bit)</code> \u91cc\u5c3d\u91cf\u585e\u6ee1\u7d27\u6328\u7740\u7684\u5c0f\u7c7b\u578b\uff1a</p> <ul> <li>112 + 112 + 32 = 256</li> <li>\u521a\u597d\u585e\u6ee1\u4e00\u4e2a 256 \u4f4d\u69fd\uff0c\u4e0d\u6d6a\u8d39\u3001\u4e0d\u591a\u7528 gas\u3002</li> </ul> <p>\u8fd9\u5c31\u662f\u201cpacked 256 bit storage slot\u201d\u7684\u542b\u4e49\uff1a\u4e24\u4e2a\u50a8\u5907 + 1 \u4e2a 32bit \u65f6\u95f4\u6233\uff0c\u6574\u6574\u9f50\u9f50\u653e\u5728\u4e00\u4e2a\u69fd\u91cc\u3002</p>"},{"location":"web3/defi/uniswap_v2_price_precision_240710/#22-32","title":"2.2 \u7d2f\u79ef\u4ef7\u683c\u5e03\u5c40\uff1a\u4e3a\u4ec0\u4e48\u9700\u8981\u989d\u5916\u768432\u4f4d\uff1f","text":"<p>\u767d\u76ae\u4e66\u63a5\u7740\u8bf4\uff1a</p> <p>although the price at any given moment (stored as a UQ112.112 number) is guaranteed to fit in 224 bits, the accumulation of this price over an interval is not. The extra 32 bits on the end of the storage slots for the accumulated price of A/B and B/A are used to store overflow bits resulting from repeated summations of prices.</p> <p>\u767d\u76ae\u4e66\u8bf4\uff1a\"\u867d\u7136\u4efb\u4f55\u7ed9\u5b9a\u65f6\u523b\u7684\u4ef7\u683c\u4fdd\u8bc1\u9002\u5408224\u4f4d\uff0c\u4f46\u8be5\u4ef7\u683c\u5728\u4e00\u4e2a\u533a\u95f4\u5185\u7684\u7d2f\u79ef\u5219\u4e0d\u7136\u3002\"</p> <ul> <li>\u77ac\u65f6\u4ef7\u683c\uff1aUQ112.112\uff0c\u7528 <code>uint224</code> \u5c31\u591f\u5b58\uff1b</li> <li>\u7d2f\u79ef\u4ef7\u683c\uff1a<code>priceCumulativeLast += price * timeElapsed</code>\uff0c<code>price</code> \u662f UQ112.112\uff08224 \u4f4d\uff09\uff0c<code>timeElapsed</code> \u662f <code>uint32</code> \u79d2\u6570\uff0c\u6bcf\u6b21\u4e58\u6cd5\u7ed3\u679c\u53ef\u80fd\u9700\u8981 224 + 32 = 256 \u4f4d\uff0c\u518d\u4e0d\u65ad\u7d2f\u52a0\uff0c\u80af\u5b9a\u4f1a\u201c\u7406\u8bba\u4e0a\u6ea2\u51fa 224 \u4f4d\u201d\u3002</li> </ul> <pre><code>if (timeElapsed &gt; 0 &amp;&amp; _reserve0 != 0 &amp;&amp; _reserve1 != 0) {\n    price0CumulativeLast += uint(\n        UQ112x112.encode(_reserve1).uqdiv(_reserve0)\n    ) * timeElapsed;\n    price1CumulativeLast += uint(\n        UQ112x112.encode(_reserve0).uqdiv(_reserve1)\n    ) * timeElapsed;\n}\n</code></pre> <p>\u6ce8\u610f\u51e0\u70b9\uff1a</p> <ul> <li><code>UQ112x112.encode(...).uqdiv(...)</code> \u8fd4\u56de\u7684\u662f\u4e00\u4e2a <code>uint224</code> \u7684 UQ112.112 \u6570\u3002</li> <li><code>uint(...)</code> \u8f6c\u6210 <code>uint256</code>\uff0c\u518d\u4e58 <code>timeElapsed (uint32)</code>\uff0c\u6574\u4f53\u7528 256 \u4f4d\u505a\u7b97\u672f\u3002</li> <li>\u6ea2\u51fa\u884c\u4e3a\u662f\u6309 <code>mod 2\u00b2\u2075\u2076</code> \u6765\u7684\uff08Solidity 0.5/0.6 \u4e0b\uff0c\u9ed8\u8ba4 wrap around\uff09\u3002</li> </ul> <p>\u76f4\u89c9\u7406\u89e3\uff1a\u201c\u6211\u7528 224 \u4f4d\u5b58\u4ef7\u683c\u5c0f\u6570\uff0c\u989d\u5916\u5f00\u4e86 32 \u4f4d\u5f53\u7f13\u51b2\u533a\uff0c\u7ed9\u957f\u671f\u7d2f\u52a0\u7559\u7a7a\u95f4\u3002\u771f\u6b63\u62ff\u6765\u7b97 TWAP \u662f\u7528\u5dee\u503c\u9664\u4ee5\u65f6\u95f4\u95f4\u9694\uff0c\u6240\u4ee5\u53ea\u8981\u4e0b\u6e38\u7528\u540c\u6837\u7684 \u2018\u53d6\u6a21 + \u6ea2\u51fa\u5b89\u5168\u7b97\u672f\u2019\uff0c\u5c31\u80fd\u6b63\u786e\u6062\u590d\u5e73\u5747\u503c\u3002\u201d</p>"},{"location":"web3/defi/uniswap_v2_price_precision_240710/#32","title":"\u4e09\u3001\u65f6\u95f4\u6233\u768432\u4f4d\u9650\u5236\u4e0e\u6ea2\u51fa\u5b89\u5168","text":"<p>\u767d\u76ae\u4e66\u8fd9\u6bb5\u8bdd\u662f\u5bb9\u6613\u7591\u60d1\u7684\u5730\u65b9\uff1a</p> <p>The primary downside is that 32 bits isn't quite enough to store timestamp values that will reasonably never overflow. In fact, the date when the Unix timestamp overflows a uint32 is 02/07/2106. To ensure that this system continues to function properly after this date, and every multiple of 2\u00b3\u00b2 - 1 seconds thereafter, oracles are simply required to check prices at least once per interval (approximately 136 years). This is because the core method of accumulation (and modding of timestamp), is actually overflow-safe, meaning that trades across overflow intervals can be appropriately accounted for given that oracles are using the proper (simple) overflow arithmetic to compute deltas.</p> <p>\u7ffb\u8bd1\u6210\u4e2d\u6587\u6765\u7406\u89e3\uff1a</p> <p>32 \u4f4d\u7684\u4e3b\u8981\u7f3a\u70b9\u5728\u4e8e\uff1a\u5b83\u4e0d\u8db3\u4ee5\u5b58\u50a8\u201c\u6c38\u8fdc\u4e0d\u4f1a\u6ea2\u51fa\u201d\u7684\u65f6\u95f4\u6233\u503c\u3002\u4e8b\u5b9e\u4e0a\uff0cUnix \u65f6\u95f4\u6233\u5728 <code>uint32</code> \u4e2d\u6ea2\u51fa\u7684\u65e5\u671f\u662f 2106 \u5e74 2 \u6708 7 \u65e5\u3002\u4e3a\u4e86\u786e\u4fdd\u8fd9\u4e2a\u7cfb\u7edf\u5728\u8be5\u65e5\u671f\u4e4b\u540e\u4ecd\u80fd\u6b63\u5e38\u8fd0\u884c\uff0c\u5e76\u5728\u4e4b\u540e\u6bcf\u7ecf\u8fc7 <code>2\u00b3\u00b2 - 1</code> \u79d2\uff08\u5927\u7ea6 136 \u5e74\uff09\u518d\u6b21\u6ea2\u51fa\u65f6\u7ee7\u7eed\u6b63\u5e38\u5de5\u4f5c\uff0c\u9884\u8a00\u673a\uff08oracles\uff09\u53ea\u9700\u8981\u505a\u5230\u4e00\u4ef6\u4e8b\uff1a\u5728\u6bcf\u4e2a\u5468\u671f\u91cc\u81f3\u5c11\u68c0\u67e5\u4e00\u6b21\u4ef7\u683c\uff08\u4e5f\u5c31\u662f\u5927\u7ea6\u6bcf 136 \u5e74\u68c0\u67e5\u4e00\u6b21\uff09\u3002</p> <p>\u8fd9\u662f\u56e0\u4e3a\u7d2f\u79ef\uff08accumulation\uff09\u4ee5\u53ca\u5bf9\u65f6\u95f4\u6233\u8fdb\u884c\u53d6\u6a21\uff08modding of timestamp\uff09\u7684\u6838\u5fc3\u65b9\u6cd5\u672c\u8eab\u662f\u6ea2\u51fa\u5b89\u5168\u7684\u3002\u53ea\u8981\u9884\u8a00\u673a\u5728\u8ba1\u7b97\u65f6\u95f4\u5dee\uff08delta\uff09\u65f6\u4f7f\u7528\u6b63\u786e\u7684\uff08\u7b80\u5355\u7684\uff09\u6ea2\u51fa\u7b97\u672f\uff0c\u5373\u4f7f\u4ea4\u6613\u8de8\u8d8a\u4e86\u65f6\u95f4\u6233\u6ea2\u51fa\u7684\u95f4\u9694\uff0c\u4e5f\u4ecd\u7136\u80fd\u591f\u88ab\u6b63\u786e\u8bb0\u8d26\u3002</p>"},{"location":"web3/defi/uniswap_v2_price_precision_240710/#31-mod-232","title":"3.1 \u4e3a\u4ec0\u4e48\u65f6\u95f4\u6233\u8981 mod 2\u00b3\u00b2\uff1f","text":"<p>\u8fd9\u8ddf\u524d\u9762\u8bf4\u7684\u201c\u4e24\u4e2a <code>uint112</code> + \u4e00\u4e2a <code>uint32</code> \u62fc\u5728\u540c\u4e00\u69fd\u201d\u662f\u540c\u4e00\u4e2a\u8bbe\u8ba1\uff1a</p> <p><code>block.timestamp</code> \u662f\u4e00\u4e2a\u4e0d\u65ad\u589e\u5927\u7684 Unix \u65f6\u95f4\u6233\uff08\u79d2\uff09\uff0c\u4e3a\u4e86\u585e\u8fdb 32 \u4f4d\uff0c\u8981\u505a\uff1a<code>uint32 blockTimestamp = uint32(block.timestamp % 2**32)</code>\uff0c\u5b58\u7684\u65f6\u5019\u53ea\u4fdd\u7559\u4f4e 32 \u4f4d\uff08\u5bf9 2\u00b3\u00b2 \u53d6\u6a21\uff09\u3002</p> <p>\u66f4\u65b0\u65f6 <code>_update()</code> \u7684\u6d41\u7a0b\uff08\u7b80\u5316\uff09\uff1a</p> <pre><code>uint32 blockTimestamp = uint32(block.timestamp % 2**32);\nuint32 timeElapsed = blockTimestamp - blockTimestampLast; // \u6ce8\u610f\uff1a\u8fd9\u662f uint32 \u51cf\u6cd5\n// timeElapsed \u5c31\u662f\u201c\u81ea\u4e0a\u6b21\u66f4\u65b0\u4ee5\u6765\u7ecf\u8fc7\u7684\u79d2\u6570\u201d\uff0c\u4f46\u6709\u6ea2\u51fa\u8bed\u4e49\n</code></pre> <p>\u8fd9\u4e00\u6b65\u7684\u5173\u952e\uff1a<code>uint32</code> \u7684\u51cf\u6cd5\u5728\u6ea2\u51fa\u65f6\u81ea\u52a8\u6309 2\u00b3\u00b2 \u53d6\u6a21\u3002</p> <p>\u5728\u6ca1\u6ea2\u51fa\u7684\u4e00\u822c\u60c5\u51b5\u4e0b\uff1a<code>timeElapsed = current - last</code></p> <p>\u5728\u7ecf\u5386\u8fc7\u4e00\u6b21 2\u00b3\u00b2 \u6ea2\u51fa\uff08\u65f6\u95f4\u6233\u7ed5\u4e86\u4e00\u5708\uff09\uff1a\u5047\u8bbe <code>last = 2\u00b3\u00b2 - 10</code>\uff0c<code>current = 5</code>\uff08\u7ed5\u4e86\u4e00\u5708 +5 \u79d2\uff09\uff0c<code>timeElapsed = 5 - (2\u00b3\u00b2 - 10)</code>\uff0c\u5728 <code>uint32</code> \u4e0b\u7b49\u4ef7\u4e8e\uff1a<code>timeElapsed = 5 + 10 = 15</code>\uff0c\u4e5f\u5c31\u662f\uff1a\u5b9e\u9645\u7ecf\u8fc7\u7684\u65f6\u95f4\uff0810 \u79d2\u5230\u5708\u5c3e + 5 \u79d2\u5230\u5f53\u524d\uff09\u3002</p> <p>\u8fd9\u5c31\u662f\u767d\u76ae\u4e66\u6240\u8bf4\u7684\u201coverflow-safe accumulation\u201d\uff1a\u53ea\u8981\u59cb\u7ec8\u7528\u540c\u6837\u7684 32 \u4f4d\u53d6\u6a21 + \u6ea2\u51fa\u8bed\u4e49\uff0c\u4e0d\u9700\u8981\u5173\u5fc3\u65f6\u95f4\u6233\u201c\u7ed5\u4e86\u51e0\u5708\u201d\uff0c\u6bcf\u6b21 delta \u90fd\u662f\u6b63\u786e\u7684\u3002</p>"},{"location":"web3/defi/uniswap_v2_price_precision_240710/#32_1","title":"3.2 \u4e3a\u4ec0\u4e48\u8bf4\u201c\u6ea2\u51fa\u5b89\u5168\u201d\uff1f","text":"<p>2\u00b3\u00b2 \u79d2 \u2248 4,294,967,296 \u79d2 \u2248 136 \u5e74\u3002</p> <p>\u6838\u5fc3\u95ee\u9898\u5728\u4e8e\uff1aTWAP \u7684\u8c03\u7528\u65b9\u4e5f\u8981\u7528\u540c\u6837\u7684\u6ea2\u51fa\u7b97\u672f\u3002</p> <p>\u8c03\u7528\u65b9\u901a\u5e38\u8fd9\u6837\u7b97\u4ef7\u683c\uff08\u6765\u81ea\u767d\u76ae\u4e66 2.2\uff09\uff1a</p> <ul> <li>\u5728 t1 \u65f6\u523b\u8bfb\u53d6\u4e00\u6b21 priceCumulativeLast\uff0c\u8bb0\u4f5c a1</li> <li>\u5728 t2 \u65f6\u523b\u518d\u8bfb\u4e00\u6b21 a2</li> <li>TWAP \u2248 (a2 - a1) / (t2 - t1)</li> </ul> <p>\u5982\u679c\uff1a</p> <ul> <li>t1 \u548c t2 \u4e4b\u95f4\u8de8\u8d8a\u4e86\u591a\u6b21 2\u00b3\u00b2 \u6ea2\u51fa\u5468\u671f\uff08\u6bd4\u5982\u9694\u4e86 300 \u5e74\uff0c\u7ed5\u4e86\u4e24\u5708\u591a\uff09\uff0c\u90a3\u4e48\u5355\u7eaf\u7528 32 \u4f4d\u65f6\u95f4\u6233\u5dee\u503c\u5c31\u4e0d\u591f\u533a\u5206\u4e86\u3002</li> <li>\u4f46\u53ea\u8981\u6bcf\u4e2a 2\u00b3\u00b2 \u79d2\uff08\u7ea6 136 \u5e74\uff09\u5185\u81f3\u5c11\u8bfb\u4e00\u6b21\uff0c\u4f60\u4e0d\u4f1a\u8de8\u8d8a\u8d85\u8fc7\u4e00\u5708\u7684\u6a21\u6570\uff0ct2 - t1 \u7684 32 \u4f4d\u6ea2\u51fa\u8bed\u4e49\u4ecd\u80fd\u6b63\u786e\u4ee3\u8868\u771f\u5b9e\u7ecf\u8fc7\u7684\u79d2\u6570\u3002</li> </ul> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff1a\u5047\u8bbe</p> <ul> <li>t1 =2^32-100\uff08\u6ea2\u51fa\u524d100\u79d2\uff09</li> <li>t2 =50\uff08\u6ea2\u51fa\u540e50\u79d2\uff0c\u5b9e\u9645\u65f6\u95f4\u6233\uff09</li> </ul> <p>\u76f4\u63a5\u76f8\u51cf\u4f1a\u51fa\u9519\uff1a<code>50 - (2^32 - 100) = \u8d1f\u6570</code>\uff0c\u4f46\u4f7f\u7528 <code>uint32</code> \u7684\u6a21\u8fd0\u7b97\uff1a</p> <p>\u65f6\u95f4\u5dee = <code>uint32(t2 - t1) = uint32(50-(2^32-100)) = uint32(-2^32+150)</code> = 150 \u79d2</p> <p>\u53ea\u8981\u4e24\u6b21\u91c7\u6837\u95f4\u9694 &lt; 2^32\u79d2\uff08136\u5e74\uff09\uff0c\u8ba1\u7b97\u5c31\u662f\u6b63\u786e\u7684\u3002</p>"}]}