{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"]},"docs":[{"location":"","title":"Welcome to My Blog","text":"<p> \u7ea6 72 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4\u4e0d\u5230 1 \u5206\u949f</p> <p>Hi! Nice to see you! I'm a Web3 developer.</p> <ul> <li>Github\uff1aLifefindsitsway</li> <li>Notion Page\uff1aWeb3 Tutorials</li> </ul> File Name Description Crypto Laws \u6574\u7406 Crypto \u9886\u57df\u7684\u6cd5\u5f8b\u6cd5\u89c4\u4fe1\u606f\u3001\u53f8\u6cd5\u6848\u4f8b Blockchain &amp; Crypto &amp; Web3 \u6574\u7406 Blockchain &amp; Crypto &amp; Web3 \u76f8\u5173\u8d44\u6599 DeFi &amp; DAPP Development Tutorials DAPP\u3001DeFi \u76f8\u5173\u8d44\u6599 Web3 Entrepreneurship Web3 \u521b\u4e1a\u76f8\u5173 Meme Meme \u4f18\u8d28\u8d44\u6599"},{"location":"changelog/","title":"\u66f4\u65b0\u65e5\u5fd7","text":"<p> \u7ea6 295 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 1 \u5206\u949f</p> <ul> <li>2026-01-01\uff1a\u95ea\u7535\u8d37\uff1a\u4ece\u539f\u7406\u5230\u653b\u51fb\u6f14\u793a</li> <li>2025-11-13:<ul> <li>Gas \u4f18\u5316\u6307\u5357\uff08\u4e00\uff09\uff1aGas \u673a\u5236\u539f\u7406</li> <li>Gas \u4f18\u5316\u6307\u5357\uff08\u4e8c\uff09\uff1aEIP-1559 \u4ea4\u6613\u89e3\u6790</li> <li>Gas \u4f18\u5316\u6307\u5357\uff08\u4e09\uff09\uff1a\u5b58\u50a8\u4f18\u5316</li> <li>Gas \u4f18\u5316\u6307\u5357\uff08\u56db\uff09\uff1a\u8ba1\u7b97\u4f18\u5316</li> <li>Gas \u4f18\u5316\u6307\u5357\uff08\u4e94\uff09\uff1aGas \u8bc4\u4f30\u4e0e\u6d4b\u91cf</li> </ul> </li> <li>2024-06-10\uff1aUniswap V2 \u4ef7\u683c\u7cbe\u5ea6\u89e3\u6790</li> <li>2024-06-01\uff1a<ul> <li>Solidity \u4ee3\u7406\u5408\u7ea6\u4e0e\u53ef\u5347\u7ea7\u5408\u7ea6\u7cfb\u5217\uff08\u4e00\uff09\uff1a\u4e3a\u4ec0\u4e48\u9700\u8981\u53ef\u5347\u7ea7\uff1f</li> <li>Solidity \u4ee3\u7406\u5408\u7ea6\u4e0e\u53ef\u5347\u7ea7\u5408\u7ea6\u7cfb\u5217\uff08\u4e8c\uff09\uff1a\u900f\u660e\u4ee3\u7406 vs UUPS</li> </ul> </li> <li>2024-05-27\uff1aSolidity \u5408\u7ea6\u95f4\u8c03\u7528\uff08\u4e09\uff09\uff1a\u521b\u5efa\u5408\u7ea6\u7684\u4e24\u79cd\u65b9\u5f0f\uff1acreate \u4e0e create2</li> <li>2024-05-23\uff1aSolidity \u5408\u7ea6\u95f4\u8c03\u7528\uff08\u4e8c\uff09\uff1a\u5e95\u5c42\u8c03\u7528\u4e0e calldata \u8be6\u89e3</li> <li>2024-05-21\uff1aSolidity \u5408\u7ea6\u95f4\u8c03\u7528\uff08\u4e00\uff09\uff1a\u56db\u79cd\u65b9\u5f0f\u8c03\u7528\u5df2\u90e8\u7f72\u5408\u7ea6</li> <li>2024-04-15\uff1aHardhat \u5165\u95e8\u6307\u5357\uff0825\u5e74\u66f4\u65b0\u7248\uff09</li> <li>2024-04-13\uff1aEVM \u57fa\u7840\u539f\u7406\uff08\u4e09\uff09\uff1aABI \u7f16\u7801\u4e0e\u5e95\u5c42\u8c03\u7528</li> <li>2024-04-11\uff1aEVM \u57fa\u7840\u539f\u7406\uff08\u4e8c\uff09\uff1a\u6570\u636e\u533a\u57df\u4e0e\u5408\u7ea6\u6267\u884c</li> <li>2024-04-10\uff1aEVM \u57fa\u7840\u539f\u7406\uff08\u4e00\uff09\uff1a\u4ece\u4ea4\u6613\u5230\u5b57\u8282\u7801</li> <li>2024-03-21\uff1aSolidity \u5730\u5740\u7c7b\u578b &amp; \u5e38\u89c1\u7528\u6cd5\u5168\u653b\u7565</li> <li>2024-03-20\uff1a\u4e3a\u4ec0\u4e48\u4ee5\u592a\u574a\u5730\u5740\u662f 20 \u5b57\u8282\uff1f\u4ece\u79c1\u94a5\u5230\u5730\u5740\u7684\u5168\u89e3\u6790</li> <li>2024-02-13\uff1a\u6bd4\u7279\u5e01\u7684\u8bde\u751f\u5386\u7a0b</li> <li>2021-01: \u5357\u4eac\u5927\u5b66\u516c\u5f00\u8bfe\u300a\u533a\u5757\u94fe\u4e0e\u521b\u65b0\u601d\u7ef4\u300b\u5b66\u4e60\u7b14\u8bb0</li> </ul>"},{"location":"blockchain/blockchain_and_innovative_thinking_notes_2101/","title":"\u5357\u4eac\u5927\u5b66\u516c\u5f00\u8bfe\u300a\u533a\u5757\u94fe\u4e0e\u521b\u65b0\u601d\u7ef4\u300b\u5b66\u4e60\u7b14\u8bb0","text":"<p> \u7ea6 11588 \u4e2a\u5b57  15 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 39 \u5206\u949f</p> <p>\u8fd9\u7bc7\u6587\u6863\u662f 2021 \u5e74 1 \u6708\u6211\u5b66\u4e60\u5357\u4eac\u5927\u5b66\u516c\u5f00\u8bfe\u300a\u533a\u5757\u94fe\u4e0e\u521b\u65b0\u601d\u7ef4\u300b\u65f6\u6574\u7406\u7684\u90e8\u5206\u7b14\u8bb0\uff0c\u4e3a\u5b8c\u6210\u6bd5\u4e1a\u8bbe\u8ba1\u800c\u5b66\u4e60\u7684\u533a\u5757\u94fe\u57fa\u7840\u7406\u8bba\uff0c\u4e5f\u662f\u6211\u8e0f\u5165\u533a\u5757\u94fe\u9886\u57df\u7684\u542f\u8499\u8bfe\u7a0b\u3002</p> <p>\u516c\u5f00\u8bfe\u5730\u5740\uff1ahttps://www.icourse163.org/course/NJU-1449346161</p>"},{"location":"blockchain/blockchain_and_innovative_thinking_notes_2101/#_1","title":"\u7b2c\u4e00\u7ae0\uff1a\u4ec0\u4e48\u662f\u533a\u5757\u94fe\u548c\u533a\u5757\u94fe\u601d\u7ef4","text":""},{"location":"blockchain/blockchain_and_innovative_thinking_notes_2101/#11","title":"1.1\u3001\u533a\u5757\u94fe\u7684\u5c0f\u6545\u4e8b","text":"<p>\u53bb\u4e2d\u5fc3\u5316\u601d\u60f3</p> <p>\u7ecf\u8fc7\u6539\u9769\u4ee5\u540e\uff0c\u7389\u77f3\u6751\u7684\u6bcf\u4e00\u4e2a\u6751\u6c11\u624b\u91cc\u90fd\u62e5\u6709\u4e00\u4e2a\u8d26\u672c\u3002\u6bcf\u4e2a\u8d26\u672c\u91cc\u5934\u90fd\u8bb0\u5f55\u7740\u6751\u6c11\u6316\u51fa\u7389\u77f3\u7684\u4fe1\u606f\uff0c\u6452\u5f03\u4e86\u4ee5\u5f80\u53ea\u6709\u6751\u957f\u624b\u91cc\u552f\u4e00\u8d26\u672c\u7684\u201c\u4e2d\u5fc3\u5316\u201d\u8bb0\u8d26\u65b9\u5f0f\uff0c\u91c7\u53d6\u4e86\u4eba\u624b\u4e00\u4e2a\u8d26\u672c\u7684 \u201c\u53bb\u4e2d\u5fc3\u5316\u201d\u5206\u5e03\u5f0f\u8bb0\u8d26\u65b9\u5f0f\u3002</p> <p>\u9632\u7be1\u6539\u601d\u60f3</p> <p>\u5728\u6bcf\u4e2a\u6751\u6c11\u7684\u8d26\u672c\u91cc\uff0c\u4f1a\u7ed9\u6bcf\u5757\u7389\u77f3\u90fd\u505a\u4e0a\u6807\u8bb0\uff0c\u8bb0\u5f55\u7389\u77f3\u6316\u6398\u5230\u7684\u65f6\u95f4\u3001\u5730\u70b9\u548c\u4eba\u7269\uff0c\u4ee5\u53ca\u4e0a\u4e00\u5757\u88ab\u6316\u5230\u7684\u7389\u77f3\u7684\u4fe1\u606f\u3002\u8fd9\u6837\uff0c\u6bcf\u5757\u7389\u90fd\u4e0e\u4e0a\u4e00\u5757\u7389\u5f62\u6210\u4fe1\u606f\u5173\u8054\uff0c\u4e32\u8054\u6210\u4e00\u4e2a\u94fe\u6761\u3002\u8fd9\u79cd\u65b9\u5f0f\u4f7f\u5f97\u8c01\u90fd\u65e0\u6cd5\u51ed\u7a7a\u634f\u9020\uff0c\u4e5f\u65e0\u6cd5\u66f4\u6539\u4e4b\u524d\u7684\u8bb0\u5f55\uff0c\u4ece\u800c\u505a\u5230\u4e86 \u201c\u9632\u7be1\u6539\u201d\u3002</p> <p>\u4ea4\u6613\u4fe1\u606f\u516c\u5f00\u900f\u660e\u7684\u601d\u60f3</p> <p>\u5f53\u6709\u6751\u6c11\u6316\u5230\u7389\u77f3\u4e4b\u540e\uff0c\u4ed6\u5728\u81ea\u5df1\u7684\u8d26\u672c\u4e0a\u8bb0\u5f55\u7684\u540c\u65f6\uff0c\u4f1a\u7528\u6751\u53e3\u7684\u5927\u5587\u53ed\u5411\u5168\u6751\u5e7f\u64ad\u901a\u77e5\u3002\u542c\u5230\u901a\u77e5\u540e\uff0c\u6240\u6709\u6751\u6c11\u90fd\u5728\u5404\u81ea\u7684\u672c\u5b50\u4e0a\u5199\u4e0b\u540c\u6837\u7684\u5185\u5bb9\u3002\u56e0\u6b64\uff0c\u6240\u6709\u6751\u6c11\u90fd\u62e5\u6709\u4e00\u4efd\u5b8c\u6574\u7684\u3001\u540c\u6b65\u7684\u7389\u77f3\u4fe1\u606f\uff0c\u4ed6\u4eec\u53ef\u4ee5\u968f\u65f6\u7ffb\u9605\u81ea\u5df1\u7684\u8d26\u672c\u8fdb\u884c\u67e5\u8be2\u3002</p> <p>\u5171\u8bc6</p> <p>\u6700\u540e\u662f\u5171\u8bc6\u7684\u601d\u60f3\u3002\u5f53\u67d0\u4e2a\u6751\u6c11\u53d1\u73b0\u6709\u4e00\u7b14\u7389\u77f3\u4fe1\u606f\u8bb0\u5f55\u9519\u8bef\u5e76\u9700\u8981\u66f4\u6b63\u65f6\uff0c\u5fc5\u987b\u5f97\u5230\u81f3\u5c1151%\u7684\u6751\u6c11\u540c\u610f\uff0c\u624d\u80fd\u4fee\u6539\u8fd9\u7b14\u8bb0\u5f55\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u53ea\u6709\u5f97\u5230\u591a\u6570\u6751\u6c11\u7684\u8ba4\u540c\uff0c\u4fe1\u606f\u624d\u80fd\u88ab\u6b63\u5f0f\u8bb0\u5f55\u5728\u6bcf\u4e2a\u4eba\u7684\u8d26\u672c\u4e2d\u3002\u8fd9\u5c31\u4f53\u73b0\u4e86\u533a\u5757\u94fe\u4e2d \u201c\u5171\u8bc6\u201d \u7684\u57fa\u672c\u601d\u60f3\u3002</p>"},{"location":"blockchain/blockchain_and_innovative_thinking_notes_2101/#12","title":"1.2\u3001\u533a\u5757\u94fe\u7684\u8d77\u6e90\u4e0e\u73b0\u72b6","text":"<p>\uff081\uff09\u5bc6\u7801\u670b\u514b</p> <p>1992\u5e74\uff0c\u82f1\u7279\u5c14\u9ad8\u7ea7\u79d1\u5b66\u5bb6\u8482\u59c6\u00b7\u6885\uff08Tim May\uff09\u4e0e\u670b\u53cb\u805a\u4f1a\u65f6\uff0c\u8ba8\u8bba\u4e92\u8054\u7f51\u5e94\u8be5\u5982\u4f55\u66f4\u597d\u5730\u4fdd\u62a4\u4eba\u4eec\u7684\u9690\u79c1\u3002\u201c\u600e\u6837\u4fdd\u62a4\u5168\u4e16\u754c\u6c11\u4f17\u7684\u9690\u79c1\u5728\u4e92\u8054\u7f51\u4e0a\u4e0d\u88ab\u522b\u6709\u7528\u5fc3\u7684\u4eba\u5229\u7528\u5462\uff1f\u201d\uff0c\u4ed6\u4eec\u6210\u7acb\u4e86\u4e00\u4e2a\u5c0f\u7ec4\uff1a\u5bc6\u7801\u670b\u514b\u3002</p> <p>\u5728\u805a\u4f1a\u7ed3\u675f\u4e00\u5468\u540e\uff0c\u5c0f\u7ec4\u6210\u5458\u57c3\u91cc\u514b\u00b7\u4f11\u65af\u5199\u4e86\u4e2a\u7a0b\u5e8f\uff0c\u53ef\u4ee5\u63a5\u6536\u52a0\u5bc6\u90ae\u4ef6\uff0c\u64e6\u9664\u6240\u6709\u8eab\u4efd\u6807\u8bb0\uff0c\u5e76\u5c06\u5b83\u4eec\u53d1\u9001\u56de\u7528\u6237\u5217\u8868\uff0c\u5f53\u4f60\u7b7e\u540d\u540e\uff0c\u4f60\u4f1a\u5f97\u5230\u4f11\u65af\u7684\u56de\u4fe1\u3002</p> <p>1993\u5e74\uff0c\u57c3\u91cc\u514b\u00b7\u4f11\u65af\u4e0e\u5176\u4ed6\u51e0\u4e2a\u4eba\uff0c\u5347\u7ea7\u8fed\u4ee3\u4e86\u52a0\u5bc6\u7535\u5b50\u90ae\u4ef6\u7cfb\u7edf\uff0c\u76f4\u63a5\u628a\u7cfb\u7edf\u6539\u540d\u53eb\u201c\u5bc6\u7801\u670b\u514b\u201d\u3002\u5bc6\u7801\u670b\u514b\u4e0d\u518d\u662f\u4e00\u4e2a\u5c0f\u7ec4\uff0c\u4f7f\u7528\u5bc6\u7801\u670b\u514b\u90ae\u4ef6\u7cfb\u7edf\u7684\u7528\u6237\u7ea61400\u4eba\uff0c\u8fd9\u4e9b\u4eba\u9010\u6e10\u5f62\u6210\u4e00\u4e2a\u975e\u5e38\u79c1\u5bc6\u7684\u5708\u5b50\u3002\u540c\u65f6\u57c3\u91cc\u514b\u00b7\u4f11\u65af\u53d1\u5e03\u4e86\u300a\u5bc6\u7801\u670b\u514b\u5ba3\u8a00\u300b\u5411\u6743\u529b\u673a\u6784\u53d1\u8d77\u4e86\u6311\u6218\uff1a\u201c\u5728\u7535\u5b50\u4fe1\u606f\u65f6\u4ee3\uff0c\u4e2a\u4eba\u9690\u79c1\u5728\u4e00\u4e2a\u5f00\u653e\u7684\u793e\u4f1a\u4e2d\u662f\u5fc5\u9700\u54c1\u3002\u6211\u4eec\u4e0d\u6307\u671b\u653f\u5e9c\u3001\u516c\u53f8\u6216\u8005\u5176\u4ed6\u4ec0\u4e48\u4e0d\u8981\u8138\u7684\u7ec4\u7ec7\u6765\u627f\u8bfa\u6211\u4eec\u7684\u9690\u79c1\u6743\u3002\u6211\u4eec\u5fc5\u987b\u4fdd\u62a4\u6211\u4eec\u7684\u9690\u79c1\u3002\u5fc5\u9700\u6709\u4eba\u7ad9\u51fa\u6765\u505a\u4e00\u4e2a\u8f6f\u4ef6\uff0c\u7528\u6765\u4fdd\u62a4\u4e2a\u4eba\u9690\u79c1\u2026\u2026\u6211\u4eec\u8ba1\u5212\u505a\u8fd9\u6837\u4e00\u4e2a\u8f6f\u4ef6\u3002\u201d</p> <p>\u8865\u5145\uff1a\u5bc6\u7801\u670b\u514b\u65e9\u671f\u6210\u5458\u975e\u5e38\u591a\u7cbe\u82f1\uff0c\u6bd4\u5982\u201c\u7ef4\u57fa\u89e3\u5bc6\u201d\u521b\u59cb\u4eba\u963f\u6851\u5947\u3001BT\u4e0b\u8f7d\u4f5c\u8005\u5e03\u62c9\u59c6\u00b7\u79d1\u6069\u3001\u4e07\u7ef4\u7f51\u53d1\u660e\u4ebaTim-Berners Lee\u7235\u58eb\u3001\u63d0\u51fa\u6765\u667a\u80fd\u5408\u7ea6\u6982\u5ff5\u7684\u5c3c\u514b\u8428\u535a\u3001Facebook\u521b\u59cb\u4eba\u4e4b\u4e00\u8096\u6069\u00b7\u5e15\u514b\u3001\u53d1\u660e\u6bd4\u7279\u5e01\u7684\u4e2d\u672c\u806a\u3002</p> <p>\uff082\uff09Ecash</p> <p>\u5927\u536b\u00b7\u4e54\u59c6\u662f\u5bc6\u7801\u670b\u514b\u7684\u9886\u8896\u7ea7\u4eba\u7269\uff0c\u4ed6\u57281990\u5e74\u53d1\u660e\u4e86\u5bc6\u7801\u5b66\u533f\u540d\u73b0\u91d1\u652f\u4ed8\u7cfb\u7edf\uff0c\u5373Ecash\u3002\u4e54\u59c6\u8ba4\u4e3a\u5206\u5e03\u5f0f\u7684\u3001\u771f\u6b63\u7684\u6570\u5b57\u73b0\u91d1\u7cfb\u7edf\u5e94\u8be5\u4e3a\u4eba\u4eec\u7684\u9690\u79c1\u52a0\u5bc6\u3002\u56e0\u6b64\u4ed6\u7684\u7535\u5b50\u652f\u4ed8\u7cfb\u7edf\u91cc\u7684\u52a0\u5bc6\u4f7f\u7528\u4e86\u6570\u5b66\u7f16\u7801\u3002\u8fd8\u6709\u4e00\u4e2a\u5c0f\u7279\u70b9\u5c31\u662f\u652f\u4ed8\u65f6\u4ed8\u6b3e\u65b9\u533f\u540d\u7684\uff0c\u6536\u6b3e\u65b9\u975e\u533f\u540d\u7684\u3002</p> <p>Ecash\u79bb\u7ebf\u5de5\u4f5c\uff0c\u4e0d\u5360\u7528\u7535\u8bdd\u7cfb\u7edf\uff0c\u6709\u70b9\u4e91\u5b58\u50a8\u7684\u5473\u9053\uff0c\u540e\u6765\u56e0\u4e3a\u592a\u8d85\u524d\u800c\u5931\u8d25\u4e86\u3002</p> <p>\uff083\uff09\u54c8\u5e0c\u73b0\u91d1</p> <p>\u82f1\u56fd\u5bc6\u7801\u5b66\u5bb6\u4e9a\u5f53\u00b7\u8d1d\u514b\u4e5f\u662f\u5bc6\u7801\u670b\u514b\u7684\u6210\u5458\u30021997\u5e74\uff0c\u4ed6\u53d1\u660e\u4e86\u54c8\u5e0c\u73b0\u91d1\uff0c\u7528\u5230\u4e86\u5de5\u4f5c\u91cf\u8bc1\u660e\u7cfb\u7edf\uff08proof of work\uff09\u3002\u5176\u5b9e\u4e9a\u5f53\u00b7\u8d1d\u514b\u6700\u521d\u53d1\u660e\u8fd9\u4e2a\u7cfb\u7edf\u662f\u60f3\u89e3\u51b3\u5783\u573e\u90ae\u4ef6\u7684\u95ee\u9898\uff0c\u4e5f\u5c31\u662f\u4e3a\u4e86\u907f\u514d\u5176\u4ed6\u4eba\u53d1\u9001\u542b\u6709\u76f8\u540c\u4fe1\u606f\u7684\u90ae\u4ef6\u3002\u5b83\u7684\u5de5\u4f5c\u91cf\u8bc1\u660e\u7cfb\u7edf\uff0c\u89e3\u51b3\u4e86\u6570\u5b57\u8d27\u5e01\u7684\u4e00\u5927\u96be\u9898\uff1a\u5982\u4f55\u4fdd\u8bc1\u6570\u5b57\u8d27\u5e01\u4e0d\u88ab\u4ea4\u6613\u8fc7\u5f88\u591a\u6b21\uff1f \u8fd9\u5c31\u8981\u6c42\u8ba1\u7b97\u673a\u5728\u83b7\u5f97\u4fe1\u606f\u4e4b\u524d\uff0c\u505a\u4e00\u5b9a\u7684\u5de5\u4f5c\u91cf\u8ba1\u7b97\u6765\u907f\u514d\u91cd\u590d\u4ea4\u6613\u3002</p> <p>\uff084\uff09\u65f6\u95f4\u6233\u6982\u5ff5</p> <p>1997\u5e74\uff0c\u5bc6\u7801\u670b\u514b\u6210\u5458\u54c8\u4f2f\u548c\u65af\u6258\u5c3c\u5854\u63d0\u51fa\u4e86\u65f6\u95f4\u6233\u6982\u5ff5\uff08\u4e00\u79cd\u7b7e\u540d\u534f\u8bae\uff09\u3002\u540e\u6765\u8fd9\u4e2a\u4fdd\u8bc1\u4e86\u6570\u5b57\u8d27\u5e01\u5b89\u5168\u95ee\u9898\uff0c\u5373\u7528\u65f6\u95f4\u6233\u7684\u65b9\u5f0f\u6765\u4fdd\u8bc1\u6587\u4ef6\u7684\u5148\u540e\u987a\u5e8f\u3002\u65f6\u95f4\u6233\u534f\u8bae\u8981\u6c42\u5728\u6587\u4ef6\u521b\u5efa\u540e\uff0c\u4e0d\u80fd\u6539\u52a8\u3002\u5f53\u4e00\u4e2a\u865a\u62df\u8d27\u5e01\u88ab\u4ea4\u6613\u65f6\uff0c\u88ab\u76d6\u4e0a\u65f6\u95f4\u6233\uff0c\u5b83\u5c31\u65e0\u6cd5\u7be1\u6539\uff0c\u5728\u533a\u5757\u94fe\u7cfb\u7edf\u4e2d\uff0c\u6bcf\u4e00\u4e2a\u65b0\u533a\u5757\u751f\u6210\u65f6\uff0c\u90fd\u4f1a\u88ab\u6253\u4e0a\u65f6\u95f4\u6233\uff0c\u6700\u7ec8\u4f9d\u7167\u533a\u5757\u751f\u6210\u65f6\u95f4\u7684\u5148\u540e\u987a\u5e8f\u76f8\u8fde\u6210\u533a\u5757\u94fe\u3002</p> <p>\uff085\uff09\u6bd4\u7279\u5e01\u8bde\u751f</p> <p>2004\u5e74\uff0c\u4e00\u4f4d\u5bc6\u7801\u670b\u514b\u6210\u5458\u54c8\u5c14\u82ac\u59ae\u63d0\u51fa\u4e86\u7535\u5b50\u8d27\u5e01\u548c\u52a0\u5bc6\u73b0\u91d1\u7684\u6982\u5ff5\u3002\u4ed6\u7406\u60f3\u4e2d\u7684\u8fd9\u79cd\u8d27\u5e01\u662f\u53ef\u91cd\u590d\u4f7f\u7528\u7684\uff0c\u5e76\u53c2\u7167\u4e86\u5931\u8d25\u9879\u76ee\u7684\u4f18\u70b9\u3002\u4f46\u662f\u4ed6\u7684\u8bbe\u60f3\u8fd8\u662f\u4e0d\u591f\u6210\u4e3a\u4e00\u79cd\u4e16\u754c\u578b\u7684\u865a\u62df\u8d27\u5e01\u3002</p> <p>2008\u5e74\uff0c\u4e2d\u672c\u806a\u5bf9\u5927\u536b\u4e54\u59c6\u7684Ecash\u8fdb\u884c\u4e86\u4f18\u5316\uff0c\u7efc\u5408\u4e86\u65f6\u95f4\u6233\u3001\u5de5\u4f5c\u91cf\u8bc1\u660e\u673a\u5236\u3001\u975e\u5bf9\u79f0\u52a0\u5bc6\u6280\u672f\u3001UTXO\u7684\u7ed3\u6784\uff0c\u6700\u7ec8\u4ed6\u53d1\u660e\u4e86\u6bd4\u7279\u5e01\u3002\u4eba\u4eec\u5c31\u628a\u6bd4\u7279\u5e01\u7684\u5e95\u5c42\u6280\u672f\u79f0\u4e3a\u533a\u5757\u94fe\u3002</p> <p>\u533a\u5757\u94fe\u6280\u672f\u53d1\u5c55\u7684\u4e09\u4e2a\u9636\u6bb5</p> <ol> <li>\u533a\u5757\u94fe 1.0 \u2014\u2014 \u6570\u5b57\u8d27\u5e01\uff1a\u4ee5\u6bd4\u7279\u5e01\u4e3a\u4ee3\u8868\u7684\u53bb\u4e2d\u5fc3\u5316\u6570\u5b57\u652f\u4ed8\u7cfb\u7edf\uff0c\u4ee3\u8868\u9879\u76ee\uff1a\u6bd4\u7279\u5e01\u3001\u83b1\u7279\u5e01\u3001\u5c71\u5be8\u5e01\u3002</li> <li>\u533a\u5757\u94fe 2.0 \u2014\u2014 \u667a\u80fd\u5408\u7ea6\uff1a\u4ee5\u4ee5\u592a\u574a\u4e3a\u4ee3\u8868\uff0c\u652f\u6301\u7528\u6237\u81ea\u884c\u7f16\u5199\u667a\u80fd\u5408\u7ea6\uff0c\u6784\u5efa\u53bb\u4e2d\u5fc3\u5316\u5e94\u7528\uff08DAPP\uff09\u3002</li> <li>\u533a\u5757\u94fe 3.0 \u2014\u2014 \u884c\u4e1a\u5e94\u7528\u5ef6\u4f38\uff1a\u5c06\u533a\u5757\u94fe\u6280\u672f\u62d3\u5c55\u5230\u91d1\u878d\u3001\u7269\u6d41\u3001\u533b\u7597\u3001\u653f\u52a1\u7b49\u5404\u4e2a\u884c\u4e1a\u7684\u5177\u4f53\u573a\u666f\u4e2d\uff0c\u5b9e\u73b0\u6280\u672f\u4e0e\u5b9e\u4f53\u7ecf\u6d4e\u7684\u6df1\u5ea6\u878d\u5408\u3002</li> </ol> <p></p>"},{"location":"blockchain/blockchain_and_innovative_thinking_notes_2101/#13","title":"1.3\u3001\u4fe1\u4efb\u7684\u5efa\u7acb\u548c\u533a\u5757\u94fe\u7684\u5f62\u8c61\u89e3\u91ca","text":"<p>\u4f20\u7edf\u793e\u4f1a\u5982\u4f55\u5efa\u7acb\u4fe1\u4efb\uff1f</p> <p>\u8840\u7f18\uff1a\u540e\u5929\u96be\u4ee5\u83b7\u5f97</p> <p>\u9053\u5fb7\uff1a\u53ef\u6267\u884c\u6027\u5dee</p> <p>\u5b97\u6559\uff1a\u592a\u865a\u5e7b</p> <p>\u9738\u6743\uff1a\u7f3a\u4e4f\u4e00\u5b9a\u7684\u516c\u5141\u6027</p> <p>\u7528\u6743\u5a01\u624b\u6bb5\u5f15\u5165\u7b2c\u4e09\u65b9\u80cc\u4e66</p> <p>\u5171\u8bc6\uff0c\u5c31\u662f\u5171\u540c\u5236\u5b9a\u89c4\u5219\uff1b</p> <p>\u5171\u6cbb\uff0c\u5c31\u662f\u5171\u540c\u7ba1\u7406\u7cfb\u7edf\uff1b</p> <p>\u5171\u4eab\uff0c\u5c31\u662f\u5171\u4eab\u6570\u636e\u7b49\u65b9\u5f0f\u6765\u5efa\u7acb\u53ef\u9760\u7684\u4fe1\u4efb\u5173\u7cfb\u3002</p> <p>\u4e2d\u5fc3\u5316\u7684\u610f\u601d\u662f\u4e2d\u5fc3\u51b3\u5b9a\u8282\u70b9\uff0c\u8282\u70b9\u5fc5\u987b\u4f9d\u8d56\u4e2d\u5fc3\uff0c\u8282\u70b9\u79bb\u5f00\u4e86\u4e2d\u5fc3\u5c31\u65e0\u6cd5\u751f\u5b58\u3002</p> <p>\u533a\u5757\u94fe\u672c\u8d28\u5c31\u662f\u4e00\u4e2a\u53bb\u4e2d\u5fc3\u5316\u7684\u5206\u5e03\u5f0f\u8d26\u672c\uff0c\u539f\u6765\u9700\u8981\u901a\u8fc7\u94f6\u884c\u6216\u7b2c\u4e09\u65b9\u652f\u4ed8\u624d\u80fd\u5b8c\u6210\u7684\u4ea4\u6613\uff0c\u73b0\u5728\u53ef\u4ee5\u901a\u8fc7\u5206\u5e03\u5f0f\u8282\u70b9\u7ec4\u6210\u7684\u7f51\u7edc\u6765\u5b8c\u6210\u3002</p> <p>\u533a\u5757\u94fe\u6280\u672f\u4e4b\u6240\u4ee5\u53ef\u4fe1\uff0c\u5c31\u662f\u56e0\u4e3a\u6709\u4e00\u4e2a\u76f8\u5bf9\u53ef\u4fe1\u7684\u201c\u516c\u5f00\u7684\u516c\u4f17\u8d26\u672c\u201d\uff0c\u5728\u76f8\u4e92\u964c\u751f\u7684\u7528\u6237\u4e4b\u95f4\u5efa\u7acb\u4e86\u7a33\u56fa\u7684\u4fe1\u4efb\u5173\u7cfb\uff0c\u653e\u5fc3\u5927\u80c6\u7684\u8fdb\u884c\u4ea4\u6613\u3002</p> <p>\u533a\u5757\u94fe\u7684\u5b9a\u4e49\uff1a</p> <p>\u72ed\u4e49\u6765\u8bf4\uff0c\u533a\u5757\u94fe\u662f\u4e00\u79cd\u6309\u7167\u65f6\u95f4\u987a\u5e8f\uff0c\u5c06\u6570\u636e\u533a\u5757\u4ee5\u987a\u5e8f\u76f8\u8fde\u7684\u65b9\u5f0f\u7ec4\u5408\u6210\u7684\u4e00\u79cd\u94fe\u5f0f\u6570\u636e\u7ed3\u6784\uff0c\u5e76\u4ee5\u5bc6\u7801\u5b66\u65b9\u5f0f\u4fdd\u8bc1\u7684\u4e0d\u53ef\u7be1\u6539\u548c\u4e0d\u53ef\u4f2a\u9020\u7684\u5206\u5e03\u5f0f\u8d26\u672c\u3002</p> <p>\u5e7f\u4e49\u6765\u8bf4\uff0c\u533a\u5757\u94fe\u662f\u5229\u7528\u5757\u94fe\u5f0f\u6570\u636e\u7ed3\u6784\u6765\u9a8c\u8bc1\u4e0e\u5b58\u50a8\u6570\u636e\u3001\u5229\u7528\u5171\u8bc6\u7b97\u6cd5\u6765\u751f\u6210\u548c\u66f4\u65b0\u6570\u636e\u3001\u5229\u7528\u5bc6\u7801\u5b66\u7684\u65b9\u5f0f\u4fdd\u8bc1\u6570\u636e\u5b89\u5168\u3001\u5229\u7528\u667a\u80fd\u5408\u7ea6\u6765\u7f16\u7a0b\u548c\u64cd\u4f5c\u6570\u636e\u7684\u4e00\u79cd\u5168\u65b0\u7684\u5206\u5e03\u5f0f\u57fa\u7840\u67b6\u6784\u4e0e\u8ba1\u7b97\u8303\u5f0f\u3002</p> <p>\u533a\u5757\u94fe\u7684\u5f62\u8c61\u89e3\u91ca\uff1a\u672c\u8d28\u4e0a\u662f\u4e00\u4e2a\u53bb\u4e2d\u5fc3\u5316\u7684\u5206\u5e03\u5f0f\u8d26\u672c\uff0c\u5982\u679c\u8bf4\u533a\u5757\u94fe\u5c31\u662f\u8d26\u672c\uff0c\u90a3\u4e48\u6784\u6210\u533a\u5757\u94fe\u7684\u6bcf\u4e00\u4e2a\u533a\u5757\u5c31\u662f\u8d26\u672c\u7684\u6bcf\u4e00\u9875\uff0c\u6bcf\u589e\u52a0\u4e00\u4e2a\u533a\u5757\uff0c\u8d26\u672c\u540e\u9762\u5c31\u4f1a\u589e\u52a0\u4e00\u9875\uff0c\u533a\u5757\u94fe\u6709\u591a\u957f\uff0c\u8d26\u672c\u5c31\u6709\u591a\u539a\u3002</p> <p>\u8fd9\u4e2a\u8d26\u672c\u5b58\u5728\u7f51\u7edc\u4e2d\u5404\u81ea\u8282\u70b9\u7684\u624b\u91cc\uff0c\u800c\u4e0d\u662f\u7edf\u4e00\u5b58\u50a8\u5728\u4e00\u4e2a\u4e2d\u5fc3\u8282\u70b9\uff0c\u5e76\u4e14\u662f\u4efb\u4f55\u4eba\u90fd\u53ef\u4ee5\u770b\u5f97\u5230\u7684\u516c\u5f00\u8d26\u672c\u3002</p> <p>\u533a\u5757\u9ad8\u5ea6\u5c31\u76f8\u5f53\u4e8e\u8d26\u672c\u7684\u9875\u6570\uff1b\u533a\u5757\u5c31\u76f8\u5f53\u4e8e\u8bb0\u8d26\u672c\u7684\u4e00\u9875\uff1b\u94fe\u5c31\u76f8\u5f53\u4e8e\u8bb0\u8d26\u672c\u3002</p> <p>\u533a\u5757\u94fe\u662f\u5c06\u4ea4\u6613\u6570\u636e\u6253\u5305\u6210\u4e00\u4e2a\u4e2a\u201c\u6570\u636e\u533a\u5757\u201d\uff0c\u518d\u6309\u65f6\u95f4\u987a\u5e8f\u8fde\u63a5\u8d77\u6765\uff0c\u5f62\u6210\u4e00\u79cd\u94fe\u5f0f\u7ed3\u6784\u5b58\u50a8\uff0c\u8fd9\u6761\u94fe\u5c31\u662f\u533a\u5757\u94fe\uff0c\u533a\u5757\u94fe\u4e5f\u662f\u6570\u636e\u7684\u5b58\u50a8\u65b9\u5f0f\u3002</p> <p>\u516c\u5f0f\uff1a\u533a\u5757\uff08Block\uff09 + \u94fe\uff08Chain\uff09 = \u533a\u5757\u94fe\uff08Blockchain\uff09</p> <p></p> <p>\u533a\u5757\u94fe=\u533a\u5757+\u94fe</p> <p>\u6839\u636e\u8282\u70b9\u7684\u52a0\u5165\u6216\u8005\u9000\u51fa\u662f\u5426\u9700\u8981\u6279\u51c6\uff0c\u5c06\u533a\u5757\u94fe\u5206\u4e3a\uff1a\u516c\u6709\u94fe\u3001\u79c1\u6709\u94fe\u4ee5\u53ca\u8054\u76df\u94fe\u3002</p> <p>\u8282\u70b9\u5c31\u662f\u7f51\u7edc\u7684\u9aa8\u5e72\uff0c\u7528\u6765\u9a8c\u8bc1\u548c\u8bb0\u5f55\u4ea4\u6613\u3002\u6211\u4eec\u901a\u5e38\u6240\u8bf4\u7684\u8282\u70b9\u662f\u6307\u533a\u5757\u94fe\u7f51\u7edc\u4e2d\u7684\u8ba1\u7b97\u673a\uff0c\u5305\u62ec\u624b\u673a\u3001\u77ff\u673a\u3001\u53f0\u5f0f\u673a\u548c\u670d\u52a1\u5668\u7b49\u3002</p> <p>\u516c\u5f00\u94fe\uff1a\u5c31\u662f\u516c\u5f00\u7684\u533a\u5757\u94fe\uff0c\u6240\u6709\u4eba\u90fd\u53ef\u4ee5\u4f5c\u4e3a\u7f51\u7edc\u4e2d\u7684\u4e00\u4e2a\u8282\u70b9\u81ea\u7531\u52a0\u5165\u6216\u9000\u51fa\uff0c\u8282\u70b9\u4e4b\u95f4\u57fa\u4e8e\u5171\u8bc6\u673a\u5236\u5f00\u5c55\u5de5\u4f5c\u3002\u662f\u771f\u6b63\u610f\u4e49\u4e0a\u5b8c\u5168\u7684\u53bb\u4e2d\u5fc3\u5316\u3002</p> <p>\u79c1\u6709\u94fe\uff1a\u4e00\u822c\u7528\u5728\u4f01\u4e1a\u5185\u90e8\uff0c\u7cfb\u7edf\u7684\u8fd0\u4f5c\u89c4\u5219\u3001\u8282\u70b9\u7684\u8bfb\u53d6\u548c\u4fee\u6539\u6743\u9650\u6839\u636e\u4f01\u4e1a\u7684\u8981\u6c42\u8fdb\u884c\u8bbe\u5b9a\u3002</p> <p>\u8054\u76df\u94fe\uff1a\u4e00\u79cd\u591a\u4e2d\u5fc3\u5316\u6216\u8005\u90e8\u5206\u53bb\u4e2d\u5fc3\u5316\u7684\u533a\u5757\u94fe\uff0c\u5171\u8bc6\u673a\u5236\u53d7\u67d0\u4e9b\u6307\u5b9a\u8282\u70b9\u63a7\u5236\uff0c\u4e00\u822c\u662f\u7531\u82e5\u5e72\u673a\u6784\u8054\u5408\u53d1\u8d77\uff0c\u6bd4\u5982\u884c\u4e1a\u5185\u90e8\uff0c\u5b83\u4ecb\u4e8e\u516c\u6709\u94fe\u548c\u79c1\u6709\u94fe\u4e4b\u95f4\uff0c\u517c\u5177\u90e8\u5206\u53bb\u4e2d\u5fc3\u5316\u7684\u7279\u6027\u3002</p>"},{"location":"blockchain/blockchain_and_innovative_thinking_notes_2101/#14","title":"1.4\u3001\u4ece\u4fe1\u606f\u4e92\u8054\u7f51\u5230\u4ef7\u503c\u4e92\u8054\u7f51","text":"<p>\u4fe1\u606f\u4e92\u8054\u7f51\u7684\u4f5c\u7528</p> <ul> <li>\u63d0\u4f9b\u4e0d\u53d7\u5730\u57df\u9650\u5236\u7684\u4fe1\u606f\u4f20\u9012\u901a\u9053\u3002</li> <li>\u4f9d\u9760\u786c\u4ef6\u4e0e\u57fa\u7840\u534f\u8bae\uff08\u5982 TCP/IP\uff09\u5b9e\u73b0\u5168\u7403\u4fe1\u606f\u4f20\u9012\u3002</li> <li>\u4fe1\u606f\u4e92\u8054\u7f51\u5b58\u5728\u7684\u95ee\u9898</li> </ul> <p>\u95ee\u9898\u4e00\uff1a\u8eab\u4efd\u65e0\u6cd5\u81ea\u8bc1\uff0c\u65e0\u6cd5\u5411\u4ed6\u4eba\u8bc1\u660e\u5f53\u524d\u662f\u201c\u4f60\u201d\u672c\u4eba\u5728\u8fdb\u884c\u4ea4\u6d41\u3002</p> <p>\u95ee\u9898\u4e8c\uff1a\u4fe1\u606f\u771f\u5b9e\u6027\u65e0\u6cd5\u4fdd\u8bc1\uff0c\u4fe1\u606f\u6613\u590d\u5236\u3001\u9020\u5047\u6210\u672c\u4f4e\uff0c\u4e14\u9020\u5047\u8005\u8eab\u4efd\u96be\u4ee5\u8ffd\u6eaf\uff0c\u52a0\u5267\u4e86\u865a\u5047\u4fe1\u606f\u4f20\u64ad\u3002</p> <p>\u533a\u5757\u94fe\u7684\u89e3\u51b3\u65b9\u6848</p> <p>\u901a\u8fc7\u5efa\u7acb\u201c\u533a\u5757\u94fe\u4ef7\u503c\u4f20\u8f93\u534f\u8bae\u201d\uff0c\u5229\u7528\u4e0a\u94fe\u6570\u636e\u4e0d\u53ef\u7be1\u6539\u7684\u7279\u6027\uff0c\u786e\u4fdd\u7f51\u7edc\u4e2d\u6570\u636e\u7684\u771f\u5b9e\u6027\u4e0e\u53ef\u4fe1\u6027\u3002</p> <p>\u6570\u636e\u5b64\u5c9b</p> <p>\u6709\u4ef7\u503c\uff0c\u4f46\u662f\u6ca1\u6709\u4f7f\u7528\u4ef7\u503c\u662f\u4fe1\u606f\u4e92\u8054\u7f51\u7684\u57fa\u672c\u7279\u5f81\u3002</p> <p>\u4ef7\u503c\u4e92\u8054\u7f51\u7684\u4f5c\u7528\u5728\u4e8e\uff1a</p> <ul> <li>\u4fdd\u62a4\u4fe1\u606f\u7684\u771f\u5b9e\u6027\uff1b</li> <li>\u4f7f\u5f97\u6570\u5b57\u5316\u7684\u4ef7\u503c\u4e5f\u53ef\u4ee5\u50cf\u4fe1\u606f\u4e00\u6837\u5728\u4e92\u8054\u7f51\u4e0a\u81ea\u7531\u6d41\u901a\u548c\u4f20\u8f93\u3002</li> </ul> <p>\u5e0c\u671b\u901a\u8fc7\u5efa\u7acb\u533a\u5757\u94fe\u4ef7\u503c\u4f20\u8f93\u534f\u8bae\uff0c\u5229\u7528\u4e0a\u94fe\u6570\u636e\u4e0d\u53ef\u7be1\u6539\uff08\u6570\u636e\u7be1\u6539\u96be\u5ea6\u8fc7\u5927\u3001\u4ee3\u4ef7\u8fc7\u9ad8\uff09 \u7684\u7279\u70b9\uff0c\u786e\u4fdd\u7f51\u7edc\u4e2d\u6570\u636e\u7684\u771f\u5b9e\u6027\u3002</p> <p>\u6848\u4f8b\u5206\u6790\uff1a\u623f\u5c4b\u4e70\u5356\u4e0e\u667a\u80fd\u5408\u7ea6</p> <p>\u573a\u666f\u63cf\u8ff0\uff1a\u4f60\u62e5\u6709\u4e00\u5957\u623f\u5b50\u8981\u51fa\u552e\uff0c\u518d\u8d2d\u4e70\u65b0\u623f\u3002\u4f60\u9700\u8981\uff1a</p> <ol> <li>\u627e\u623f\u4ea7\u4e2d\u4ecb\u6302\u724c\uff1b</li> <li>\u7b7e\u7f72\u4e70\u5356\u5408\u540c\uff1b</li> <li>\u901a\u8fc7\u4e2d\u4ecb\u5b8c\u6210\u4ea4\u6613\u5e76\u652f\u4ed8\u4e2d\u4ecb\u8d39\uff1b</li> <li>\u5230\u623f\u7ba1\u6240\u529e\u7406\u4ea7\u6743\u53d8\u66f4\u3002    \u5b8c\u6210\u552e\u51fa\u540e\uff0c\u4f60\u4f5c\u4e3a\u4e70\u65b9\u518d\u6b21\u7ecf\u5386\u76f8\u540c\u6d41\u7a0b\u3002</li> </ol> <p>\u667a\u80fd\u5408\u7ea6\u5982\u4f55\u4f18\u5316\u6b64\u8fc7\u7a0b\uff1f</p> <ul> <li>\u4e70\u5356\u53cc\u65b9\u901a\u8fc7\u79c1\u94a5\u7b7e\u540d\u786e\u8ba4\u8eab\u4efd\u4e0e\u610f\u613f\u3002</li> <li>\u516c\u94a5\u9a8c\u8bc1\u673a\u5236\u786e\u4fdd\u4ea4\u6613\u53cc\u65b9\u8eab\u4efd\u771f\u5b9e\u4e14\u4fe1\u606f\u4e0d\u53ef\u4f2a\u9020\u3002</li> <li>\u533a\u5757\u94fe\u6280\u672f\u4fdd\u969c\u6574\u4e2a\u4ea4\u6613\u6d41\u7a0b\u900f\u660e\u3001\u53ef\u4fe1\u3001\u65e0\u9700\u7b2c\u4e09\u65b9\u4e2d\u4ecb\u3002</li> </ul>"},{"location":"blockchain/blockchain_and_innovative_thinking_notes_2101/#15","title":"1.5\u3001\u533a\u5757\u94fe\u7684\u795e\u8bdd\u4e0e\u8bef\u89e3","text":"<p>\u274c \u5bf9\u4e8e\u533a\u5757\u94fe\u7684\u5e38\u89c1\u9519\u8bef\u770b\u6cd5</p> <ul> <li>\u533a\u5757\u94fe\u548c\u6bd4\u7279\u5e01\u662f\u4e00\u56de\u4e8b\u3002</li> <li>\u533a\u5757\u94fe\u5c31\u662f\u5708\u94b1\u7684\uff01\uff01\uff01</li> <li>\u533a\u5757\u94fe\u7684\u53bb\u4e2d\u5fc3\u5316\u5c31\u662f\u6ca1\u6709\u4e2d\u5fc3\u3002</li> <li>\u533a\u5757\u94fe\u662f\u4e07\u80fd\u7684\u3002</li> <li>\u533a\u5757\u94fe\u662f\u4f01\u4e1a\u3001\u7ecf\u6d4e\u4e43\u81f3\u6574\u4e2a\u4eba\u7c7b\u7684\u6551\u661f\uff01</li> </ul> <p>\u533a\u5757\u94fe\u6280\u672f\u4e4b\u6240\u4ee5\u80fd\u5b58\u5728\u548c\u53d1\u5c55\uff0c\u5176\u672c\u8d28\u4e0a\u5e0c\u671b\u89e3\u51b3\u7684\u662f\u53ef\u9760\u4ea4\u6613\u7684\u95ee\u9898\u3002</p> <p>\u6838\u5fc3\u76ee\u6807\uff1a\u4fdd\u8bc1\u4fe1\u606f\u7684\u771f\u5b9e\u51c6\u786e\uff0c\u4fdd\u969c\u4ea4\u6613\u5b89\u5168</p> <p>\u533a\u5757\u94fe\u7684\u201c\u795e\u8bdd\u201d\u8f9f\u8c23</p> <p>\u89c2\u70b9\u4e00\uff1a\u533a\u5757\u94fe\u7684\u4ef7\u503c\u662f\u7b2c\u4e00\u4ee3\u4e92\u8054\u7f51\u7684\u5f88\u591a\u500d\uff1f</p> <p>\u533a\u5757\u94fe\u867d\u7136\u5e38\u88ab\u79f0\u4e3a\u201c\u7b2c\u4e8c\u4ee3\u4e92\u8054\u7f51\u201d\u6216\u201c\u4ef7\u503c\u4e92\u8054\u7f51\u201d\uff0c\u4f46\u5176\u672c\u8d28\u662f\u5728\u539f\u6709\u4fe1\u606f\u4e92\u8054\u7f51\u7684\u57fa\u7840\u4e0a\uff0c\u901a\u8fc7\u6280\u672f\u624b\u6bb5\u4fdd\u969c\u4fe1\u606f\u7684\u53ef\u9760\u6027\uff0c\u5e76\u975e\u5bf9\u4e92\u8054\u7f51\u539f\u6709\u529f\u80fd\u8fdb\u884c\u5f7b\u5e95\u53d8\u9769\u3002\u56e0\u6b64\uff0c\u6240\u8c13\u201c\u4ef7\u503c\u662f\u7b2c\u4e00\u4ee3\u4e92\u8054\u7f51\u7684\u591a\u5c11\u500d\u201d\u7684\u8bf4\u6cd5\uff0c\u5b9e\u5c5e\u8a00\u8fc7\u5176\u5b9e\u3002</p> <p>\u89c2\u70b9\u4e8c\uff1a\u533a\u5757\u94fe\u5df2\u8fdb\u5165\u6210\u719f\u5e94\u7528\u7684\u201c3.0\u65f6\u4ee3\u201d\uff1f</p> <p>\u76ee\u524d\u867d\u5df2\u6709\u201c\u533a\u5757\u94fe 3.0\u201d\u7684\u8bf4\u6cd5\uff0c\u4e14\u533a\u5757\u94fe\u6280\u672f\u5df2\u5728\u591a\u4e2a\u884c\u4e1a\u5b9e\u73b0\u843d\u5730\u5e94\u7528\uff0c\u4f46\u6211\u4eec\u4ecd\u9700\u6e05\u9192\u8ba4\u8bc6\u5230\uff1a\u533a\u5757\u94fe\u6280\u672f\u4ecd\u5904\u4e8e\u53d1\u5c55\u840c\u82bd\u671f\uff0c\u8ddd\u79bb\u6280\u672f\u6210\u719f\u8fd8\u6709\u5f88\u957f\u7684\u8def\uff0c\u5927\u89c4\u6a21\u5546\u4e1a\u5e94\u7528\u4ecd\u9700\u65f6\u95f4\u3002</p> <p>\u89c2\u70b9\u4e09\uff1a\u533a\u5757\u94fe\u9002\u7528\u4e8e\u6240\u6709\u884c\u4e1a\u4e14\u6beb\u65e0\u7f3a\u9677\uff1f</p> <p>\u533a\u5757\u94fe\u4f5c\u4e3a\u4e00\u79cd\u5177\u6709\u53bb\u4e2d\u5fc3\u5316\u3001\u6570\u636e\u4e0d\u53ef\u7be1\u6539\u7279\u5f81\u7684\u6280\u672f\uff0c\u4e0e\u8bb8\u591a\u884c\u4e1a\u7684\u771f\u5b9e\u9700\u6c42\u76f8\u543b\u5408\uff0c\u56e0\u6b64\u5df2\u5728\u4f17\u591a\u9886\u57df\u5c55\u5f00\u5e94\u7528\u63a2\u7d22\u3002\u4f46\u8fd9\u5e76\u4e0d\u4ee3\u8868\u533a\u5757\u94fe\u9002\u7528\u4e8e\u4efb\u4f55\u884c\u4e1a\uff0c\u4e5f\u4e0d\u610f\u5473\u7740\u8be5\u6280\u672f\u672c\u8eab\u6beb\u65e0\u7f3a\u9677\u3002</p> <p>\u4e0d\u53ef\u80fd\u4e09\u89d2\u95ee\u9898\uff1a\u53ef\u6269\u5c55\u6027\u3001\u53bb\u4e2d\u5fc3\u5316\u3001\u5b89\u5168\u6027\u53ea\u80fd\u4e09\u9009\u4e8c\u3002</p>"},{"location":"blockchain/blockchain_and_innovative_thinking_notes_2101/#16","title":"1.6\u3001\u6bd4\u7279\u5e01\uff1a\u4eba\u7c7b\u9996\u6b21\u533a\u5757\u94fe\u5927\u89c4\u6a21\u793e\u4f1a\u5b9e\u9a8c","text":"<p>\u4e2d\u672c\u806a\u7684\u300a\u4e00\u79cd\u70b9\u5bf9\u70b9\u7684\u7535\u5b50\u73b0\u91d1\u652f\u4ed8\u7cfb\u7edf\u300b\uff1a</p> <p>\u9996\u5148\uff0c\u5728\u4e2a\u4eba\u5bf9\u4e2a\u4eba\u7684\u8f6c\u8d26\u4e2d\uff0c\u9700\u8981\u6709\u4e00\u79cd\u80fd\u591f\u4e0d\u4f9d\u9644\u4e8e\u7b2c\u4e09\u65b9\u5b9a\u4ef7\u673a\u6784\u3001\u5c31\u80fd\u5224\u65ad\u5176\u4ef7\u503c\u7684\u7535\u5b50\u8d27\u5e01\u3002</p> <p>\u7136\u540e\uff0c\u6211\u4eec\u9700\u8981\u6709\u4e00\u4efd\u53bb\u4e2d\u5fc3\u5316\u7684\u6570\u5b57\u8d26\u672c\uff0c\u80fd\u591f\u628a\u4ea4\u6613\u8bb0\u5f55\u53ca\u5b58\u50a8\u7684\u4ea4\u6613\u4fe1\u606f\u5206\u53d1\u7ed9\u4e16\u754c\u5404\u5730\u7684\u8ba1\u7b97\u673a\uff0c\u5f53\u7136\uff0c\u8d26\u672c\u7684\u8fd0\u4f5c\u65b9\u5f0f\u4e0e\u5176\u4ed6\u4f20\u7edf\u8bb0\u8d26\u65b9\u5f0f\u5927\u81f4\u76f8\u540c\u3002</p> <p></p> <p>\u533a\u5757\u94fe\u6280\u672f\u5c31\u662f\u70b9\u5bf9\u70b9\u4f20\u8f93\u3001\u5206\u5e03\u5f0f\u8d26\u672c\u3001\u5171\u8bc6\u673a\u5236\u3001\u52a0\u5bc6\u7b97\u6cd5\u7b49\u7684\u96c6\u6210\u8fd0\u7528\u3002</p> <p>\u91d1\u878d\u65f6\u62a5\u67d0\u79d1\u6280\u4f5c\u8005\u8bf4\uff1a\u201c\u5bf9\u4e8e\u6bd4\u7279\u5e01\u800c\u8a00\uff0c\u533a\u5757\u94fe\u5bf9\u4e8e\u5b83\u7684\u610f\u4e49\uff0c\u5c31\u5982\u540c\u4e92\u8054\u7f51\u5bf9\u90ae\u4ef6\u7684\u610f\u4e49\u4e00\u6837\u3002\u201d</p> <p>\u4e3a\u4ec0\u4e48\u6bd4\u7279\u5e01\u7684\u4ef7\u683c\u4e00\u5ea6\u4e0a\u5347\u523019000\u7f8e\u5143\uff0c\u66b4\u6da8\u51e0\u5343\u500d\uff0c\u5373\u4f7f\u5728\u7ecf\u5386\u4e862018\u5e74\u4ee5\u6765\u7684\u6301\u7eed\u4e0b\u8dcc\uff0c\u76ee\u524d\u4ecd\u7136\u7ef4\u6301\u57285000\u7f8e\u5143\u5de6\u53f3\u7684\u9ad8\u4f4d\uff1f</p> <p>1\uff09\u6bd4\u7279\u5e01\u7684\u4e0d\u4f9d\u9760\u6307\u5b9a\u7684\u8d27\u5e01\u53d1\u884c\u673a\u6784\uff0c\u800c\u4f9d\u636e\u7279\u5b9a\u7b97\u6cd5\uff0c\u901a\u8fc7\u5927\u91cf\u7684\u8ba1\u7b97\u4ea7\u751f\uff0c\u4e5f\u5c31\u662f\u201c\u6316\u77ff\u201d\u3002</p> <p>\u6bd4\u7279\u5e01\u5728\u8bde\u751f\u8fc7\u7a0b\u4e86\u9644\u52a0\u4e86\u5f88\u591a\u4ef7\u503c\uff1b\u5728\u5bc6\u7801\u5b66\u7684\u5e2e\u52a9\u4e0b\uff0c\u6bd4\u7279\u5e01\u53ea\u80fd\u88ab\u771f\u5b9e\u7684\u62e5\u6709\u8005\u8f6c\u79fb\u548c\u652f\u4ed8\uff0c\u786e\u4fdd\u4e86\u8d27\u5e01\u7684\u6240\u6709\u6743\u548c\u4ea4\u6613\u6d41\u901a\u7684\u533f\u540d\u6027\u3002</p> <p>2\uff09\u603b\u6570\u91cf\u6709\u9650\uff0c\u6781\u5f3a\u7684\u7a00\u7f3a\u6027\uff0c\u6bd4\u7279\u5e01\u7684\u603b\u6570\u91cf\u5728\u6700\u521d\u8bbe\u5b9a\u65f6\uff0c\u5c31\u88ab\u7cfb\u7edf\u6c38\u4e45\u9650\u5236\u57282100\u4e07\u4e2a\u3002</p> <p>3\uff09\u7531\u4e8e\u5bf9\u533a\u5757\u94fe\u6280\u672f\u7684\u770b\u597d\uff0c\u5b83\u7684\u7b2c\u4e00\u4e2a\u4ea7\u54c1\u6bd4\u7279\u5e01\u4e5f\u5229\u597d\u3002\u6b27\u76df\u628a\u6bd4\u7279\u5e01\u770b\u4f5c\u662f\u8d27\u5e01\uff0c\u6309\u7167\u8d27\u5e01\u76d1\u7ba1\uff1b\u7f8e\u56fd\u5c06\u6bd4\u7279\u5e01\u5f52\u4e3a\u8d44\u4ea7\uff0c\u7b49\u540c\u4e8e\u77f3\u6cb9\u7b49\u5927\u5b97\u5546\u54c1\u3002</p>"},{"location":"blockchain/blockchain_and_innovative_thinking_notes_2101/#_2","title":"\u7b2c\u4e8c\u7ae0\uff1a\u6bd4\u7279\u5e01\u5206\u5e03\u5f0f\u8d26\u672c\u521d\u63a2","text":""},{"location":"blockchain/blockchain_and_innovative_thinking_notes_2101/#21","title":"2.1 \u6bd4\u7279\u5e01\u7684\u524d\u4e16\u4eca\u751f","text":"<p>\u8d27\u5e01\u662f\u4e00\u79cd\u5171\u8bc6\u7684\u7ed3\u679c\u3002</p> <p>\u8d27\u5e01\u7684\u53d1\u5c55\u9636\u6bb5\uff1a</p> <ul> <li>\u4ee5\u7269\u6613\u7269</li> <li>\u5b9e\u7269\u8d27\u5e01</li> <li>\u7eb8\u5e01</li> <li>\u4e2d\u5fc3\u5316\u8bb0\u8d26\u8d27\u5e01\uff1a\u94f6\u884c</li> </ul> <p>\u4e2d\u5fc3\u5316\u8bb0\u8d26\u8d27\u5e01\uff08\u7b2c\u4e09\u65b9\u652f\u4ed8\uff0c\u6bd4\u5982\u5fae\u4fe1\u94b1\u5305\u6216\u8005\u652f\u4ed8\u5b9d\uff09</p> <p>\u7528\u6237\u628a\u73b0\u91d1\u5b58\u653e\u5230\u5fae\u4fe1\u6216\u652f\u4ed8\u5b9d\uff0c\u6bcf\u6b21\u5bf9\u5916\u652f\u4ed8\u90fd\u6709\u5fae\u4fe1\u6216\u652f\u4ed8\u5b9d\u4ee3\u7406\u8bb0\u8d26\uff0c\u8bb0\u5f55\u6bcf\u7b14\u4ea4\u6613\u548c\u4f59\u989d\u53d8\u5316\u3002\u79fb\u52a8\u7535\u5b50\u652f\u4ed8\u7684\u5b9e\u8d28\u4e3a\u8bb0\u8d26\u8d27\u5e01\uff0c\u662f\u901a\u8fc7\u94f6\u884c\u3001\u7b2c\u4e09\u65b9\u652f\u4ed8\u673a\u6784\u3001\u592e\u884c\u8d1f\u8d23\u8bb0\u8d26\u7684\u3002</p> <p>\u7535\u5b50\u652f\u4ed8\u884c\u4e1a\u7684\u4e24\u4e2a\u57fa\u672c\u95ee\u9898\uff1a</p> <ol> <li>\u5982\u4f55\u4e0d\u901a\u8fc7\u6743\u5a01\u7684\u7b2c\u4e09\u65b9\uff0c\u5c31\u80fd\u591f\u5728\u6709\u9700\u6c42\u7684\u53cc\u65b9\u4e4b\u95f4\u8fdb\u884c\u5728\u7ebf\u8f6c\u8d26\u5462\uff1f</li> <li>\u5982\u4f55\u5728\u8fdb\u884c\u7535\u5b50\u8f6c\u8d26\u7684\u540c\u65f6\u8bb0\u5f55\u4ed8\u6b3e\u4fe1\u606f\uff0c\u907f\u514d\u91cd\u590d\u652f\u4ed8\u5e76\u786e\u4fdd\u8d44\u91d1\u5b89\u5168\u5462\uff1f</li> </ol> <p>\u8fd9\u4e2a\u53ef\u4ee5\u5728\u4e2d\u672c\u806a\u7684\u300a\u4e00\u79cd\u70b9\u5bf9\u70b9\u7684\u7535\u5b50\u73b0\u91d1\u652f\u4ed8\u7cfb\u7edf\u300b\u6709\u7b54\u6848\u3002</p>"},{"location":"blockchain/blockchain_and_innovative_thinking_notes_2101/#22","title":"2.2 \u94b1\u5305\u3001\u79c1\u94a5\u3001\u7b7e\u540d\u4e0e\u4ea4\u6613","text":"<p>\u5730\u5740\u4e0e\u79c1\u94a5</p> <p>\u6bd4\u7279\u5e01\u7684\u6240\u6709\u6743\u662f\u901a\u8fc7\u79c1\u94a5\u548c\u5730\u5740\u6765\u786e\u5b9a\u7684\u3002\u5730\u5740\u7c7b\u4f3c\u4e8e\u4e00\u4e2a\u94f6\u884c\u8d26\u6237\u7684\u8d26\u53f7\uff0c\u8981\u60f3\u7ed9\u4e00\u4e2a\u4eba\u8f6c\u6bd4\u7279\u5e01\uff0c\u53ea\u8981\u77e5\u9053\u4ed6\u7684\u6bd4\u7279\u5e01\u5730\u5740\u5c31\u53ef\u4ee5\u4e86\u3002\u79c1\u94a5\u7684\u4f5c\u7528\u4e3b\u8981\u662f\u7ed9\u4ea4\u6613\u6765\u7b7e\u540d\uff0c\u7528\u6765\u8bc1\u660e\u8fd9\u7b14\u4ea4\u6613\u662f\u7531\u4f60\u53d1\u8d77\u7684\uff0c\u522b\u4eba\u6536\u5230\u8fd9\u7b14\u4ea4\u6613\uff0c\u901a\u8fc7\u9a8c\u8bc1\u7b7e\u540d\u5c31\u53ef\u4ee5\u786e\u8ba4\u4ea4\u6613\u4e2d\u6d89\u53ca\u7684\u8d44\u91d1\u662f\u5408\u6cd5\u7684\u3002</p> <p>\u5bc6\u7801\u4f53\u5236</p> <p>\u5bf9\u79f0\u5bc6\u7801\u4f53\u5236</p> <ul> <li>\u4e00\u4e2a\u5bc6\u7801\u4f53\u5236\u4e2d\u7684\u52a0\u5bc6\u5bc6\u94a5\u548c\u89e3\u5bc6\u5bc6\u94a5\u76f8\u540c\uff0c\u6216\u8005\u7531\u5176\u4e2d\u4e00\u4e2a\u5bc6\u94a5\u5f88\u5bb9\u6613\u63a8\u7b97\u51fa\u53e6\u4e00\u4e2a\u5bc6\u94a5\u3002</li> </ul> <p>\u975e\u5bf9\u79f0\u5bc6\u7801\u4f53\u5236</p> <ul> <li>\u52a0\u5bc6\u5bc6\u94a5\u4e0d\u80fd\u63a8\u51fa\u89e3\u5bc6\u5bc6\u94a5\uff0c\u56e0\u6b64\u53ef\u4ee5\u5c06\u52a0\u5bc6\u5bc6\u94a5\u516c\u5f00\uff0c\u8fd9\u79cd\u52a0\u5bc6\u5bc6\u94a5\u4e5f\u88ab\u79f0\u4e3a\u516c\u94a5\u5bc6\u7801\u3002</li> </ul> <p>\u516c\u94a5\u52a0\u5bc6\u53d1\u660e\u4e8e20\u4e16\u7eaa70\u5e74\u4ee3\uff0c\u81ea\u4ece\u516c\u94a5\u52a0\u5bc6\u88ab\u53d1\u660e\u4e4b\u540e\uff0c\u4e00\u4e9b\u4e0d\u53ef\u9006\u7684\u6570\u5b66\u51fd\u6570\u88ab\u63d0\u51fa\uff0c\u5c31\u662f\u8bf4\u53ea\u80fd\u5411\u4e00\u4e2a\u65b9\u5411\u8ba1\u7b97\uff0c\u4f46\u4e0d\u53ef\u4ee5\u5411\u76f8\u53cd\u65b9\u5411\u5012\u63a8\u3002</p> <p>\u5728\u6bd4\u7279\u5e01\u4e2d\uff0c\u516c\u94a5\u7528\u4e8e\u63a5\u6536\u6bd4\u7279\u5e01\uff0c\u79c1\u94a5\u7528\u4e8e\u751f\u6210\u5176\u5bf9\u5e94\u5730\u5740\u4e0a\u652f\u4ed8\u6bd4\u7279\u5e01\u6240\u5fc5\u9700\u7684\u7b7e\u540d\uff0c\u4ee5\u552f\u4e00\u786e\u5b9a\u8fd9\u4e9b\u6bd4\u7279\u5e01\u7684\u6240\u6709\u6743\u3002\u5177\u4f53\u5230\u6bd4\u7279\u5e01\u5730\u5740\u7684\u751f\u6210\uff0c\u5176\u5b9e\u662f\u5148\u4ea7\u751f\u79c1\u94a5\uff0c\u79c1\u94a5\u901a\u8fc7\u692d\u5706\u66f2\u7ebf\u7b97\u6cd5\u8fd9\u79cd\u4e0d\u53ef\u9006\u7684\u51fd\u6570\u6765\u4ea7\u751f\u516c\u94a5\uff0c\u516c\u94a5\u7ecf\u8fc7\u4e00\u7cfb\u5217\u4e0d\u53ef\u9006\u7684\u8fd0\u7b97\u518d\u6765\u4ea7\u751f\u5730\u5740\u3002</p> <p>\u79c1\u94a5\u672c\u8d28\u4e0a\u662f\u4e00\u4e2a\u968f\u673a\u6570\u3002\u79c1\u94a5\u6301\u6709\u8005\u624d\u662f\u6bd4\u7279\u5e01\u7684\u62e5\u6709\u8005\uff0c\u90a3\u79c1\u94a5\u653e\u54ea\u91cc\u5462\uff1f</p> <p>\u94b1\u5305\u662f\u79c1\u94a5\u7684\u5bb9\u5668\uff0c\u662f\u5bc6\u94a5\u7684\u7ba1\u7406\u5de5\u5177\uff0c\u5b83\u53ea\u5305\u542b\u5bc6\u94a5\u800c\u4e0d\u662f\u786e\u5207\u7684\u67d0\u4e00\u4e2a\u4ee3\u5e01\u3002\u4e00\u4e2a\u6bd4\u7279\u5e01\u94b1\u5305\u4e2d\u5305\u542b\u4e00\u7cfb\u5217\u7684\u5bc6\u94a5\u5bf9\uff0c\u6bcf\u4e2a\u5bc6\u94a5\u5bf9\u5305\u62ec\u4e00\u4e2a\u79c1\u94a5\u548c\u4e00\u4e2a\u516c\u94a5\u3002</p> <p>\u94b1\u5305\u5730\u5740\u662f\u516c\u5f00\u7684\uff08\u7c7b\u4f3c\u4e8e\u94f6\u884c\u8d26\u53f7\uff09</p> <p>\u79c1\u94a5\u662f\u9690\u79d8\u7684\uff08\u7c7b\u4f3c\u4e8e\u94f6\u884c\u5bc6\u7801\uff09</p> <p>\u51b7\u94b1\u5305\u4e0e\u70ed\u94b1\u5305</p> <p>\u51b7\u94b1\u5305\uff1a\u53c8\u88ab\u79f0\u4f5c\u79bb\u7ebf\u94b1\u5305\uff0c\u4ece\u5b83\u7684\u751f\u6210\u5230\u4f7f\u7528\u90fd\u662f\u5728\u975e\u8054\u7f51\u72b6\u6001\u4e0b\uff0c\u8fd9\u7c7b\u94b1\u5305\u5f80\u5f80\u4f9d\u9760\u4e0d\u8054\u7f51\u7684\u7535\u8111\u3001\u624b\u673a\u4ee5\u53ca\u5176\u4ed6\u7684\u786c\u4ef6\u8bbe\u5907\u8fd0\u884c\u3002</p> <ul> <li>\u4f18\u70b9\uff1a\u56e0\u4e3a\u4e0d\u8054\u7f51\u6240\u4ee5\u53ef\u4ee5\u907f\u5f00\u9ed1\u5ba2\u653b\u51fb\u548c\u6728\u9a6c\u75c5\u6bd2\uff1b</li> <li>\u7f3a\u70b9\uff1a\u4f7f\u7528\u8d77\u6765\u6bd4\u8f83\u9ebb\u70e6\uff0c\u5982\u679c\u8981\u53d1\u9001\u4ea4\u6613\uff0c\u9700\u8981\u7528\u4e2d\u4ecb\u6765\u4ea4\u6362\u4ea4\u6613\u4fe1\u606f\u548c\u7b7e\u540d\u6570\u636e\uff0c\u6210\u672c\u8f83\u9ad8\u3002</li> </ul> <p>\u70ed\u94b1\u5305\uff1a\u5728\u8054\u7f51\u7684\u72b6\u6001\u4e0b\u4f7f\u7528\u7684\uff0c\u4ee5\u5728\u7ebf\u94b1\u5305\u548c\u4ea4\u6613\u5e73\u53f0\u94b1\u5305\u7b49\u5f62\u5f0f\u51fa\u73b0\u3002</p> <ul> <li>\u4f18\u70b9\uff1a\u4f7f\u7528\u65b9\u4fbf\uff0c\u6210\u672c\u4f4e\uff1b</li> <li>\u7f3a\u70b9\uff1a\u56e0\u4e3a\u8054\u7f51\uff0c\u6240\u4ee5\u5916\u754c\u53ef\u4ee5\u901a\u8fc7\u4e92\u8054\u7f51\u8bbf\u95ee\u5230\u4f60\u5b58\u50a8\u79c1\u94a5\u7684\u4f4d\u7f6e\uff0c\u5b58\u5728\u88ab\u9ed1\u5ba2\u653b\u51fb\u7684\u53ef\u80fd\u6027\u3002</li> </ul> <p>\u6bd4\u7279\u5e01\u4ea4\u6613</p> <p>\u4ece\u4e00\u4e2a\u6bd4\u7279\u5e01\u94b1\u5305\u5411\u53e6\u4e00\u4e2a\u4e2d\u8f6c\u8d26\uff0c\u6bcf\u7b14\u4ea4\u6613\u90fd\u6709\u6570\u5b57\u7b7e\u540d\u6765\u4fdd\u8bc1\u5b89\u5168\u3002\u4e00\u4e2a\u4ea4\u6613\u4e00\u65e6\u53d1\u751f\u90a3\u4e48\u5c31\u662f\u5bf9\u6240\u6709\u4eba\u90fd\u516c\u5f00\u7684\uff0c\u6bcf\u4e2a\u4ea4\u6613\u7684\u5386\u53f2\u53ef\u4ee5\u6700\u7ec8\u8ffd\u6eaf\u5230\u76f8\u5e94\u7684\u6bd4\u7279\u5e01\u6700\u521d\u88ab\u6316\u51fa\u6765\u7684\u90a3\u4e2a\u70b9\u3002\u7528\u6237\u7528\u94b1\u5305\u4e2d\u7684\u79c1\u94a5\u6765\u7b7e\u540d\u4ea4\u6613\uff0c\u4ece\u800c\u8bc1\u660e\u4ed6\u4eec\u62e5\u6709\u4ea4\u6613\u7684\u8f93\u51fa\uff0c\u4e5f\u5c31\u662f\u5176\u4e2d\u7684\u6bd4\u7279\u5e01\u3002</p> <p>\u6bd4\u7279\u5e01\u662f\u4ee5\u4ea4\u6613\u8f93\u51fa\u7684\u5f62\u5f0f\u50a8\u5b58\u5728\u533a\u5757\u94fe\u4e2d\u7684\uff0c\u6bd4\u7279\u5e01\u5e76\u4e0d\u5b58\u5728\u4e8e\u4efb\u4f55\u5730\u65b9\uff0c\u5373\u4f7f\u662f\u786c\u76d8\u4e0a\u3002\u6301\u6709\u6bd4\u7279\u5e01\u5176\u5b9e\u662f\u62e5\u6709\u7279\u5b9a\u6bd4\u7279\u5e01\u7684\u5730\u5740\uff0c\u4f46\u662f\u5176\u5b9e\u6240\u8c13\u7684\u5e01\u5e76\u4e0d\u662f\u76f4\u63a5\u5c31\u5b58\u5728\u4e8e\u8fd9\u4e2a\u5730\u5740\u4e2d\u7684\uff0c\u5730\u5740\u5c31\u76f8\u5f53\u4e8e\u4f60\u7684\u94f6\u884c\u8d26\u6237\u3002\u4e16\u754c\u4e0a\u6ca1\u6709\u4e00\u4e2a\u53ef\u4ee5\u6478\u5f97\u7740\u7684\u5b9e\u7269\uff0c\u6216\u8005\u662f\u4e00\u4e2a\u6570\u636e\u6587\u4ef6\uff0c\u53ef\u4ee5\u88ab\u53eb\u505a\u201c\u6bd4\u7279\u5e01\u201d\u7684\u3002</p> <p>\u6709\u7684\u53ea\u662f\u5404\u4e2a\u5730\u5740\u4e4b\u95f4\u7684\u8f6c\u8d26\u8bb0\u5f55\uff0c\u4f59\u989d\u65f6\u589e\u65f6\u51cf\u3002\u6240\u6709\u7684\u4ea4\u6613\u90fd\u5b58\u653e\u5728\u4e00\u4e2a\u975e\u5e38\u5927\u7684\u8d26\u672c\u6587\u4ef6\u4e2d\uff0c\u8fd9\u4e2a\u6587\u4ef6\u5c31\u5728\u201c\u533a\u5757\u94fe\u201d\u3002\u5982\u679c\u60f3\u77e5\u9053\u4e00\u4e2a\u6bd4\u7279\u5e01\u5730\u5740\u4e2d\u7684\u4f59\u989d\uff0c\u90a3\u4e48\u8fd9\u4e2a\u4e0d\u662f\u76f4\u63a5\u5b58\u653e\u5728\u6bd4\u7279\u5e01\u5730\u5740\u4e2d\u7684\uff0c\u6211\u4eec\u9700\u8981\u5230\u533a\u5757\u94fe\u4e2d\u53bb\u8ba1\u7b97\u51fa\u6765\u3002</p> <p>\u4ea4\u6613</p> <p>\u5982\u679cAlice\u7ed9Bob\u53d1\u9001\u4e00\u4e9b\u6bd4\u7279\u5e01\uff0c\u90a3\u4e48\u8fd9\u4e2a\u4ea4\u6613\u5c31\u6709\u4e09\u9879\u4fe1\u606f\uff1a</p> <p>1\u3001\u8f93\u5165\u3002\u8fd9\u91cc\u9762\u8bb0\u5f55\u4e86\u6700\u521dAlice\u62e5\u6709\u7684\u8fd9\u4e9b\u5e01\u662f\u4ece\u54ea\u4e2a\u5730\u5740\u8f6c\u7ed9\u5979\u7684\uff0c\u6211\u4eec\u5047\u8bbe\u5979\u662f\u4ece\u5979\u7684\u670b\u53cbJack\u90a3\u91cc\u5f97\u5230\u7684\u5e01\u3002</p> <p>2\u3001\u6570\u76ee\u3002\u8fd9\u4e2a\u5c31\u662fAlice\u5230\u5e95\u7ed9Bob\u8f6c\u4e86\u591a\u5c11\u4e2a\u6bd4\u7279\u5e01\u3002</p> <p>3\u3001\u8f93\u51fa\u3002Bob\u7684\u6bd4\u7279\u5e01\u5730\u5740\u3002</p> <p>\u9664\u4e86\u7b2c\u4e00\u7b14\u4ea4\u6613\u662f\u77ff\u5de5\u7684\u6316\u77ff\u6240\u5f97\u5916\uff0c\u6bcf\u4e00\u7b14\u4ea4\u6613\u90fd\u62e5\u6709\u4e00\u4e2a\u6216\u591a\u4e2a\u8f93\u5165\uff0c\u4ee5\u53ca\u4e00\u4e2a\u6216\u591a\u4e2a\u8f93\u51fa\u3002</p> <p>\u7b2c\u4e00\u7b14\u77ff\u5de5\u6316\u77ff\u7684\u6536\u5165\u4ea4\u6613\u901a\u5e38\u88ab\u79f0\u4e3aCoinbase\uff0c\u5b83\u6ca1\u6709\u8f93\u5165\uff0c\u6240\u4ee5\u4ea4\u6613\u8f93\u5165\u7684\u54c8\u5e0c\u603b\u662f\u88ab\u6807\u8bb0\u4e3a00000000...0000\uff1b\u5176\u4ed6\u7684\u4ea4\u6613\uff0c\u4efb\u4f55\u4e00\u4e2a\u4ea4\u6613\u8f93\u5165\u90fd\u4f1a\u552f\u4e00\u8ffd\u6eaf\u5230\u533a\u5757\u94fe\u4e0a\u5728\u672c\u533a\u5757\u4e4b\u524d\u7684\u67d0\u4e2a\u4ea4\u6613\u54c8\u5e0c\uff0c\u4ee5\u53ca\u7d22\u5f15\u3002</p> <p>\u901a\u8fc7\u4ea4\u6613\u54c8\u5e0c\u548c\u7d22\u5f15\uff0c\u5373\u53ef\u552f\u4e00\u786e\u5b9a\u4e00\u4e2a\u672a\u82b1\u8d39\u7684\u4ea4\u6613\u8f93\u51fa---UTXO\u3002\u8fd9\u6837\uff0c\u6bcf\u4e00\u4e2a\u4ea4\u6613\u8f93\u5165\u90fd\u548c\u4e4b\u524d\u7684\u67d0\u4e2a\u4ea4\u6613\u8f93\u51fa\u5173\u8054\u4e86\u8d77\u6765\u3002</p> <p></p> <p>\u6bd4\u7279\u5e01\u7684\u4ea4\u6613\u672c\u8d28\u662f\u4e00\u4e2a\u5305\u542b\u8f93\u5165\u503c\u4e0e\u8f93\u51fa\u503c\u7684\u6570\u636e\u7ed3\u6784\u3002</p> <p></p> <p>\u65e2\u7136\u8f93\u5165\u662f\u5bf9\u4e4b\u524d\u8f93\u51fa\u7684\u5f15\u7528\uff0c\u90a3\u5176\u4ed6\u4eba\u4e3a\u4ec0\u4e48\u4e0d\u80fd\u5f15\u7528Alice\u6253\u7ed9Bob\u7684\u8fd9\u4e24\u7b14\u4ea4\u6613\u8f93\u51fa\u5462\uff1f\u56e0\u4e3aAlice\u5728\u7ed9Bob\u8f6c\u8d26\u65f6\uff0c\u52a0\u4e86\u4e00\u4e2a\u6761\u4ef6\uff0c\u8fd9\u4e2a\u6761\u4ef6\u5728\u6bd4\u7279\u5e01\u4ea4\u6613\u4e2d\u53eb\u505a\u516c\u94a5\u811a\u672c\uff0c\u672c\u4f8b\u5b50\u4e2d\uff0c\u516c\u94a5\u811a\u672c\u7684\u5185\u5bb9\u662f\u4ea4\u6613\u8f93\u51fa\u7684\u8d26\u53f7\u5730\u5740\u5fc5\u987b\u662fBob\u7684\u5730\u5740\u3002</p> <p>\u7b7e\u540d\u4e0e\u9a8c\u7b7e\uff1a</p> <p>\u7b7e\u540d\u5fc5\u987b\u4f7f\u7528\u79c1\u94a5\uff0c\u800c\u53ea\u6709\u79c1\u94a5\u5bf9\u5e94\u7684\u516c\u94a5\u624d\u80fd\u9a8c\u8bc1\u7b7e\u540d\u901a\u8fc7\u3002\u56e0\u4e3a\u53ea\u6709Bob\u672c\u4eba\u6301\u6709\u8fd9\u4e2a\u8d26\u6237\u5730\u5740\u5bf9\u5e94\u7684\u79c1\u94a5\uff0c\u6240\u4ee5Bob\u7b7e\u540d\u540e\uff0c\u5176\u4ed6\u4eba\u53ef\u4ee5\u7528Bob\u63d0\u4f9b\u7684\u516c\u94a5\u53bb\u9a8c\u7b7e\uff0c\u800c\u5176\u4ed6\u4eba\u4e0d\u77e5\u9053Bob\u7684\u79c1\u94a5\uff0c\u5373\u4f7f\u5192\u5145Bob\uff0c\u586b\u4e0aBob\u7684\u516c\u94a5\uff0c\u522b\u4eba\u4e5f\u4e0d\u4f1a\u9a8c\u8bc1\u901a\u8fc7\uff0c\u4e5f\u5c31\u4f5c\u4e0d\u4e86\u5f0a\u4e86\u3002</p> <p>\u6ce8\uff1a\u5730\u5740\u662f\u516c\u94a5\u7684\u54c8\u5e0c</p>"},{"location":"blockchain/blockchain_and_innovative_thinking_notes_2101/#23","title":"2.3 \u975e\u5bf9\u79f0\u52a0\u5bc6\u5982\u4f55\u907f\u514d\u8bb0\u5047\u8d26","text":"<p>Alice\u8981\u4ece\u5317\u4eac\u7ed9\u5e7f\u5dde\u7684Bob\u53d1\u9001\u4e00\u4e2a\u5feb\u9012\uff0c\u9014\u4e2d\u9700\u8981\u7ecf\u8fc7\u4e0a\u6d77\u5feb\u9012\u7ad9\uff0c\u8fd9\u65f6\u4e0a\u6d77\u5feb\u9012\u4e2d\u5fc3\u51fa\u73b0\u4e86\u4e00\u4e2a\u9ed1\u5ba2\uff0c\u4ed6\u5077\u5077\u6253\u5f00\u4e86Alice\u7ed9Bob\u7684\u5feb\u9012\uff0c\u5e76\u4fee\u6539\u4e86\u5feb\u9012\u5305\u91cc\u7684\u4e1c\u897f\uff0c\u518d\u6309\u539f\u6837\u5305\u88c5\u597d\u53d1\u5f80\u5e7f\u5dde\u3002\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u5bf9\u4e8e\u8fd9\u6837\u7b80\u5355\u5305\u88c5\u7684\u4f20\u8f93\u5728\u4e2d\u9014\u662f\u5f88\u5bb9\u6613\u88ab\u4fee\u6539\u7684\u3002</p> <p></p> <p>\u4e0a\u56fe\u4e2d\uff0cAlice\u5982\u4f55\u5c06\u52a0\u5bc6\u7684\u5bc6\u7801\u7ed9Bob\u5462\uff1f</p> <p></p> <p>\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528\u975e\u5bf9\u79f0\u52a0\u5bc6</p> <p>\u975e\u5bf9\u79f0\u52a0\u5bc6\u7684\u89e3\u51b3\u65b9\u6848</p> <p>Bob\u6709\u4e24\u628a\u94a5\u5319\uff0c\u4e00\u628a\u53eb\u516c\u94a5\uff0c\u4e00\u628a\u53eb\u79c1\u94a5\u3002 \u516c\u94a5\u662f\u516c\u5f00\u7684\u8ba9\u5168\u793e\u4f1a\u90fd\u77e5\u9053\uff0cBob\u544a\u8bc9Alice\uff0c\u4f60\u7ed9\u6211\u53d1\u9001\u5bc6\u7801\u7684\u65f6\u5019\u7528\u6211\u7684\u516c\u94a5\u52a0\u5bc6\u4ee5\u540e\u518d\u4f20\uff0c\u4e0d\u7528\u62c5\u5fc3\u8fd9\u4e2a\u516c\u94a5\u52a0\u5bc6\u7684\u5185\u5bb9\u88ab\u7834\u89e3\uff0c\u56e0\u4e3a\u53ea\u6709\u6211\u7684\u79c1\u94a5\u624d\u80fd\u89e3\u5bc6\u3002 \u6709\u4e86\u975e\u5bf9\u79f0\u52a0\u5bc6\uff0c\u5206\u5e03\u5f0f\u7535\u5b50\u8d27\u5e01\u624d\u6709\u4e86\u57fa\u7840\uff0c\u624d\u80fd\u89e3\u51b3\u7535\u5b50\u8d27\u5e01\u6240\u6709\u6743\u7684\u95ee\u9898\u3002</p> <p>\u975e\u5bf9\u79f0\u52a0\u5bc6\u7684\u5b9a\u4e49\uff1a\u7ed3\u5408\u7740\u5bf9\u79f0\u52a0\u89e3\u5bc6\u7b97\u6cd5\u6765\u7406\u89e3\uff0c\u4e00\u4e2a\u662f\u5bf9\u79f0\uff0c\u4e00\u4e2a\u662f\u975e\u5bf9\u79f0\u3002</p> <p>\u5bf9\u79f0\u6307\u7684\u662f\u52a0\u5bc6\u548c\u89e3\u5bc6\u4f7f\u7528\u540c\u4e00\u4e2a\u5bc6\u94a5\uff0c\u79f0\u4e3a\u5bf9\u79f0\u5bc6\u94a5\uff1b\u975e\u5bf9\u79f0\u52a0\u89e3\u5bc6\u7b97\u6cd5\u5728\u52a0\u5bc6\u548c\u89e3\u5bc6\u65f6\uff0c\u7528\u7684\u5c31\u662f\u4e0d\u540c\u7684\u5bc6\u94a5\uff0c\u5206\u522b\u79f0\u4e3a\u516c\u94a5\u548c\u79c1\u94a5\u3002</p> <p></p> <p>\u975e\u5bf9\u79f0\u52a0\u5bc6\u7b97\u6cd5\u4e2d\u516c\u94a5\u4e0e\u79c1\u94a5\u662f\u4e00\u5bf9\uff1b</p> <ul> <li>\u82e5\u7528\u516c\u94a5\u5bf9\u6570\u636e\u8fdb\u884c\u52a0\u5bc6\uff0c\u53ea\u6709\u7528\u5bf9\u5e94\u7684\u79c1\u94a5\u624d\u80fd\u89e3\u5bc6\uff1b</li> <li>\u82e5\u7528\u79c1\u94a5\u5bf9\u6570\u636e\u8fdb\u884c\u52a0\u5bc6\uff0c\u53ea\u6709\u7528\u5bf9\u5e94\u7684\u516c\u94a5\u624d\u80fd\u89e3\u5bc6\u3002</li> </ul> <p>\u516c\u94a5\u52a0\u5bc6\u3001\u79c1\u94a5\u89e3\u5bc6\u3002</p> <p>\u79c1\u94a5\u7b7e\u540d\uff0c\u516c\u94a5\u9a8c\u7b7e\u3002</p> <p>\u8bf4\u67d0\u4eba\u5bf9\u67d0\u4e2a\u6bd4\u7279\u5e01\u62e5\u6709\u6240\u6709\u6743\uff0c\u662f\u6307\u4ed6\u62e5\u6709\u8fd9\u4e2a\u6bd4\u7279\u5e01\u5730\u5740\u5bf9\u5e94\u7684\u79c1\u94a5\u3002</p> <p>\u79c1\u94a5\u3001\u516c\u94a5\u3001\u5730\u5740\u4e09\u8005\u95f4\u7684\u5173\u7cfb\uff1a\u79c1\u94a5\u751f\u6210\u516c\u94a5\uff0c\u516c\u94a5\u751f\u6210\u5730\u5740\u3002</p> <p>\u5f53\u4f7f\u7528\u4e00\u4e2aUTXO\u65f6\uff0c\u7528\u6237\u8981\u63d0\u4f9b\u8fd9\u4e2aUTXO\u4e2d\u63cf\u8ff0\u7684\u5730\u5740\u5bf9\u5e94\u7684\u516c\u94a5\uff0c\u540c\u65f6\u7528\u8fd9\u4e2a\u516c\u94a5\u5bf9\u5e94\u7684\u79c1\u94a5\u5bf9\u8fd9\u4e2a\u4ea4\u6613\u8fdb\u884c\u7b7e\u540d\uff0c\u8fd9\u6837\u6bd4\u7279\u5e01\u7684\u63a5\u53d7\u8005\u624d\u80fd\u53bb\u9a8c\u8bc1\u8fd9\u7b14\u4ea4\u6613\u662f\u5426\u6709\u6548\u3002</p> <p>\u4ea4\u6613\u9a8c\u8bc1\u73af\u8282\uff1a</p> <p>\u628a\u516c\u94a5\u505a\u54c8\u5e0c\u770b\u8fd9\u4e2a\u503c\u662f\u5426\u4e0eUTXO\u4e2d\u63cf\u8ff0\u7684\u5730\u5740\u4e00\u81f4\uff0c\u7136\u540e\u518d\u7528\u63d0\u4f9b\u7684\u516c\u94a5\u5bf9\u4ea4\u6613\u4e2d\u63d0\u4f9b\u7684\u7b7e\u540d\u4fe1\u606f\u8fdb\u884c\u9a8c\u7b7e\uff0c\u4ee5\u786e\u5b9a\u4ea4\u6613\u662fUTXO\u7684\u6240\u6709\u8005\u53d1\u51fa\u7684\u4ea4\u6613\u3002\u5728\u4ea4\u6613\u7684\u9a8c\u8bc1\u73af\u8282\uff0c\u6211\u4eec\u4e3b\u8981\u7528\u4e86\u201c\u975e\u5bf9\u79f0\u52a0\u5bc6\u201d\u4e2d\u5173\u4e8e\u7b7e\u540d\u3001\u9a8c\u7b7e\u7684\u529f\u80fd\u3002\u5176\u4e2d\u6bd4\u7279\u5e01\u4e2d\u7684\u516c\u3001\u79c1\u94a5\u751f\u6210\u4ee5\u53ca\u7b7e\u540d\u7b97\u6cd5ECDSA\u90fd\u662f\u57fa\u4e8e\u692d\u5706\u66f2\u7ebf\u7b97\u6cd5\u7684\u3002</p> <p>\u692d\u5706\u66f2\u7ebf\u7b97\u6cd5</p> <ul> <li>\u692d\u5706\u66f2\u7ebf\u5bc6\u7801\u5b66\u7b80\u79f0ECC\uff0c\u662f\u4e00\u79cd\u5efa\u7acb\u516c\u5f00\u5bc6\u94a5\u52a0\u5bc6\u7684\u7b97\u6cd5\uff08\u975e\u5bf9\u79f0\u52a0\u5bc6\uff09\u3002\u7c7b\u4f3c\u7684\u8fd8\u6709RSA\u3001ElGamal\u7b97\u6cd5\u7b49\u3002ECC\u88ab\u516c\u8ba4\u4e3a\u5728\u7ed9\u5b9a\u5bc6\u94a5\u957f\u5ea6\u4e0b\u6700\u5b89\u5168\u7684\u52a0\u5bc6\u7b97\u6cd5\u3002</li> <li>\u692d\u5706\u66f2\u7ebf\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u603b\u79f0\uff0c\u662f\u4e00\u79cd\u6570\u5b66\u57fa\u7840\u7b97\u6cd5\uff0c\u4e0d\u662f\u771f\u6b63\u7528\u5728\u5bc6\u7801\u5b66\u4e0a\u7684\u5bc6\u7801\u7b97\u6cd5\u3002\u8bb8\u591a\u975e\u5bf9\u79f0\u52a0\u5bc6\u7b97\u6cd5\uff0c\u4f8b\u5982RSA\u3001\u692d\u5706\u66f2\u7ebf\uff0c\u80fd\u591f\u88ab\u5927\u5bb6\u8ba4\u53ef\u4f7f\u7528\uff0c\u662f\u56e0\u4e3a\u6bcf\u79cd\u52a0\u5bc6\u7b97\u6cd5\u5728\u6570\u5b66\u4e0a\u90fd\u6709\u4e00\u4e2a\u8fd0\u7b97\uff0c\u800c\u8fd9\u4e2a\u8fd0\u7b97\u7684\u9006\u8fc7\u7a0b\u88ab\u8bc1\u660e\u662f\u6570\u5b66\u96be\u9898\u3002</li> </ul> <p>\u5728\u6bd4\u7279\u5e01\u4ea4\u6613\u4e2d\u6709\u4e09\u4e2a\u4fdd\u969c\u6765\u907f\u514d\u8ba1\u5047\u8d26\uff1a</p> <p>1\uff09\u7528\u79c1\u94a5\u5bf9\u4ea4\u6613\u4fe1\u606f\u7b7e\u540d\uff0c\u5fc5\u987b\u7528\u914d\u5bf9\u7684\u516c\u94a5\u9a8c\u8bc1\u7b7e\u540d\uff0c\u79c1\u94a5\u7684\u4f7f\u7528\u8005\u5fc5\u987b\u662f\u4ed8\u6b3e\u4eba\uff1b\uff08\u79c1\u94a5\u7b7e\u540d\uff09</p> <p>2\uff09\u88ab\u7b7e\u540d\u7684\u4ea4\u6613\u4fe1\u606f\u5728\u7f51\u7edc\u4e0a\u8fdb\u884c\u5e7f\u64ad\uff0c\u6240\u6709\u53c2\u4e0e\u5230\u6bd4\u7279\u5e01\u7f51\u7edc\u7684\u4eba\u90fd\u53ef\u4ee5\u63a5\u6536\u5230\u8fd9\u7b14\u4ea4\u6613\u4fe1\u606f\uff0c\u5e76\u4e14\u53ef\u4ee5\u5bf9\u4ea4\u6613\u4fe1\u606f\u8fdb\u884c\u9a8c\u7b7e\uff0c\u786e\u4fdd\u4ea4\u6613\u662f\u5408\u6cd5\u7684\uff1b\uff08\u516c\u94a5\u9a8c\u7b7e\uff09</p> <p>3\uff09\u63a5\u6536\u5230\u4ea4\u6613\u4fe1\u606f\u540e\uff0c\u5927\u5bb6\u4f1a\u6309\u7167\u7ea6\u5b9a\u7684\u89c4\u5219\u751f\u6210\u533a\u5757\uff0c\u5c31\u662f\u4e00\u4e2a\u6570\u636e\u5757\uff0c\u8fd9\u4e2a\u6570\u636e\u5757\u4e2d\u5305\u62ec\u6240\u6709\u7684\u4ea4\u6613\u660e\u7ec6\u4fe1\u606f\uff0c\u6309\u7167merkle\u6811\u7684\u65b9\u5f0f\u7ec4\u88c5\u8d77\u6765\u3002</p> <p>\u6ce8\uff1a\u524d\u4e24\u4e2a\u4fdd\u969c\u90fd\u662f\u4f7f\u7528\u4e86\u975e\u5bf9\u79f0\u52a0\u5bc6\u7b97\u6cd5\u6765\u5b8c\u6210\u7684</p>"},{"location":"blockchain/blockchain_and_innovative_thinking_notes_2101/#24","title":"2.4 \u54c8\u5e0c\u8fd0\u7b97\u4e0e\u795e\u5947\u7684\u96be\u4ee5\u7be1\u6539","text":"<p>\u54c8\u5e0c\u51fd\u6570\u7684\u7279\u6027\uff1a</p> <p>1\uff09\u53ef\u4ee5\u7528\u4e8e\u201c\u4efb\u610f\u201d\u957f\u5ea6\u7684\u6d88\u606f\uff1b</p> <p>2\uff09\u4ea7\u751f\u7684Hash\u503c\u662f\u56fa\u5b9a\u957f\u5ea6\u7684\uff1b</p> <p>3\uff09\u5bf9\u4e8e\u4efb\u610f\u7ed9\u5b9a\u7684\u6d88\u606f\uff0c\u5bb9\u6613\u8ba1\u7b97\u6d88\u606f\u5bf9\u5e94\u7684\u54c8\u5e0c\u503c\uff1b</p> <p>4\uff09\u4e0d\u80fd\u901a\u8fc7\u7ed9\u5b9a\u7684\u54c8\u5e0c\u503c\u53cd\u5411\u63a8\u7b97\u51fa\u8f93\u5165\u7684\u6570\u636e\u6216\u8005\u6d88\u606f\u3002</p> <p>\u533a\u5757\u94fe\u4e2d\u7684\u54c8\u5e0c\u6307\u9488\uff1a\u666e\u901a\u7684\u6307\u9488\u53ea\u662f\u4fdd\u5b58\u7ed3\u6784\u4f53\u5728\u5185\u5b58\u4e2d\u7684\u4f4d\u7f6e\uff0c\u800c\u54c8\u5e0c\u6307\u9488\u662f\u4e0d\u4ec5\u8981\u4fdd\u5b58\u7ed3\u6784\u4f53\u5728\u5185\u5b58\u4e2d\u7684\u4f4d\u7f6e\uff0c\u8fd8\u8981\u4fdd\u5b58\u7ed3\u6784\u4f53\u7684\u54c8\u5e0c\u503c\u3002</p> <p></p> <p>\u533a\u5757\u94fe\u548c\u666e\u901a\u94fe\u8868\u7684\u533a\u522b\uff1a\u6bd4\u7279\u5e01\u80cc\u540e\u7684\u6280\u672f\u4e3b\u8981\u662f\u533a\u5757\u94fe\uff0c\u800c\u533a\u5757\u94fe\u662f\u7531\u4e00\u4e2a\u4e2a\u533a\u5757\u8fde\u63a5\u800c\u6210\uff0c\u533a\u5757\u94fe\u548c\u666e\u901a\u94fe\u8868\u7684\u4e3b\u8981\u533a\u522b\u5c31\u5728\u4e8e\u7528\u54c8\u5e0c\u6307\u9488\u4ee3\u66ff\u4e86\u666e\u901a\u7684\u6307\u9488\u3002\u666e\u901a\u94fe\u8868\u5982\u679c\u5185\u5bb9\u53d1\u751f\u4e86\u6539\u53d8\uff0c\u6307\u9488\u4e0d\u4f1a\u53d1\u751f\u6539\u53d8\uff0c\u800c\u533a\u5757\u94fe\u4e00\u65e6\u5185\u5bb9\u53d1\u751f\u4e86\u53d8\u5316\uff0c\u540e\u9762\u533a\u5757\u7684\u54c8\u5e0c\u6307\u9488\u90fd\u4f1a\u53d1\u751f\u53d8\u5316\uff0c\u7c7b\u4f3c\u4e8e\u591a\u7c73\u82e5\u9aa8\u724c\u6548\u5e94\u3002</p> <p>\u54c8\u5e0c\u8fd0\u7b97\u80fd\u5e2e\u52a9\u8bc6\u522b\u533a\u5757\u6570\u636e\u662f\u5426\u88ab\u7be1\u6539\uff0c\u533a\u5757\u94fe\u7684\u54c8\u5e0c\u503c\u80fd\u552f\u4e00\u800c\u7cbe\u51c6\u5730\u6807\u8bc6\u4e00\u4e2a\u533a\u5757\uff0c\u533a\u5757\u94fe\u4e2d\u4efb\u610f\u8282\u70b9\u901a\u8fc7\u7b80\u5355\u7684\u54c8\u5e0c\u8ba1\u7b97\u90fd\u53ef\u4ee5\u83b7\u5f97\u8fd9\u4e2a\u533a\u5757\u7684\u54c8\u5e0c\u503c\uff0c\u8ba1\u7b97\u51fa\u7684\u54c8\u5e0c\u503c\u6ca1\u6709\u53d8\u5316\u4e5f\u5c31\u610f\u5473\u7740\u533a\u5757\u94fe\u4e2d\u7684\u4fe1\u606f\u6ca1\u6709\u88ab\u7be1\u6539\u3002\u53e6\u5916\uff0c\u54c8\u5e0c\u8fd0\u7b97\u8fd8\u80fd\u5e2e\u52a9\u628a\u5404\u4e2a\u533a\u5757\u4e32\u8fde\u6210\u533a\u5757\u94fe\u3002\u6bcf\u4e2a\u533a\u5757\u90fd\u5305\u542b\u4e0a\u4e00\u4e2a\u533a\u5757\u7684\u54c8\u5e0c\u503c\u548c\u4e0b\u4e00\u4e2a\u533a\u5757\u7684\u503c\uff0c\u5c31\u76f8\u5f53\u4e8e\u901a\u8fc7\u4e0a\u4e00\u4e2a\u533a\u5757\u7684\u54c8\u5e0c\u503c\u6302\u94a9\u5230\u8fd9\u4e00\u4e2a\u533a\u5757\uff0c\u901a\u8fc7\u8fd9\u4e00\u4e2a\u533a\u5757\u7684\u54c8\u5e0c\u503c\u6302\u94a9\u5230\u4e0b\u4e00\u4e2a\u533a\u5757\uff0c\u5c31\u81ea\u7136\u800c\u7136\u5f62\u6210\u4e00\u4e2a\u94fe\u5f0f\u7ed3\u6784\u7684\u533a\u5757\u94fe\u3002</p> <p>\u6ce8\uff1a\u54c8\u5e0c\u8fd0\u7b97\u8fd8\u80fd\u52a0\u5bc6\u4ea4\u6613\u5730\u5740</p> <p>Merkle\u6811\u7684\u4f5c\u7528</p> <p>\u7b2c\u4e00\uff0c\u53ef\u4ee5\u5feb\u901f\u5b9a\u4f4d\u6bcf\u7b14\u4ea4\u6613\uff0c\u7531\u4e8e\u4ea4\u6613\u5728\u5b58\u50a8\u4e0a\u662f\u7ebf\u6027\u5b58\u50a8\uff0c\u5b9a\u4f4d\u5230\u67d0\u7b14\u4ea4\u6613\u4f1a\u9700\u8981\u904d\u5386\uff0c\u6548\u7387\u4f4e\u65f6\u95f4\u6162\uff0c\u901a\u8fc7\u8fd9\u6837\u7684\u4e8c\u53c9\u6811\u53ef\u4ee5\u5feb\u901f\u5b9a\u4f4d\u5230\u60f3\u8981\u627e\u7684\u4ea4\u6613\u3002</p> <p>\u7b2c\u4e8c\uff0c\u5728\u4e0d\u9700\u8981\u5b58\u50a8\u6574\u4e2a\u6570\u636e\u7684\u60c5\u51b5\u4e0b\uff0c\u5c31\u53ef\u4ee5\u7b80\u660e\u5730\u6838\u5b9e\u4ea4\u6613\u662f\u5426\u88ab\u7be1\u6539\uff0c\u4ece\u4ea4\u6613\u5230\u6bcf\u4e2a\u4e8c\u53c9\u6811\u7684\u54c8\u5e0c\u503c\uff0c\u6709\u4efb\u4f55\u4e00\u4e2a\u6570\u5b57\u7684\u53d8\u5316\u90fd\u4f1a\u5bfc\u81f4\u6839\u54c8\u5e0c\u7684\u53d8\u5316\u3002\u540c\u65f6\uff0c\u5982\u679c\u6709\u9519\u8bef\uff0c\u53ef\u4ee5\u5feb\u901f\u5b9a\u4f4d\u5230\u9519\u8bef\u7684\u5730\u65b9\u3002</p> <ul> <li>merkle tree\u662f\u4e00\u79cd\u6811\u72b6\u7ed3\u6784\uff0c\u5b83\u5177\u6709\u6811\u7ed3\u6784\u7684\u6240\u6709\u7279\u70b9\uff1b</li> <li>merkle tree\u7684\u53f6\u5b50\u8282\u70b9\u7684\u503c\u662f\u6570\u636e\u96c6\u5408\u7684\u5355\u5143\u6570\u636e\u6216\u8005\u662f\u5355\u5143\u6570\u636e\u7684\u54c8\u5e0c\u503c\uff1b</li> <li>\u975e\u53f6\u5b50\u8282\u70b9\u7684\u503c\u662f\u6839\u636e\u5b83\u4e0b\u9762\u6240\u6709\u53f6\u5b50\u8282\u70b9\u7684\u503c\uff0c\u6309\u7167hash\u7b97\u6cd5\u8ba1\u7b97\u800c\u5f97\u51fa\u7684\u3002</li> </ul> <p></p> <p>\u6316\u77ff: \u533a\u5757\u5934\u4e2d\u6709\u4e2a\u53c2\u6570\u53eb\u968f\u673a\u6570Nonce\uff0c\u5bfb\u627e\u8fd9\u4e2a\u968f\u673a\u6570\u7684\u8fc7\u7a0b\u5c31\u53eb\u505a\u201c\u6316\u77ff\u201d\uff1b</p> <p>\u6ce8\uff1a\u7f51\u7edc\u4e0a\u4efb\u4f55\u4e00\u53f0\u673a\u5668\u53ea\u8981\u627e\u5230\u5408\u9002\u7684\u6570\u5b57\u586b\u5230\u81ea\u5df1\u7684Nonce\u4f4d\u7f6e\uff0c\u4f7f\u5f97\u533a\u5757\u5934\u8fd96\u4e2a\u5b57\u6bb5\uff0880\u4e2a\u5b57\u8282\uff09\u7684\u6570\u636e\u7684\u54c8\u5e0c\u503c\u7b26\u5408\u76ee\u6807\u54c8\u5e0c\u503c\u3002</p> <p>Nonce\uff1aNumber Only Used Once \u7684\u7f29\u5199\uff0c\u5373\u201c\u53ea\u7528\u4e00\u6b21\u7684\u6570\u5b57\u201d\u3002</p>"},{"location":"blockchain/blockchain_and_innovative_thinking_notes_2101/#25-utxo","title":"2.5 \u53cc\u82b1\u95ee\u9898\u548cUTXO","text":"<p>\u53cc\u82b1\uff0c\u5373\u4e00\u7b14\u94b1\u88ab\u82b1\u8d39\u4e86\u4e24\u6b21\u751a\u81f3\u66f4\u591a\u6b21\u3002</p> <p>\u6570\u5b57\u8d27\u5e01\u4e2d\u7684\u53cc\u82b1\u95ee\u9898\uff1a</p> <p>\u5728\u6570\u5b57\u8d27\u5e01\u7cfb\u7edf\u4e2d\uff0c\u6570\u5b57\u8d44\u4ea7\u672c\u8d28\u4e0a\u662f\u4ee5\u4e92\u8054\u7f51\u4e3a\u57fa\u7840\u7684\u865a\u62df\u6570\u5b57\uff0c\u7b80\u5355\u6765\u8bf4\u6240\u8c13\u7684\u6570\u5b57\u8d44\u4ea7\u5176\u5b9e\u5c31\u662f\u4e00\u4e32\u5b57\u7b26\uff0c\u56e0\u6b64\u5b83\u5f88\u5bb9\u6613\u88ab\u590d\u5236\u6216\u8005\u591a\u6b21\u53d1\u9001\u4f7f\u7528\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u6ca1\u6709\u4e2d\u5fc3\u673a\u6784\u7684\u5b58\u5728\uff0c\u4eba\u4eec\u5e76\u4e0d\u80fd\u786e\u5b9a\u4e00\u7b14\u8d44\u4ea7\u662f\u5426\u5df2\u7ecf\u88ab\u82b1\u6389\uff0c\u8fd9\u5c31\u5bfc\u81f4\u7cfb\u7edf\u53ef\u80fd\u5b58\u5728\u540c\u4e00\u7b14\u6570\u5b57\u8d44\u4ea7\u56e0\u4e0d\u5f53\u64cd\u4f5c\u88ab\u91cd\u590d\u4f7f\u7528\u7684\u60c5\u51b5\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u53cc\u82b1\u95ee\u9898\uff0c\u6211\u4eec\u65e5\u5e38\u7684\u6570\u5b57\u8d44\u4ea7\u4f7f\u7528\u4f9d\u8d56\u4e8e\u7b2c\u4e09\u65b9\u4fe1\u4efb\u673a\u6784\u8fdb\u884c\u3002\u8fd9\u7c7b\u673a\u6784\u5bf9\u6570\u636e\u8fdb\u884c\u4e2d\u5fc3\u5316\u7ba1\u7406\uff0c\u7531\u5b83\u4fdd\u7ba1\u4ea4\u6613\u603b\u8d26\uff0c\u5e76\u901a\u8fc7\u5b9e\u65f6\u4fee\u6539\u8d26\u6237\u4f59\u989d\u7684\u65b9\u6cd5\u6765\u9632\u6b62\u53cc\u91cd\u652f\u4ed8\u7684\u51fa\u73b0\u3002\u4f46\u662f\u9a8c\u8bc1\u8d39\u7528\u6781\u9ad8\u3002</p> <p>\u5728\u6bd4\u7279\u5e01\u7cfb\u7edf\u4e2d\u662f\u5982\u4f55\u907f\u514d\u53cc\u82b1\u95ee\u9898\u7684\u5462\uff1f</p> <p>\u77ff\u5de5\u5728\u751f\u6210\u533a\u5757\u7684\u65f6\u5019\uff0c\u4f1a\u4ece\u7f51\u7edc\u4e0a\u6536\u96c6\u4ea4\u6613\u4fe1\u606f\uff0c\u4ea4\u6613\u4fe1\u606f\u4e2d\u5305\u542b\u4e86\u4ed8\u6b3e\u4eba\u7684\u79c1\u94a5\u7b7e\u540d\u3002\u77ff\u5de5\u9996\u5148\u4f1a\u9a8c\u8bc1\u7b7e\u540d\u662f\u4e0d\u662f\u6b63\u786e\u7684\uff0c\u53ea\u6709\u6b63\u786e\u7684\u7b7e\u540d\u624d\u4f1a\u88ab\u8ba4\u4e3a\u662f\u4ed8\u6b3e\u4eba\u8ba4\u53ef\u7684\u652f\u4ed8\u3002\u7136\u540e\u77ff\u5de5\u4f1a\u4ece\u4ee5\u524d\u7684\u533a\u5757\u94fe\u4e2d\u8ffd\u6eaf\uff0c\u770b\u770b\u4ed8\u6b3e\u4eba\u8fd9\u6b21\u6d88\u8d39\u7684\u6bd4\u7279\u5e01\u662f\u4e0d\u662f\u4ee5\u524d\u6ca1\u6709\u88ab\u6d88\u8d39\u8fc7\u3002\u7136\u540e\u8bb0\u5f55\u4e0b\u4ed8\u6b3e\u4eba\u53ef\u7528\u7684\u6bd4\u7279\u5e01\u4f59\u989d\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u4e5f\u88ab\u79f0\u4e3aUTXO\u673a\u5236\u3002</p> <p>UTXO\u662fUnspent Transaction Outputs\u7684\u7f29\u5199\uff0c\u5168\u79f0\u53eb\u505a\u201c\u5c1a\u672a\u4f7f\u7528\u7684\u4ea4\u6613\u8f93\u51fa\u201d\u3002</p> <p>U \u4ee3\u8868Unspent\uff0c\u8868\u793a\u672a\u652f\u4ed8\u7684\u6216\u5c1a\u672a\u4f7f\u7528\u7684\uff0c\u201c\u5c1a\u672a\u652f\u4ed8\u201d\u6307\u7684\u662f\u8fd9\u4e2a\u4ea4\u6613\u8f93\u51fa\u8fd8\u6ca1\u6709\u51fa\u73b0\u5728\u5176\u5b83\u4ea4\u6613\u7684\u8f93\u5165\u7aef\uff1b</p> <p>TX \u662ftransaction \u7684\u7f29\u5199\uff0c\u4ea4\u6613\u662f\u4ece\u4e00\u4e2a\u6bd4\u7279\u5e01\u94b1\u5305\u5411\u53e6\u4e00\u4e2a\u94b1\u5305\u8f6c\u8d26\uff0c\u662f\u552f\u4e00\u53ef\u4ee5\u6539\u53d8\u6bd4\u7279\u5e01\u6240\u6709\u6743\u7684\u65b9\u5f0f\uff0c\u5305\u542b\u4e86\u8f93\u5165\u3001\u6570\u76ee\u548c\u8f93\u51fa\u8fd9\u4e9b\u57fa\u672c\u5185\u5bb9\uff1b</p> <p>O \u662fOutput\uff0c\u662f\u8f93\u51fa\u7684\u610f\u601d\uff0cTXO\u8fde\u8d77\u6765\u5c31\u662f\u6307\u4ea4\u6613\u8f93\u51fa\u3002</p> <p>\u6ce8\uff1a\u6bd4\u7279\u5e01\u91cc\u5e76\u6ca1\u6709\u7528\u6237\u8d26\u6237\u7684\u6982\u5ff5\u3002\u6bd4\u7279\u5e01\u662f\u4ee5\u4ea4\u6613\u8f93\u51fa\uff0c\u4e5f\u5c31\u662fTXO\u7684\u5f62\u5f0f\u5b58\u5728\u7684\u3002\u6211\u4eec\u8bf4\u81ea\u5df1\u6709\u591a\u5c11\u6bd4\u7279\u5e01\u5b9e\u9645\u4e0a\u662f\u6307\u6211\u4eec\u62e5\u6709\u6240\u6709\u6743\u7684\u90a3\u4e9bUTXO\u4e2d\u6240\u6307\u660e\u7684\u6bd4\u7279\u5e01\u7684\u6570\u91cf\u3002\u6ca1\u6709\u6bd4\u7279\u5e01\uff0c\u53ea\u6709UTXO\u3002</p> <p>Alice\u670910\u4e2a\u6bd4\u7279\u5e01\uff0c\u672c\u8d28\u4e0a\u662f\u5f53\u524d\u533a\u5757\u94fe\u8d26\u672c\u4e2d\uff0c\u6709\u82e5\u5e72\u7b14\u4ea4\u6613\u7684UTXO\u9879\u6536\u6b3e\u4eba\u5199\u7684\u662fAlice\u7684\u5730\u5740\uff0c\u800c\u8fd9\u4e9bUTXO\u9879\u7684\u6570\u989d\u603b\u548c\u662f10\u3002</p> <p>\u6bd4\u7279\u5e01\u7684\u5206\u5e03\u5f0f\u533a\u5757\u94fe\u8d26\u672c</p> <p>\u6bd4\u7279\u5e01\u7684\u5206\u5e03\u5f0f\u533a\u5757\u94fe\u8d26\u672c\uff0c\u7531\u4e00\u7b14\u4e00\u7b14\u7684\u4ea4\u6613\u5f62\u6210\u7684\uff0c\u6bcf\u4e00\u7b14\u4ea4\u6613\u90fd\u8981\u82b1\u8d39\u4e00\u7b14\u8f93\u5165\u4ea7\u751f\u4e00\u7b14\u8f93\u51fa\uff0c\u800c\u5176\u6240\u4ea7\u751f\u7684\u8f93\u51fa\uff0c\u5c31\u662f\u672a\u82b1\u8d39\u8fc7\u7684\u4ea4\u6613\u8f93\u51fa\u201d\uff0c\u4e5f\u5c31\u662fUTXO\u3002\u8fd9\u4e9b\u4ea4\u6613\u6784\u6210\u4e86\u4e00\u7ec4\u94fe\u5f0f\u7ed3\u6784\uff0c\u6240\u6709\u5408\u6cd5\u7684\u6bd4\u7279\u5e01\u4ea4\u6613\u90fd\u53ef\u4ee5\u8ffd\u6eaf\u5230\u524d\u4e00\u4e2a\u6216\u591a\u4e2a\u4ea4\u6613\u7684\u8f93\u51fa\uff0c\u94fe\u6761\u7684\u6e90\u5934\u5c31\u662f\u6316\u77ff\u5956\u52b1\uff0c\u672b\u5c3e\u5219\u662f\u5f53\u524d\u672a\u82b1\u8d39\u7684\u4ea4\u6613\u8f93\u51fa\u3002</p> <p>\u6bd4\u7279\u5e01\u4ea4\u6613\u89c4\u5219\uff1a</p> <p>1\uff09\u9664\u4e86coinbase\u4ea4\u6613\u5916\uff0c\u6240\u6709\u7684\u8d44\u91d1\u6765\u6e90\u90fd\u5fc5\u987b\u6765\u81ea\u524d\u9762\u67d0\u4e00\u4e2a\u6216\u8005\u51e0\u4e2a\u4ea4\u6613\u7684UTXO\uff1b</p> <p>2\uff09\u4efb\u4f55\u4e00\u7b14\u4ea4\u6613\u7684\u4ea4\u6613\u8f93\u5165\u603b\u91cf\u5fc5\u987b\u7b49\u4e8e\u4ea4\u6613\u8f93\u51fa\u603b\u91cf\uff0c\u7b49\u5f0f\u4e24\u8fb9\u5fc5\u987b\u914d\u5e73\u3002</p> <p>UTXO\u4e3e\u4f8b\uff1a</p> <p></p> <p>\u6ce8\uff1aUTXO\u6280\u672f\u4e5f\u5e76\u975e100%\u4fdd\u8bc1\u57fa\u4e8e\u533a\u5757\u94fe\u7684\u4ea4\u6613\u4e2d\u675c\u7edd\u53cc\u82b1\u95ee\u9898\uff0c51%\u653b\u51fb\uff0c\u53c8\u88ab\u79f0\u4e3aMajority attack\uff0c\u8fd9\u79cd\u653b\u51fb\u662f\u901a\u8fc7\u63a7\u5236\u7f51\u7edc\u7b97\u529b\u5b9e\u73b0\u53cc\u82b1\u3002</p>"},{"location":"blockchain/blockchain_and_innovative_thinking_notes_2101/#26","title":"2.6 \u5171\u8bc6\u7b97\u6cd5\u548c\u5de5\u4f5c\u91cf\u8bc1\u660e\u673a\u5236","text":"<p>\u4ec0\u4e48\u53eb\u201c\u5171\u8bc6\u201d</p> <p>\u4ece\u8bed\u6587\u7684\u89d2\u5ea6\u8fdb\u884c\u7406\u89e3\uff0c\u53ef\u4ee5\u89e3\u91ca\u4e3a\uff0c\u8bb8\u591a\u4e0d\u540c\u7684\u4eba\u5bf9\u540c\u4e00\u4ef6\u4e8b\u60c5\u8fbe\u6210\u4e00\u6837\u7684\u6216\u8005\u81f3\u5c11\u8bf4\u65b9\u5411\u4e00\u81f4\u7684\u770b\u6cd5\u3002\u8fd9\u4e2a\u89e3\u91ca\u540c\u6837\u9002\u7528\u4e8e\u6bd4\u7279\u5e01\u7f51\u7edc\u5f53\u4e2d\u3002</p> <p>\u5171\u8bc6\u673a\u5236</p> <p>\u8fbe\u6210\u5171\u8bc6\u7684\u4e3b\u4f53\uff1a\u5b83\u662f\u5f53\u524d\u8fd9\u4e2a\u533a\u5757\u94fe\u4e2d\u7684\u4e00\u4e9b\u8282\u70b9\uff0c\u5230\u5e95\u54ea\u4e9b\u8282\u70b9\u9700\u8981\u8fbe\u6210\u4e00\u81f4\uff0c\u4e5f\u662f\u4e00\u4e2a\u9700\u8981\u8003\u8651\u7684\u95ee\u9898\u3002</p> <p>\u8fd9\u4e9b\u8282\u70b9\u9700\u8981\u5bf9\u4ec0\u4e48\u4e1c\u897f\u8fbe\u6210\u4e00\u81f4\uff1f\u5171\u8bc6\u673a\u5236\u6d89\u53ca\u4e86\u533a\u5757\u8be5\u5982\u4f55\u751f\u6210\u4ee5\u53ca\u751f\u6210\u4e4b\u540e\u5982\u4f55\u9009\u62e9\u7684\u95ee\u9898\u3002</p> <p>\u5728\u6bd4\u7279\u5e01\u7f51\u7edc\u4e2d\u6bcf\u4e2a\u77ff\u5de5\u90fd\u6709\u6743\u5229\u751f\u6210\u65b0\u7684\u533a\u5757\uff0c\u90a3\u4e48\u6211\u4eec\u5230\u5e95\u8be5\u9009\u62e9\u8c01\u7684\u533a\u5757\u4f5c\u4e3a\u6574\u4e2a\u7f51\u7edc\u7684\u65b0\u533a\u5757\u5462\uff1f\u8fd9\u4e2a\u65b0\u533a\u5757\u751f\u6210\u4e4b\u540e\uff0c\u5728\u8fd9\u6761\u94fe\u4e0a\u8fdb\u884c\u7684\u4ea4\u6613\u80fd\u4e0d\u80fd\u901a\u8fc7\u5462\uff1f</p> <p>\u5728\u65e5\u5e38\u751f\u6d3b\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u6709\u4e00\u4e2a\u8001\u5927\u6216\u8005\u4e00\u4e2a\u9886\u5bfc\u6765\u62cd\u677f\u51b3\u5b9a\u8fd9\u4e9b\u95ee\u9898\u3002\u5728\u533a\u5757\u94fe\u4e2d\uff0c\u6bcf\u4e2a\u8282\u70b9\u90fd\u662f\u5e73\u7b49\u7684\uff0c\u6ca1\u6709\u4e00\u4e2a\u4e2d\u5fc3\u673a\u6784\u7684\u5b58\u5728\uff0c\u8fd9\u65f6\u5019\u5c31\u9700\u8981\u901a\u8fc7\u5171\u8bc6\u673a\u5236\u6765\u8fbe\u6210\u8282\u70b9\u95f4\u7684\u4e00\u81f4\u3002</p> <p>\u5171\u8bc6\u7b97\u6cd5</p> <p>\u5171\u8bc6\u7b97\u6cd5\u662f\u4e3a\u4e86\u8fbe\u6210\u5171\u8bc6\u6240\u4f9d\u636e\u7684\u4e00\u79cd\u89c4\u5219\uff0c\u662f\u7b5b\u9009\u51fa\u5177\u6709\u4ee3\u8868\u6027\u7684\u8282\u70b9\u7684\u65b9\u6cd5\u3002\u4e3a\u6b64\uff0c\u533a\u5757\u94fe\u8bbe\u8ba1\u4e86\u4e00\u5b9a\u7684\u5e95\u5c42\u7b97\u6cd5\uff0c\u901a\u8fc7\u8fd9\u4e2a\u7279\u5b9a\u7684\u7b97\u6cd5\u6765\u9009\u51fa\u54ea\u4e2a\u53ef\u4ee5\u751f\u6210\u65b0\u533a\u5757\u7684\u8282\u70b9\uff0c\u540c\u65f6\u5bf9\u4e8e\u6bcf\u4e00\u7b14\u5728\u8fd9\u6761\u533a\u5757\u94fe\u4e0a\u8fdb\u884c\u7684\u4ea4\u6613\u662f\u5426\u51c6\u8bb8\u5b8c\u6210\u8fdb\u884c\u4e86\u7ea6\u675f\u548c\u89c4\u5b9a\uff0c\u4e5f\u5c31\u662f\u5171\u8bc6\u7b97\u6cd5\u3002</p> <p>\u5171\u8bc6\u7b97\u6cd5\u6709\u5f88\u591a\u79cd\uff0c\u4e3b\u8981\u6709\u5de5\u4f5c\u91cf\u8bc1\u660e\u3001\u6743\u76ca\u8bc1\u660e\u3001\u59d4\u6258\u5de5\u4f5c\u91cf\u8bc1\u660e\u3001\u59d4\u6258\u6743\u76ca\u8bc1\u660e\u3001\u5b9e\u7528\u62dc\u5360\u5ead\u5bb9\u9519\u7b97\u6cd5\u7b49\uff0c\u4ed6\u4eec\u6700\u7ec8\u7684\u76ee\u7684\u662f\u4e00\u81f4\u7684\uff0c\u4f46\u5728\u5177\u4f53\u7684\u5b9e\u73b0\u8fc7\u7a0b\u4e2d\u5404\u5177\u7279\u8272\u3002</p> <p>\u6bd4\u7279\u5e01\u7684\u5171\u8bc6\u673a\u5236--\u5de5\u4f5c\u91cf\u8bc1\u660e\u673a\u5236</p> <p>\u5de5\u4f5c\u91cf\u8bc1\u660e\uff0c\u82f1\u6587\u5168\u79f0\u53ebproof of work\uff0c\u901a\u5e38\u6211\u4eec\u53eb\u5b83POW\u3002\u5de5\u4f5c\u91cf\u8bc1\u660e\u5c31\u662f\u4e00\u4efd\u8bc1\u660e\uff0c\u7528\u6765\u786e\u8ba4\u4f60\u505a\u8fc7\u4e00\u5b9a\u91cf\u7684\u5de5\u4f5c\u3002\u600e\u4e48\u8bc1\u660e\u5462\uff1f\u901a\u8fc7\u5de5\u4f5c\u7ed3\u679c--\u5f53\u7528\u6237\u505a\u4e00\u5b9a\u96be\u5ea6\u7684\u5de5\u4f5c\u5f97\u51fa\u4e00\u4e2a\u7ed3\u679c\u65f6\uff0c\u901a\u8fc7\u5c55\u73b0\u51fa\u8fd9\u4e2a\u7ed3\u679c\u8bc1\u660e\u4f60\u5b8c\u6210\u4e86\u4e00\u5b9a\u7684\u5de5\u4f5c\u91cf -- \u4e5f\u5c31\u662f\u8bf4POW\u4f5c\u4e3a\u4e00\u79cd\u5171\u8bc6\u673a\u5236\uff0c\u5b83\u662f\u7ed3\u679c\u5bfc\u5411\u800c\u975e\u8fc7\u7a0b\u5bfc\u5411\u7684\u3002</p> <p>\u5de5\u4f5c\u91cf\u8bc1\u660e\u673a\u5236</p> <p>\u539f\u56e0\uff1a\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u5982\u679c\u6211\u4eec\u901a\u8fc7\u76d1\u6d4b\u5de5\u4f5c\u7684\u6574\u4e2a\u8fc7\u7a0b\u6765\u8bc1\u660e\u5de5\u4f5c\u91cf\uff0c\u8fd9\u662f\u6781\u4e3a\u4f4e\u6548\u7684\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u4e00\u5b9a\u7684\u6548\u7387\uff0c\u5c31\u8bbe\u8ba1\u4e86\u901a\u8fc7\u9a8c\u8bc1\u7ed3\u679c\u7684\u65b9\u5f0f\u8bc1\u660e\u5de5\u4f5c\u91cf\u7684\u65b9\u6cd5\u3002</p> <p>\u5173\u952e\u7279\u5f81\uff1a\u4e0d\u5bf9\u79f0\u6027</p> <p>\u8fdb\u884c\u5b9e\u9645\u5de5\u4f5c\u7684\u7528\u6237\u9700\u8981\u4ed8\u51fa\u5f88\u591a\u7684\u5de5\u4f5c\u91cf\u624d\u80fd\u5f97\u5230\u4e00\u4e2a\u7b26\u5408\u5df2\u5b9a\u6761\u4ef6\u7684\u7ed3\u679c\uff0c\u4f46\u662f\u4f5c\u4e3a\u9a8c\u8bc1\u65b9\u5374\u53ef\u4ee5\u6839\u636e\u7528\u6237\u63d0\u4f9b\u7684\u6750\u6599\u5f88\u5bb9\u6613\u91cd\u7b97\u8fd9\u4e2a\u7ed3\u679c\uff0c\u540c\u65f6\u9a8c\u8bc1\u8fd9\u4e2a\u7ed3\u679c\u662f\u5426\u6ee1\u8db3\u63d0\u524d\u89c4\u5b9a\u597d\u7684\u6761\u4ef6\u3002</p> <p>\u793a\u4f8b\uff1a\"Hello,world!\"\u540e\u9762\u6dfb\u52a0\u4e00\u4e2anonce\u7684\u6574\u6570\u503c\uff0c\u5bf9\u53d8\u66f4\u540e\u7684\u5b57\u7b26\u4e32\u8fdb\u884c\u54c8\u5e0c\u8fd0\u7b97\u3002\u5f97\u5230\u7684\u54c8\u5e0c\u7ed3\u679c\u4ee5\"0000\"\u5f00\u5934\uff0c\u5219\u8bf4\u660e\u9a8c\u8bc1\u901a\u8fc7\uff0c\u4e3a\u4e86\u8fbe\u5230\u8fd9\u4e2a\u5de5\u4f5c\u91cf\u8bc1\u660e\u7684\u76ee\u6807\uff0c\u6211\u4eec\u9700\u8981\u4e0d\u505c\u7684\u9012\u589enonce\u503c\uff0c\u5bf9\u5f97\u5230\u7684\u65b0\u5b57\u7b26\u4e32\u8fdb\u884c\u54c8\u5e0c\u8fd0\u7b97\u3002\u6309\u7167\u8fd9\u4e2a\u89c4\u5219\uff0c\u6211\u4eec\u9700\u8981\u7ecf\u8fc74251\u6b21\u8ba1\u7b97\u624d\u80fd\u627e\u5230\u6070\u597d\u524d4\u4f4d\u4e3a0\u7684\u54c8\u5e0c\u6563\u5217\u3002</p> <p>\u5b9e\u9645\u8bc1\u660e\u6211\u4eec\u4e0d\u53ef\u80fd\u8fde\u7eed\u4e00\u76f4\u6709\u8fd9\u6837\u597d\u8fd0\u6c14\u3002\u7edd\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u662f\u4e0d\u5f97\u4e0d\u901a\u8fc7\u5bf9nonce\u7684\u503c\u8fdb\u884c\u9010\u4e2a\u9012\u589e\u7684\u65b9\u5f0f\u6765\u6539\u53d8\u5b57\u7b26\u4e32\u7684\u5185\u5bb9\uff0c\u591a\u6b21\u5c1d\u8bd5\u540e\u6700\u7ec8\u5f97\u5230\u6ee1\u8db3\u6761\u4ef6\u7684\u503c\u3002</p> <p>\u9996\u5148\uff0c\u751f\u6210\u8981\u52a0\u5165\u5230\u533a\u5757\u94fe\u4e2d\u7684\u4e00\u7b14\u65b0\u7684\u4ea4\u6613\u4fe1\u606f\uff0c\u4e5f\u5c31\u662f\u65b0\u533a\u5757\u65f6\u5fc5\u987b\u6ee1\u8db3\u7684\u8981\u6c42\u3002\u7136\u540e\u5728\u57fa\u4e8e\u5de5\u4f5c\u91cf\u8bc1\u660e\u673a\u5236\u6784\u5efa\u7684\u533a\u5757\u94fe\u7f51\u7edc\u4e2d\uff0c\u6240\u6709\u8282\u70b9\u5f00\u59cb\u4e0d\u65ad\u5c1d\u8bd5\u548c\u8ba1\u7b97\uff0c\u76f4\u5230\u7b2c\u4e00\u4e2a\u8282\u70b9\u627e\u5230\u4e86\u90a3\u4e2a\u968f\u673a\u54c8\u5e0c\u6563\u5217\u7684\u6570\u503c\u89e3\uff0c\u4e8e\u662f\u5b83\u5c31\u5f97\u5230\u4e86\u751f\u6210\u65b0\u533a\u5757\u7684\u6743\u529b\u3002</p> <p>\u5de5\u4f5c\u91cf\u8bc1\u660e\u673a\u5236\u7684\u7f3a\u70b9\uff1a\u9020\u6210\u4e86\u5927\u91cf\u7684\u8d44\u6e90\u6d6a\u8d39\uff0c\u8fbe\u6210\u5171\u8bc6\u6240\u9700\u8981\u7684\u5468\u671f\u8f83\u957f\u3002</p>"},{"location":"blockchain/blockchain_and_innovative_thinking_notes_2101/#27-51","title":"2.7 \u533a\u5757\u9ad8\u5ea6\uff0c51%\u653b\u51fb\uff0c\u77ff\u6c60\u4e0e\u7b97\u529b","text":"<p>\u533a\u5757\u662f\u4e00\u79cd\u88ab\u5305\u542b\u5728\u516c\u5f00\u8d26\u7c3f\u91cc\u7684\u805a\u5408\u4e86\u4ea4\u6613\u4fe1\u606f\u7684\u5bb9\u5668\u6570\u636e\u7ed3\u6784\uff0c\u8fd9\u4e2a\u516c\u5f00\u8d26\u7c3f\u5c31\u662f\u533a\u5757\u94fe\u3002\u5b83\u662f\u6784\u6210\u533a\u5757\u94fe\u7684\u57fa\u672c\u5355\u5143\uff0c\u7531\u5305\u542b\u5143\u6570\u636e\u7684\u533a\u5757\u5934\u548c\u5305\u542b\u4ea4\u6613\u6570\u636e\u7684\u533a\u5757\u4e3b\u4f53\u6784\u6210\u3002</p> <p>\u5728\u6574\u4e2a\u533a\u5757\u94fe\u7cfb\u7edf\u4e2d\uff0c\u5927\u7ea6\u6bcf\u5341\u51e0\u5206\u949f\u5c31\u4f1a\u521b\u5efa\u4e00\u4e2a\u533a\u5757\u3002\u8fd9\u4e2a\u533a\u5757\u91cc\u9762\u5305\u542b\u4e86\u8fd9\u6bb5\u65f6\u95f4\u5185\u5168\u7f51\u8303\u56f4\u53d1\u751f\u7684\u6240\u6709\u4ea4\u6613\u4fe1\u606f\uff0c\u4e5f\u5c31\u662f\u533a\u5757\u4e3b\u4f53\u90e8\u5206\u3002\u90a3\u4e48\u8fd9\u4e2a\u533a\u5757\u751f\u6210\u4e4b\u540e\u8981\u600e\u4e48\u8ddf\u539f\u6765\u7684\u533a\u5757\u94fe\u63a5\u8d77\u6765\u5462\uff1f</p> <p>\u533a\u5757\u5934\u4e2d\u5305\u542b\u4e86\u4e09\u7ec4\u5143\u6570\u636e\uff0c\u5176\u4e2d\u7b2c\u4e00\u7ec4\u5c31\u662f\u4e0a\u4e00\u4e2a\u533a\u5757\u7684\u54c8\u5e0c\u503c\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u7b2c\u4e8c\u4e2a\u533a\u5757\u7684\u7236\u54c8\u5e0c\u4e3a\u7b2c\u4e00\u4e2a\u533a\u5757\u7684\u54c8\u5e0c\uff0c\u7b2c\u4e09\u4e2a\u533a\u5757\u7684\u7236\u54c8\u5e0c\u4e3a\u7b2c\u4e8c\u4e2a\u533a\u5757\u7684\u54c8\u5e0c\uff0c\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0c\u5c31\u628a\u4e00\u4e2a\u4e2a\u533a\u5757\u94fe\u63a5\u8d77\u6765\u4e86\uff0c\u5f62\u6210\u4e86\u4e00\u4e2a\u524d\u5411\u7684\u94fe\u8868\u3002</p> <p></p> <p>\u533a\u5757\u6807\u8bc6\u7b26\uff1a\u6bcf\u4e2a\u533a\u5757\u90fd\u6709\u552f\u4e00\u7684\u533a\u5757\u54c8\u5e0c\u503c\u8868\u793a\u5b83\u7684\u8eab\u4efd\uff0c\u5c31\u50cf\u6211\u4eec\u7684\u8eab\u4efd\u8bc1\u53f7\u7801\u4e00\u6837\uff0c\u77e5\u9053\u4e00\u4e2a\u533a\u5757\u7684\u54c8\u5e0c\uff0c\u5c31\u4e00\u5b9a\u80fd\u627e\u5230\u552f\u4e00\u5339\u914d\u7684\u90a3\u4e2a\u533a\u5757\uff0c\u8fd9\u5c31\u662f\u533a\u5757\u6807\u8bc6\u7b26\u3002</p> <p>\u8fd8\u6709\u4e00\u79cd\u8bc6\u522b\u533a\u5757\u7684\u65b9\u5f0f\u662f\u901a\u8fc7\u8be5\u533a\u5757\u5728\u533a\u5757\u94fe\u4e2d\u7684\u4f4d\u7f6e\uff0c\u5373\u201c\u533a\u5757\u9ad8\u5ea6\u201d\u3002\u533a\u5757\u9ad8\u5ea6\u662f\u7528\u6765\u6807\u8bc6\u4e00\u4e2a\u533a\u5757\u5728\u533a\u5757\u94fe\u4e2d\u4f4d\u7f6e\u7684\u4e00\u4e2a\u6982\u5ff5\u3002</p> <p></p> <p>\u539f\u56e0\uff1a\u5728\u540c\u4e00\u65f6\u95f4\uff0c\u6709\u53ef\u80fd\u5b58\u5728\u4e24\u4e2a\u6216\u4e24\u4e2a\u4ee5\u4e0a\u7684\u533a\u5757\uff0c\u4ed6\u4eec\u76f8\u5bf9\u4e8e\u6574\u6761\u533a\u5757\u94fe\u6765\u8bf4\uff0c\u5904\u4e8e\u5e73\u7b49\u7684\u4f4d\u7f6e\uff0c\u6240\u4ee5\u4ed6\u4eec\u6709\u7740\u76f8\u540c\u7684\u533a\u5757\u9ad8\u5ea6\u3002</p> <p>\u5c31\u6bd4\u5982\u4e00\u5ea7\u697c\u91cc\u9762\uff0c\u6709201\u623f\u95f4\uff0c203\u623f\u95f4\uff0c\u623f\u95f4\u53f7\u8868\u793a\u533a\u5757\u54c8\u5e0c\uff0c\u4e8c\u697c\u7c7b\u4f3c\u533a\u5757\u9ad8\u5ea6\u3002</p> <p>\u7b97\u529b</p> <p>\u4e5f\u53eb\u54c8\u5e0c\u7387\uff0c\u662f\u7528\u6765\u8861\u91cf\u8fdb\u884c\u54c8\u5e0c\u8fd0\u7b97\u7684\u80fd\u529b\u7684\u6307\u6807\uff0c\u6216\u8005\u8bf4\u8fdb\u884c\u4e00\u6b21\u54c8\u5e0c\u8ba1\u7b97\u6240\u9700\u8981\u4f7f\u7528\u7684\u65f6\u95f4\u3002\u5982\u679c\u8bf4\u7f51\u7edc\u8fbe\u5230\u4e8610T\u54c8\u5e0c\u6bcf\u79d2\u7684\u54c8\u5e0c\u7387\u65f6\uff0c\u5c31\u610f\u5473\u7740\u5b83\u53ef\u4ee5\u6bcf\u79d2\u8fdb\u884c10\u4e07\u4ebf\u6b21\u54c8\u5e0c\u8fd0\u7b97\u3002</p> <p>\u533a\u5757\u94fe\u7f51\u7edc\u4e2d\u6bcf\u4e2a\u77ff\u5de5\u90fd\u6709\u8d44\u683c\u751f\u6210\u533a\u5757\uff0c\u56e0\u6b64\u4e3a\u4e86\u51b3\u5b9a\u4e0b\u4e00\u4e2a\u533a\u5757\u7531\u8c01\u751f\u6210\uff0c\u9700\u8981\u901a\u8fc7\u4e00\u5b9a\u7684\u65b9\u6cd5\u6765\u51b3\u5b9a\u3002\u5728POW\u673a\u5236\u4e2d\uff0c\u6240\u6709\u8282\u70b9\u901a\u8fc7\u968f\u673a\u7684\u5c1d\u8bd5\u548c\u8ba1\u7b97\uff0c\u76f4\u5230\u6709\u4e00\u4e2a\u8282\u70b9\u627e\u5230\u4e86\u90a3\u4e2a\u968f\u673a\u54c8\u5e0c\u6563\u5217\u7684\u6570\u503c\u89e3\uff0c\u6210\u4e3a\u6709\u8d44\u683c\u751f\u6210\u65b0\u533a\u5757\u7684\u4e3b\u4f53\u3002</p> <p>\u54c8\u5e0c\u78b0\u649e\uff1a\u89e3\u51fa\u968f\u673a\u54c8\u5e0c\u503c\u4e0d\u65ad\u5c1d\u8bd5\u7684\u8fc7\u7a0b\u3002\u4e00\u4e2a\u6316\u77ff\u673a\u6bcf\u79d2\u949f\u80fd\u505a\u8fd9\u79cd\u78b0\u649e\u7684\u6b21\u6570\uff0c\u4ee3\u8868\u5176\u7b97\u529b\u3002\u77ff\u5de5\u8fdb\u884c\u6316\u77ff\u6240\u4f7f\u7528\u7684\u673a\u5668\u8d8a\u5148\u8fdb\uff0c\u7b97\u529b\u5c31\u4f1a\u8d8a\u9ad8\u3002</p> <p>\u533a\u5757\u94fe\u8f6c\u8d26\u7684\u57fa\u672c\u539f\u7406\uff1a</p> <p>\u6574\u4e2a\u533a\u5757\u94fe\u7f51\u7edc\u4e4b\u6240\u4ee5\u80fd\u8fd0\u884c\uff0c\u9760\u7684\u5c31\u662f\u6574\u4e2a\u7f51\u7edc\u7684\u201c\u77ff\u5de5\u201d\uff0c\u56e0\u4e3a\u4ed6\u4eec\u901a\u8fc7\u7b97\u529b\u89e3\u7b54\u52a0\u5bc6\u96be\u9898\uff0c\u4ece\u800c\u6316\u51fa\u65b0\u7684\u533a\u5757\u3002\u6316\u51fa\u533a\u5757\u540e\uff0c\u4ed6\u4eec\u5c31\u6709\u6743\u529b\u5c06\u8f6c\u8d26\u4fe1\u606f\u653e\u5165\u5230\u533a\u5757\u4e2d\uff0c\u7136\u540e\u5b8c\u6210\u8fd9\u7b14\u8f6c\u8d26\uff0c\u8fd9\u5c31\u662f\u533a\u5757\u94fe\u8f6c\u8d26\u7684\u57fa\u672c\u539f\u7406\u3002</p> <p>\u4e2d\u672c\u806a\u4e00\u5f00\u59cb\u5c31\u5b9a\u4e49\u4e86\u6bd4\u7279\u5e01\u603b\u91cf\u4e3a2100\u4e07\u4e2a\uff0c\u5e76\u4e14\u52a0\u5bc6\u6570\u5b66\u9898\u7684\u96be\u5ea6\u4e5f\u8d8a\u6765\u8d8a\u5927\u3002\u6b63\u6240\u8c13\u4f17\u4eba\u62fe\u67f4\u706b\u7130\u9ad8\uff0c\u8d8a\u6765\u8d8a\u591a\u7684\u4eba\u628a\u81ea\u5df1\u7684\u77ff\u673a\u62ff\u51fa\u6765\uff0c\u7ec4\u6210\u4e86\u201c\u6316\u77ff\u5c0f\u5206\u961f\u201d\uff0c\u8fd9\u7c7b\u7ec4\u7ec7\u5c31\u88ab\u79f0\u4e3a\u201c\u77ff\u6c60\u201d\u3002</p> <p>51%\u653b\u51fb\u51fa\u73b0\u7684\u6839\u672c\u539f\u56e0\uff1a\u5728\u6574\u4e2a\u7f51\u7edc\u4e2d\uff0c\u6709\u4eba\u7684\u7b97\u529b\u8d85\u8fc7\u4e86\u5168\u7f51\u768450%\uff0c\u90a3\u4e48\u5728\u4ed6\u7684\u63a7\u5236\u7b97\u529b\u7684\u8fd9\u6bb5\u65f6\u95f4\uff0c\u53ef\u4ee5\u5c06\u533a\u5757\u9006\u8f6c\uff0c\u8fdb\u884c\u53cd\u5411\u4ea4\u6613\uff0c\u5b9e\u73b0\u53cc\u82b1\u3002</p> <p>\u5c3d\u7ba151%\u7684\u653b\u51fb\u4e0d\u4f1a\u4ea7\u751f\u65b0\u5e01\u6216\u8005\u76f4\u63a5\u5bfc\u81f4\u533a\u5757\u94fe\u5d29\u6e83\uff0c\u4f46\u5bf9\u53c2\u4e0e\u8005\u5bf9\u52a0\u5bc6\u8d27\u5e01\u7684\u4fe1\u5fc3\u4f1a\u4ea7\u751f\u4e25\u91cd\u5f71\u54cd\u3002</p> <p></p> <p>51%\u653b\u51fb\u8bba</p> <p>\u867d\u7136\u770b\u8d77\u676551%\u653b\u51fb\u975e\u5e38\u6050\u6016\uff0c\u4e0d\u8fc7\u8fd9\u901a\u5e38\u4ec5\u5b58\u5728\u4e8e\u7406\u8bba\u60c5\u51b5\u4e0b\u3002\u56e0\u4e3a\u5982\u679c\u4f60\u60f3\u505a\u5230\uff0c\u9996\u5148\u9700\u8981\u8db3\u591f\u7684\u94b1\u53bb\u638c\u63a7\u5168\u7f5151%\u7684\u7b97\u529b\uff0c\u8fd9\u5c06\u662f\u975e\u5e38\u5927\u7684\u4e00\u7b14\u6295\u8d44\u3002\u5176\u6b21\u5728\u653b\u51fb\u540e\uff0c\u5e01\u79cd\u4ef7\u683c\u4f1a\u53d7\u5230\u5f71\u54cd\uff0c\u4f60\u8981\u5356\u51fa\u975e\u5e38\u591a\u7684\u5e01\u624d\u80fd\u8fbe\u5230\u6536\u652f\u5e73\u8861\u3002\u8fd9\u5c31\u662f51%\u653b\u51fb\u8bba\u3002</p>"},{"location":"blockchain/blockchain_and_innovative_thinking_notes_2101/#28","title":"2.8 \u603b\u7ed3","text":"<p>\u77ff\u5de5\uff1a\u77ff\u5de5\u5c31\u662f\u6307\u53c2\u4e0e\u6bd4\u7279\u5e01\u6316\u77ff\u7684\u4e2a\u4f53\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u6bcf\u4e00\u4e2a\u81f4\u529b\u4e8e\u751f\u4ea7\u65b0\u533a\u5757\u7684\u6bd4\u7279\u5e01\u8282\u70b9\u7684\u4e3b\u4eba\uff0c\u5c31\u662f\u4e00\u4e2a\u77ff\u5de5\uff0c\u662f\u4e00\u5207\u884c\u4e3a\u7684\u64cd\u4f5c\u8005\uff0c\u4e5f\u5c31\u662f\u6bd4\u7279\u5e01\u7f51\u7edc\u53c2\u4e0e\u7684\u4e3b\u4f53\u3002</p> <p>\u77ff\u6c60\uff1a\u77ff\u6c60\u7684\u6982\u5ff5\u662f\u5728\u77ff\u5de5\u7684\u57fa\u7840\u4e0a\u5ef6\u4f38\u51fa\u6765\u7684\u3002\u968f\u7740\u53c2\u4e0e\u6316\u77ff\u7684\u77ff\u5de5\u8d8a\u6765\u8d8a\u591a\uff0c\u4e00\u4e2a\u4e2a\u4f53\u77ff\u5de5\u8981\u60f3\u6316\u5230\u77ff\uff0c\u5f97\u5230\u751f\u6210\u65b0\u533a\u5757\u7684\u6743\u529b\u7684\u53ef\u80fd\u6027\u8d8a\u6765\u8d8a\u4f4e\uff0c\u6240\u4ee5\u4e00\u4e9b\u77ff\u5de5\u96c6\u5408\u8d77\u6765\uff0c\u96c6\u5408\u5404\u81ea\u7684\u7b97\u529b\uff0c\u63d0\u9ad8\u6316\u5230\u77ff\u7684\u53ef\u80fd\u6027\u3002\u8fd9\u79cd\u77ff\u5de5\u7684\u96c6\u5408\u4f53\u5c31\u662f\u77ff\u6c60\u3002</p> <p>\u516c\u94a5\u3001\u79c1\u94a5\uff1a\u516c\u94a5\u3001\u79c1\u94a5\u662f\u4e00\u7ec4\u914d\u5408\u4f7f\u7528\u7684\u6982\u5ff5\uff0c\u4ed6\u4eec\u4e4b\u95f4\u6709\u7740\u7d27\u5bc6\u7684\u8054\u7cfb\u3002\u7b80\u5355\u6765\u8bf4\uff0c\u79c1\u94a5\u662f\u7cfb\u7edf\u968f\u673a\u751f\u6210\u7684\uff0c\u516c\u94a5\u662f\u7531\u79c1\u94a5\u8ba1\u7b97\u5f97\u51fa\u7684\uff1b\u516c\u94a5\u8d1f\u8d23\u52a0\u5bc6\uff0c\u79c1\u94a5\u8d1f\u8d23\u89e3\u5bc6\uff1b\u79c1\u94a5\u8d1f\u8d23\u7b7e\u540d\uff0c\u516c\u94a5\u8d1f\u8d23\u9a8c\u8bc1\u3002\u5728\u4e24\u8005\u7684\u914d\u5408\u4f7f\u7528\u4e4b\u4e0b\uff0c\u77ff\u5de5\u624d\u80fd\u5b8c\u6210\u6bd4\u7279\u5e01\u7684\u4ea4\u6613\u3002</p> <p>\u94b1\u5305\uff1a\u6bd4\u7279\u5e01\u94b1\u5305\u5c31\u662f\u7528\u6765\u88c5\u5bc6\u94a5\u7684\u5bb9\u5668\uff0c\u5b83\u53ea\u5305\u542b\u5bc6\u94a5\u800c\u4e0d\u5305\u542b\u5177\u4f53\u7684\u591a\u5c11\u4e2a\u6bd4\u7279\u5e01\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u94b1\u5305\u91cc\u9762\u5b58\u653e\u4e86\u4e00\u7cfb\u5217\u7684\u5bc6\u94a5\uff0c\u6bcf\u4e00\u5bc6\u94a5\u5bf9\u5e94\u7740\u4e00\u4e2a\u79c1\u94a5\u548c\u7531\u8fd9\u4e2a\u79c1\u94a5\u751f\u6210\u7684\u516c\u94a5\uff0c\u7528\u4e8e\u5b8c\u6210\u8fd9\u4e2a\u94b1\u5305\u4e3b\u4eba\u53ef\u80fd\u8981\u8fdb\u884c\u7684\u6bd4\u7279\u5e01\u4ea4\u6613\u3002\u94b1\u5305\u8fd8\u6709\u4e00\u4e2a\u5730\u5740\uff0c\u8fd9\u4e2a\u5730\u5740\u5c31\u76f8\u5f53\u4e8e\u4f60\u652f\u4ed8\u5b9d\u7684\u8d26\u53f7\u4e00\u6837\uff0c\u4f60\u8981\u63d0\u4f9b\u81ea\u5df1\u7684\u8d26\u53f7\uff0c\u624d\u80fd\u5411\u5916\u8f6c\u8d26\u6216\u8005\u7ed9\u81ea\u5df1\u5145\u503c\u3002</p> <p>\u4ea4\u6613\uff1a\u5229\u7528\u77ff\u5de5\u638c\u63e1\u7684\u79c1\u94a5\uff0c\u628a\u6bd4\u7279\u5e01\u4ece\u4e00\u4e2a\u5730\u5740\u8f6c\u5230\u53e6\u4e00\u4e2a\u5730\u5740\u7684\u884c\u4e3a\u3002\u6211\u4eec\u6240\u8bf4\u7684\u6bd4\u7279\u5e01\uff0c\u5176\u5b9e\u5c31\u662f\u4e00\u7cfb\u5217\u4ea4\u6613\u8f93\u51fa\u7684\u96c6\u5408\uff0c\u6211\u4eec\u8bf4\u81ea\u5df1\u6709\u591a\u5c11\u6bd4\u7279\u5e01\u5b9e\u9645\u4e0a\u662f\u6307\u6211\u4eec\u62e5\u6709\u6240\u6709\u6743\u7684\u90a3\u4e9bUTXO\u4e2d\u6240\u6307\u660e\u7684\u6bd4\u7279\u5e01\u7684\u6570\u91cf\u3002</p> <p>\u533a\u5757\uff1a\u662f\u6784\u6210\u533a\u5757\u94fe\u7684\u57fa\u672c\u5355\u5143\uff0c\u5728\u533a\u5757\u94fe\u4e2d\uff0c\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u5c31\u4f1a\u5f62\u6210\u4e00\u4e2a\u65b0\u7684\u533a\u5757\uff0c\u77ff\u5de5\u4eec\u5c31\u662f\u5728\u901a\u8fc7\u6316\u77ff\u4e89\u593a\u751f\u6210\u65b0\u533a\u5757\u7684\u6743\u529b\u3002\u6bcf\u4e00\u4e2a\u533a\u5757\u7531\u533a\u5757\u5934\u548c\u533a\u5757\u4e3b\u4f53\u6784\u6210\u3002\u5728\u533a\u5757\u5934\u4e2d\u5305\u542b\u4e86\u524d\u4e00\u4e2a\u533a\u5757\u7684\u54c8\u5e0c\u4fe1\u606f\uff0c\u53ef\u4ee5\u5e2e\u52a9\u65b0\u533a\u5757\u548c\u4e4b\u524d\u7684\u533a\u5757\u8054\u7cfb\u8d77\u6765\uff1b\u800c\u533a\u5757\u4e3b\u4f53\u5219\u5305\u542b\u4e86\u8fd9\u4e00\u6bb5\u65f6\u95f4\u5185\u6240\u6709\u7684\u4ea4\u6613\u4fe1\u606f\u3002</p> <p></p> <p>\u7b97\u529b\uff1a\u662f\u7528\u6765\u8861\u91cf\u8fdb\u884c\u54c8\u5e0c\u8fd0\u7b97\u7684\u80fd\u529b\u7684\u6307\u6807\uff0c\u5b83\u53ef\u4ee5\u7528\u6bcf\u79d2\u5b8c\u6210\u54c8\u5e0c\u78b0\u649e\u6b21\u6570\u6765\u8861\u91cf\u3002\u7b97\u529b\u8d8a\u5f3a\uff0c\u6316\u5230\u4e0b\u4e00\u4e2a\u65b0\u533a\u5757\u7684\u53ef\u80fd\u6027\u4e5f\u76f8\u5e94\u7684\u8d8a\u5927\u3002</p>"},{"location":"blockchain/the_evolution_of_bitcoin_240213/","title":"\u6bd4\u7279\u5e01\u7684\u8bde\u751f\u5386\u7a0b","text":"<p> \u7ea6 2739 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 9 \u5206\u949f</p> <p>\u6bd4\u7279\u5e01\u5e76\u975e\u6a2a\u7a7a\u51fa\u4e16\u7684\u5355\u70b9\u521b\u65b0\uff0c\u800c\u662f\u5c06\u6570\u5341\u5e74\u95f4\u5173\u4e8e\u79c1\u4eba\u8d27\u5e01\u3001\u5bc6\u7801\u5b66\u9690\u79c1\u5de5\u5177\u3001\u70b9\u5bf9\u70b9\u7f51\u7edc\u4e0e\u5de5\u4f5c\u91cf\u8bc1\u660e\u7b49\u591a\u6761\u6f14\u8fdb\u8def\u5f84\uff0c\u5728 2008-2009 \u5e74\u7684\u5386\u53f2\u7a97\u53e3\u671f\u5185\uff0c\u7ec4\u5408\u4e3a\u4e00\u4e2a\u53ef\u8fd0\u884c\u7684\u3001\u5f00\u653e\u53c2\u4e0e\u3001\u6297\u5ba1\u67e5\u7684\u7535\u5b50\u73b0\u91d1\u7cfb\u7edf\u3002</p> <p>\u6839\u636e \"Bitcoin 101: past, present and future\" \u6574\u7406\u5982\u4e0b\uff1a</p> <p>1933 \u5e74\uff0c\u5bcc\u5170\u514b\u6797\u00b7\u7f57\u65af\u798f\uff08Franklin Roosevelt\uff09\u603b\u7edf\u7b7e\u7f72\u4e86 6102 \u53f7\u884c\u653f\u4ee4\uff0c\u7981\u6b62\u79c1\u4eba\u4f7f\u7528\u76f4\u63a5\u5f62\u5f0f\u7684\u8d27\u5e01\uff08\u4f8b\u5982\u91d1\u675c\u5e03\u9686\uff08doubloons\uff09\u548c\u91d1\u5e01\uff09\u548c\u95f4\u63a5\u5f62\u5f0f\u7684\u8d27\u5e01\uff08\u4f8b\u5982\u4ee3\u8868\u62b5\u62bc\u54c1\u7684\u94f6\u884c\u7968\u636e\u548c\u91d1\u5757\uff09\uff0c\u653f\u5e9c\u6ca1\u6536\u4e86\u6240\u6709\u516c\u6c11\u7684\u9ec4\u91d1\uff0c\u8fd9\u4ef6\u4e8b\u5bf9\u7406\u89e3\u6bd4\u7279\u5e01\u7684\u5386\u53f2\u6781\u4e3a\u91cd\u8981\uff0c\u56e0\u4e3a\u8fd9\u4ef6\u4e8b\u60c5\u53d1\u751f\u5728\u88ab\u8ba4\u4e3a\u662f\u201c\u81ea\u7531\u5927\u9646\u201d\u3001\u5baa\u653f\u81ea\u7531\u6c11\u4e3b\u653f\u4f53\u7684\u6545\u4e61\uff1b</p> <p>\u4e00\u4e2a\u5947\u602a\u7684\u4e8b\u5b9e\u662f\uff0c\u4e2d\u672c\u806a\u5c06\u81ea\u5df1\u7684\u51fa\u751f\u65e5\u671f\u5199\u4e3a 1975 \u5e74\u7684 4 \u6708 5 \u65e5\uff1a4 \u6708 5 \u65e5\u6b63\u662f\u7f57\u65af\u798f\u7b7e\u7f72 6102 \u53f7\u884c\u653f\u4ee4\u7684\u65f6\u95f4\uff0c\u800c 1975 \u5e74\u662f Gerald Ford\uff08\u6770\u62c9\u5c14\u5fb7\u00b7\u798f\u7279\uff09\u603b\u7edf\u53d6\u6d88\u8fd9\u4e00\u884c\u653f\u4ee4\u7684\u65f6\u95f4\u3002</p> <p>\u6bd4\u7279\u5e01\u7684\u96be\u5ea6\u8c03\u6574\u7b97\u6cd5\u662f\u6bcf 2016 \u4e2a\u533a\u5757\u53d1\u751f\u4e00\u6b21\uff0c\u8fd9\u4e2a\u6570\u5b57\u6b63\u662f\u4e0a\u8ff0\u884c\u653f\u4ee4\u7684\u7f16\u53f7\uff086102\uff09\u7684\u5012\u5e8f\u3002 </p> <p>1936 \u5e74\uff0cAlan Turing\uff08\u963f\u5170\u00b7\u56fe\u7075\uff09\u53d1\u8868\u300a\u8bba\u53ef\u8ba1\u7b97\u7684\u6570\u5b57\u4ee5\u53ca\u53ef\u5224\u5b9a\u6027\u7684\u8fd0\u7528\u300b\uff0c\u4e3a\u4fe1\u606f\u9769\u547d\u5960\u5b9a\u4e86\u7406\u8bba\u57fa\u7840\uff1b</p> <p>1971 \u5e74\uff0c\u5c3c\u514b\u677e\u6682\u505c\u7f8e\u5143\u4e0e\u9ec4\u91d1\u7684\u6c47\u5151\uff1b</p> <p>1976 \u5e74\uff0c\u7814\u7a76\u5458 Diffie\uff08\u8fea\u83f2\uff09\u548c Hellman\uff08\u8d6b\u5c14\u66fc\uff09\u53d1\u8868\u300a\u5bc6\u7801\u5b66\u7684\u65b0\u65b9\u5411\u300b\uff0c\u975e\u5bf9\u79f0\u5bc6\u7801\u5b66\u7406\u8bba\u8bde\u751f\uff1b</p> <p>1978 \u5e74</p> <ul> <li>Rivest\uff08\u674e\u7ef4\u65af\u7279\uff09\u3001Shamir\uff08\u6c99\u7c73\u5c14\uff09\u548c Adleman\uff08\u963f\u5fb7\u5c14\u66fc\uff09\u53d1\u8868\u300a\u4e00\u79cd\u83b7\u5f97\u6570\u5b57\u7b7e\u540d\u548c\u516c\u94a5\u5bc6\u7801\u7cfb\u7edf\u7684\u65b9\u6cd5\u300b\uff0c\u4f7f\u975e\u5bf9\u79f0\u5bc6\u7801\u5b66\u6210\u4e3a\u73b0\u5b9e\uff1b</li> <li>Hayek\uff08\u54c8\u8036\u514b\uff09\u51fa\u7248\u300a\u8d27\u5e01\u7684\u53bb\u56fd\u5bb6\u5316\u300b\uff0c\u53cd\u5bf9\u56fd\u5bb6\u5bf9\u8d27\u5e01\u7684\u5784\u65ad\uff1b</li> </ul> <p>1979 \u5e74\uff0cRalph Merkle\uff08\u62c9\u5c14\u592b\u00b7\u9ed8\u514b\u5c14\uff0cMerkle Tree \u7684\u63d0\u51fa\u8005\uff09\u4e3a Merkle Tree \u7684\u60f3\u6cd5\u7533\u8bf7\u4e13\u5229\uff1b</p> <p>1980 \u5e74\uff0cSamuel Konkin III \u53d1\u8868\u300a\u65b0\u81ea\u7531\u610f\u5fd7\u4e3b\u4e49\u5ba3\u8a00\u300b\uff0c\u5021\u5bfc\u4e00\u79cd\u6fc0\u8fdb\u7684\u601d\u60f3\uff1a\u201c\u5149\u53d9\u8bf4\u81ea\u7531\u7684\u7f8e\u4e3d\u548c\u7edf\u6cbb\u7684\u4e11\u964b\u662f\u4e0d\u591f\u7684\uff0c\u6211\u4eec\u8fd8\u5fc5\u987b\u91c7\u53d6\u52a1\u5b9e\u7684\u884c\u52a8\uff0c\u5f00\u53d1\u51fa\u80fd\u591f\u62b5\u5fa1\u7edf\u6cbb\u7684\u6280\u672f\u5de5\u5177\u3002\u201d\uff0c\u8fd9\u79cd\u601d\u60f3\u540e\u6765\u88ab\u201c\u5bc6\u7801\u670b\u514b\u201d\u8fd0\u52a8\u7ee7\u627f\u4e86\uff1b</p> <p>1981 \u5e74</p> <ul> <li>\u4e92\u8054\u7f51\u534f\u8bae\uff08IP\uff09\u53d1\u884c\u4e86\u7b2c\u56db\u7248\uff08IPv4\uff09\uff1b</li> <li>David Chaum\uff08\u5927\u536b\u00b7\u4e54\u59c6\uff09\u8bbe\u60f3\u4e86\u4e00\u79cd\u4f7f\u7528\u6570\u5b57\u5047\u540d\u3001\u65e0\u6cd5\u8ffd\u8e2a\u7684\u7535\u5b50\u90ae\u4ef6\u534f\u8bae\uff0c\u5e76\u51fa\u7248\u4e86\u300a\u4e0d\u53ef\u8ffd\u8e2a\u7684\u7535\u5b50\u90ae\u4ef6\u3001\u8fd4\u56de\u5730\u5740\u4ee5\u53ca\u7535\u5b50\u5047\u540d\u300b\uff0c\u6807\u5fd7\u7740\u4f7f\u7528\u975e\u5bf9\u79f0\u5bc6\u7801\u5b66\u6765\u7b7e\u540d\u6d88\u606f\uff08\u800c\u975e\u52a0\u5bc6\u6587\u672c\uff09\u7684\u7528\u6cd5\u7684\u5f00\u7aef\uff1b</li> </ul> <p>1982 \u5e74\uff0c\u300a\u81ea\u7531\u7684\u4f26\u7406\u300b\u5efa\u8bae\u5e9f\u9664\u7f8e\u56fd\u8054\u90a6\u50a8\u5907\u59d4\u5458\u4f1a\uff0c\u56de\u5230\u5e02\u573a\u5316\u8d27\u5e01\u6a21\u5f0f\uff1b</p> <p>1983 \u5e74\uff0cDavid Chaum \u51fa\u7248\u300a\u7528\u4e8e\u4e0d\u53ef\u8ffd\u8e2a\u7684\u652f\u4ed8\u7684\u76f2\u7b7e\u540d\u300b\uff0c\u7b2c\u4e00\u6b21\u63d0\u51fa\u4f7f\u7528\u5bc6\u7801\u5b66\u7b7e\u540d\u7cfb\u7edf\u6765\u6784\u9020\u4e0d\u53ef\u8ffd\u8e2a\u7684\u7535\u5b50\u652f\u4ed8\u7684\u60f3\u6cd5\uff1b</p> <p>1985 \u5e74\uff0c\u51fa\u7248\u300a\u692d\u5706\u66f2\u7ebf\u5bc6\u7801\u5b66\u300b\uff0c\u63d0\u51fa\u4e86\u4e00\u79cd\u57fa\u4e8e\u6709\u9650\u57df\u692d\u5706\u66f2\u7ebf\u3001\u66ff\u4ee3 RSA \u7684\u516c\u94a5\u7b7e\u540d\u7b97\u6cd5\uff1b</p> <p>1988 \u5e74\uff0cTimothy May\uff08\u8482\u83ab\u897f\u00b7\u6885\uff09\u53d1\u8868\u300a\u5bc6\u7801\u65e0\u653f\u5e9c\u4e3b\u4e49\u5ba3\u8a00\u300b\uff0c\u603b\u7ed3\u90e8\u5206\u5199\u9053\uff1a\u201c\u5728\u7269\u7406\u4e16\u754c\u4e2d\uff0c\u56fd\u5bb6\u63a7\u5236\u7740\u6211\u4eec\uff0c\u4f46\u5728\u4e92\u8054\u7f51\u7684\u7535\u5b50\u4e16\u754c\u4e2d\uff0c\u611f\u8c22\u5bc6\u7801\u5b66\uff0c\u53ea\u8981\u6211\u4eec\u5f00\u53d1\u51fa\u4e86\u6b63\u786e\u7684\u5de5\u5177\uff0c\u56fd\u5bb6\u5c31\u65e0\u6cd5\u63a7\u5236\u6211\u4eec\u3002\u6211\u4eec\u53ef\u4ee5\u521b\u9020\u5047\u540d\u3001\u4ea4\u6362\u601d\u60f3\u670d\u52a1\u548c\u4ea7\u54c1\uff0c\u800c\u4e0d\u5fc5\u5fcd\u53d7\u76d1\u89c6\u201d\uff1b</p> <p>1989 \u5e74\uff0cDavid Chaum \u57fa\u4e8e\u975e\u5bf9\u79f0\u5bc6\u7801\u5b66\u548c\u76f2\u7b7e\u540d\u5f00\u53d1\u4e86 DigiCash\uff0c\u5b83\u57fa\u4e8e\u7535\u5b50\u8d27\u5e01 Ecash\uff0cEcash \u53ef\u4ee5\u5728\u7f51\u7edc\u4e2d\u4f20\u8f93\u3001\u7528\u4e8e\u5b8c\u6210\u5728\u7ebf\u652f\u4ed8\uff0c\u7528\u6237\u53ef\u4ee5\u4ece\u94f6\u884c\u548c\u5176\u5b83\u91d1\u878d\u673a\u6784\u8d2d\u4e70 Ecash\uff0c\u5b9e\u73b0\u5feb\u901f\u548c\u5b89\u5168\u7684\u652f\u4ed8\uff1b</p> <p>\u8fd9\u8fd8\u4e0d\u662f\u6bd4\u7279\u5e01\uff0c\u4f46\u6211\u4eec\u79bb\u5b83\u66f4\u8fd1\u4e86\u3002 </p> <p>1990 \u5e74\uff0cClaus Schnorr\uff08\u514b\u52b3\u65af\u00b7\u65bd\u8bfa\u5c14\uff09\u4e3a\u4e00\u79cd\u4f7f\u7528\u692d\u5706\u66f2\u7ebf\u5bc6\u7801\u5b66\u7684\u7b7e\u540d\u7b97\u6cd5\u7533\u8bf7\u4e86\u4e13\u5229\uff0c\u5bf9\u6bd4\u7279\u5e01\u7684\u65e5\u540e\u6539\u8fdb\uff08\u4f8b\u5982 taproot\uff09\u975e\u5e38\u91cd\u8981\uff1b</p> <p>\u5728 2008 \u5e74\uff0cSatoshi Nakamoto\uff08\u4e2d\u672c\u806a\uff09\u5e76\u6ca1\u6709\u4f7f\u7528 Schnorr \u7b7e\u540d\uff0c\u867d\u7136\u90a3\u4e2a\u65f6\u5019 Schnorr \u7684\u4e13\u5229\u5df2\u7ecf\u5230\u671f\u4e86\uff0c\u4f46\u4e2d\u672c\u806a\u8ba4\u4e3a\u5c06\u8fd9\u4e48\u91cd\u8981\u7684\u7cfb\u7edf\u6784\u7b51\u5728\u4e00\u79cd\u65b0\u7684\u3001\u672a\u7ecf\u751f\u4ea7\u73af\u5883\u8003\u9a8c\u3001\u7f3a\u4e4f\u5ba1\u8ba1\u3001\u6d4b\u8bd5\u548c\u540c\u884c\u8bc4\u8bae\u7684\u6280\u672f\u4e0a\uff0c\u53ef\u80fd\u6709\u5371\u9669\u3002\u76f8\u53cd\uff0c\u4ed6\u9009\u62e9\u4e86\u4e0d\u90a3\u4e48\u9ad8\u6548\u7684 ECDSA \u7684\u7b97\u6cd5\uff0cECDSA \u8fd8\u4e0d\u50cf Schnorr \u7b7e\u540d\u90a3\u6837\u652f\u6301\u7b7e\u540d\u805a\u5408\u3002 </p> <p>1991 \u5e74</p> <ul> <li>Phil Zimmermann\uff08\u83f2\u5c14\u00b7\u9f50\u9ed8\u5c14\u66fc\uff09\u53d1\u660e\u4e86 PGP (Pretty Good Privacy) \u8f6f\u4ef6\uff0c\u5b83\u7684\u4f5c\u7528\u5c31\u662f\u4e3a\u7528\u6237\u751f\u6210\u4e00\u5bf9\u516c\u79c1\u94a5\u3002\u516c\u94a5\u7528\u6765\u52a0\u5bc6\u8981\u53d1\u7ed9\u5176\u6240\u6709\u8005\u7684\u6d88\u606f\uff0c\u800c\u5176\u4eba\u7684\u79c1\u94a5\u5219\u7528\u6765\u89e3\u5bc6\u8fd9\u6837\u7684\u4fe1\u606f\u548c\u6587\u6863\uff1b</li> <li>\u7814\u7a76\u5458 Haber \u548c Stornetta \u53d1\u8868\u8bba\u6587\u300a\u5982\u4f55\u4e3a\u7535\u5b50\u6587\u6863\u6dfb\u52a0\u65f6\u95f4\u6233\u300b\uff08\u4e2d\u672c\u806a\u5728\u6bd4\u7279\u5e01\u8bba\u6587\u4e2d\u4e5f\u5f15\u7528\u4e86\u8fd9\u7bc7\u6587\u7ae0\uff09\uff0c\u5728\u8be5\u6587\u4e2d\uff0c\u4e24\u4f4d\u7814\u7a76\u5458\u53d1\u6398\u4e86\u8bc1\u660e\u4e00\u4efd\u6587\u6863\u5728\u7ed9\u5b9a\u65f6\u95f4\u5c31\u5df2\u5b58\u5728\u7684\u6280\u672f\uff0c\u4f46\u6bd4\u7279\u5e01\u5fc5\u987b\u505a\u5230\u66f4\u591a\uff1a\u5728\u76f8\u540c\u7684\u65f6\u95f4\u95f4\u9694\u540c\u65f6\u8bc1\u660e\u201c\u5b58\u5728\u6027\u201d\u548c\u201c\u552f\u4e00\u6027\u201d\uff1b</li> </ul> <p>1992 \u5e74\uff0c\u5bc6\u7801\u670b\u514b\u56e2\u4f53\u5728\u65e7\u91d1\u5c71\u8bde\u751f\uff0c\u81ea\u7531\u610f\u5fd7\u4e3b\u4e49\u7684\u79ef\u6781\u5206\u5b50\u4e3b\u5f20\u5927\u91cf\u8fd0\u7528\u8ba1\u7b97\u673a\u5bc6\u7801\u5b66\uff0c\u4f5c\u4e3a\u793e\u4f1a\u548c\u653f\u6cbb\u53d8\u9769\u7684\u8def\u5f84\uff1b</p> <p>\u8457\u540d\u8bb0\u8005 Julian Assange\uff08\u6731\u5229\u5b89\u00b7\u963f\u6851\u5947\uff09\u4e5f\u662f\u8fd9\u4e2a\u56e2\u4f53\u7684\u6210\u5458\u3002 </p> <p>1993 \u5e74\uff0c\u300a\u5bc6\u7801\u670b\u514b\u5ba3\u8a00\u300b\u51fa\u7248\uff0c\u5bc6\u7801\u670b\u514b\u548c\u5bc6\u7801\u65e0\u653f\u5e9c\u4e3b\u4e49\u7684\u533a\u522b\u5728\u4e8e\uff0c\u540e\u8005\u4e3b\u5f20\u4f7f\u7528\u5bc6\u7801\u5b66\u6280\u672f\uff0c\u4f5c\u4e3a\u5728\u793e\u4f1a\u4e2d\u652f\u6301\u65e0\u653f\u5e9c\u4e3b\u4e49\u548c\u4e2a\u4eba\u6ce8\u610f\u7684\u5de5\u5177\uff0c\u4f46\u5bc6\u7801\u670b\u514b\u662f\u4f7f\u7528\u5bc6\u7801\u5b66\u6765\u53d8\u9769\u793e\u4f1a\u548c\u653f\u6cbb\u7684\u6d3b\u52a8\u5bb6\uff1b</p> <p>1994 \u5e74\uff0cTimothy May \u51fa\u7248\u300aThe cyphernomicon\u300b\uff08\u76f4\u8bd1\u4e3a \u201c\u5bc6\u7801\u5b66\u201d\uff09\uff0c\u63a2\u8ba8\u4e86\u5bc6\u7801\u5b66\u6280\u672f\u53ef\u4ee5\u5982\u4f55\u7528\u6765\u4fdd\u62a4\u4e2a\u4eba\u6570\u636e\u7684\u9690\u79c1\u6027\u3001\u521b\u5efa\u7528\u4e8e\u4ea4\u6362\u5546\u54c1\u548c\u670d\u52a1\u7684\u7f51\u7edc\u800c\u65e0\u9700\u653f\u5e9c\u673a\u6784\u7684\u63a7\u5236\u3001\u5728\u65e5\u76ca\u76f8\u4e92\u8fde\u63a5\u7684\u4e16\u754c\u4e2d\u4fdd\u62a4\u8a00\u8bba\u81ea\u7531\uff1b</p> <p>90 \u5e74\u4ee3\u7684\u5bc6\u7801\u5b66\u6218\u4e89\uff08Crypto Wars\uff09\uff1a\u7f8e\u56fd\u653f\u5e9c\u5c06\u5f3a\u52a0\u5bc6\u6280\u672f\u89c6\u4e3a\u519b\u7528\u7269\u54c1\uff0c\u51fa\u53e3\u53d7\u5230\u4e25\u683c\u9650\u5236\uff0c\u6781\u5927\u5730\u9650\u5236\u4e86\u52a0\u5bc6\u6280\u672f\u5728\u5168\u4e16\u754c\u7684\u63a8\u5e7f\u3002</p> <p>1997 \u5e74</p> <ul> <li>Adam Back\uff08\u4e9a\u5f53\u00b7\u8d1d\u514b\uff09\u4e3a\u89e3\u51b3\u5783\u573e\u90ae\u4ef6\u8f70\u70b8\u800c\u63d0\u51fa\u4e86 HashCash\uff0c\u8fd9\u5c31\u662f\u6bd4\u7279\u5e01\u7684\u5de5\u4f5c\u91cf\u8bc1\u660e\uff1b</li> <li>Nick\u00b7Szabo\uff08\u5c3c\u514b\u00b7\u8428\u535a\uff09\u63d0\u51fa\u667a\u80fd\u5408\u7ea6\uff1b</li> <li>\u300a\u4e3b\u6743\u4e2a\u4eba\u300b\u51fa\u7248\uff1b</li> </ul> <p>\u4e2d\u672c\u806a\u5728\u8bba\u6587\u4e2d\u5f15\u7528\u4e86\u4e9a\u5f53\u00b7\u8d1d\u514b\u548c\u4ed6\u7684 HashCash \u8bba\u6587\uff0c\u4f5c\u4e3a\u521b\u9020\u6bd4\u7279\u5e01\u7684\u57fa\u7840\u3002</p> <p>\u4e0d\u8fc7\uff0c\u51fa\u7248\u4e8e 1992 \u5e74\u7684\u8bba\u6587\u300a\u901a\u8fc7\u8fd0\u7b97\u6765\u5b9a\u4ef7\uff0c\u6253\u8d25\u5783\u573e\u90ae\u4ef6\u300b\u5df2\u7ecf\u63d0\u51fa\u4e86\u7c7b\u4f3c\u7684\u60f3\u6cd5\u3002</p> <p>1998 \u5e74</p> <ul> <li>Nick\u00b7Szabo \u53d1\u660e BitGold\uff082005 \u5e74\u624d\u5b8c\u6574\u516c\u5f00\uff09\uff1b</li> <li>Wei Dai \u53d1\u8868\u8bba\u6587 B-Money\uff1b</li> <li>Peter Thiel\uff08\u5f7c\u5f97\u00b7\u8482\u5c14\uff09\u521b\u5efa\u4e86 Confinity\uff0c\u4e00\u79cd\u7528\u4e8e\u7535\u5b50\u5546\u52a1\u7684\u5728\u7ebf\u652f\u4ed8\u7cfb\u7edf\uff0c\u4f46\u4ed6\u7684\u613f\u666f\u7c7b\u4f3c\u4e8e\u6bd4\u7279\u5e01\uff1a\u201c\u5728\u73b0\u5b9e\u4e16\u754c\u4e2d\uff0c\u4f60\u9700\u8981\u8ddf\u4f60\u6240\u5728\u56fd\u5ea6\u7684\u8d27\u5e01\u6253\u4ea4\u9053\uff0c\u4f46\u5230\u4e86\u4e92\u8054\u7f51\u4e0a\uff0c\u4f60\u5c31\u662f\u8d5b\u535a\u7a7a\u95f4\u7684\u516c\u6c11\uff0c\u56e0\u6b64\u662f\u65e0\u56fd\u754c\u7684\u3001\u65e0\u5b98\u50da\u4e3b\u4e49\u7684\uff0c\u4f60\u5c06\u7528 confinty \u8d27\u5e01\u6765\u652f\u4ed8\u3002\u201d\uff1b</li> </ul> <p>Nick\u00b7Szabo \u548c Wei Dai \u7684\u8bbe\u60f3\u90fd\u53d7\u56f0\u4e8e\u540c\u4e00\u4e2a\u95ee\u9898\uff1a\u8d44\u91d1\u53ef\u80fd\u88ab\u91cd\u590d\u82b1\u8d39\uff08Double Spending Attack\uff09\u3002</p> <p>1999 \u5e74</p> <ul> <li>Elon Musk\uff08\u4f0a\u9686\u00b7\u9a6c\u65af\u514b\uff09\u521b\u5efa\u4e86 X.com\uff1b</li> <li>Milton Friedman\uff08\u7c73\u5c14\u987f\u00b7\u5f17\u91cc\u5fb7\u66fc\uff09\u9884\u8a00\uff1a\u201c\u6211\u8ba4\u4e3a\uff0c\u4e92\u8054\u7f51\u5c06\u662f\u524a\u5f31\u653f\u5e9c\u6743\u529b\u5bf9\u4eba\u4eec\u751f\u6d3b\u7684\u5f71\u54cd\u7684\u91cd\u5927\u529b\u91cf\u3002\u4f46\u8fd8\u5c11\u4e86\u4e00\u6837\u4e1c\u897f \u2014\u2014 \u6211\u89c9\u5f97\u5f88\u5feb\u5c31\u4f1a\u6709\u4eba\u53d1\u660e\u51fa\u6765 \u2014\u2014 \u4e00\u79cd\u4e92\u8054\u7f51\u7535\u5b50\u8d27\u5e01\uff0c\u5141\u8bb8 A \u5c06\u8d44\u91d1\u8f6c\u79fb\u7ed9 B \u4e14 B \u4e0d\u5fc5\u8ba4\u8bc6 A\u3002\u8fd9\u6837\u7684\u7cfb\u7edf\u8fd8\u4e0d\u5b58\u5728\uff0c\u4f46\u4e00\u5b9a\u4f1a\u51fa\u73b0\u7684\uff0c\u800c\u4e14\u5b83\u4f1a\u8ba9\u4e92\u8054\u7f51\u53d8\u6210\u6700\u4f1f\u5927\u7684\u53d8\u9769\u3002\u201d</li> </ul> <p>2000 \u5e74\uff0cElon Musk \u7684 X.com \u548c Peter Thiel \u7684 Confinity \u5408\u5e76\u4e86\uff0cPayPal \u7531\u6b64\u8bde\u751f\uff0c\u76d1\u7ba1\u4ecb\u5165\uff0cPayPal \u653e\u5f03\u4e86\u4e92\u8054\u7f51\u8d27\u5e01\u7684\u60f3\u6cd5\uff0c\u8f6c\u800c\u6210\u4e3a\u4e86\u4f20\u7edf\u8d27\u5e01\u7684\u4e00\u4e2a\u652f\u4ed8\u7f51\u7edc\uff1b</p> <p>2001 \u5e74</p> <ul> <li>Bram Cohen\uff08\u5e03\u83b1\u59c6\u00b7\u79d1\u4ea8\uff09\u521b\u5efa BitTorrent\uff0c\u4e00\u79cd\u70b9\u5bf9\u70b9\u7684\u7f51\u7edc\u534f\u8bae\uff0c\u51fa\u73b0\u4e86\u53ef\u4ee5\u4f20\u8f93\u97f3\u4e50\u3001\u89c6\u9891\u548c\u7535\u5b50\u6587\u4ef6\u7684 Napster\uff0c\u4f46\u5b83\u662f\u4ee5\u4e2d\u5fc3\u5316\u7684\u8303\u5f0f\u8fd0\u884c\u7684\uff1b</li> <li>\u7f8e\u56fd\u53d1\u751f 911 \u6050\u6016\u88ad\u51fb\u540e\uff0c\u51fa\u53f0\u4e25\u683c\u7684\u91d1\u878d\u7ba1\u5236\uff08\u5728\u53cd\u6050\u7684\u53e3\u53f7\u4e0b\uff09\uff0c\u5b98\u5458\u8981\u6c42\u6709\u6743\u77e5\u9053\u6bcf\u4e00\u4e2a\u4eba\u7684\u6bcf\u4e00\u7b14\u8d44\u91d1\u52a8\u5411\u4ee5\u53ca\u7406\u7531\uff08\u65e0\u8bba\u662f\u5426\u8eab\u5904\u7f8e\u56fd\u53f8\u6cd5\u8f96\u533a\uff09\uff1b</li> <li>Adam Back \u5411 16 \u5c81\u7684 Peter Todd\uff08\u5f7c\u7279\u00b7\u9676\u5fb7\uff09 \u89e3\u91ca\uff0cHashCash \u4e0d\u4ec5\u53ef\u4ee5\u7528\u4e8e\u5bf9\u6297\u5783\u573e\u90ae\u4ef6\uff0c\u8fd8\u53ef\u4ee5\u4f5c\u4e3a\u7535\u5b50\u73b0\u91d1\u8d27\u5e01\u7cfb\u7edf\u7684\u57fa\u7840\u3002Peter \u5411 Adam \u6307\u51fa\u4e86\u4e00\u4e2a\u95ee\u9898\uff1a\u5982\u679c\u8fd9\u79cd\u5de5\u4f5c\u91cf\u8bc1\u660e\u662f\u53ef\u4ee5\u5728\u4e3b\u4f53\u95f4\u8f6c\u79fb\u7684\uff0c\u90a3\u4e48\u5b83\u5c06\u4f1a\u6076\u6027\u901a\u80c0\uff1b\u63a8\u7406\u8fc7\u7a0b\u662f\uff0c\u4f7f\u7528\u5de5\u4f5c\u91cf\u8bc1\u660e\u53ef\u4ee5\u8bc1\u660e\u4e86\u4f60\u4ed8\u51fa\u4e86\u4e00\u4e9b\u8ba1\u7b97\u4ee3\u4ef7\uff08\u673a\u5668\u7684\u65f6\u95f4\u548c\u80fd\u91cf\uff09\uff0c\u800c\u5173\u952e\u662f\u8ba9\u5de5\u4f5c\u91cf\u8bc1\u660e\u53ef\u4ee5\u8f6c\u79fb\uff0c\u4e5f\u5c31\u662f\u8bc1\u660e\u4e86\u67d0\u4eba\u82b1\u8d39\u4e86\u65f6\u95f4\u548c\u6295\u5165\u4e86\u673a\u5668\uff0c\u800c\u6211\u53ea\u662f\u590d\u7528\u4e86\u5df2\u7ecf\u53d1\u751f\u7684\u8ba1\u7b97\u4ee3\u4ef7\uff1a</li> </ul> <p>\u5728 2001 \u5e74\u5b8c\u6210\u7684\u4e00\u4e2a\u5de5\u4f5c\u91cf\u8bc1\u660e\uff0c\u5c06\u8ddf 2022 \u5e74\u5b8c\u6210\u7684\u5de5\u4f5c\u91cf\u8bc1\u660e\u622a\u7136\u4e0d\u540c\uff0c\u56e0\u4e3a\u673a\u5668\u7684\u8ba1\u7b97\u529b\u662f\u6307\u6570\u589e\u957f\u7684\uff0c\u6240\u4ee5 2001 \u5e74\u7684\u5de5\u4f5c\u91cf\u8bc1\u660e\u4f1a\u53d8\u5f97\u6beb\u65e0\u610f\u4e49\uff1b</p> <p>\u5982\u679c\u4eba\u4eec\u5bf9 \u201c\u7535\u5b50\u8d27\u5e01\u201d \u6709\u5f88\u5927\u7684\u9700\u6c42\uff0c\u90a3\u4e48\u5b83\u7684\u4ef7\u683c\u4f1a\u4e0a\u5347\uff0c\u5176\u76c8\u5229\u7a7a\u95f4\u4e5f\u4f1a\u589e\u52a0\uff0c\u66f4\u591a\u4eba\u4f1a\u5c1d\u8bd5\u52a0\u5165\uff0c\u4ece\u800c\u521b\u9020\u66f4\u591a\u4f9b\u7ed9\u91cf\u3002\u800c\u4f9b\u7ed9\u91cf\u7684\u589e\u52a0\u4f1a\u8ba9\u4ef7\u683c\u56de\u843d\uff1b\u56e0\u6b64\uff0c\u7cdf\u7cd5\u7684\u7ecf\u6d4e\u5468\u671f\u4f1a\u51fa\u73b0\uff0c\u5c31\u50cf\u6cd5\u5e01\u7cfb\u7edf\u4e00\u6837\uff1b</p> <p>\u89e3\u51b3\u65b9\u6848\u5c31\u662f\u81ea\u52a8\u5316\u7684\u96be\u5ea6\u8c03\u6574\uff0c\u8fd9\u5c06\u7531\u4e2d\u672c\u806a\u6765\u5b9e\u73b0\u3002 </p> <p>2003 \u5e74\uff0c\u89c6\u9891\u6e38\u620f Second Life \u7206\u706b\uff0c\u6e38\u620f\u4e2d\u7684 Linden Dollar \u8d27\u5e01\u53ef\u4ee5\u5728\u573a\u5185\u5916\u4ea4\u6362\uff0c\u5355\u4f4d\u4ef7\u503c\u5927\u5927\u8d85\u8fc7\u4e86\u5355\u4f4d\u7f8e\u5143\uff0c\u7ed3\u679c\u62db\u6765\u76d1\u7ba1\u6253\u51fb\uff0c\u88ab\u8feb\u8ba9 Linden Dollar \u8ddf\u7f8e\u5143\u4fdd\u6301 1\uff1a1 \u7684\u951a\u5b9a\u4ef7\u683c\uff1b</p> <p>2004 \u5e74\uff0c\u5bc6\u7801\u670b\u514b Hal Finney\uff08\u54c8\u5c14\u00b7\u82ac\u5c3c\uff0cPGP 2.0 \u7684\u4f5c\u8005\uff09\u53d1\u660e\u201c\u53ef\u590d\u7528\u7684\u5de5\u4f5c\u91cf\u8bc1\u660e\uff08RPOW\uff09\u201d\uff0c\u6700\u7ec8\u8ba9 HashCash \u7684\u5de5\u4f5c\u91cf\u8bc1\u660e\u53d8\u5f97\u53ef\u4ee5\u8f6c\u79fb\uff0c\u4f46\u91cd\u590d\u82b1\u8d39\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff1b</p> <p>2005 \u5e74\uff0cNick\u00b7Szabo \u5b8c\u6574\u516c\u5f00\u4e86 BitGold\uff08\u6784\u601d\u4e8e 1998 \u5e74\u7684\u7535\u5b50\u8d27\u5e01\uff09\uff0c\u800c\u4e14\u53ef\u4ee5\u8ba4\u4e3a\u5176\u901a\u8fc7\u521b\u5efa\u8d27\u5e01\u4ee5\u53ca\u5bf9\u4ea4\u6613\u5386\u53f2\u6295\u7968\uff0c\u89e3\u51b3\u4e86\u91cd\u590d\u82b1\u8d39\u95ee\u9898\uff1b</p> <p>\u5df2\u7ecf\u975e\u5e38\u63a5\u8fd1\u6bd4\u7279\u5e01\u7684\u60f3\u6cd5\u3002 </p> <p>2008 \u5e74</p> <ul> <li>Schnorr \u7b7e\u540d\u7b97\u6cd5\u7684\u4e13\u5229\u8fc7\u671f\u4e86\uff08\u867d\u7136\u4e2d\u672c\u806a\u6ca1\u6709\u9009\u62e9\u5b83\uff09\uff1b</li> <li>\u6b21\u8d37\u5371\u673a\u5f15\u53d1\u5168\u7403\u91d1\u878d\u5371\u673a\uff1b</li> <li>2008 \u5e74 10 \u6708 31 \u65e5\uff08UTC\uff09\uff0c\u4e2d\u672c\u806a\u53d1\u5e03\u6bd4\u7279\u5e01\u8bba\u6587\u3002</li> </ul> <p></p> <p>2009 \u5e74 1 \u6708 3 \u65e5\uff0c\u7b2c\u4e00\u4e2a\u6bd4\u7279\u5e01\u533a\u5757\u6316\u51fa\u3002</p>"},{"location":"web3/dapp/address_240321/","title":"Solidity \u5730\u5740\u7c7b\u578b & \u5e38\u89c1\u7528\u6cd5\u5168\u653b\u7565","text":"<p> \u7ea6 1226 \u4e2a\u5b57  41 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 5 \u5206\u949f</p>"},{"location":"web3/dapp/address_240321/#1-solidity","title":"1. Solidity \u5730\u5740\u7c7b\u578b","text":"<p>\u5730\u5740\u7c7b\u578b\uff08<code>address</code>\uff09\u7528\u4e8e\u5b58\u50a8\u4e00\u4e2a 20 \u5b57\u8282\u7684\u503c\uff08\u4ee5\u592a\u574a\u5730\u5740\u7684\u5927\u5c0f\uff09\u3002\u5b83\u4e0d\u4ec5\u4ec5\u662f\u4e00\u4e2a\u5b58\u50a8\u5355\u4f4d\uff0c\u8fd8\u63d0\u4f9b\u4e86\u4e0e\u4ee5\u592a\u574a\u8d26\u6237\u4ea4\u4e92\u7684\u591a\u79cd\u65b9\u5f0f\uff0c\u5bf9\u4e8e\u7f16\u5199\u667a\u80fd\u5408\u7ea6\u81f3\u5173\u91cd\u8981\u3002</p> <p>\u6ce8\uff1a\u8fd9\u4e9b\u8d26\u6237\u53ef\u4ee5\u662f\u5916\u90e8\u8d26\u6237\uff08\u7531\u7528\u6237\u63a7\u5236\u7684\u8d26\u6237\uff0c\u62e5\u6709\u79c1\u94a5\uff09\u6216\u5408\u7ea6\u8d26\u6237\uff08\u7531\u5408\u7ea6\u4ee3\u7801\u63a7\u5236\u7684\u8d26\u6237\uff09\u3002</p> <p>Solidity \u4e2d\u6709\u4e24\u79cd\u5730\u5740\u7c7b\u578b\uff1a</p> <ul> <li>address\uff1a\u666e\u901a\u5730\u5740\uff0c\u4e0d\u80fd\u63a5\u6536 ETH\uff0c\u5373\u4e0d\u80fd\u8c03\u7528 <code>transfer</code> / <code>send</code> / <code>call{value: ...}</code> \u7b49\u65b9\u6cd5\uff1b</li> <li>address payable\uff1a\u80fd\u63a5\u6536 ETH\uff0c\u652f\u6301\u8c03\u7528 <code>transfer</code> / <code>send</code> / <code>call{value: ...}</code> \u7b49\u65b9\u6cd5\uff1b</li> </ul> <p>\u6ce8\uff1a\u4e0e ETH \u76f8\u5173\u7684\u64cd\u4f5c\uff08\u8f6c\u8d26\u3001\u6536\u6b3e\uff09\uff0c\u90fd\u5fc5\u987b\u4f7f\u7528 address payable\u3002</p> <p>\u5bf9\u4e8e <code>address</code> \u7c7b\u578b\uff0c\u5e38\u7528\u7684\u5c5e\u6027\u5305\u62ec\uff1a</p> <ul> <li><code>balance</code>\uff1a\u83b7\u53d6\u5730\u5740\u4e2d\u7684 ETH \u4f59\u989d\uff1b</li> <li><code>code</code>\uff08Solidity ^0.8.0\uff09\uff1a\u83b7\u53d6\u5730\u5740\u4e2d\u5b58\u50a8\u7684\u5408\u7ea6\u4ee3\u7801\uff08\u5982\u679c\u6709\u7684\u8bdd\uff09\uff0c\u6b64\u5c5e\u6027\u5728 Solidity 0.8.0 \u4ee5\u540e\u7248\u672c\u4e2d\u65b0\u589e\uff1b</li> <li><code>codehash</code>\uff08Solidity ^0.8.0\uff09\uff1a\u83b7\u53d6\u5730\u5740\u7684\u5408\u7ea6\u4ee3\u7801\u7684\u54c8\u5e0c\u503c\uff08\u5982\u679c\u5730\u5740\u4e3a\u5408\u7ea6\u5730\u5740\uff09\uff0c\u5982\u679c\u5730\u5740\u662f\u5916\u90e8\u8d26\u6237\u6216\u5408\u7ea6\u4e2d\u6ca1\u6709\u4ee3\u7801\uff0c\u5219\u8fd4\u56de\u96f6\u54c8\u5e0c\uff1b</li> </ul> <p>\u5bf9\u4e8e <code>address payable</code> \u7c7b\u578b\uff0c\u9664 <code>address</code> \u7c7b\u578b\u7684\u5c5e\u6027\u5916\uff0c\u8fd8\u5305\u62ec\u4e09\u79cd\u4e0e ETH \u8f6c\u8d26\u76f8\u5173\u7684\u65b9\u6cd5\uff1a</p> <ul> <li><code>transfer(uint256 amount)</code>\uff1a\u56fa\u5b9a 2300 gas \u4f9b\u5bf9\u65b9 fallback/receive \u4f7f\u7528\uff0c\u5931\u8d25\u4f1a\u76f4\u63a5 <code>revert</code>\uff0c\u65b0\u7248\u672c\u91cc\u56e0\u4e3a gas \u653f\u7b56\u4e0d\u7a33\u5b9a\uff0c\u5b98\u65b9\u5df2\u7ecf\u4e0d\u63a8\u8350\u7528 <code>transfer</code> \u548c <code>send</code> \u4e86\uff1b</li> <li><code>send(uint256 amount) returns (bool)</code>\uff1a2300 gas \u9650\u5236\uff0c\u8fd4\u56de\u4e00\u4e2a\u5e03\u5c14\u503c\u8868\u793a\u6210\u529f\u4e0e\u5426\uff0c\u4e0d\u4f1a\u5728\u5931\u8d25\u65f6 <code>revert</code>\uff0c\u81ea\u5df1\u51b3\u5b9a\u8981\u4e0d\u8981 <code>require</code>\uff1b</li> <li><code>call(bytes memory data) returns (bool, bytes memory)</code>\uff1a\u5411\u5730\u5740\u53d1\u9001 ETH\uff0c\u53ef\u540c\u65f6\u8c03\u7528\u5176\u5408\u7ea6\u51fd\u6570\uff0c\u8fd4\u56de\u4e00\u4e2a\u5e03\u5c14\u503c\u8868\u793a\u6210\u529f\u4e0e\u5426\u548c\u8fd4\u56de\u6570\u636e\u3002</li> </ul> \u51fd\u6570 \u662f\u5426\u63a8\u8350 \u5931\u8d25\u662f\u5426 revert Gas \u9650\u5236 <code>transfer</code> \u274c \u4e0d\u63a8\u8350 \u2714\ufe0f \u81ea\u52a8 revert 2300 gas <code>send</code> \u274c \u4e0d\u63a8\u8350 \u274c \u8fd4\u56de false 2300 gas <code>call{value:...}</code> \u2714\ufe0f \u63a8\u8350\u6807\u51c6 \u274c \u9700\u624b\u52a8 require \u65e0\u9650\u5236 <p>\u9700\u8981\u8f6c\u8d26\u65f6\uff0c\u5efa\u8bae\u4f7f\u7528 <code>call</code> \u65b9\u6cd5\uff0c\u56e0\u4e3a <code>transfer</code> \u4e0e <code>send</code> \u65b9\u6cd5\u5b58\u5728 Gas \u9650\u5236\uff08\u53ea\u63d0\u4f9b2300 Gas\uff0c\u8fd9\u8db3\u4ee5\u8bb0\u5f55\u4e8b\u4ef6\uff0c\u4f46\u4e0d\u8db3\u4ee5\u8fdb\u884c\u66f4\u590d\u6742\u7684\u64cd\u4f5c\uff09\uff0c\u800c <code>call</code> \u6bd4\u8f83\u7075\u6d3b\u3002</p>"},{"location":"web3/dapp/address_240321/#2","title":"2. \u5730\u5740\u4e0e\u5916\u90e8\u5408\u7ea6\u4ea4\u4e92\uff08\u63a5\u53e3\u7c7b\u578b\u8f6c\u6362\uff09","text":""},{"location":"web3/dapp/address_240321/#21","title":"2.1 \u4e3a\u4ec0\u4e48\u8f6c\u6362\u6210\u63a5\u53e3\u7c7b\u578b\uff1f","text":"<p>\u4ee5\u592a\u574a\u4e16\u754c\u91cc\uff1a</p> <ul> <li>\u6bcf\u4e2a\u5408\u7ea6 = \u4e00\u6bb5\u90e8\u7f72\u5728\u94fe\u4e0a\u7684\u4ee3\u7801</li> <li>\u6bcf\u4e2a\u5408\u7ea6 = \u4e00\u4e2a\u72ec\u7acb\u7684\u5730\u5740\uff08address\uff09</li> </ul> <p>\u4f46 <code>address</code> \u672c\u8d28\u53ea\u662f 20 \u5b57\u8282\u6570\u5b57\uff0c\u5e76\u6ca1\u6709\u201c\u51fd\u6570\u4fe1\u606f\u201d\uff0c\u56e0\u6b64\uff1a</p> <p>\u274c address \u4e0d\u77e5\u9053\u8fd9\u4e2a\u5730\u5740\u5bf9\u5e94\u54ea\u79cd\u5408\u7ea6</p> <p>\u274c address \u4e0d\u77e5\u9053\u91cc\u9762\u6709\u54ea\u4e9b\u51fd\u6570</p> <p>\u274c address \u4e0d\u80fd\u76f4\u63a5\u8c03\u7528 transfer\u3001approve\u3001swap \u7b49\u51fd\u6570</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>address token = 0x...;\ntoken.transfer(to, amount); // \u274c \u7f16\u8bd1\u9519\u8bef\n</code></pre> <p>\u56e0\u4e3a <code>address</code> \u7c7b\u578b\u6ca1\u6709 <code>transfer</code> \u65b9\u6cd5\u3002</p> <p>Solidity \u662f\u5f3a\u7c7b\u578b\u8bed\u8a00\uff0c\u5fc5\u987b\u660e\u786e\u544a\u8bc9\u5b83\uff1a\u8fd9\u4e2a address \u662f\u4ec0\u4e48\u7c7b\u578b\u7684\u5408\u7ea6\uff01</p> <p>\u6240\u4ee5\u6211\u4eec\u624d\u9700\u8981\uff1a</p> <p>\u2705 \u5148\u5b9a\u4e49\u63a5\u53e3\uff08Interface\uff09\u2014\u2014\u63cf\u8ff0\u5408\u7ea6\u51fd\u6570</p> <p>\u2705 \u518d\u628a <code>address</code> \u5f3a\u5236\u8f6c\u6362\u6210\u63a5\u53e3\u7c7b\u578b</p> <p>\u2705 \u6700\u540e\u7528\u63a5\u53e3\u6765\u8c03\u7528\u51fd\u6570</p>"},{"location":"web3/dapp/address_240321/#22","title":"2.2 \u5730\u5740\u8f6c\u63a5\u53e3\u5e76\u8c03\u7528\u51fd\u6570\uff08\u6838\u5fc3\u8bed\u6cd5\uff09","text":"<p>\u5178\u578b\u5199\u6cd5\uff1a<code>IERC20(tokenAddress).transfer(to, amount)</code></p> <p>\u4ee3\u7801\u542b\u4e49\uff1a</p> <ol> <li><code>tokenAddress</code> \u2014\u2014 \u8fd9\u662f ERC20 \u5408\u7ea6\u90e8\u7f72\u5728\u94fe\u4e0a\u7684\u5730\u5740\uff1b</li> <li><code>IERC20(tokenAddress)</code> \u2014\u2014 \u544a\u8bc9 Solidity\uff1a\u6309 ERC20 \u63a5\u53e3\u7684\u89c4\u8303\u8bbf\u95ee\u8fd9\u4e2a <code>address</code>\uff1b</li> <li><code>.transfer(...)</code> \u2014\u2014 \u7f16\u8bd1\u5668\u68c0\u67e5\u53c2\u6570\u7c7b\u578b\u3001\u8fd4\u56de\u503c\uff1b</li> <li>\u7f16\u8bd1\u540e\u6267\u884c\u4f4e\u7ea7 call\uff08ABI \u7f16\u7801\uff0cEVM \u6267\u884c\uff09\uff1b</li> </ol>"},{"location":"web3/dapp/address_240321/#23-address","title":"2.3 \u6700\u5e38\u7528\u573a\u666f\uff1a\u628a address \u50a8\u5b58\u8d77\u6765\uff0c\u7136\u540e\u4ea4\u4e92","text":"<p>\u4f8b\u5982 DEX\u3001Vault\u3001Staking \u5408\u7ea6\u90fd\u8fd9\u4e48\u5199\uff1a</p> <pre><code>contract Test {\n  address public token; // \u4fdd\u5b58\u4ee3\u5e01\u5408\u7ea6\u5730\u5740\n\n  function setToken(address _token) external {\n    token = _token;\n  }\n\n  function transferOut(address to, uint256 amount) external {\n    // address \u2192 IERC20\n    bool ok = IERC20(token).transfer(to, amount);\n    require(ok, \"transfer failed\");\n  }\n}\n</code></pre> <p>\u4e3a\u4ec0\u4e48\u4e0d\u80fd\u76f4\u63a5\u7528 <code>address</code>\uff1f\u56e0\u4e3a <code>address</code> \u6ca1\u6709 <code>transfer</code> \u51fd\u6570\u3002</p>"},{"location":"web3/dapp/address_240321/#24","title":"2.4 \u5b89\u5168\u6ce8\u610f\u4e8b\u9879","text":"<p>1\uff09\u786e\u4fdd\u8f6c\u6362\u7684 <code>address</code> \u662f\u671f\u671b\u7684\u5408\u7ea6\u5730\u5740</p> <p>\u5982\u679c\u7528\u6237\u4f20\u5165\u6076\u610f\u5730\u5740\uff1a<code>IERC20(fakeAddress).transfer(...)</code>\uff0c\u4f1a\u8c03\u5230\u9519\u8bef\u903b\u8f91 \u6216 fallback\uff0c\u89e6\u53d1\u6076\u610f\u4ee3\u7801\u3002</p> <p>\u6240\u4ee5\u5e38\u89c1\u505a\u6cd5\uff1a</p> <ul> <li>\u2714 \u767d\u540d\u5355\uff1b</li> <li>\u2714 constructor \u91cc\u5199\u6b7b\u5730\u5740\uff1b</li> <li>\u2714 \u4f7f\u7528 immutable \u5e38\u91cf\uff1b</li> <li>\u2714 \u4ec5 owner \u53ef\u4fee\u6539 token \u5730\u5740\uff1b</li> </ul> <p>2\uff09\u4f7f\u7528 <code>try/catch</code>\uff08\u9002\u5408\u5916\u90e8\u5408\u7ea6\u4e0d\u7a33\u5b9a\u65f6\uff09</p> <pre><code>try IERC20(token).transfer(to, amount) returns (bool ok) {\n  require(ok, \"failed\");\n} catch {\n  revert(\"token call failed\");\n}\n</code></pre> <p>3\uff09\u6c38\u8fdc\u4e0d\u8981\u7528 <code>address</code> \u518d\u53bb\u8c03\u7528\u672a\u77e5\u5408\u7ea6\u7684 send/transfer\uff08\u65e7\u5199\u6cd5\uff09</p> <p>\u65e7\u5199\u6cd5\u6709\u98ce\u9669\uff1a<code>payable(addr).transfer(amount);</code> // \u53ef\u80fd\u5931\u8d25</p> <p>\u6539\u7528\uff1a</p> <pre><code>(bool ok,) = payable(addr).call{value: amount}(\"\");\nrequire(ok);\n</code></pre> <p>\u603b\u7ed3\uff1a</p> \u6b65\u9aa4 \u76ee\u7684 \ud83d\udd39 \u5199\u63a5\u53e3 Interface \u544a\u8bc9 Solidity \u8fd9\u4e2a\u5408\u7ea6\u6709\u54ea\u4e9b\u51fd\u6570 \ud83d\udd39 \u7528 <code>IERC20(tokenAddress)</code> \u628a address \u8f6c\u6210\u63a5\u53e3\u7c7b\u578b \ud83d\udd39 \u7528\u63a5\u53e3\u8bbf\u95ee\u51fd\u6570 \u5b89\u5168\u3001\u7c7b\u578b\u68c0\u67e5\u3001\u81ea\u52a8 ABI \u7f16\u7801 \ud83d\udd39 \u7528\u5730\u5740\u4fdd\u5b58\u5408\u7ea6\u5730\u5740 \u5408\u7ea6\u95f4\u4ea4\u4e92"},{"location":"web3/dapp/address_240321/#3","title":"3. \u5730\u5740 + \u6620\u5c04 / \u6570\u7ec4\uff1a\u8bb0\u8d26 &amp; \u5173\u7cfb","text":""},{"location":"web3/dapp/address_240321/#31","title":"3.1 \u5730\u5740 + \u6620\u5c04","text":"<p><code>mapping(address =&gt; uint256)</code> \u662f\u6700\u5e38\u89c1\u7684\u7528\u6cd5\u4e4b\u4e00\uff0c\u4f8b\u5982 ERC20 \u7684\u4f59\u989d\u8868\uff1a</p> <pre><code>mapping(address =&gt; uint256) public balanceOf;\n\nfunction mint(uint256 amount) external {\n    balanceOf[msg.sender] += amount;\n}\n</code></pre> <p>\u591a\u5c42 mapping\uff08\u6bd4\u5982 allowance\uff09\uff1a</p> <pre><code>mapping(address =&gt; mapping(address =&gt; uint256)) public allowance;\n\nfunction approve(address spender, uint256 amount) external {\n    allowance[msg.sender][spender] = amount;\n}\n</code></pre> <p><code>mapping</code> \u91cc\u7684 key \u7528 <code>address</code> \u975e\u5e38\u81ea\u7136\uff0c\u800c\u4e14\u4f1a\u81ea\u52a8\u521d\u59cb\u5316\u4e3a 0\uff0c\u4e0d\u5b58\u5728\u5219\u8fd4\u56de\u9ed8\u8ba4\u503c\u3002</p>"},{"location":"web3/dapp/address_240321/#32","title":"3.2 \u5730\u5740 + \u6570\u7ec4","text":"<p><code>address[]</code>\uff0c\u6570\u7ec4\u91cc\u7684\u5143\u7d20\u53ef\u4ee5\u662f <code>address</code> \u6216 <code>address payable</code>\uff0c\u770b\u4f60\u8981\u4e0d\u8981\u7ed9\u4ed6\u4eec\u8f6c\u8d26\u3002</p> <p>\u6bd4\u5982\u8bb0\u5f55\u6240\u6709\u5b58\u6b3e\u8fc7\u7684\u7528\u6237\uff1a</p> <pre><code>address[] public users;\nmapping(address =&gt; bool) public hasDeposited;\n\nfunction deposit() external payable {\n    if (!hasDeposited[msg.sender]) {\n        hasDeposited[msg.sender] = true;\n        users.push(msg.sender);\n    }\n}\n</code></pre>"},{"location":"web3/dapp/address_240321/#4","title":"4. \u7279\u6b8a\u5730\u5740","text":"<p><code>msg.sender</code> \u2013 \u5f53\u524d\u5408\u7ea6\u7684\u8c03\u7528\u8005\uff0c\u53ef\u80fd\u662f\u5916\u90e8\u8d26\u6237\uff0c\u4e5f\u53ef\u80fd\u662f\u53e6\u4e00\u4e2a\u5408\u7ea6\u3002</p> <p><code>tx.origin</code> \u2013 \u4ea4\u6613\u6700\u539f\u59cb\u53d1\u8d77\u4eba\uff0c\u5bb9\u6613\u88ab\u300c\u4e2d\u95f4\u5408\u7ea6\u300d\u9a97\u8c03\u7528\uff0c\u5bfc\u81f4\u9493\u9c7c\u653b\u51fb\uff0c\u6743\u9650\u63a7\u5236\u7528 <code>msg.sender</code> \u5c31\u591f\u4e86\u3002</p> <p><code>address(this)</code> - \u5408\u7ea6\u81ea\u5df1\u7684\u5730\u5740\u3002</p>"},{"location":"web3/dapp/ethereum_address_size_240320/","title":"\u4e3a\u4ec0\u4e48\u4ee5\u592a\u574a\u5730\u5740\u662f 20 \u5b57\u8282\uff1f\u4ece\u79c1\u94a5\u5230\u5730\u5740\u7684\u5168\u89e3\u6790","text":"<p> \u7ea6 816 \u4e2a\u5b57  40 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 3 \u5206\u949f</p>"},{"location":"web3/dapp/ethereum_address_size_240320/#1","title":"1. \u4ee5\u592a\u574a\u5730\u5740\u591a\u5927\uff1f","text":"<p>\u4ee5\u592a\u574a\u5730\u5740\u5927\u5c0f\uff1a20 \u5b57\u8282\uff08bytes\uff09 = 160 \u4f4d\uff08bits\uff09\uff0c\u5bf9\u5916\u901a\u5e38\u5199\u6210\uff1a<code>0x</code> + 40 \u4e2a\u5341\u516d\u8fdb\u5236\u5b57\u7b26</p> <ul> <li>\u6bcf\u4e2a\u5341\u516d\u8fdb\u5236\u5b57\u7b26\u662f 4 bit</li> <li>40 \u00d7 4 = 160 bit = 20 byte</li> </ul> <p>\u4f8b\u5982\uff1a0x28816c4c4792467390c90e5b426f198570e29307\uff0c\u53bb\u6389 <code>0x</code>\uff0c\u5269\u4e0b\u7684 40 \u4e2a Hex \u5b57\u7b26\uff0c\u5c31\u662f 20 \u5b57\u8282\u7684\u4e8c\u8fdb\u5236\u5730\u5740\u3002</p>"},{"location":"web3/dapp/ethereum_address_size_240320/#2-20","title":"2. \u4ece\u5bc6\u94a5\u5230\u5730\u5740\uff1a\u4e3a\u4ec0\u4e48\u662f 20 \u5b57\u8282\uff1f","text":"<p>\u4ee5\u592a\u574a\u8d26\u6237\u7684\u751f\u6210\u6d41\u7a0b\uff08\u5916\u90e8\u8d26\u6237 EOA\uff09\u5927\u81f4\u662f\u8fd9\u6837\uff1a</p> <ol> <li>\u751f\u6210\u4e00\u4e2a \u79c1\u94a5\uff08256 bit \u968f\u673a\u6570\uff09\uff1b</li> <li>\u7528 secp256k1 \u692d\u5706\u66f2\u7ebf\u7b97\u51fa \u516c\u94a5\uff0864 \u5b57\u8282\uff1ax\u3001y \u5404 32 \u5b57\u8282\uff09\uff1b</li> <li>\u5bf9\u516c\u94a5\u505a\u4e00\u6b21 Keccak-256 \u54c8\u5e0c\uff1a\u5f97\u5230 32 \u5b57\u8282\uff1b</li> <li>\u53d6\u54c8\u5e0c\u7ed3\u679c\u7684\u540e 20 \u5b57\u8282\uff08\u53f3\u8fb9 20 \u5b57\u8282\uff09\uff0c\u4f5c\u4e3a\u5730\u5740\uff1b</li> </ol> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502          \u79c1\u94a5 Private Key             \u2502\n\u2502     256-bit \u968f\u673a\u6570\uff0832 \u5b57\u8282\uff09           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                      \u2502\n                      \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         \u516c\u94a5 Public Key               \u2502\n\u2502 secp256k1 \u692d\u5706\u66f2\u7ebf\u63a8\u5bfc\u51fa 64 \u5b57\u8282\u5750\u6807     \u2502\n\u2502  \u516c\u94a5 = (x: 32 bytes, y: 32 bytes)    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                      \u2502\n                      \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502      Keccak-256 \u54c8\u5e0c\uff0832 \u5b57\u8282\uff09        \u2502\n\u2502 hash = keccak256(uncompressed_pubkey)\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                      \u2502\n                      \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       \u53d6\u54c8\u5e0c\u7ed3\u679c\u7684\u6700\u540e 20 \u5b57\u8282           \u2502\n\u2502     \uff08\u53f3 20 \u5b57\u8282 = 160 bit\uff09           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                      \u2502\n                      \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         \u4ee5\u592a\u574a\u5730\u5740 Ethereum Address    \u2502\n\u2502   0x + 40 \u4f4d\u5341\u516d\u8fdb\u5236\u5b57\u7b26\uff08= 20\u5b57\u8282\uff09     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>\u6240\u4ee5\u5730\u5740\u672c\u8d28\u4e0a\u662f\uff1a address = last_20_bytes( keccak256( public_key ) )</p> <p>\u95ee\u9898\uff1a\u4e3a\u4ec0\u4e48\u4e0d\u7528 32 \u5b57\u8282\uff0c\u975e\u8981\u622a\u65ad\u6210 20 \u5b57\u8282\uff1f</p> <p>\u7b80\u5355\u7406\u89e3\uff1a\u622a\u65ad\u4e00\u70b9 hash\uff0c\u5f53\u5730\u5740\u7528\uff0c\u591f\u7528 + \u597d\u7528 + \u8282\u7701\u8d44\u6e90\u3002</p> <p>\uff081\uff09\u77ed\u4e00\u70b9\uff0c\u65b9\u4fbf\u5c55\u793a\u4e0e\u8f93\u5165</p> <ul> <li> <p>32 \u5b57\u8282\u5730\u5740 \u2192 64 \u4e2a Hex \u5b57\u7b26</p> </li> <li> <p>20 \u5b57\u8282\u5730\u5740 \u2192 40 \u4e2a Hex \u5b57\u7b26</p> </li> </ul> <p>\u4ece\u524d\u7aef UI\u3001\u94b1\u5305\u663e\u793a\u3001\u7528\u6237\u590d\u5236\u7c98\u8d34\u7684\u4f53\u9a8c\u6765\u770b\uff0c40 \u4e2a\u5b57\u7b26\u5df2\u7ecf\u5f88\u957f\u4e86\uff0c64 \u4e2a\u66f4\u96be\u7528\u3002</p> <p>\uff082\uff09\u5b89\u5168\u6027\u4ecd\u7136\u8db3\u591f</p> <p>\u5730\u5740\u7a7a\u95f4\u6709 2\u00b9\u2076\u2070 \u2248 1.46 \u00d7 10\u2074\u2078 \u79cd\u53ef\u80fd\uff0c\u5373\u4f7f\u5168\u5730\u7403\u7b97\u529b\u7206\u70b8\u5f0f\u63d0\u9ad8\uff0c\u8981\u300c\u78b0\u649e\u300d\u4e00\u4e2a\u6307\u5b9a\u5730\u5740\u4e5f\u51e0\u4e4e\u4e0d\u53ef\u80fd\u3002</p> <p>\u771f\u6b63\u7684\u5b89\u5168\u6027\u74f6\u9888\u662f\uff1a\u79c1\u94a5\u662f\u5426\u771f\u7684\u968f\u673a &amp; \u662f\u5426\u88ab\u6cc4\u9732\uff0c\u800c\u4e0d\u662f\u300c\u5730\u5740\u591f\u4e0d\u591f\u957f\u300d\u3002</p> <p>\uff083\uff09\u5b58\u50a8\u7a7a\u95f4\u66f4\u5c0f</p> <p>\u72b6\u6001\u6811\uff08state trie\uff09\u3001\u4ea4\u6613\u7f16\u7801\u91cc\u5730\u5740\u8981\u5b58\u5f88\u591a\u6b21\uff0c20 \u5b57\u8282 \u00d7 N \u6b21\uff0c\u6bd4 32 \u5b57\u8282 \u00d7 N \u6b21\u7701\u7a7a\u95f4\u3001\u7701\u5e26\u5bbd\u3001\u7701\u5b58\u50a8\u3002</p>"},{"location":"web3/dapp/ethereum_address_size_240320/#3-solidity-address","title":"3. Solidity \u91cc\u7684 address \u5b9e\u9645\u5360\u591a\u5c11\u5b57\u8282\uff1f","text":"<p>\u8fd9\u91cc\u8981\u5206 \u201c\u6982\u5ff5\u4e0a\u7684\u5927\u5c0f\u201d \u548c \u201cEVM \u5b9e\u9645\u5b58\u50a8\u7684\u5927\u5c0f\u201d \u4e24\u5c42\u770b\u3002</p> <p>\u6982\u5ff5\u4e0a\uff1aaddress = 20 \u5b57\u8282</p> <p>\u5728 Solidity \u7c7b\u578b\u7cfb\u7edf\u91cc\uff1a</p> <pre><code>address         // 20 \u5b57\u8282\naddress payable // \u4e5f\u662f 20 \u5b57\u8282\uff0c\u53ea\u662f\u591a\u4e86\u8f6c\u8d26\u51fd\u6570\n</code></pre> <p>\u5b58\u50a8\u5728 EVM storage \u91cc\uff1a\u5360\u7528 32 \u5b57\u8282\u69fd\u4f4d</p> <p>EVM \u7684\u6700\u5c0f\u5b58\u50a8\u5355\u4f4d\u662f \u4e00\u4e2a storage slot = 32 \u5b57\u8282\uff08256 bit\uff09\uff0c\u5373\u4f7f\u53ea\u5b58\u4e00\u4e2a bool / uint8 / address\uff0c\u5b83\u9ed8\u8ba4\u4e5f\u5360\u7528\u4e00\u4e2a\u5b8c\u6574 32 \u5b57\u8282\u69fd\uff08\u9664\u975e\u7f16\u8bd1\u5668\u505a\u53d8\u91cf\u6253\u5305\uff09\u3002</p> <pre><code>contract Store {\n    address public owner;    // slot 0\uff0c\u5360 32 \u5b57\u8282\n    uint256 public value;    // slot 1\uff0c\u5360 32 \u5b57\u8282\n}\n</code></pre> <p>\u867d\u7136 address \u5b9e\u9645\u53ea\u7528\u6389 20 \u5b57\u8282\uff0c\u5176\u4f59 12 \u5b57\u8282\u662f\u586b\u5145\u7684\uff08\u901a\u5e38\u4e3a 0\uff09\uff0c\u4f46\uff1a</p> <ul> <li>\u5728 storage \u5c42\u9762\uff1a1 \u4e2a address = 1 \u4e2a slot = 32 \u5b57\u8282</li> <li>\u5728 \u8bed\u4e49\u5c42\u9762\uff1aaddress \u8fd8\u662f\u4ee3\u8868 20 \u5b57\u8282\u7684\u5730\u5740</li> </ul> <p>\u8fd9\u4e5f\u5c31\u662f\u4e3a\u4ec0\u4e48\u6709\u65f6\u5019\u8bb2\u300c\u5b58\u4e00\u4e2a\u5730\u5740\uff0cgas \u5f88\u8d35\u300d\uff0c\u56e0\u4e3a\u5b83\u4f1a\u89e6\u53d1\u4e00\u6b21 <code>SSTORE</code> \u5230\u65b0\u69fd\u4f4d\u3002</p> <p>\u5982\u679c\u53d8\u91cf\u6253\u5305\uff0c\u4f8b\u5982\uff1a</p> <pre><code>contract Packed {\n    address public owner;   // 20 bytes\n    uint96  public count;   // 12 bytes\n}\n</code></pre> <ul> <li>20 + 12 = 32 \u5b57\u8282</li> <li>\u7f16\u8bd1\u5668\u4f1a\u628a <code>owner</code> \u548c <code>count</code> \u585e\u8fdb\u540c\u4e00\u4e2a slot \u2192 \u4f9d\u7136\u662f 32 \u5b57\u8282\u4e00\u4e2a\u69fd\uff0c\u4f46\u5bb9\u7eb3\u4e86\u4e24\u4e2a\u5b57\u6bb5</li> </ul> <p>\u7ed3\u8bba\uff1a</p> <ul> <li>\u5355\u72ec\u770b\u7c7b\u578b\uff1aaddress = 20 bytes\uff1b</li> <li>\u5b58\u5728 storage\uff1a\u4e00\u822c\u5360 1 \u4e2a 32-byte slot\uff08\u9664\u975e packing\uff09\uff1b</li> </ul>"},{"location":"web3/dapp/ethereum_address_size_240320/#4-abi-calldata-memory","title":"4. \u5728 ABI / calldata / memory \u91cc\u7684\u5730\u5740\u5927\u5c0f","text":"<p>Solidity \u5bf9\u5916\u7f16\u7801\uff08ABI\uff09\u65f6\u5019\uff0c\u6709\u4e00\u4e2a\u89c4\u5219\uff1a\u6240\u6709\u503c\u7c7b\u578b\u6309 32 \u5b57\u8282\u5bf9\u9f50\u3002</p> <p>\u6240\u4ee5\u5728\u4ee5\u4e0b\u573a\u666f\u4e2d\uff1a</p> <ul> <li>\u51fd\u6570\u53c2\u6570\u7684 ABI \u7f16\u7801\uff08calldata\uff09\uff1b</li> <li>\u51fd\u6570\u8fd4\u56de\u503c\u7684 ABI \u7f16\u7801\uff1b</li> <li>event topics\uff08\u65e5\u5fd7\u91cc\uff09\uff1b</li> </ul> <p>\u4e00\u4e2a address \u901a\u5e38\u662f\u8fd9\u4e48\u8868\u793a\u7684\uff1a\u524d\u9762 12 \u5b57\u8282\u8865 0 + \u540e\u9762 20 \u5b57\u8282\u5730\u5740</p> <p>\u4f8b\u5982\u5730\u5740\uff1a0x28816c4c4792467390c90e5b426f198570e29307\uff0c\u5728 ABI \u7f16\u7801\u4e2d\uff0c\u4f1a\u88ab\u653e\u8fdb 32 \u5b57\u8282\uff1a</p> <pre><code>0x00000000000000000000000028816c4c4792467390c90e5b426f198570e29307\n  \u2191                       \u2191\n12 bytes 0              20 bytes address\n</code></pre> <p>\u7f16\u7801\u65f6\uff0c\u5360 32 \u5b57\u8282\uff08\u5bf9\u9f50\u5230 256 bit\uff09\uff0c\u8bed\u4e49\u4e0a\uff0c\u6709\u6548\u8f7d\u8377\u4ecd\u7136\u662f 20 \u5b57\u8282\u3002</p>"},{"location":"web3/dapp/evm_fundamentals_part1_from_transactions_to_bytecode_240410/","title":"EVM \u57fa\u7840\u539f\u7406\uff08\u4e00\uff09\uff1a\u4ece\u4ea4\u6613\u5230\u5b57\u8282\u7801","text":"<p> \u7ea6 2974 \u4e2a\u5b57  28 \u884c\u4ee3\u7801  5 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 10 \u5206\u949f</p> <p>\u672c\u6587\u662f EVM \u57fa\u7840\u539f\u7406\u7cfb\u5217\u7684\u7b2c\u4e00\u7bc7\uff0c\u5e2e\u52a9\u4f60\u5efa\u7acb\u5bf9\u4ee5\u592a\u574a\u865a\u62df\u673a\u7684\u6574\u4f53\u8ba4\u77e5\u3002</p> <p>\u4f5c\u4e3a Solidity \u5f00\u53d1\u8005\uff0c\u4f60\u53ef\u80fd\u5df2\u7ecf\u5199\u8fc7\u4e0d\u5c11\u5408\u7ea6\uff0c\u4f46\u6709\u6ca1\u6709\u60f3\u8fc7\uff1a\u5f53\u4f60\u70b9\u51fb \"Deploy\" \u7684\u90a3\u4e00\u523b\uff0c\u4ee3\u7801\u7a76\u7adf\u7ecf\u5386\u4e86\u4ec0\u4e48\uff1f</p> <pre><code>Solidity \u6e90\u7801 \u2192 \u7f16\u8bd1 \u2192 \u5b57\u8282\u7801 \u2192 \u90e8\u7f72\u4e0a\u94fe \u2192 EVM \u6267\u884c\n</code></pre> <p>EVM\uff08Ethereum Virtual Machine\uff09\u662f\u8fd9\u6761\u94fe\u8def\u7684\u7ec8\u70b9\uff0c\u4e5f\u662f\u771f\u6b63\u7684\u6267\u884c\u8005\u3002\u5b83\u4e0d\u8ba4\u8bc6 <code>function</code>\u3001<code>mapping</code> \u8fd9\u4e9b\u5173\u952e\u5b57\uff0c\u53ea\u8ba4\u8bc6\u4e00\u4e32\u5341\u516d\u8fdb\u5236\u7684\u5b57\u8282\u7801\u3002</p> <p>\u7406\u89e3 EVM \u7684\u5de5\u4f5c\u539f\u7406\uff0c\u662f\u5199\u51fa\u9ad8\u6548\u3001\u5b89\u5168\u5408\u7ea6\u7684\u57fa\u7840\u3002</p>"},{"location":"web3/dapp/evm_fundamentals_part1_from_transactions_to_bytecode_240410/#_1","title":"\u4e00\u3001\u4ee5\u592a\u574a\u662f\u4e00\u53f0\u72b6\u6001\u673a","text":"<p>\u4ee5\u592a\u574a\u7684\u672c\u8d28\u662f\u4e00\u53f0\u5168\u7403\u5171\u4eab\u7684\u72b6\u6001\u673a\uff0c\u901a\u8fc7\u4ea4\u6613\u9a71\u52a8\u72b6\u6001\u53d8\u5316\u3002</p> <p>\u4e09\u4e2a\u6838\u5fc3\u6982\u5ff5\uff1a</p> <ul> <li>\u72b6\u6001\uff1a\u6240\u6709\u8d26\u6237\u7684\u6570\u636e\u5feb\u7167\uff08\u4f59\u989d\u3001\u5408\u7ea6\u5b58\u50a8\u7b49\uff09</li> <li>\u4ea4\u6613\uff1a\u6539\u53d8\u72b6\u6001\u7684\u552f\u4e00\u65b9\u5f0f</li> <li>\u72b6\u6001\u8f6c\u6362\u51fd\u6570\uff1a\u7ed9\u5b9a\u5f53\u524d\u72b6\u6001 + \u4ea4\u6613 \u2192 \u8f93\u51fa\u65b0\u72b6\u6001</li> </ul> <p>\u7528\u516c\u5f0f\u8868\u8fbe\uff1a</p> <pre><code>APPLY(\u65e7\u72b6\u6001, \u4ea4\u6613) \u2192 \u65b0\u72b6\u6001 \u6216 \u9519\u8bef\n</code></pre> <p>\u6bcf\u4e2a\u533a\u5757\u5305\u542b\u4e00\u6279\u4ea4\u6613\uff0c\u6309\u987a\u5e8f\u6267\u884c\u540e\u4e16\u754c\u72b6\u6001\u66f4\u65b0\u3002\u6574\u4e2a\u4ee5\u592a\u574a\u7f51\u7edc\u5c31\u662f\u4e0d\u65ad\u91cd\u590d\u8fd9\u4e2a\u8fc7\u7a0b\u3002</p>"},{"location":"web3/dapp/evm_fundamentals_part1_from_transactions_to_bytecode_240410/#_2","title":"\u4e8c\u3001\u4e24\u79cd\u8d26\u6237","text":"<p>\u4ee5\u592a\u574a\u7684\u4e16\u754c\u72b6\u6001\u7531\u8d26\u6237\u7ec4\u6210\uff0c\u8d26\u6237\u5206\u4e24\u79cd\uff1a</p> \u7279\u6027 EOA\uff08\u5916\u90e8\u8d26\u6237\uff09 \u5408\u7ea6\u8d26\u6237 \u63a7\u5236\u8005 \u79c1\u94a5\u6301\u6709\u4eba \u4ee3\u7801\u903b\u8f91 \u6709\u65e0\u4ee3\u7801 \u65e0 \u6709 \u80fd\u5426\u53d1\u8d77\u4ea4\u6613 \u80fd \u4e0d\u80fd\uff08\u53ea\u80fd\u88ab\u8c03\u7528\uff09 \u4f8b\u5b50 \u4f60\u7684 MetaMask \u94b1\u5305 Uniswap \u5408\u7ea6 <p>\u6bcf\u4e2a\u8d26\u6237\u6709 4 \u4e2a\u5b57\u6bb5\uff1a</p> <pre><code>\u8d26\u6237 {\n    nonce,        // \u4ea4\u6613\u8ba1\u6570\uff08\u9632\u91cd\u653e\uff09\n    balance,      // ETH \u4f59\u989d\uff08\u5355\u4f4d\uff1awei\uff09\n    codeHash,     // \u4ee3\u7801\u54c8\u5e0c\uff08EOA \u4e3a\u7a7a\uff09\n    storageRoot   // \u5b58\u50a8\u6811\u6839\uff08\u5408\u7ea6\u6570\u636e\uff09\n}\n</code></pre> <p>\u5173\u952e\u70b9\uff1a\u5408\u7ea6\u8d26\u6237\u4e0d\u80fd\u4e3b\u52a8\u53d1\u8d77\u4ea4\u6613\uff0c\u5fc5\u987b\u7531 EOA \u89e6\u53d1\u3002\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\u6bcf\u7b14\u4ea4\u6613\u90fd\u9700\u8981\u4f60\u7528\u94b1\u5305\u7b7e\u540d\u3002</p>"},{"location":"web3/dapp/evm_fundamentals_part1_from_transactions_to_bytecode_240410/#_3","title":"\u4e09\u3001\u4ea4\u6613\u7684\u7ed3\u6784","text":"<p>\u5f53\u4f60\u8c03\u7528\u5408\u7ea6\u65f6\uff0c\u5b9e\u9645\u4e0a\u662f\u53d1\u9001\u4e86\u4e00\u7b14\u4ea4\u6613\u3002\u4ea4\u6613\u7684\u5173\u952e\u5b57\u6bb5\uff1a</p> <ul> <li>from\uff1a\u53d1\u9001\u8005\uff08\u5fc5\u987b\u662f EOA\uff09</li> <li>to\uff1a\u63a5\u6536\u8005\uff08\u5408\u7ea6\u5730\u5740\u6216 EOA\uff1b\u90e8\u7f72\u5408\u7ea6\u65f6\u4e3a\u7a7a\uff09</li> <li>value\uff1a\u8f6c\u8d26\u91d1\u989d\uff08\u5355\u4f4d\uff1awei\uff09</li> <li>data\uff1a\u8c03\u7528\u6570\u636e\uff08\u51fd\u6570\u9009\u62e9\u5668 + \u53c2\u6570\u7f16\u7801\uff09</li> <li>gasLimit\uff1a\u613f\u610f\u652f\u4ed8\u7684\u6700\u5927 Gas</li> <li>gasPrice\uff1a\u6bcf\u5355\u4f4d Gas \u7684\u4ef7\u683c</li> </ul> <p>\u4e24\u79cd\u4ea4\u6613\u7c7b\u578b\u7531 <code>to</code> \u5b57\u6bb5\u51b3\u5b9a\uff1a</p> <ul> <li><code>to</code> \u4e3a\u7a7a \u2192 \u521b\u5efa\u5408\u7ea6</li> <li><code>to</code> \u4e3a\u5408\u7ea6\u5730\u5740 \u2192 \u8c03\u7528\u5408\u7ea6</li> </ul>"},{"location":"web3/dapp/evm_fundamentals_part1_from_transactions_to_bytecode_240410/#_4","title":"\u56db\u3001\u4ea4\u6613\u6267\u884c\u6d41\u7a0b","text":"<p>\u4e00\u7b14\u4ea4\u6613\u4ece\u7b7e\u540d\u5230\u6539\u53d8\u72b6\u6001\uff0c\u7ecf\u5386\u4ee5\u4e0b\u6b65\u9aa4\uff1a</p> <ol> <li>\u9a8c\u8bc1\u4ea4\u6613\uff08\u7b7e\u540d\u3001nonce\u3001\u4f59\u989d\uff09</li> <li>\u9884\u6263 Gas \u8d39\u7528</li> <li>EVM \u6267\u884c\u4ea4\u6613</li> <li>\u6210\u529f\uff1a\u66f4\u65b0\u72b6\u6001\uff0c\u9000\u8fd8\u5269\u4f59 Gas\uff1b\u5931\u8d25\uff1a\u56de\u6eda\u72b6\u6001\uff0cGas \u4e0d\u9000</li> </ol> <p>\u539f\u5b50\u6027\uff1a\u4ea4\u6613\u8981\u4e48\u5b8c\u5168\u6210\u529f\uff0c\u8981\u4e48\u5b8c\u5168\u5931\u8d25\uff0c\u6ca1\u6709\u4e2d\u95f4\u72b6\u6001\u3002</p>"},{"location":"web3/dapp/evm_fundamentals_part1_from_transactions_to_bytecode_240410/#gas","title":"\u4e94\u3001Gas\uff1a\u8ba1\u7b97\u7684\u71c3\u6599","text":"<p>EVM \u6267\u884c\u6bcf\u4e00\u6b65\u64cd\u4f5c\u90fd\u9700\u8981\u6d88\u8017 Gas\u3002\u8fd9\u4e2a\u8bbe\u8ba1\u6709\u4e09\u4e2a\u76ee\u7684\uff1a</p> <ol> <li>\u9632\u6b62\u65e0\u9650\u5faa\u73af\uff1a\u6ca1\u6709 Gas \u9650\u5236\uff0c\u6076\u610f\u4ee3\u7801\u53ef\u4ee5\u5361\u6b7b\u7f51\u7edc</li> <li>\u8d44\u6e90\u5b9a\u4ef7\uff1a\u4e0d\u540c\u64cd\u4f5c\u6d88\u8017\u4e0d\u540c\u8d44\u6e90\uff0c\u4ef7\u683c\u4e0d\u540c</li> <li>\u6fc0\u52b1\u77ff\u5de5\uff1aGas \u8d39\u652f\u4ed8\u7ed9\u533a\u5757\u751f\u4ea7\u8005</li> </ol> <p>Gas \u6210\u672c\u7684\u5927\u81f4\u5206\u7ea7\uff1a</p> \u7ea7\u522b Gas \u8303\u56f4 \u5178\u578b\u64cd\u4f5c \u4fbf\u5b9c 3-5 \u52a0\u51cf\u4e58\u9664\u3001\u6808\u64cd\u4f5c \u4e2d\u7b49 30-200 \u5185\u5b58\u64cd\u4f5c\u3001\u54c8\u5e0c \u6602\u8d35 100-2600 \u8bfb\u5b58\u50a8\uff08SLOAD\uff09 \u6781\u8d35 5000-20000+ \u5199\u5b58\u50a8\uff08SSTORE\uff09 <p>\u4e3a\u4ec0\u4e48\u5b58\u50a8\u64cd\u4f5c\u8fd9\u4e48\u8d35\uff1f\u56e0\u4e3a\u5b58\u50a8\u6570\u636e\u9700\u8981\u6c38\u4e45\u4fdd\u5b58\u5728\u533a\u5757\u94fe\u4e0a\uff0c\u6240\u6709\u8282\u70b9\u90fd\u8981\u5b58\u4e00\u4efd\u3002\u8fd9\u4e2a\u8bdd\u9898\u6211\u4eec\u5728\u7b2c\u4e8c\u7bc7\u8be6\u7ec6\u5c55\u5f00\u3002</p>"},{"location":"web3/dapp/evm_fundamentals_part1_from_transactions_to_bytecode_240410/#_5","title":"\u516d\u3001\u5b9e\u6218\uff1a\u8ffd\u8e2a\u4e00\u7b14\u4ea4\u6613","text":"<p>\u6765\u770b\u4e00\u4e2a\u5177\u4f53\u4f8b\u5b50\u3002\u90e8\u7f72\u8fd9\u4e2a\u7b80\u5355\u7684\u8ba1\u6570\u5668\u5408\u7ea6\uff1a</p> <pre><code>// SPDX-License-Identifier: MIT\npragma solidity ^0.8.24;\n\ncontract Counter {\n    uint256 public count;\n    address public immutable owner;\n\n    event Initialized(uint256 initialCount, address indexed owner);\n\n    constructor(uint256 initialCount, address initialOwner) {\n        owner = initialOwner;   // immutable\uff1a\u90e8\u7f72\u65f6\u786e\u5b9a\uff0c\u8fd0\u884c\u65f6\u4ece code \u4e2d\u8bfb\u53d6\n        count = initialCount;\n\n        emit Initialized(initialCount, initialOwner);\n    }\n\n    function increment() external {\n        count += 1;\n    }\n}\n</code></pre> <p>\u8c03\u7528 <code>increment()</code> \u540e\uff0c\u5728 Etherscan \u4e0a\u53ef\u4ee5\u770b\u5230\u4ea4\u6613\u7684 Input Data \u662f\uff1a<code>0xd09de08a</code> </p> <p>\u8fd9 4 \u4e2a\u5b57\u8282\u662f\u4ec0\u4e48\uff1f\u5b83\u662f <code>increment()</code> \u51fd\u6570\u7684\u9009\u62e9\u5668\uff0c\u8ba1\u7b97\u65b9\u5f0f\uff1a</p> <pre><code>keccak256(\"increment()\") \u7684\u524d 4 \u5b57\u8282 = 0xd09de08a\n</code></pre> <p>EVM \u5c31\u662f\u901a\u8fc7\u8fd9\u4e2a\u9009\u62e9\u5668\u6765\u8bc6\u522b\u4f60\u8981\u8c03\u7528\u54ea\u4e2a\u51fd\u6570\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u6df1\u5165\u5b57\u8282\u7801\u7684\u4e16\u754c\u3002</p>"},{"location":"web3/dapp/evm_fundamentals_part1_from_transactions_to_bytecode_240410/#_6","title":"\u4e03\u3001\u7f16\u8bd1\u4ea7\u51fa\uff1a\u4e24\u6bb5\u5b57\u8282\u7801","text":"<p>Solidity \u7f16\u8bd1\u540e\u4f1a\u4ea7\u51fa\u4e24\u6bb5\u5b57\u8282\u7801\uff1a</p> <p> </p>"},{"location":"web3/dapp/evm_fundamentals_part1_from_transactions_to_bytecode_240410/#creation-code","title":"Creation Code","text":"<p>Solidity \u6e90\u7801\u7f16\u8bd1\u540e\u4f1a\u751f\u6210 Creation Code\uff08\u521b\u5efa\u5b57\u8282\u7801\uff09\uff0c\u4e3b\u8981\u804c\u8d23\u5305\u62ec\uff1a</p> <ul> <li>\u89e3\u6790 constructor \u53c2\u6570</li> <li>\u6267\u884c constructor \u903b\u8f91</li> <li>\u521d\u59cb\u5316 storage\uff08\u5199\u5165\u72b6\u6001\u53d8\u91cf\u521d\u59cb\u503c\uff09</li> <li>\u5728\u6700\u540e <code>RETURN</code> \u51fa Runtime Code</li> </ul> <p>Creation Code \u53ea\u5728\u90e8\u7f72\u9636\u6bb5\u6267\u884c\u4e00\u6b21\uff0c\u6267\u884c\u5b8c\u6bd5\u540e\u8fd4\u56de Runtime Code\uff0c\u7136\u540e\u88ab\u4e22\u5f03\uff0c\u4e0d\u5b58\u50a8\u5728\u94fe\u4e0a\u3002</p>"},{"location":"web3/dapp/evm_fundamentals_part1_from_transactions_to_bytecode_240410/#runtime-code","title":"Runtime Code","text":"<p>Runtime Code \u662f Creation Code \u6267\u884c\u7ed3\u675f\u65f6\u8fd4\u56de\u7684\u5b57\u8282\u5e8f\u5217\uff0c\u6c38\u4e45\u5b58\u50a8\u5728\u94fe\u4e0a\uff0c\u540e\u7eed\u6240\u6709 <code>CALL / DELEGATECALL / STATICCALL</code> \u8c03\u7528\u90fd\u6267\u884c\u8fd9\u6bb5\u4ee3\u7801\u3002</p> <p>\u5b83\u4e0d\u5305\u542b constructor\uff0c\u65e0\u6cd5\u518d\u4fee\u6539\uff08\u4e0d\u53ef\u53d8\uff09\uff0c\u53ea\u8d1f\u8d23\u54cd\u5e94\u5916\u90e8\u51fd\u6570\u8c03\u7528\u3002</p> <p>\u4e00\u53e5\u8bdd\u603b\u7ed3\uff1aSolidity \u6e90\u7801\u5728\u7f16\u8bd1\u540e\u4f1a\u751f\u6210 Creation Code\uff0c\u5408\u7ea6\u90e8\u7f72\u7684\u8fc7\u7a0b\uff0c\u672c\u8d28\u4e0a\u5c31\u662f EVM \u6267\u884c Creation Code\uff0c\u800c\u8be5\u6267\u884c\u8fc7\u7a0b\u7684\u8fd4\u56de\u503c\u5c31\u662f\u6700\u7ec8\u88ab\u6c38\u4e45\u5b58\u50a8\u5728\u94fe\u4e0a\u7684 Runtime Code\u3002</p> <p>\u7c7b\u6bd4\uff1aCreation Code \u50cf\u662f\"\u5b89\u88c5\u7a0b\u5e8f\"\uff0c\u6267\u884c\u4e00\u6b21\u5c31\u5b8c\u6210\u4f7f\u547d\uff1bRuntime Code \u662f\"\u5df2\u5b89\u88c5\u7684\u8f6f\u4ef6\"\uff0c\u957f\u671f\u9a7b\u7559\u3002</p>"},{"location":"web3/dapp/evm_fundamentals_part1_from_transactions_to_bytecode_240410/#evm_1","title":"\u7528 EVM \u89c6\u89d2\u91cd\u65b0\u7406\u89e3\"\u90e8\u7f72\u5408\u7ea6\"","text":"<p>\u4ece EVM \u7684\u89d2\u5ea6\u770b\uff1a</p> <p>1.\u90e8\u7f72\u4ea4\u6613\u672c\u8eab\u4e5f\u662f\u4e00\u7b14\u666e\u901a\u4ea4\u6613</p> <p>2.<code>data</code> \u5b57\u6bb5\u4e2d\u643a\u5e26\u7684\u662f Creation Code</p> <p>3.EVM \u5728\u90e8\u7f72\u9636\u6bb5\uff1a</p> <ul> <li>\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u7a7a\u5408\u7ea6\u8d26\u6237</li> <li>\u6267\u884c Creation Code</li> <li>\u5c06 <code>RETURN</code> \u7684\u5b57\u8282\u7801\u4fdd\u5b58\u4e3a\u8be5\u8d26\u6237\u7684 <code>code</code></li> </ul> <p>\u7528\u4e00\u53e5\u975e\u5e38\"EVM \u5473\"\u7684\u8bdd\u8bf4\u5c31\u662f\uff1a</p> <p>Deploy = execute init code, store returned bytes as account.code</p>"},{"location":"web3/dapp/evm_fundamentals_part1_from_transactions_to_bytecode_240410/#_7","title":"\u52a8\u624b\u9a8c\u8bc1\uff1a\u67e5\u770b\u4e09\u79cd\u5b57\u8282\u7801","text":"<p>\u524d\u9762\u4ecb\u7ecd\u4e86 Creation Code \u548c Runtime Code\uff0c\u73b0\u5728\u901a\u8fc7 Remix \u5b9e\u9645\u67e5\u770b\u5b83\u4eec\u7684\u6837\u5b50\u3002</p> <p>\u5728\u5b9e\u9645\u90e8\u7f72\u65f6\uff0c\u8fd8\u6709\u4e00\u4e2a\u6982\u5ff5\u9700\u8981\u4e86\u89e3\uff1aInit Code\u3002</p> <ul> <li>Creation Code\uff1aSolidity \u7f16\u8bd1\u5668\u751f\u6210\u7684\u90e8\u7f72\u5b57\u8282\u7801</li> <li>Init Code\uff1a\u5b9e\u9645\u53d1\u9001\u5230\u94fe\u4e0a\u6267\u884c\u7684\u5b8c\u6574\u90e8\u7f72\u6570\u636e\uff0cInit Code = Creation Code + ABI \u7f16\u7801\u7684\u6784\u9020\u51fd\u6570\u53c2\u6570</li> </ul> <p>\u5982\u679c\u5408\u7ea6\u6ca1\u6709\u6784\u9020\u51fd\u6570\u53c2\u6570\uff0c\u4e24\u8005\u5b8c\u5168\u76f8\u540c\uff1b\u5982\u679c\u6709\u53c2\u6570\uff0cInit Code \u4f1a\u5728 Creation Code \u672b\u5c3e\u9644\u52a0\u53c2\u6570\u6570\u636e\u3002Init Code \u662f\u4ee5\u592a\u574a\u9ec4\u76ae\u4e66\u548c EVM \u89c4\u8303\u4e2d\u4f7f\u7528\u7684\u672f\u8bed\uff0c\u672c\u7cfb\u5217\u540e\u7eed\u5185\u5bb9\u9075\u5faa EVM \u89c4\u8303\uff0c\u4f7f\u7528 Init Code \u672f\u8bed\u3002</p> <p>\uff081\uff09\u5728 Remix \u4e2d\u67e5\u770b\u5b57\u8282\u7801</p> <p>\u4ee5\u524d\u9762\u7684 Counter \u5408\u7ea6\u4e3a\u4f8b\uff0c\u8fd9\u4e2a\u5408\u7ea6\u6709\u4e24\u4e2a\u6784\u9020\u51fd\u6570\u53c2\u6570\uff08<code>initialCount</code> \u548c <code>initialOwner</code>\uff09\u3002</p> <p>\u5728 Remix \u4e2d\u521b\u5efa\u3001\u7f16\u8bd1\u5408\u7ea6\u540e\uff0c\u70b9\u51fb Compilation Details \u6309\u94ae\uff08\u5728 Compile \u6309\u94ae\u5bf9\u5e94\u754c\u9762\uff09\uff0c\u4f1a\u5f39\u51fa\u4e00\u4e2a\u8be6\u60c5\u7a97\u53e3\u3002\u5728\u8fd9\u4e2a\u7a97\u53e3\u4e2d\u53ef\u4ee5\u770b\u5230\uff1a</p> \u5b57\u6bb5 \u5bf9\u5e94\u5185\u5bb9 BYTECODE \u2192 object Creation Code RUNTIME BYTECODE \u2192 object Runtime Code <p></p> <p>\u70b9\u51fb BYTECODE \u65c1\u8fb9\u7684\u590d\u5236\u56fe\u6807\uff0c\u5f97\u5230\u4e00\u4e2a JSON \u5bf9\u8c61\uff1a</p> <pre><code>{\n  \"functionDebugData\": {},\n  \"generatedSources\": [...],\n  \"linkReferences\": {},\n  \"object\": \"60a0604052...\",  // \u2190 \u8fd9\u5c31\u662f Creation Code\n  \"opcodes\": \"PUSH1 0xA0 PUSH1 0x40 ...\",\n  \"sourceMap\": \"...\"\n}\n</code></pre> <p><code>object</code> \u5b57\u6bb5\u7684\u503c\u5c31\u662f Creation Code\uff08\u5341\u516d\u8fdb\u5236\u5b57\u7b26\u4e32\uff09\u3002</p> <p>\u540c\u6837\uff0c\u590d\u5236 RUNTIME BYTECODE\uff0c\u5176\u4e2d\u7684 <code>object</code> \u5b57\u6bb5\u5c31\u662f Runtime Code\u3002</p> <p>\u4ee5\u4e0b\u662f\u4f7f\u7528 Solidity 0.8.25 \u7f16\u8bd1\u540e\u7684\u5b9e\u9645\u5b57\u8282\u7801\uff08\u53ef\u80fd\u56e0\u7f16\u8bd1\u5668\u7248\u672c\u548c\u4f18\u5316\u8bbe\u7f6e\u7565\u6709\u4e0d\u540c\uff09\uff1a</p> <p>Creation Code\uff08\u7f16\u8bd1\u4ea7\u51fa\uff09\uff1a</p> <pre><code>60a060405234801561000f575f80fd5b506040516103b93803806103b983398181016040528101906100319190610151565b8073ffffffffffffffffffffffffffffffffffffffff1660808173ffffffffffffffffffffffffffffffffffffffff1681525050815f819055508073ffffffffffffffffffffffffffffffffffffffff167fa7a5b80bcd3bef76524ec80559f1ad1932344089b316a7be619ed23956b5ad6c836040516100b1919061019e565b60405180910390a250506101b7565b5f80fd5b5f819050919050565b6100d6816100c4565b81146100e0575f80fd5b50565b5f815190506100f1816100cd565b92915050565b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f610120826100f7565b9050919050565b61013081610116565b811461013a575f80fd5b50565b5f8151905061014b81610127565b92915050565b5f8060408385031215610167576101666100c0565b5b5f610174858286016100e3565b92505060206101858582860161013d565b9150509250929050565b610198816100c4565b82525050565b5f6020820190506101b15f83018461018f565b92915050565b6080516101eb6101ce5f395f609001526101eb5ff3fe608060405234801561000f575f80fd5b506004361061003f575f3560e01c806306661abd146100435780638da5cb5b14610061578063d09de08a1461007f575b5f80fd5b61004b610089565b60405161005891906100e4565b60405180910390f35b61006961008e565b604051610076919061013c565b60405180910390f35b6100876100b2565b005b5f5481565b7f000000000000000000000000000000000000000000000000000000000000000081565b60015f808282546100c39190610182565b92505081905550565b5f819050919050565b6100de816100cc565b82525050565b5f6020820190506100f75f8301846100d5565b92915050565b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f610126826100fd565b9050919050565b6101368161011c565b82525050565b5f60208201905061014f5f83018461012d565b92915050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f61018c826100cc565b9150610197836100cc565b92508282019050808211156101af576101ae610155565b5b9291505056fea26469706673582212205e4cbff569d629a1f295a09c80bb97e55d3dde1d2d301c4b1863f0f00f0b34e464736f6c63430008190033\n</code></pre> <p>\u8fd9\u6bb5\u4ee3\u7801\u5305\u542b\uff1a\u6784\u9020\u51fd\u6570\u903b\u8f91\u3001\u53c2\u6570\u89e3\u6790\u4ee3\u7801\u3001\u6700\u7ec8 RETURN Runtime Code \u7684\u903b\u8f91\u3002\u957f\u5ea6\uff1a953 \u5b57\u8282\uff081906 \u4e2a\u5341\u516d\u8fdb\u5236\u5b57\u7b26\uff09\u3002</p> <p>Runtime Code\uff08\u90e8\u7f72\u540e\u6c38\u4e45\u5b58\u50a8\u5728\u94fe\u4e0a\uff09\uff1a</p> <pre><code>608060405234801561000f575f80fd5b506004361061003f575f3560e01c806306661abd146100435780638da5cb5b14610061578063d09de08a1461007f575b5f80fd5b61004b610089565b60405161005891906100e4565b60405180910390f35b61006961008e565b604051610076919061013c565b60405180910390f35b6100876100b2565b005b5f5481565b7f000000000000000000000000000000000000000000000000000000000000000081565b60015f808282546100c39190610182565b92505081905550565b5f819050919050565b6100de816100cc565b82525050565b5f6020820190506100f75f8301846100d5565b92915050565b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f610126826100fd565b9050919050565b6101368161011c565b82525050565b5f60208201905061014f5f83018461012d565b92915050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f61018c826100cc565b9150610197836100cc565b92508282019050808211156101af576101ae610155565b5b9291505056fea26469706673582212205e4cbff569d629a1f295a09c80bb97e55d3dde1d2d301c4b1863f0f00f0b34e464736f6c63430008190033\n</code></pre> <p>\u8fd9\u6bb5\u4ee3\u7801\u53ea\u5305\u542b\uff1a\u51fd\u6570\u8c03\u5ea6\u5668\uff08dispatcher\uff09\u3001<code>count()</code> \u51fd\u6570\u903b\u8f91\u3001<code>owner()</code> \u51fd\u6570\u903b\u8f91\u3001<code>increment()</code> \u51fd\u6570\u903b\u8f91\u3002\u957f\u5ea6\uff1a491 \u5b57\u8282\uff08982 \u4e2a\u5341\u516d\u8fdb\u5236\u5b57\u7b26\uff09\u3002</p> <p>\u6ce8\u610f\uff1aRuntime Code \u4e2d\u4e0d\u5305\u542b\u6784\u9020\u51fd\u6570\uff0c\u56e0\u4e3a\u6784\u9020\u51fd\u6570\u53ea\u6267\u884c\u4e00\u6b21\u3002\u53ef\u4ee5\u770b\u5230 Runtime Code \u6bd4 Creation Code \u77ed\u4e86\u5c06\u8fd1\u4e00\u534a\u3002</p> <p>\uff082\uff09\u6784\u9020 Init Code</p> <p>\u6b65\u9aa4 1\uff1a\u51c6\u5907\u6784\u9020\u51fd\u6570\u53c2\u6570</p> <p>\u5047\u8bbe\u6211\u4eec\u90e8\u7f72\u65f6\u4f20\u5165\uff1a</p> <ul> <li><code>initialCount = 100</code></li> <li><code>initialOwner = 0x1d477b7733Fe1347eE91e8D15f8c7f203E147AA0</code></li> </ul> <p>\u6b65\u9aa4 2\uff1aABI \u7f16\u7801\u53c2\u6570</p> <p>\u6784\u9020\u51fd\u6570\u53c2\u6570\u9700\u8981\u6309 ABI \u89c4\u5219\u7f16\u7801\uff1a</p> <pre><code>// uint256(100) = 0x64\uff0c\u5de6\u586b\u5145\u96f6\u5230 32 \u5b57\u8282\n0000000000000000000000000000000000000000000000000000000000000064\n\n// address\uff0c\u5de6\u586b\u5145\u96f6\u5230 32 \u5b57\u8282\n0000000000000000000000001d477b7733Fe1347eE91e8D15f8c7f203E147AA0\n</code></pre> <p>\u4e24\u4e2a\u53c2\u6570\u62fc\u63a5\u540e\uff0864 \u5b57\u8282 = 128 \u4e2a\u5341\u516d\u8fdb\u5236\u5b57\u7b26\uff09\uff1a</p> <pre><code>00000000000000000000000000000000000000000000000000000000000000640000000000000000000000001d477b7733Fe1347eE91e8D15f8c7f203E147AA0\n</code></pre> <p>\u6b65\u9aa4 3\uff1a\u62fc\u63a5\u5f97\u5230 Init Code</p> <p>Init Code = Creation Code + \u6784\u9020\u51fd\u6570\u53c2\u6570\u7f16\u7801</p> <p>\u5b8c\u6574\u7684 Init Code\uff081017 \u5b57\u8282 = 2034 \u4e2a\u5341\u516d\u8fdb\u5236\u5b57\u7b26\uff09\uff1a</p> <pre><code>60a060405234801561000f575f80fd5b506040516103b93803806103b983398181016040528101906100319190610151565b8073ffffffffffffffffffffffffffffffffffffffff1660808173ffffffffffffffffffffffffffffffffffffffff1681525050815f819055508073ffffffffffffffffffffffffffffffffffffffff167fa7a5b80bcd3bef76524ec80559f1ad1932344089b316a7be619ed23956b5ad6c836040516100b1919061019e565b60405180910390a250506101b7565b5f80fd5b5f819050919050565b6100d6816100c4565b81146100e0575f80fd5b50565b5f815190506100f1816100cd565b92915050565b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f610120826100f7565b9050919050565b61013081610116565b811461013a575f80fd5b50565b5f8151905061014b81610127565b92915050565b5f8060408385031215610167576101666100c0565b5b5f610174858286016100e3565b92505060206101858582860161013d565b9150509250929050565b610198816100c4565b82525050565b5f6020820190506101b15f83018461018f565b92915050565b6080516101eb6101ce5f395f609001526101eb5ff3fe608060405234801561000f575f80fd5b506004361061003f575f3560e01c806306661abd146100435780638da5cb5b14610061578063d09de08a1461007f575b5f80fd5b61004b610089565b60405161005891906100e4565b60405180910390f35b61006961008e565b604051610076919061013c565b60405180910390f35b6100876100b2565b005b5f5481565b7f000000000000000000000000000000000000000000000000000000000000000081565b60015f808282546100c39190610182565b92505081905550565b5f819050919050565b6100de816100cc565b82525050565b5f6020820190506100f75f8301846100d5565b92915050565b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f610126826100fd565b9050919050565b6101368161011c565b82525050565b5f60208201905061014f5f83018461012d565b92915050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f61018c826100cc565b9150610197836100cc565b92508282019050808211156101af576101ae610155565b5b9291505056fea26469706673582212205e4cbff569d629a1f295a09c80bb97e55d3dde1d2d301c4b1863f0f00f0b34e464736f6c6343000819003300000000000000000000000000000000000000000000000000000000000000640000000000000000000000001d477b7733Fe1347eE91e8D15f8c7f203E147AA0\n</code></pre> <p>\u957f\u5ea6\u9a8c\u8bc1\uff1a953\uff08Creation Code\uff09+ 64\uff08\u53c2\u6570\uff09= 1017 \u5b57\u8282 \u2713</p> <p>\uff083\uff09\u5728 Etherscan \u4e0a\u9a8c\u8bc1</p> <p>\u5728 Etherscan \u4e0a\u67e5\u770b\u90e8\u7f72\u4ea4\u6613\u8be6\u60c5\uff0cinput \u5b57\u6bb5\u7684\u5185\u5bb9\u5c31\u662f Init Code\uff08Creation Code + \u53c2\u6570\u7f16\u7801\uff09\uff1a</p> <p></p> <p>\u90e8\u7f72\u6210\u529f\u540e\uff0c\u67e5\u770b\u5408\u7ea6\u9875\u9762\uff1a</p> <ul> <li>Contract Creation Code \u663e\u793a\u7684\u662f Init Code</li> <li>Deployed Bytecode \u663e\u793a\u7684\u662f Runtime Code</li> </ul> <p></p> <p>\uff084\uff09\u5e38\u89c1\u95ee\u9898</p> <p>Q1\uff1a\u4e3a\u4ec0\u4e48 Runtime Code \u6bd4 Creation Code \u77ed\uff1f</p> <p>Creation Code \u5305\u542b\u6784\u9020\u51fd\u6570\u903b\u8f91\u548c\u53c2\u6570\u89e3\u6790\u4ee3\u7801\uff0c\u8fd9\u4e9b\u53ea\u5728\u90e8\u7f72\u65f6\u6267\u884c\u4e00\u6b21\u3002Runtime Code \u53ea\u4fdd\u7559\u8fd0\u884c\u65f6\u9700\u8981\u7684\u51fd\u6570\uff0c\u6240\u4ee5\u901a\u5e38\u66f4\u77ed\u3002\u5728\u672c\u4f8b\u4e2d\uff0cRuntime Code\uff08491 \u5b57\u8282\uff09\u5927\u7ea6\u53ea\u6709 Creation Code\uff08953 \u5b57\u8282\uff09\u7684\u4e00\u534a\u5927\u5c0f\u3002</p> <p>Q2\uff1aimmutable \u53d8\u91cf\u5b58\u5728\u54ea\u91cc\uff1f</p> <p><code>immutable</code> \u53d8\u91cf\u5728\u90e8\u7f72\u65f6\u786e\u5b9a\u503c\uff0c\u76f4\u63a5\u5d4c\u5165\u5230 Runtime Code \u4e2d\u3002\u6240\u4ee5\u6bcf\u6b21\u90e8\u7f72\u53c2\u6570\u4e0d\u540c\uff0cRuntime Code \u4e5f\u4f1a\u7565\u6709\u4e0d\u540c\u3002</p>"},{"location":"web3/dapp/evm_fundamentals_part1_from_transactions_to_bytecode_240410/#evm_2","title":"\u516b\u3001EVM \u6267\u884c\u6a21\u578b","text":"<p>EVM \u662f\u57fa\u4e8e\u6808\u7684\u865a\u62df\u673a\u3002\u6808\u662f\u4e00\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u5c31\u50cf\u4e00\u645e\u76d8\u5b50\u2014\u2014\u53ea\u80fd\u4ece\u9876\u90e8\u653e\u5165\u6216\u53d6\u51fa\u3002</p> <p>EVM \u6808\u7684\u7279\u6027\uff1a</p> <ul> <li>\u6bcf\u4e2a\u5143\u7d20 256 \u4f4d\uff0832 \u5b57\u8282\uff09</li> <li>\u6700\u5927\u6df1\u5ea6 1024</li> <li>\u53ea\u80fd\u64cd\u4f5c\u9876\u90e8 16 \u4e2a\u5143\u7d20\uff08\u8fd9\u662f\u786c\u9650\u5236\uff09</li> </ul> <p></p> <p>EVM \u6267\u884c\u5b57\u8282\u7801\u7684\u8fc7\u7a0b\uff1a</p> <ol> <li>\u8bfb\u53d6\u5f53\u524d\u4f4d\u7f6e\u7684\u64cd\u4f5c\u7801</li> <li>\u6267\u884c\u8be5\u64cd\u4f5c\u7801</li> <li>\u6263\u9664 Gas</li> <li>\u79fb\u52a8\u5230\u4e0b\u4e00\u4e2a\u4f4d\u7f6e</li> <li>\u91cd\u590d\uff0c\u76f4\u5230\u9047\u5230 STOP/RETURN/REVERT \u6216 Gas \u8017\u5c3d</li> </ol> <p>\u7a0b\u5e8f\u8ba1\u6570\u5668\uff08PC\uff09\uff1a\u8bb0\u5f55\u5f53\u524d\u6267\u884c\u5230\u54ea\u4e2a\u4f4d\u7f6e\u3002\u9047\u5230\u8df3\u8f6c\u6307\u4ee4\u65f6\uff0cPC \u4f1a\u6539\u53d8\u3002</p>"},{"location":"web3/dapp/evm_fundamentals_part1_from_transactions_to_bytecode_240410/#evm_3","title":"\u4e5d\u3001\u64cd\u4f5c\u7801\uff1aEVM \u7684\u6307\u4ee4\u96c6","text":"<p>\u64cd\u4f5c\u7801\uff08Opcode\uff09\u662f EVM \u80fd\u7406\u89e3\u7684\u6700\u5c0f\u6307\u4ee4\u3002\u6bcf\u4e2a\u64cd\u4f5c\u7801\u5360 1 \u5b57\u8282\uff0c\u6240\u4ee5\u6700\u591a 256 \u79cd\uff0c\u76ee\u524d\u4f7f\u7528\u7ea6 140 \u79cd\u3002</p>"},{"location":"web3/dapp/evm_fundamentals_part1_from_transactions_to_bytecode_240410/#_8","title":"\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u4f8b\u5b50","text":"<p>\u8fd9\u6bb5\u5b57\u8282\u7801\u8ba1\u7b97 1 + 1\uff1a</p> <pre><code>6001 6001 01\n</code></pre> <p>\u62c6\u89e3\uff1a</p> \u5b57\u8282\u7801 \u64cd\u4f5c\u7801 \u542b\u4e49 60 01 PUSH1 0x01 \u628a 1 \u538b\u5165\u6808 60 01 PUSH1 0x01 \u628a 1 \u538b\u5165\u6808 01 ADD \u5f39\u51fa\u4e24\u4e2a\u503c\uff0c\u76f8\u52a0\uff0c\u7ed3\u679c\u538b\u5165\u6808 <p>\u6267\u884c\u8fc7\u7a0b\uff1a</p> <pre><code>\u521d\u59cb:     []\nPUSH1 1: [1]\nPUSH1 1: [1, 1]\nADD:     [2]       \u2190 1+1 \u7684\u7ed3\u679c\n</code></pre>"},{"location":"web3/dapp/evm_fundamentals_part1_from_transactions_to_bytecode_240410/#_9","title":"\u5e38\u7528\u6838\u5fc3\u64cd\u4f5c\u7801","text":"\u7c7b\u522b \u64cd\u4f5c\u7801 \u529f\u80fd \u7b97\u672f ADD, SUB, MUL, DIV \u57fa\u672c\u8fd0\u7b97 \u6bd4\u8f83 LT, GT, EQ \u5c0f\u4e8e\u3001\u5927\u4e8e\u3001\u7b49\u4e8e \u6808\u64cd\u4f5c PUSH, POP, DUP, SWAP \u538b\u5165\u3001\u5f39\u51fa\u3001\u590d\u5236\u3001\u4ea4\u6362 \u5185\u5b58 MLOAD, MSTORE \u8bfb\u5199\u5185\u5b58 \u5b58\u50a8 SLOAD, SSTORE \u8bfb\u5199\u5b58\u50a8\uff08\u5f88\u8d35\uff01\uff09 \u73af\u5883 CALLER, CALLVALUE msg.sender, msg.value \u6d41\u7a0b JUMP, JUMPI, RETURN, REVERT \u8df3\u8f6c\u3001\u8fd4\u56de\u3001\u56de\u6eda <p>Gas \u5dee\u5f02\u9884\u544a\uff1aMLOAD \u53ea\u8981 3 Gas\uff0cSLOAD \u8981 100-2100 Gas\u3002\u4e3a\u4ec0\u4e48\u5dee\u8fd9\u4e48\u591a\uff1f\u4e0b\u4e00\u7bc7\u63ed\u6653\u3002</p> <p>\u5b8c\u6574\u64cd\u4f5c\u7801\u5217\u8868\uff1ahttps://www.evm.codes/</p>"},{"location":"web3/dapp/evm_fundamentals_part1_from_transactions_to_bytecode_240410/#evm_4","title":"\u5341\u3001\u51fd\u6570\u9009\u62e9\u5668\uff1aEVM \u5982\u4f55\u8def\u7531\uff1f","text":"<p>\u4e00\u4e2a\u5408\u7ea6\u6709\u591a\u4e2a\u51fd\u6570\uff0cEVM \u600e\u4e48\u77e5\u9053\u8c03\u7528\u54ea\u4e2a\uff1f</p>"},{"location":"web3/dapp/evm_fundamentals_part1_from_transactions_to_bytecode_240410/#_10","title":"\u9009\u62e9\u5668\u7684\u8ba1\u7b97","text":"<p>\u6bcf\u4e2a\u51fd\u6570\u6709\u4e00\u4e2a 4 \u5b57\u8282\u7684\"\u8eab\u4efd\u8bc1\" \u2014\u2014 \u51fd\u6570\u9009\u62e9\u5668\uff1a</p> <pre><code>\u9009\u62e9\u5668 = keccak256(\"\u51fd\u6570\u7b7e\u540d\") \u7684\u524d 4 \u5b57\u8282\n</code></pre> <p>\u4f8b\u5982\uff1a</p> <pre><code>keccak256(\"increment()\") \u2192 0xd09de08a...\nkeccak256(\"count()\")     \u2192 0x06661abd...\n</code></pre>"},{"location":"web3/dapp/evm_fundamentals_part1_from_transactions_to_bytecode_240410/#_11","title":"\u8def\u7531\u903b\u8f91","text":"<p>\u5408\u7ea6\u5b57\u8282\u7801\u5f00\u5934\u6709\u4e00\u6bb5 dispatcher\uff08\u8c03\u5ea6\u5668\uff09\uff0c\u903b\u8f91\u5982\u4e0b\uff1a</p> <ol> <li>\u4ece calldata \u53d6\u524d 4 \u5b57\u8282\u4f5c\u4e3a selector</li> <li>\u4f9d\u6b21\u4e0e\u6bcf\u4e2a\u51fd\u6570\u7684\u9009\u62e9\u5668\u6bd4\u8f83</li> <li>\u5339\u914d \u2192 \u8df3\u8f6c\u5230\u5bf9\u5e94\u51fd\u6570\u4ee3\u7801</li> <li>\u90fd\u4e0d\u5339\u914d \u2192 \u6267\u884c fallback \u6216 revert</li> </ol> <p>\u7528\u64cd\u4f5c\u7801\u8868\u793a\u7684\u6838\u5fc3\u6d41\u7a0b\uff1a</p> <pre><code>PUSH1 0x00\nCALLDATALOAD     // \u52a0\u8f7d calldata \u524d 32 \u5b57\u8282\nPUSH1 0xe0\nSHR              // \u53f3\u79fb 224 \u4f4d\uff0c\u5f97\u5230\u524d 4 \u5b57\u8282\nDUP1\nPUSH4 0xd09de08a // increment() \u7684\u9009\u62e9\u5668\nEQ               // \u6bd4\u8f83\u662f\u5426\u76f8\u7b49\nPUSH2 0x0045     // increment() \u4ee3\u7801\u4f4d\u7f6e\nJUMPI            // \u76f8\u7b49\u5219\u8df3\u8f6c\n</code></pre> <p>\u8fd9\u5c31\u89e3\u91ca\u4e86\u4e3a\u4ec0\u4e48\u8c03\u7528 <code>increment()</code> \u65f6\uff0c\u4ea4\u6613\u7684 input \u662f <code>0xd09de08a</code>\u3002</p>"},{"location":"web3/dapp/evm_fundamentals_part1_from_transactions_to_bytecode_240410/#_12","title":"\u5c0f\u7ed3","text":"<p>\u672c\u6587\u4ecb\u7ecd\u4e86 EVM \u7684\u6838\u5fc3\u6982\u5ff5\uff1a</p> <ol> <li>\u4ee5\u592a\u574a\u662f\u4ea4\u6613\u9a71\u52a8\u7684\u72b6\u6001\u673a</li> <li>\u8d26\u6237\u5206 EOA \u548c\u5408\u7ea6\u8d26\u6237\u4e24\u79cd</li> <li>\u4ea4\u6613\u662f\u6539\u53d8\u72b6\u6001\u7684\u552f\u4e00\u65b9\u5f0f</li> <li>Gas \u662f\u8ba1\u7b97\u8d44\u6e90\u7684\u5ea6\u91cf\u5355\u4f4d</li> <li>\u7f16\u8bd1\u4ea7\u51fa Creation Code \u548c Runtime Code\uff0c\u52a8\u624b\u9a8c\u8bc1\u4e86\u5b83\u4eec\u4e0e Init Code \u7684\u533a\u522b</li> <li>EVM \u662f\u57fa\u4e8e\u6808\u7684\u865a\u62df\u673a\uff0c\u901a\u8fc7\u64cd\u4f5c\u7801\u6267\u884c\u8ba1\u7b97</li> <li>\u51fd\u6570\u9009\u62e9\u5668\u7528\u4e8e\u8def\u7531\u5230\u6b63\u786e\u7684\u51fd\u6570</li> </ol> <p>\u4e0b\u4e00\u7bc7\uff0c\u6211\u4eec\u5c06\u6df1\u5165 EVM \u7684\u4e09\u4e2a\u6570\u636e\u533a\u57df\u2014\u2014\u6808\u3001\u5185\u5b58\u3001\u5b58\u50a8\uff0c\u7406\u89e3\u5b83\u4eec\u7684\u6210\u672c\u5dee\u5f02\u548c\u4f18\u5316\u7b56\u7565\u3002</p> <p>\u7cfb\u5217\u5bfc\u822a\uff1a</p> <ul> <li>\u7b2c\u4e00\u7bc7\uff1aEVM \u57fa\u7840\u539f\u7406\uff08\u4e00\uff09\uff1a\u4ece\u4ea4\u6613\u5230\u5b57\u8282\u7801\uff08\u672c\u7bc7\uff09</li> <li>\u7b2c\u4e8c\u7bc7\uff1aEVM \u57fa\u7840\u539f\u7406\uff08\u4e8c\uff09\uff1aEVM \u6570\u636e\u533a\u57df\u4e0e\u5408\u7ea6\u6267\u884c</li> <li>\u7b2c\u4e09\u7bc7\uff1aEVM \u57fa\u7840\u539f\u7406\uff08\u4e09\uff09\uff1aABI \u7f16\u7801\u4e0e\u5e95\u5c42\u8c03\u7528</li> </ul>"},{"location":"web3/dapp/evm_fundamentals_part2_data_regions_and_contract_execution_240411/","title":"EVM \u57fa\u7840\u539f\u7406\uff08\u4e8c\uff09\uff1a\u6570\u636e\u533a\u57df\u4e0e\u5408\u7ea6\u6267\u884c","text":"<p> \u7ea6 2215 \u4e2a\u5b57  15 \u884c\u4ee3\u7801  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 8 \u5206\u949f</p> <p>\u672c\u6587\u662f EVM \u57fa\u7840\u539f\u7406\u7cfb\u5217\u7684\u7b2c\u4e8c\u7bc7\uff0c\u6df1\u5165\u7406\u89e3\u6808\u3001\u5185\u5b58\u3001\u5b58\u50a8\u7684\u8bbe\u8ba1\u539f\u7406\uff0c\u4ee5\u53ca\u5408\u7ea6\u7684\u90e8\u7f72\u4e0e\u8c03\u7528\u673a\u5236\u3002</p> <p>\u4e0a\u4e00\u7bc7\u6211\u4eec\u63d0\u5230 MLOAD \u53ea\u8981 3 Gas\uff0c\u800c SLOAD \u8981 2100 Gas\uff08\u51b7\u8bbf\u95ee\uff09\u3002\u4e3a\u4ec0\u4e48\u5dee\u8ddd\u8fd9\u4e48\u5927\uff1f</p> <p>\u56e0\u4e3a\u5b83\u4eec\u64cd\u4f5c\u7684\u6570\u636e\u533a\u57df\u6709\u672c\u8d28\u533a\u522b\uff1a</p> <ul> <li>\u5185\u5b58\uff1a\u4e34\u65f6\u7684\u3001\u672c\u5730\u7684\u3001\u4fbf\u5b9c\u7684</li> <li>\u5b58\u50a8\uff1a\u6c38\u4e45\u7684\u3001\u5168\u7f51\u5171\u8bc6\u7684\u3001\u6602\u8d35\u7684</li> </ul>"},{"location":"web3/dapp/evm_fundamentals_part2_data_regions_and_contract_execution_240411/#_1","title":"\u4e00\u3001\u4e09\u4e2a\u6570\u636e\u533a\u57df\u6982\u89c8","text":"\u533a\u57df \u751f\u547d\u5468\u671f \u8bbf\u95ee\u6210\u672c \u5178\u578b\u7528\u9014 \u6808 \u51fd\u6570\u6267\u884c\u671f\u95f4 \u6700\u4fbf\u5b9c \u5c40\u90e8\u53d8\u91cf\u3001\u8ba1\u7b97\u4e2d\u95f4\u503c \u5185\u5b58 \u51fd\u6570\u6267\u884c\u671f\u95f4 \u4e2d\u7b49 \u51fd\u6570\u53c2\u6570\u3001\u4e34\u65f6\u6570\u636e \u5b58\u50a8 \u6c38\u4e45 \u6700\u8d35 \u72b6\u6001\u53d8\u91cf <p>\u6838\u5fc3\u539f\u5219\uff1a\u80fd\u7528\u6808\u5c31\u4e0d\u7528\u5185\u5b58\uff0c\u80fd\u7528\u5185\u5b58\u5c31\u4e0d\u7528\u5b58\u50a8\u3002</p>"},{"location":"web3/dapp/evm_fundamentals_part2_data_regions_and_contract_execution_240411/#stack","title":"\u4e8c\u3001\u6808\uff08Stack\uff09","text":"<p>\u4e0a\u4e00\u7bc7\u5df2\u7ecf\u4ecb\u7ecd\u4e86\u6808\u7684\u57fa\u7840\uff0c\u8fd9\u91cc\u805a\u7126\u5b83\u7684\u5c40\u9650\u6027\u3002</p> <p>\u5c40\u9650\u6027 1\uff1a\u53ea\u80fd\u8bbf\u95ee\u9876\u90e8 16 \u4e2a\u5143\u7d20</p> <p>EVM \u7684 DUP \u548c SWAP \u6307\u4ee4\u6700\u591a\u64cd\u4f5c\u7b2c 16 \u4e2a\u5143\u7d20\uff1a</p> <pre><code>DUP1 - DUP16     // \u590d\u5236\u7b2c 1-16 \u4e2a\u5143\u7d20\u5230\u6808\u9876\nSWAP1 - SWAP16   // \u4ea4\u6362\u6808\u9876\u4e0e\u7b2c 2-17 \u4e2a\u5143\u7d20\n</code></pre> <p>\u5982\u679c\u4f60\u7684\u51fd\u6570\u6709\u8d85\u8fc7 16 \u4e2a\u5c40\u90e8\u53d8\u91cf\uff0c\u7f16\u8bd1\u5668\u4f1a\u88ab\u8feb\u4f7f\u7528\u5185\u5b58\uff0cGas \u6210\u672c\u4e0a\u5347\u3002</p> <p>\u5b9e\u8df5\u5efa\u8bae\uff1a\u51cf\u5c11\u51fd\u6570\u5185\u7684\u5c40\u90e8\u53d8\u91cf\u6570\u91cf\uff0c\u5c24\u5176\u662f\u540c\u65f6\u5b58\u6d3b\u7684\u53d8\u91cf\u3002</p> <p>\u5c40\u9650\u6027 2\uff1a\u6700\u5927\u6df1\u5ea6 1024</p> <p>\u6808\u6df1\u5ea6\u8d85\u8fc7 1024 \u4f1a\u5bfc\u81f4\u4ea4\u6613\u5931\u8d25\u3002\u8fd9\u5728\u6df1\u5ea6\u9012\u5f52\u6216\u590d\u6742\u7684\u5408\u7ea6\u8c03\u7528\u94fe\u4e2d\u53ef\u80fd\u89e6\u53d1\u3002</p> <p>\u6808\u7684\u4f18\u52bf</p> <ul> <li>\u64cd\u4f5c\u6210\u672c\u6781\u4f4e\uff08PUSH/POP/DUP/SWAP \u90fd\u662f 3 Gas \u5de6\u53f3\uff09</li> <li>\u65e0\u9700\u5730\u5740\u5bfb\u5740\uff0c\u76f4\u63a5\u64cd\u4f5c\u6808\u9876</li> </ul> <p>Stack too deep \u9519\u8bef</p> <p>Solidity \u7f16\u8bd1\u5668\u4f1a\u5c1d\u8bd5\u4f18\u5316\u6808\u4f7f\u7528\u3002\u5f53\u4f60\u9047\u5230 <code>Stack too deep</code> \u9519\u8bef\u65f6\uff0c\u610f\u5473\u7740\u7f16\u8bd1\u5668\u65e0\u6cd5\u5728 16 \u4e2a\u69fd\u4f4d\u5185\u5b89\u6392\u6240\u6709\u53d8\u91cf\u3002</p> <p>\u89e3\u51b3\u65b9\u6848\uff1a</p> <ul> <li>\u51cf\u5c11\u540c\u65f6\u5b58\u6d3b\u7684\u5c40\u90e8\u53d8\u91cf</li> <li>\u5c06\u90e8\u5206\u903b\u8f91\u63d0\u53d6\u5230\u5185\u90e8\u51fd\u6570</li> <li>\u4f7f\u7528\u7ed3\u6784\u4f53\u6253\u5305\u76f8\u5173\u53d8\u91cf</li> </ul>"},{"location":"web3/dapp/evm_fundamentals_part2_data_regions_and_contract_execution_240411/#memory","title":"\u4e09\u3001\u5185\u5b58\uff08Memory\uff09","text":"<p>\u5185\u5b58\u662f\u7ebf\u6027\u5b57\u8282\u6570\u7ec4\uff0c\u6309\u9700\u6269\u5c55\uff0c\u51fd\u6570\u6267\u884c\u7ed3\u675f\u540e\u6e05\u7a7a\u3002</p>"},{"location":"web3/dapp/evm_fundamentals_part2_data_regions_and_contract_execution_240411/#solidity","title":"Solidity \u7684\u5185\u5b58\u5e03\u5c40","text":"<p>Solidity \u4fdd\u7559\u4e86\u524d 4 \u4e2a 32 \u5b57\u8282\u69fd\u4f4d\uff1a</p> \u504f\u79fb\u91cf \u7528\u9014 0x00 - 0x3f Scratch space\uff08\u4e34\u65f6\u8ba1\u7b97\u7a7a\u95f4\uff09 0x40 - 0x5f Free memory pointer 0x60 - 0x7f Zero slot\uff08\u7528\u4e8e\u52a8\u6001\u6570\u7ec4\u521d\u59cb\u5316\uff09 0x80+ \u53ef\u5206\u914d\u533a\u57df <p>Free Memory Pointer\uff080x40\uff09 \u662f Solidity \u5185\u5b58\u7ba1\u7406\u7684\u6838\u5fc3\uff1a</p> <ul> <li>\u5b58\u50a8\u4e0b\u4e00\u4e2a\u53ef\u5206\u914d\u5730\u5740</li> <li>\u6bcf\u6b21\u5206\u914d\u5185\u5b58\u540e\u81ea\u52a8\u9012\u589e</li> <li>Solidity \u4e0d\u4f1a\u4e3b\u52a8\u91ca\u653e\u5185\u5b58\uff08\u51fd\u6570\u7ed3\u675f\u540e\u6574\u4f53\u6e05\u7a7a\uff09</li> </ul>"},{"location":"web3/dapp/evm_fundamentals_part2_data_regions_and_contract_execution_240411/#_2","title":"\u6269\u5c55\u6210\u672c\uff1a\u8d8a\u5927\u8d8a\u8d35","text":"<p>\u5185\u5b58\u4e0d\u662f\u56fa\u5b9a\u5927\u5c0f\uff0c\u800c\u662f\u6309\u9700\u6269\u5c55\u3002\u6269\u5c55\u662f\u6709\u6210\u672c\u7684\uff0c\u800c\u4e14\u662f\u975e\u7ebf\u6027\u589e\u957f\uff1a</p> <pre><code>memory_cost = 3 * words + words\u00b2 / 512\n</code></pre> <p>\u5176\u4e2d <code>words = ceil(size / 32)</code>\u3002</p> \u5185\u5b58\u5927\u5c0f \u6269\u5c55\u6210\u672c 1 KB (32 words) 98 Gas 10 KB (320 words) 1,160 Gas 1 MB (32,768 words) 2,195,456 Gas <p>\u4e8c\u6b21\u65b9\u589e\u957f\u7684\u8bbe\u8ba1\u610f\u56fe\uff1a\u9632\u6b62\u5408\u7ea6\u6ee5\u7528\u5185\u5b58\u3002\u5c0f\u5185\u5b58\u64cd\u4f5c\u4fbf\u5b9c\uff08\u9f13\u52b1\u6b63\u5e38\u4f7f\u7528\uff09\uff0c\u5927\u5185\u5b58\u64cd\u4f5c\u6781\u5176\u6602\u8d35\uff08\u60e9\u7f5a\u6ee5\u7528\uff09\u3002</p> <p>\u5185\u5b58 vs \u6808</p> <p>\u5185\u5b58\u7684\u4f18\u52bf\u662f\u53ef\u4ee5\u5b58\u50a8\u4efb\u610f\u5927\u5c0f\u7684\u6570\u636e\uff08\u5982\u52a8\u6001\u6570\u7ec4\u3001\u5b57\u7b26\u4e32\uff09\uff0c\u800c\u6808\u6bcf\u4e2a\u5143\u7d20\u56fa\u5b9a 32 \u5b57\u8282\u3002</p>"},{"location":"web3/dapp/evm_fundamentals_part2_data_regions_and_contract_execution_240411/#storage","title":"\u56db\u3001\u5b58\u50a8\uff08Storage\uff09","text":"<p>\u5b58\u50a8\u662f\u5408\u7ea6\u7684\u6c38\u4e45\u72b6\u6001\uff0c\u6570\u636e\u5199\u5165\u540e\u4e00\u76f4\u4fdd\u7559\u5728\u533a\u5757\u94fe\u4e0a\u3002</p>"},{"location":"web3/dapp/evm_fundamentals_part2_data_regions_and_contract_execution_240411/#_3","title":"\u5b58\u50a8\u6a21\u578b","text":"<p>\u5b58\u50a8\u662f\u4e00\u4e2a 2\u00b2\u2075\u2076 \u69fd\u4f4d\u7684\u7a00\u758f\u6570\u7ec4\uff0c\u6bcf\u4e2a\u69fd\u4f4d 32 \u5b57\u8282\uff1a</p> <pre><code>slot[0] \u2192 32 bytes\nslot[1] \u2192 32 bytes\n...\nslot[2\u00b2\u2075\u2076 - 1] \u2192 32 bytes\n</code></pre> <p>\u5b9e\u9645\u5b9e\u73b0\u662f\u952e\u503c\u6570\u636e\u5e93\uff08\u5982 LevelDB\uff09\uff0c\u53ea\u6709\u975e\u96f6\u69fd\u4f4d\u624d\u5360\u7528\u7a7a\u95f4\u3002</p>"},{"location":"web3/dapp/evm_fundamentals_part2_data_regions_and_contract_execution_240411/#_4","title":"\u72b6\u6001\u53d8\u91cf\u7684\u69fd\u4f4d\u5206\u914d","text":"<p>\u5b9a\u957f\u7c7b\u578b\uff1aSolidity \u6309\u58f0\u660e\u987a\u5e8f\u5206\u914d\uff0c\u5c0f\u53d8\u91cf\u4f1a\u6253\u5305\u5230\u540c\u4e00\u69fd\u4f4d\u3002</p> <pre><code>contract SlotPacking {\n    uint256 a;     // slot 0\uff08\u5b8c\u6574\u5360\u7528\uff09\n    uint128 b;     // slot 1\uff08\u4f4e 16 \u5b57\u8282\uff09\n    uint128 c;     // slot 1\uff08\u9ad8 16 \u5b57\u8282\uff09\n    uint256 d;     // slot 2\n}\n</code></pre> <p>Solidity \u5728\u540c\u4e00\u4e2a storage slot\uff0832 \u5b57\u8282\uff09\u91cc\u505a\u6253\u5305\u65f6\uff0c\u6309\u58f0\u660e\u987a\u5e8f\u4f9d\u6b21\u653e\u5165\uff0c\u5e76\u4e14\u662f\u4ece\u8be5 slot \u7684\u4f4e\u4f4d\uff08least-significant\uff09\u5b57\u8282\u5f00\u59cb\u586b\u5145\uff0c\u5f80\u9ad8\u4f4d\u65b9\u5411\u63a8\u8fdb\uff1b\u653e\u4e0d\u4e0b\u5c31\u6362\u4e0b\u4e00\u4e2a slot\u3002</p> <p>\u7ed3\u6784\u4f53\uff1a\u4ece\u65b0\u69fd\u4f4d\u5f00\u59cb\uff0c\u5185\u90e8\u6309\u987a\u5e8f\u6392\u5217\u3002</p> <pre><code>struct Data {\n    uint256 id;    // slot n\n    address owner; // slot n+1\n}\n</code></pre>"},{"location":"web3/dapp/evm_fundamentals_part2_data_regions_and_contract_execution_240411/#_5","title":"\u52a8\u6001\u7c7b\u578b\u7684\u69fd\u4f4d\u8ba1\u7b97","text":"<p>Solidity \u7528 keccak256 \u8ba1\u7b97\u52a8\u6001\u7c7b\u578b\u7684\u4f4d\u7f6e\u3002</p> <p>\u52a8\u6001\u6570\u7ec4\uff1a</p> <pre><code>uint256[] arr;  // \u5047\u8bbe\u5728 slot p\n</code></pre> <ul> <li><code>slot p</code> \u5b58\u50a8\u6570\u7ec4\u957f\u5ea6</li> <li><code>arr[i]</code> \u7684\u4f4d\u7f6e\uff1a<code>keccak256(p) + i</code></li> </ul> <p>Mapping\uff1a</p> <p>\u6620\u5c04\u4e0d\u80fd\u6309\u987a\u5e8f\u5b58\u50a8\uff0c\u56e0\u4e3a\u952e\u662f\u52a8\u6001\u7684\u3002</p> <pre><code>mapping(address =&gt; uint256) balances;  // \u5047\u8bbe\u5728 slot p\n</code></pre> <ul> <li><code>slot p</code> \u4e0d\u5b58\u50a8\u4efb\u4f55\u6570\u636e</li> <li><code>balances[key]</code> \u7684\u4f4d\u7f6e\uff1a<code>keccak256(abi.encode(key, p))</code></li> </ul> <p>\u628a key\uff0832 \u5b57\u8282\uff09\u548c slot\uff0832 \u5b57\u8282\uff09\u62fc\u6210 64 \u5b57\u8282\uff0c\u518d\u54c8\u5e0c\u3002</p> <p>\u5d4c\u5957 Mapping\uff1a</p> <pre><code>mapping(address =&gt; mapping(uint256 =&gt; bool)) approvals;  // slot p\n</code></pre> <p><code>approvals[addr][id]</code> \u7684\u4f4d\u7f6e\uff1a</p> <pre><code>keccak256(abi.encode(id, keccak256(abi.encode(addr, p))))\n</code></pre>"},{"location":"web3/dapp/evm_fundamentals_part2_data_regions_and_contract_execution_240411/#_6","title":"\u5b58\u50a8\u6210\u672c\u8be6\u89e3","text":"\u64cd\u4f5c \u6761\u4ef6 Gas \u6210\u672c SLOAD \u51b7\u8bbf\u95ee 2,100 SLOAD \u70ed\u8bbf\u95ee 100 SSTORE 0 \u2192 \u975e\u96f6 22,100 SSTORE \u975e\u96f6 \u2192 \u975e\u96f6 5,000 SSTORE \u975e\u96f6 \u2192 0 5,000\uff0c\u6709\u9000\u6b3e <p>\u51b7/\u70ed\u8bbf\u95ee\uff08EIP-2929\uff09\uff1a\u540c\u4e00\u4ea4\u6613\u4e2d\u9996\u6b21\u8bbf\u95ee\u67d0\u69fd\u4f4d\u4e3a\"\u51b7\"\uff0c\u540e\u7eed\u4e3a\"\u70ed\"\u3002</p>"},{"location":"web3/dapp/evm_fundamentals_part2_data_regions_and_contract_execution_240411/#_7","title":"\u4e94\u3001\u5408\u7ea6\u90e8\u7f72\u673a\u5236","text":"<p>\u4e24\u79cd\u4ea4\u6613\u7c7b\u578b</p> <p>\u4ee5\u592a\u574a\u7684\u4ea4\u6613\u5206\u4e24\u79cd\uff0c\u7531 <code>to</code> \u5b57\u6bb5\u51b3\u5b9a\uff1a</p> to \u5b57\u6bb5 \u4ea4\u6613\u7c7b\u578b \u6267\u884c\u5185\u5bb9 \u7a7a \u521b\u5efa\u5408\u7ea6 \u6267\u884c data \u4e2d\u7684 Init Code \u5408\u7ea6\u5730\u5740 \u8c03\u7528\u5408\u7ea6 \u6267\u884c data \u4f5c\u4e3a calldata <p>\u5173\u4e8e Creation Code \u4e0e Init Code \u7684\u8be6\u7ec6\u533a\u522b\u548c\u5b9e\u9645\u9a8c\u8bc1\uff0c\u53c2\u89c1\u7b2c\u4e00\u7bc7\u7684\"\u52a8\u624b\u9a8c\u8bc1\uff1a\u67e5\u770b\u4e09\u79cd\u5b57\u8282\u7801\"\u90e8\u5206\u3002</p>"},{"location":"web3/dapp/evm_fundamentals_part2_data_regions_and_contract_execution_240411/#_8","title":"\u90e8\u7f72\u6267\u884c\u6d41\u7a0b","text":"<p>\u5173\u952e\u70b9\uff1a</p> <ul> <li>Init Code \u662f\u4e00\u6bb5\"\u5b89\u88c5\u7a0b\u5e8f\"\uff0c\u6267\u884c\u540e\u88ab\u4e22\u5f03</li> <li>Runtime Code \u662f Init Code \u7684\u6267\u884c\u7ed3\u679c\uff0c\u7531 RETURN \u8fd4\u56de</li> <li>\u6784\u9020\u51fd\u6570\u7684\u53c2\u6570\u88ab ABI \u7f16\u7801\u540e\u9644\u52a0\u5728 Creation Code \u672b\u5c3e\uff0c\u5171\u540c\u6784\u6210 Init Code</li> </ul>"},{"location":"web3/dapp/evm_fundamentals_part2_data_regions_and_contract_execution_240411/#_9","title":"\u5408\u7ea6\u5730\u5740\u8ba1\u7b97","text":"<p>CREATE\uff08\u666e\u901a\u90e8\u7f72\uff09\uff1a</p> <pre><code>address = keccak256(rlp([sender, nonce]))[12:]\n</code></pre> <p>\u5730\u5740\u7531\u90e8\u7f72\u8005\u5730\u5740\u548c nonce \u51b3\u5b9a\uff0c\u56e0\u6b64\u4e0d\u53ef\u9884\u6d4b\uff08nonce \u4f1a\u53d8\u5316\uff09\u3002</p> <p>CREATE2\uff08\u786e\u5b9a\u6027\u90e8\u7f72\uff09\uff1a</p> <pre><code>address = keccak256(0xff ++ sender ++ salt ++ keccak256(initCode))[12:]\n</code></pre> <p>\u901a\u8fc7\u81ea\u5b9a\u4e49 salt\uff0c\u53ef\u4ee5\u5728\u90e8\u7f72\u524d\u9884\u6d4b\u5730\u5740\u3002\u8fd9\u5728\u5de5\u5382\u5408\u7ea6\u3001\u8de8\u94fe\u90e8\u7f72\u4e2d\u5f88\u6709\u7528\u3002</p> <p>\u95ee\u9898\uff1a\u4e3a\u4ec0\u4e48 CREATE2 \u8981\u7528 Init Code \u800c\u4e0d\u662f Creation Code\uff1f</p> <p>\u4f7f\u7528 Init Code \u662f\u56e0\u4e3a \u76f8\u540c\u7684\u4ee3\u7801 + \u76f8\u540c\u7684\u53c2\u6570 \u624d\u5e94\u8be5\u5f97\u5230\u76f8\u540c\u7684\u5730\u5740\u3002\u5982\u679c\u53ea\u7528 Creation Code\uff0c\u4e0d\u540c\u53c2\u6570\u4f1a\u90e8\u7f72\u5230\u540c\u4e00\u5730\u5740\uff0c\u8fd9\u4e0d\u662f\u671f\u671b\u7684\u884c\u4e3a\u3002</p>"},{"location":"web3/dapp/evm_fundamentals_part2_data_regions_and_contract_execution_240411/#_10","title":"\u516d\u3001\u51fd\u6570\u8c03\u7528\u673a\u5236","text":""},{"location":"web3/dapp/evm_fundamentals_part2_data_regions_and_contract_execution_240411/#calldata","title":"calldata \u7ed3\u6784","text":"<p>\u8c03\u7528 <code>transfer(address to, uint256 amount)</code> \u65f6\uff0ccalldata \u7684\u7ed3\u6784\uff1a</p> <pre><code>\u51fd\u6570\u9009\u62e9\u5668\uff084 \u5b57\u8282\uff09+ ABI \u7f16\u7801\u7684\u53c2\u6570\uff0832 \u5b57\u8282 \u00d7 N\uff09\n</code></pre> <p>EVM \u901a\u8fc7\u9009\u62e9\u5668\u8def\u7531\u5230\u5bf9\u5e94\u51fd\u6570\uff08\u4e0a\u4e00\u7bc7\u5df2\u8bb2\uff09\u3002</p>"},{"location":"web3/dapp/evm_fundamentals_part2_data_regions_and_contract_execution_240411/#call","title":"Call \u7684\u4e0a\u4e0b\u6587\u4f20\u9012","text":"<p>\u5f53\u5408\u7ea6 A \u8c03\u7528\u5408\u7ea6 B \u65f6\uff0cEVM \u4f1a\u4f20\u9012\u4e00\u4e2a\u6267\u884c\u4e0a\u4e0b\u6587\uff1a</p> \u4e0a\u4e0b\u6587\u53d8\u91cf \u542b\u4e49 msg.sender \u8c03\u7528\u8005\uff08A \u7684\u5730\u5740\uff09 msg.value \u53d1\u9001\u7684 ETH msg.data calldata gas \u53ef\u7528 Gas <p>63/64 \u89c4\u5219\uff08EIP-150\uff09\uff1a\u8c03\u7528\u65f6\u6700\u591a\u8f6c\u53d1\u5f53\u524d\u5269\u4f59 Gas \u7684 63/64\uff0c\u4fdd\u7559 1/64 \u7528\u4e8e\u8c03\u7528\u540e\u7684\u64cd\u4f5c\u3002</p>"},{"location":"web3/dapp/evm_fundamentals_part2_data_regions_and_contract_execution_240411/#_11","title":"\u4e09\u79cd\u8c03\u7528\u65b9\u5f0f","text":"\u64cd\u4f5c\u7801 msg.sender \u5b58\u50a8\u4e0a\u4e0b\u6587 \u5178\u578b\u7528\u9014 call \u53d8\u4e3a\u8c03\u7528\u8005 \u88ab\u8c03\u7528\u5408\u7ea6 \u666e\u901a\u8c03\u7528 delegatecall \u4fdd\u6301\u4e0d\u53d8 \u8c03\u7528\u65b9\u5408\u7ea6 \u4ee3\u7406\u6a21\u5f0f staticcall \u53d8\u4e3a\u8c03\u7528\u8005 \u53ea\u8bfb view \u51fd\u6570 <p>delegatecall \u7684\u672c\u8d28\uff1a\"\u501f\u58f3\u6267\u884c\"\u2014\u2014\u4ee3\u7801\u662f B \u7684\uff0c\u4f46\u5b58\u50a8\u548c msg.sender \u90fd\u662f A \u7684\u3002\u8fd9\u662f\u4ee3\u7406\u5408\u7ea6\u7684\u57fa\u7840\u3002</p>"},{"location":"web3/dapp/evm_fundamentals_part2_data_regions_and_contract_execution_240411/#_12","title":"\u4e03\u3001\u8fd4\u56de\u4e0e\u5f02\u5e38","text":""},{"location":"web3/dapp/evm_fundamentals_part2_data_regions_and_contract_execution_240411/#_13","title":"\u6b63\u5e38\u8fd4\u56de","text":"<p>RETURN\uff1a\u8fd4\u56de\u6570\u636e\u5e76\u7ed3\u675f\u6267\u884c\u3002</p> <pre><code>RETURN(offset, size)  // \u8fd4\u56de memory[offset:offset+size]\n</code></pre> <p>\u8fd4\u56de\u7684\u6570\u636e\u5b58\u5165\u8c03\u7528\u8005\u7684 returndata \u7f13\u51b2\u533a\uff0c\u53ef\u901a\u8fc7 RETURNDATASIZE \u548c RETURNDATACOPY \u8bbf\u95ee\u3002</p>"},{"location":"web3/dapp/evm_fundamentals_part2_data_regions_and_contract_execution_240411/#_14","title":"\u5f02\u5e38\u56de\u6eda","text":"\u64cd\u4f5c\u7801 \u884c\u4e3a Gas \u5904\u7406 REVERT \u56de\u6eda\u72b6\u6001\uff0c\u8fd4\u56de\u9519\u8bef\u6570\u636e \u9000\u8fd8\u5269\u4f59 Gas INVALID \u56de\u6eda\u72b6\u6001\uff0c\u65e0\u8fd4\u56de\u6570\u636e \u6d88\u8017\u6240\u6709 Gas <p>Solidity \u7684 <code>require</code> \u548c <code>revert</code> \u7f16\u8bd1\u4e3a REVERT\uff0c<code>assert</code> \u5728 0.8.0 \u540e\u4e5f\u7528 REVERT\uff08\u65e9\u671f\u7248\u672c\u7528 INVALID\uff09\u3002</p>"},{"location":"web3/dapp/evm_fundamentals_part2_data_regions_and_contract_execution_240411/#returndata","title":"returndata \u673a\u5236","text":"<p>EIP-211 \u5f15\u5165\u4e86 returndata \u7f13\u51b2\u533a\uff1a</p> <pre><code>(bool success, bytes memory data) = target.call(payload);\n</code></pre> <p>\u5e95\u5c42\u64cd\u4f5c\uff1a</p> <ol> <li>call \u6267\u884c\u540e\uff0c\u8fd4\u56de\u503c\u5199\u5165 returndata</li> <li>RETURNDATASIZE \u83b7\u53d6\u8fd4\u56de\u6570\u636e\u957f\u5ea6</li> <li>RETURNDATACOPY \u5c06\u6570\u636e\u590d\u5236\u5230\u5185\u5b58</li> </ol>"},{"location":"web3/dapp/evm_fundamentals_part2_data_regions_and_contract_execution_240411/#event","title":"\u516b\u3001Event \u5e95\u5c42\u673a\u5236","text":""},{"location":"web3/dapp/evm_fundamentals_part2_data_regions_and_contract_execution_240411/#log","title":"LOG \u64cd\u4f5c\u7801","text":"<p>Event \u901a\u8fc7 LOG0 - LOG4 \u64cd\u4f5c\u7801\u5b9e\u73b0\uff1a</p> <pre><code>LOG{n}(offset, size, topic0, topic1, ..., topic{n-1})\n</code></pre> <ul> <li><code>n</code> \u662f topic \u6570\u91cf\uff080-4\uff09</li> <li><code>offset/size</code> \u6307\u5b9a\u975e indexed \u6570\u636e\u5728\u5185\u5b58\u4e2d\u7684\u4f4d\u7f6e</li> <li>topic0 \u901a\u5e38\u662f\u4e8b\u4ef6\u7b7e\u540d\u7684 keccak256</li> </ul>"},{"location":"web3/dapp/evm_fundamentals_part2_data_regions_and_contract_execution_240411/#indexed","title":"indexed \u53c2\u6570","text":"<pre><code>event Transfer(address indexed from, address indexed to, uint256 value);\n</code></pre> \u53c2\u6570 \u5b58\u50a8\u4f4d\u7f6e \u4f5c\u7528 indexed topic \u53ef\u88ab\u94fe\u4e0b\u9ad8\u6548\u8fc7\u6ee4 \u975e indexed data \u53ea\u80fd\u5168\u91cf\u8bfb\u53d6 <p>\u4e00\u4e2a\u4e8b\u4ef6\u6700\u591a 4 \u4e2a topic\uff08\u5305\u62ec\u4e8b\u4ef6\u7b7e\u540d\uff09\uff0c\u6240\u4ee5\u6700\u591a 3 \u4e2a indexed \u53c2\u6570\u3002</p>"},{"location":"web3/dapp/evm_fundamentals_part2_data_regions_and_contract_execution_240411/#event_1","title":"\u4e3a\u4ec0\u4e48 Event \u6bd4\u5b58\u50a8\u4fbf\u5b9c\uff1f","text":"<p>Event \u6570\u636e\uff1a</p> <ul> <li>\u4e0d\u5b58\u50a8\u5728\u4e16\u754c\u72b6\u6001\u4e2d</li> <li>\u4e0d\u53c2\u4e0e\u5171\u8bc6\u9a8c\u8bc1</li> <li>\u53ea\u80fd\u88ab\u94fe\u4e0b\u8bfb\u53d6</li> </ul> <p>\u56e0\u6b64 LOG \u64cd\u4f5c\u7684 Gas \u8fdc\u4f4e\u4e8e SSTORE\u3002</p>"},{"location":"web3/dapp/evm_fundamentals_part2_data_regions_and_contract_execution_240411/#_15","title":"\u5c0f\u7ed3","text":"<p>\u672c\u6587\u4ecb\u7ecd\u4e86 EVM \u7684\u6570\u636e\u7ba1\u7406\u548c\u6267\u884c\u673a\u5236\uff1a</p> <ol> <li>\u6808\uff1a\u6700\u5feb\u6700\u4fbf\u5b9c\uff0c\u4f46\u6709 16 \u5143\u7d20\u548c 1024 \u6df1\u5ea6\u9650\u5236</li> <li>\u5185\u5b58\uff1a\u4e34\u65f6\u5b58\u50a8\uff0c\u6269\u5c55\u6210\u672c\u975e\u7ebf\u6027\u589e\u957f</li> <li>\u5b58\u50a8\uff1a\u6c38\u4e45\u72b6\u6001\uff0c\u6210\u672c\u6700\u9ad8\uff0c\u51b7\u70ed\u8bbf\u95ee\u6709\u533a\u522b</li> <li>\u90e8\u7f72\uff1aInit Code \u6267\u884c\u540e\u8fd4\u56de Runtime Code</li> <li>\u8c03\u7528\uff1acall/delegatecall/staticcall \u5404\u6709\u4e0d\u540c\u7684\u4e0a\u4e0b\u6587</li> <li>Event\uff1a\u901a\u8fc7 LOG \u64cd\u4f5c\u7801\u5b9e\u73b0\uff0c\u6bd4\u5b58\u50a8\u4fbf\u5b9c</li> </ol> <p>\u4e0b\u4e00\u7bc7\uff0c\u6211\u4eec\u5c06\u6df1\u5165 ABI \u7f16\u7801\u89c4\u5219\u548c\u5e95\u5c42\u8c03\u7528\u7684\u5b9e\u6218\u6280\u5de7\u3002</p> <p>\u7cfb\u5217\u5bfc\u822a\uff1a</p> <ul> <li>\u7b2c\u4e00\u7bc7\uff1aEVM \u57fa\u7840\u539f\u7406\uff08\u4e00\uff09\uff1a\u4ece\u4ea4\u6613\u5230\u5b57\u8282\u7801</li> <li>\u7b2c\u4e8c\u7bc7\uff1aEVM \u57fa\u7840\u539f\u7406\uff08\u4e8c\uff09\uff1aEVM \u6570\u636e\u533a\u57df\u4e0e\u5408\u7ea6\u6267\u884c\uff08\u672c\u7bc7\uff09</li> <li>\u7b2c\u4e09\u7bc7\uff1aEVM \u57fa\u7840\u539f\u7406\uff08\u4e09\uff09\uff1aABI \u7f16\u7801\u4e0e\u5e95\u5c42\u8c03\u7528</li> </ul>"},{"location":"web3/dapp/evm_fundamentals_part3_abi_encoding_and_low-level_calls_240413/","title":"EVM \u57fa\u7840\u539f\u7406\uff08\u4e09\uff09\uff1aABI \u7f16\u7801\u4e0e\u5e95\u5c42\u8c03\u7528","text":"<p> \u7ea6 1952 \u4e2a\u5b57  102 \u884c\u4ee3\u7801  4 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 8 \u5206\u949f</p> <p>\u672c\u6587\u662f EVM \u57fa\u7840\u539f\u7406\u7cfb\u5217\u7684\u7b2c\u4e09\u7bc7\uff0c\u638c\u63e1 ABI \u7f16\u7801\u89c4\u5219\u548c\u5e95\u5c42\u8c03\u7528\u7684\u5b9e\u6218\u6280\u5de7\u3002</p> <p>ABI\uff08Application Binary Interface\uff09\u662f\u5408\u7ea6\u4e0e\u5916\u90e8\u4e16\u754c\u4ea4\u4e92\u7684\u534f\u8bae\u3002\u7406\u89e3\u5b83\u6709\u52a9\u4e8e\uff1a</p> <ul> <li>\u6784\u9020\u539f\u59cb\u4ea4\u6613</li> <li>\u89e3\u6790\u94fe\u4e0a\u6570\u636e</li> <li>\u6392\u67e5\u8c03\u7528\u5931\u8d25\u95ee\u9898</li> </ul>"},{"location":"web3/dapp/evm_fundamentals_part3_abi_encoding_and_low-level_calls_240413/#_1","title":"\u4e00\u3001\u51fd\u6570\u9009\u62e9\u5668","text":""},{"location":"web3/dapp/evm_fundamentals_part3_abi_encoding_and_low-level_calls_240413/#_2","title":"\u8ba1\u7b97\u89c4\u5219","text":"<p>\u9009\u62e9\u5668 = \u51fd\u6570\u7b7e\u540d\u7684 keccak256 \u54c8\u5e0c\u7684\u524d 4 \u5b57\u8282\u3002</p> <p>\u51fd\u6570\u7b7e\u540d\u7684\u89c4\u8303\u683c\u5f0f\uff1a</p> <ul> <li>\u51fd\u6570\u540d + \u53c2\u6570\u7c7b\u578b\u5217\u8868</li> <li>\u4e0d\u542b\u7a7a\u683c\u3001\u53c2\u6570\u540d\u3001\u8fd4\u56de\u503c</li> <li>\u4f7f\u7528\u57fa\u7840\u7c7b\u578b\uff08uint256 \u800c\u975e uint\uff09</li> </ul> <pre><code>transfer(address,uint256)     \u2713 \u6b63\u786e\ntransfer(address to, uint256) \u2717 \u4e0d\u80fd\u6709\u53c2\u6570\u540d\ntransfer(address, uint)       \u2717 uint \u5e94\u5199\u6210 uint256\n</code></pre>"},{"location":"web3/dapp/evm_fundamentals_part3_abi_encoding_and_low-level_calls_240413/#_3","title":"\u9009\u62e9\u5668\u78b0\u649e","text":"<p>\u9009\u62e9\u5668\u53ea\u6709 4 \u5b57\u8282\uff0832 \u4f4d\uff09\uff0c\u7406\u8bba\u4e0a 2\u00b3\u00b2 \u2248 43 \u4ebf\u79cd\u53ef\u80fd\u3002</p> <p>\u78b0\u649e\uff1a\u4e24\u4e2a\u4e0d\u540c\u7684\u51fd\u6570\u7b7e\u540d\u4ea7\u751f\u76f8\u540c\u7684\u9009\u62e9\u5668\u3002</p> <p>\u7ecf\u5178\u6848\u4f8b\uff1a</p> <pre><code>collate_propagate_storage(bytes16) \u2192 0x42966c68\nburn(uint256)                      \u2192 0x42966c68\n</code></pre> <p>\u78b0\u649e\u7684\u5f71\u54cd\uff1a</p> <ul> <li>\u540c\u4e00\u5408\u7ea6\u5185\uff1a\u7f16\u8bd1\u5668\u4f1a\u62a5\u9519\uff0c\u4e0d\u5141\u8bb8\u5b58\u5728</li> <li>\u8de8\u5408\u7ea6\u8c03\u7528\uff1a\u5982\u679c\u9009\u62e9\u5668\u78b0\u649e\u4e14\u53c2\u6570\u7c7b\u578b\u517c\u5bb9\uff0c\u53ef\u80fd\u8c03\u7528\u5230\u9519\u8bef\u7684\u51fd\u6570</li> </ul> <p>\u5b89\u5168\u63d0\u793a\uff1a\u4f7f\u7528\u77e5\u540d\u51fd\u6570\u540d\uff08\u5982 ERC20 \u6807\u51c6\uff09\u53ef\u964d\u4f4e\u78b0\u649e\u98ce\u9669\u3002</p>"},{"location":"web3/dapp/evm_fundamentals_part3_abi_encoding_and_low-level_calls_240413/#_4","title":"\u4e8c\u3001\u9759\u6001\u7c7b\u578b\u7f16\u7801","text":"<p>ABI \u7f16\u7801\u7684\u6838\u5fc3\u89c4\u5219\uff1a\u6240\u6709\u503c\u586b\u5145\u5230 32 \u5b57\u8282\u3002</p> \u7c7b\u578b \u7f16\u7801\u65b9\u5f0f \u793a\u4f8b uint256 \u76f4\u63a5\u4f7f\u7528 100 \u2192 0x0000...0064 uint8/uint128 \u7b49 \u5de6\u586b\u5145\u96f6\u5230 32 \u5b57\u8282 uint8(1) \u2192 0x0000...0001 int256 \u8d1f\u6570\u7528\u8865\u7801 -1 \u2192 0xffff...ffff address \u5de6\u586b\u5145\u96f6\u5230 32 \u5b57\u8282 0xABC... \u2192 0x000...ABC... bool 0 \u6216 1 true \u2192 0x0000...0001 bytes1-bytes32 \u53f3\u586b\u5145\u96f6\u5230 32 \u5b57\u8282 bytes4(0x12345678) \u2192 0x12345678000...000"},{"location":"web3/dapp/evm_fundamentals_part3_abi_encoding_and_low-level_calls_240413/#_5","title":"\u591a\u53c2\u6570\u6253\u5305","text":"<p>\u591a\u4e2a\u53c2\u6570\u6309\u58f0\u660e\u987a\u5e8f\u4f9d\u6b21\u62fc\u63a5\uff0c\u6bcf\u4e2a 32 \u5b57\u8282\u3002</p> <pre><code>function example(uint256 a, address b, bool c)\n</code></pre> <p>calldata \u7ed3\u6784\uff1a</p> <p></p>"},{"location":"web3/dapp/evm_fundamentals_part3_abi_encoding_and_low-level_calls_240413/#_6","title":"\u4e09\u3001\u52a8\u6001\u7c7b\u578b\u7f16\u7801","text":"<p>\u9759\u6001\u7c7b\u578b\u7f16\u7801\u5f88\u7b80\u5355\uff1a\u6bcf\u4e2a\u503c\u56fa\u5b9a 32 \u5b57\u8282\uff0c\u6309\u987a\u5e8f\u62fc\u63a5\u3002\u4f46\u52a8\u6001\u7c7b\u578b\uff08string\u3001bytes\u3001\u6570\u7ec4\uff09\u957f\u5ea6\u4e0d\u56fa\u5b9a\uff0c\u600e\u4e48\u529e\uff1f</p> <p>\u89e3\u51b3\u65b9\u6848\uff1a\u5934\u90e8\u653e offset\uff08\u504f\u79fb\u91cf\uff09\uff0c\u5c3e\u90e8\u653e\u5b9e\u9645\u6570\u636e\u3002</p>"},{"location":"web3/dapp/evm_fundamentals_part3_abi_encoding_and_low-level_calls_240413/#_7","title":"\u901a\u7528\u7ed3\u6784","text":"<ul> <li>Head\uff08\u5934\u90e8\uff09\uff1a\u6bcf\u4e2a\u53c2\u6570\u5360 32 \u5b57\u8282\uff0c\u52a8\u6001\u53c2\u6570\u5b58 offset\uff0c\u6307\u5411 Tail \u8d77\u59cb\u4f4d\u7f6e</li> <li>Tail\uff08\u5c3e\u90e8\uff09\uff1a\u771f\u6b63\u7684\u6570\u636e\u5185\u5bb9\uff0c\u53ea\u4e3a\u52a8\u6001\u53c2\u6570\u5b58\u5728\uff0c\u6309\u987a\u5e8f\u8ffd\u52a0\uff0c\u683c\u5f0f\uff1a<code>length (32 bytes)</code> + <code>data (\u6309 32 \u5b57\u8282\u5bf9\u9f50)</code></li> <li>offset\uff1a\u4ece\u5934\u90e8\u8d77\u59cb\u4f4d\u7f6e\u5230\u5c3e\u90e8\u8d77\u59cb\u4f4d\u7f6e\u7684\u5b57\u8282\u504f\u79fb\u91cf</li> </ul> <p>\u6f14\u793a\u7a0b\u5e8f\uff1a</p> <pre><code>// SPDX-License-Identifier: MIT\npragma solidity ^0.8.24;\n\ncontract ABI {\n    string public strVar;\n    bytes public bytesVar;\n    uint256[] public arr;\n\n    struct Students {\n        uint256 age;\n        string name;\n        uint256 grades;\n    }\n\n    event StringABI(string _string);\n    event BytesABI(bytes _bytes);\n    event ArrayABI(uint256[] _array);\n    event StudentInfo(uint256 indexed _age, string indexed _name, uint256 indexed _grades);\n\n    function abi_String(string memory _string) public {\n        strVar = _string;\n        emit StringABI(_string);\n    }\n\n    function abi_Bytes(bytes memory _bytes) public {\n        bytesVar = _bytes;\n        emit BytesABI(_bytes);\n    }\n\n    function abi_Array(uint256[] memory _array) public {\n        arr = _array;\n        emit ArrayABI(_array);\n    }\n\n    function Student(uint256 _age, string memory _name, uint256 _grades) public {\n        Students memory student;\n        student.age = _age;\n        student.name = _name;\n        student.grades = _grades;\n        emit StudentInfo(_age, _name, _grades);\n    }\n}\n</code></pre>"},{"location":"web3/dapp/evm_fundamentals_part3_abi_encoding_and_low-level_calls_240413/#1-string","title":"\u5b9e\u4f8b 1\uff1a\u5355\u4e2a string \u53c2\u6570","text":"<p>\u8c03\u7528 <code>abi_String(\"HelloWorld\")</code>\uff0ccalldata \u5982\u4e0b\uff1a</p> <pre><code>\u9009\u62e9\u5668:    0x5c235583\n[0] offset: 0x0000...0020  (32\uff0c\u6307\u5411\u4e0b\u4e00\u884c)\n[1] length: 0x0000...000a  (10\uff0c\u5b57\u7b26\u4e32\u957f\u5ea6)\n[2] data:   0x48656c6c6f576f726c6400...00  (\"HelloWorld\" + padding)\n</code></pre> <p>\u89e3\u8bfb\uff1a</p> <ul> <li>offset = 0x20\uff08\u5341\u8fdb\u5236 32\uff09\uff0c\u610f\u601d\u662f\u4ece\u53c2\u6570\u533a\u8d77\u70b9\u6570\u7b2c 32 \u5b57\u8282\u5904\u5f00\u59cb\u662f string \u7684\u5b9e\u9645\u5185\u5bb9</li> <li>length = 0x0a\uff08\u5341\u8fdb\u5236 10\uff09\uff0c<code>HelloWorld</code> \u5171 10 \u4e2a ASCII \u5b57\u7b26</li> <li>data \u662f ASCII \u7f16\u7801\uff0c\u540e\u9762\u8865\u96f6\u5bf9\u9f50\u5230 32 \u5b57\u8282</li> </ul>"},{"location":"web3/dapp/evm_fundamentals_part3_abi_encoding_and_low-level_calls_240413/#2","title":"\u5b9e\u4f8b 2\uff1a\u6df7\u5408\u53c2\u6570","text":"<p>\u8c03\u7528 <code>Student(18, \"Alice\", 95)</code>\uff0c\u53c2\u6570\u7c7b\u578b\uff1a</p> <ol> <li><code>_age</code> \u2192 uint256\uff08\u9759\u6001\uff09</li> <li><code>_name</code> \u2192 string\uff08\u52a8\u6001\uff09</li> <li><code>_grades</code> \u2192 uint256\uff08\u9759\u6001\uff09</li> </ol> <p>calldata \u7ed3\u6784\uff1a</p> <pre><code>\u9009\u62e9\u5668:     0x4c585d74\n[0] age:    0x0000...0012  (18)\n[1] offset: 0x0000...0060  (96\uff0c\u6307\u5411 name \u7684 tail)\n[2] grades: 0x0000...005f  (95)\n[3] length: 0x0000...0005  (5\uff0c\"Alice\" \u7684\u957f\u5ea6)\n[4] data:   0x416c69636500...00  (\"Alice\" + padding)\n</code></pre> <p>\u4e3a\u4ec0\u4e48 offset = 0x60\uff1f</p> <ul> <li>head \u533a\u6709 3 \u4e2a\u53c2\u6570\uff0c\u6bcf\u4e2a 32 \u5b57\u8282</li> <li>head = 3 \u00d7 32 = 96 bytes = 0x60</li> <li>\u6240\u4ee5 <code>_name</code> \u7684 tail \u4ece 0x60 \u5f00\u59cb</li> </ul> <p>\u6838\u5fc3\u89c4\u5219\uff1astatic \u53c2\u6570\u76f4\u63a5\u5b58\u503c\uff0cdynamic \u53c2\u6570\u5728 head \u91cc\u5b58 offset\uff0c\u771f\u5b9e\u5185\u5bb9\u7edf\u4e00\u653e\u5728 tail \u4e2d\u3002</p>"},{"location":"web3/dapp/evm_fundamentals_part3_abi_encoding_and_low-level_calls_240413/#abi","title":"\u56db\u3001ABI \u89e3\u7801","text":"<pre><code>(uint256 a, string memory b) = abi.decode(data, (uint256, string));\n</code></pre> <p>\u624b\u52a8\u89e3\u7801\u6b65\u9aa4\uff1a</p> <ol> <li>\u8df3\u8fc7\u524d 4 \u5b57\u8282\u9009\u62e9\u5668</li> <li>\u6309\u53c2\u6570\u987a\u5e8f\u8bfb\u53d6\u5934\u90e8</li> <li>\u9759\u6001\u7c7b\u578b\u76f4\u63a5\u89e3\u6790</li> <li>\u52a8\u6001\u7c7b\u578b\u6839\u636e offset \u8df3\u8f6c\u5230\u5c3e\u90e8\uff0c\u8bfb\u53d6 length \u548c data</li> </ol>"},{"location":"web3/dapp/evm_fundamentals_part3_abi_encoding_and_low-level_calls_240413/#_8","title":"\u4e94\u3001\u4e09\u79cd\u5e95\u5c42\u8c03\u7528","text":"\u64cd\u4f5c\u7801 \u7528\u9014 \u4e00\u53e5\u8bdd\u63cf\u8ff0 call \u666e\u901a\u8c03\u7528 \u8c03\u7528\u522b\u4eba\u7684\u4ee3\u7801\uff0c\u64cd\u4f5c\u522b\u4eba\u7684\u5b58\u50a8 delegatecall \u59d4\u6258\u8c03\u7528 \u501f\u7528\u522b\u4eba\u7684\u4ee3\u7801\uff0c\u64cd\u4f5c\u81ea\u5df1\u7684\u5b58\u50a8 staticcall \u53ea\u8bfb\u8c03\u7528 \u8c03\u7528\u522b\u4eba\u7684\u4ee3\u7801\uff0c\u7981\u6b62\u4efb\u4f55\u72b6\u6001\u4fee\u6539"},{"location":"web3/dapp/evm_fundamentals_part3_abi_encoding_and_low-level_calls_240413/#_9","title":"\u4e0a\u4e0b\u6587\u5bf9\u6bd4","text":"<p>\u5f53\u5408\u7ea6 A \u8c03\u7528\u5408\u7ea6 B \u65f6\uff1a</p> \u4e0a\u4e0b\u6587 call delegatecall staticcall msg.sender A \u4fdd\u6301\u539f\u503c A msg.value \u53ef\u6307\u5b9a \u4fdd\u6301\u539f\u503c 0 \u4ee3\u7801\u6765\u6e90 B B B \u5b58\u50a8\u64cd\u4f5c B \u7684\u5b58\u50a8 A \u7684\u5b58\u50a8 \u7981\u6b62\u5199\u5165 address(this) B A B <p>delegatecall \u7684\u672c\u8d28\uff1a\"\u501f\u58f3\u6267\u884c\"\u2014\u2014\u4ee3\u7801\u662f B \u7684\uff0c\u4f46\u6267\u884c\u73af\u5883\u5b8c\u5168\u662f A \u7684\u3002</p>"},{"location":"web3/dapp/evm_fundamentals_part3_abi_encoding_and_low-level_calls_240413/#_10","title":"\u8fd4\u56de\u503c\u5904\u7406","text":"<pre><code>(bool success, bytes memory data) = target.call(payload);\n</code></pre> <ul> <li><code>success</code>\uff1a\u8c03\u7528\u662f\u5426\u6210\u529f\uff08\u672a revert\uff09</li> <li><code>data</code>\uff1a\u8fd4\u56de\u7684\u539f\u59cb\u5b57\u8282\u6570\u636e</li> </ul>"},{"location":"web3/dapp/evm_fundamentals_part3_abi_encoding_and_low-level_calls_240413/#_11","title":"\u516d\u3001\u5e95\u5c42\u8c03\u7528\u7684\u9519\u8bef\u5904\u7406","text":""},{"location":"web3/dapp/evm_fundamentals_part3_abi_encoding_and_low-level_calls_240413/#vs","title":"\u9ad8\u7ea7\u8c03\u7528 vs \u5e95\u5c42\u8c03\u7528","text":"\u8c03\u7528\u65b9\u5f0f \u5f02\u5e38\u884c\u4e3a \u9ad8\u7ea7\u8c03\u7528\uff08\u63a5\u53e3\u8c03\u7528\uff09 \u5f02\u5e38\u81ea\u52a8\"\u5192\u6ce1\"\uff0c\u6574\u4e2a\u4ea4\u6613\u56de\u6eda \u5e95\u5c42\u8c03\u7528 \u8fd4\u56de <code>(false, errorData)</code>\uff0c\u4e0d\u4f1a\u81ea\u52a8\u56de\u6eda <p>\u5e95\u5c42\u8c03\u7528\u628a\u9519\u8bef\u5904\u7406\u7684\u51b3\u5b9a\u6743\u4ea4\u7ed9\u8c03\u7528\u8005\u3002\u4f60\u53ef\u4ee5\u9009\u62e9\uff1a</p> <ul> <li>\u5ffd\u7565\u9519\u8bef\uff0c\u7ee7\u7eed\u6267\u884c</li> <li>\u5192\u6ce1\u9519\u8bef\uff0c\u56de\u6eda\u6574\u4e2a\u4ea4\u6613</li> <li>\u89e3\u7801\u9519\u8bef\uff0c\u505a\u9488\u5bf9\u6027\u5904\u7406</li> </ul>"},{"location":"web3/dapp/evm_fundamentals_part3_abi_encoding_and_low-level_calls_240413/#returndata","title":"returndata \u7684\u7ed3\u6784","text":"<p>\u5f53\u88ab\u8c03\u7528\u5408\u7ea6 revert \u65f6\uff0c\u8fd4\u56de\u7684 <code>data</code> \u5305\u542b\u9519\u8bef\u4fe1\u606f\uff1a</p> <p></p> <p>\u5e38\u89c1\u7684\u9519\u8bef\u9009\u62e9\u5668\uff1a</p> \u9519\u8bef\u7c7b\u578b \u9009\u62e9\u5668 \u6765\u6e90 Error(string) 0x08c379a0 require(\"message\") \u6216 revert(\"message\") Panic(uint256) 0x4e487b71 assert \u5931\u8d25\u3001\u6ea2\u51fa\u3001\u9664\u96f6\u7b49 \u81ea\u5b9a\u4e49\u9519\u8bef \u5404\u4e0d\u76f8\u540c error CustomError(...)"},{"location":"web3/dapp/evm_fundamentals_part3_abi_encoding_and_low-level_calls_240413/#1","title":"\u65b9\u5f0f 1\uff1a\u76f4\u63a5\u5192\u6ce1\u539f\u59cb\u9519\u8bef","text":"<p>\u573a\u666f\uff1a\u4e0d\u5173\u5fc3\u5177\u4f53\u9519\u8bef\u5185\u5bb9\uff0c\u53ea\u9700\u8981\u628a\u9519\u8bef\u539f\u6837\u4f20\u9012\u7ed9\u4e0a\u5c42\u8c03\u7528\u8005\u3002</p> <pre><code>function forwardCall(address target, bytes calldata payload) external returns (bytes memory) {\n    (bool success, bytes memory data) = target.call(payload);\n\n    if (!success) {\n        assembly {\n            // data \u7684\u524d 32 \u5b57\u8282\u662f\u957f\u5ea6\uff0c\u5b9e\u9645\u6570\u636e\u4ece data + 32 \u5f00\u59cb\n            revert(add(data, 32), mload(data))\n        }\n    }\n\n    return data;\n}\n</code></pre> <p>\u539f\u7406\u89e3\u6790\uff1a</p> <p></p> <ul> <li><code>add(data, 32)</code>\uff1a\u8df3\u8fc7\u957f\u5ea6\u5b57\u6bb5\uff0c\u6307\u5411\u5b9e\u9645\u6570\u636e</li> <li><code>mload(data)</code>\uff1a\u8bfb\u53d6\u6570\u636e\u957f\u5ea6</li> </ul>"},{"location":"web3/dapp/evm_fundamentals_part3_abi_encoding_and_low-level_calls_240413/#2_1","title":"\u65b9\u5f0f 2\uff1a\u89e3\u7801\u9519\u8bef\u4fe1\u606f","text":"<p>\u573a\u666f\uff1a\u9700\u8981\u6839\u636e\u9519\u8bef\u7c7b\u578b\u505a\u4e0d\u540c\u5904\u7406\uff0c\u6216\u8005\u9700\u8981\u8bb0\u5f55/\u8f6c\u6362\u9519\u8bef\u4fe1\u606f\u3002</p> <pre><code>function decodeError(bytes memory data) internal pure returns (string memory) {\n    if (data.length &lt; 4) {\n        return \"Unknown error\";\n    }\n\n    bytes4 selector;\n    assembly {\n        selector := mload(add(data, 32))\n    }\n\n    // Error(string) \u7684\u9009\u62e9\u5668\n    if (selector == 0x08c379a0 &amp;&amp; data.length &gt;= 68) {\n        assembly {\n            data := add(data, 4)  // \u8df3\u8fc7 selector\n        }\n        return abi.decode(data, (string));\n    }\n\n    // Panic(uint256) \u7684\u9009\u62e9\u5668\n    if (selector == 0x4e487b71 &amp;&amp; data.length &gt;= 36) {\n        uint256 panicCode;\n        assembly {\n            panicCode := mload(add(data, 36))\n        }\n        // \u6839\u636e panicCode \u8fd4\u56de\u5bf9\u5e94\u63cf\u8ff0\n        if (panicCode == 0x01) return \"Assertion failed\";\n        if (panicCode == 0x11) return \"Arithmetic overflow\";\n        if (panicCode == 0x12) return \"Division by zero\";\n        // ... \u5176\u4ed6 panic code\n    }\n\n    return \"Unknown error\";\n}\n</code></pre>"},{"location":"web3/dapp/evm_fundamentals_part3_abi_encoding_and_low-level_calls_240413/#_12","title":"\u4e24\u79cd\u65b9\u5f0f\u7684\u5bf9\u6bd4","text":"\u7ef4\u5ea6 \u76f4\u63a5\u5192\u6ce1 \u89e3\u7801\u5904\u7406 \u4ee3\u7801\u590d\u6742\u5ea6 \u4f4e\uff08\u51e0\u884c assembly\uff09 \u9ad8\uff08\u9700\u8981\u89e3\u7801\u903b\u8f91\uff09 Gas \u6d88\u8017 \u4f4e \u8f83\u9ad8 \u9519\u8bef\u4fe1\u606f \u4fdd\u7559\u539f\u59cb\u4fe1\u606f \u53ef\u4ee5\u8f6c\u6362/\u589e\u5f3a \u9002\u7528\u573a\u666f \u4ee3\u7406\u5408\u7ea6\u3001\u7b80\u5355\u8f6c\u53d1 \u9700\u8981\u9519\u8bef\u65e5\u5fd7\u3001\u9519\u8bef\u8f6c\u6362"},{"location":"web3/dapp/evm_fundamentals_part3_abi_encoding_and_low-level_calls_240413/#_13","title":"\u4ee3\u7406\u5408\u7ea6\u7684\u5178\u578b\u5199\u6cd5","text":"<pre><code>fallback() external payable {\n    address impl = implementation;\n    assembly {\n        calldatacopy(0, 0, calldatasize())\n        let result := delegatecall(gas(), impl, 0, calldatasize(), 0, 0)\n        returndatacopy(0, 0, returndatasize())\n\n        switch result\n        case 0 { revert(0, returndatasize()) }\n        default { return(0, returndatasize()) }\n    }\n}\n</code></pre>"},{"location":"web3/dapp/evm_fundamentals_part3_abi_encoding_and_low-level_calls_240413/#_14","title":"\u5c0f\u7ed3","text":"<p>\u672c\u6587\u4ecb\u7ecd\u4e86 ABI \u7f16\u7801\u548c\u5e95\u5c42\u8c03\u7528\u7684\u6838\u5fc3\u77e5\u8bc6\uff1a</p> <ol> <li>\u51fd\u6570\u9009\u62e9\u5668\uff1akeccak256 \u54c8\u5e0c\u7684\u524d 4 \u5b57\u8282</li> <li>\u9759\u6001\u7c7b\u578b\uff1a\u586b\u5145\u5230 32 \u5b57\u8282\uff0c\u6309\u987a\u5e8f\u62fc\u63a5</li> <li>\u52a8\u6001\u7c7b\u578b\uff1ahead \u5b58 offset\uff0ctail \u5b58 length + data</li> <li>\u4e09\u79cd\u8c03\u7528\uff1acall/delegatecall/staticcall \u4e0a\u4e0b\u6587\u4e0d\u540c</li> <li>\u9519\u8bef\u5904\u7406\uff1a\u53ef\u4ee5\u5192\u6ce1\u539f\u59cb\u9519\u8bef\uff0c\u4e5f\u53ef\u4ee5\u89e3\u7801\u5904\u7406</li> </ol> <p>\u7406\u89e3\u8fd9\u4e9b\u5e95\u5c42\u673a\u5236\uff0c\u80fd\u5e2e\u52a9\u4f60\uff1a</p> <ul> <li>\u624b\u52a8\u6784\u9020\u4ea4\u6613\u6570\u636e</li> <li>\u89e3\u6790\u94fe\u4e0a\u7684 calldata \u548c returndata</li> <li>\u7f16\u5199\u66f4\u5b89\u5168\u7684\u4ee3\u7406\u5408\u7ea6</li> <li>\u6392\u67e5\u8c03\u7528\u5931\u8d25\u7684\u6839\u672c\u539f\u56e0</li> </ul>"},{"location":"web3/dapp/evm_fundamentals_part3_abi_encoding_and_low-level_calls_240413/#_15","title":"\u7cfb\u5217\u603b\u7ed3","text":"<p>\u81f3\u6b64\uff0cEVM \u57fa\u7840\u539f\u7406\u7cfb\u5217\u4e09\u7bc7\u6587\u7ae0\u5df2\u5168\u90e8\u5b8c\u6210\u3002\u8ba9\u6211\u4eec\u56de\u987e\u6574\u4e2a\u7cfb\u5217\u7684\u77e5\u8bc6\u8109\u7edc\uff1a</p> <p>\u7b2c\u4e00\u7bc7\uff1a\u4ece\u4ea4\u6613\u5230\u5b57\u8282\u7801 \u2014\u2014 \u5efa\u7acb EVM \u7684\u6574\u4f53\u8ba4\u77e5\u3002\u6211\u4eec\u4e86\u89e3\u4e86\u4ee5\u592a\u574a\u4f5c\u4e3a\u72b6\u6001\u673a\u7684\u672c\u8d28\uff0c\u4ea4\u6613\u5982\u4f55\u9a71\u52a8\u72b6\u6001\u53d8\u5316\uff0c\u4ee5\u53ca Solidity \u4ee3\u7801\u5982\u4f55\u7f16\u8bd1\u6210 EVM \u53ef\u6267\u884c\u7684\u5b57\u8282\u7801\u3002\u51fd\u6570\u9009\u62e9\u5668\u7684\u8def\u7531\u673a\u5236\u63ed\u793a\u4e86 EVM \u5982\u4f55\u627e\u5230\u5e76\u6267\u884c\u76ee\u6807\u51fd\u6570\u3002</p> <p>\u7b2c\u4e8c\u7bc7\uff1a\u6570\u636e\u533a\u57df\u4e0e\u5408\u7ea6\u6267\u884c \u2014\u2014 \u6df1\u5165 EVM \u7684\u6570\u636e\u7ba1\u7406\u3002\u6808\u3001\u5185\u5b58\u3001\u5b58\u50a8\u4e09\u4e2a\u6570\u636e\u533a\u57df\u5404\u6709\u7279\u70b9\u548c\u6210\u672c\u5dee\u5f02\uff0c\u7406\u89e3\u5b83\u4eec\u662f Gas \u4f18\u5316\u7684\u57fa\u7840\u3002\u5408\u7ea6\u7684\u90e8\u7f72\u548c\u8c03\u7528\u673a\u5236\u5219\u5c55\u793a\u4e86 EVM \u5982\u4f55\u7ba1\u7406\u5408\u7ea6\u7684\u751f\u547d\u5468\u671f\u3002</p> <p>\u7b2c\u4e09\u7bc7\uff1aABI \u7f16\u7801\u4e0e\u5e95\u5c42\u8c03\u7528 \u2014\u2014 \u638c\u63e1\u4e0e\u5408\u7ea6\u4ea4\u4e92\u7684\u5e95\u5c42\u534f\u8bae\u3002ABI \u7f16\u7801\u89c4\u5219\u51b3\u5b9a\u4e86\u6570\u636e\u5982\u4f55\u5728\u5408\u7ea6\u95f4\u4f20\u9012\uff0c\u5e95\u5c42\u8c03\u7528\u7684\u4e09\u79cd\u65b9\u5f0f\u4e3a\u4e0d\u540c\u573a\u666f\u63d0\u4f9b\u4e86\u7075\u6d3b\u7684\u9009\u62e9\u3002</p> <p>\u8fd9\u4e09\u7bc7\u6587\u7ae0\u6784\u6210\u4e86\u4e00\u4e2a\u5b8c\u6574\u7684\u5b66\u4e60\u8def\u5f84\uff1a\u4ece\u5b8f\u89c2\u8ba4\u77e5\u5230\u6570\u636e\u7ba1\u7406\uff0c\u518d\u5230\u4ea4\u4e92\u534f\u8bae\u3002\u638c\u63e1\u8fd9\u4e9b\u57fa\u7840\u77e5\u8bc6\u540e\uff0c\u4f60\u5c06\u80fd\u591f\uff1a</p> <ul> <li>\u66f4\u6df1\u5165\u5730\u7406\u89e3 Solidity \u4ee3\u7801\u7684\u6267\u884c\u8fc7\u7a0b</li> <li>\u6709\u9488\u5bf9\u6027\u5730\u8fdb\u884c Gas \u4f18\u5316</li> <li>\u6392\u67e5\u548c\u89e3\u51b3\u5e95\u5c42\u8c03\u7528\u95ee\u9898</li> <li>\u4e3a\u5b66\u4e60\u66f4\u9ad8\u7ea7\u7684\u4e3b\u9898\uff08\u5982\u4ee3\u7406\u6a21\u5f0f\u3001\u5185\u8054\u6c47\u7f16\u3001\u5b89\u5168\u5ba1\u8ba1\uff09\u6253\u4e0b\u575a\u5b9e\u57fa\u7840</li> </ul> <p>EVM \u7684\u4e16\u754c\u8fdc\u4e0d\u6b62\u4e8e\u6b64\uff0c\u4f46\u6709\u4e86\u8fd9\u4e9b\u57fa\u7840\uff0c\u4f60\u5df2\u7ecf\u5177\u5907\u4e86\u7ee7\u7eed\u6df1\u5165\u63a2\u7d22\u7684\u80fd\u529b\u3002</p> <p>\u7cfb\u5217\u5bfc\u822a\uff1a</p> <ul> <li>\u7b2c\u4e00\u7bc7\uff1aEVM \u57fa\u7840\u539f\u7406\uff08\u4e00\uff09\uff1a\u4ece\u4ea4\u6613\u5230\u5b57\u8282\u7801</li> <li>\u7b2c\u4e8c\u7bc7\uff1aEVM \u57fa\u7840\u539f\u7406\uff08\u4e8c\uff09\uff1aEVM \u6570\u636e\u533a\u57df\u4e0e\u5408\u7ea6\u6267\u884c</li> <li>\u7b2c\u4e09\u7bc7\uff1aEVM \u57fa\u7840\u539f\u7406\uff08\u4e09\uff09\uff1aABI \u7f16\u7801\u4e0e\u5e95\u5c42\u8c03\u7528\uff08\u672c\u7bc7\uff09</li> </ul>"},{"location":"web3/dapp/gas_optimization_guide_part1_gas_mechanism/","title":"Gas \u4f18\u5316\u6307\u5357\uff08\u4e00\uff09\uff1aGas \u673a\u5236\u539f\u7406","text":"<p> \u7ea6 2980 \u4e2a\u5b57  11 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 10 \u5206\u949f</p> <p>\u672c\u7bc7\u662f Gas \u4f18\u5316\u7cfb\u5217\u7684\u7b2c\u4e00\u7bc7\uff0c\u805a\u7126\u4e8e Gas \u673a\u5236\u7684\u5e95\u5c42\u539f\u7406\u3002</p> <p>\u6211\u4eec\u5c06\u4ece Gas \u7684\u8bbe\u8ba1\u54f2\u5b66\u51fa\u53d1\uff0c\u9010\u6b65\u62c6\u89e3\u4ea4\u6613\u8d39\u7528\u7684\u6784\u6210\u3001EIP-1559 \u5b9a\u4ef7\u6a21\u578b\u3001\u64cd\u4f5c\u7801\u6210\u672c\u5206\u7ea7\u3001\u51b7\u70ed\u8bbf\u95ee\u673a\u5236\uff0c\u4ee5\u53ca SSTORE \u7684\u6838\u5fc3\u5b9a\u4ef7\u89c4\u5219\u3002\u7406\u89e3\u8fd9\u4e9b\u57fa\u7840\u77e5\u8bc6\uff0c\u662f\u540e\u7eed\u8fdb\u884c Gas \u4f18\u5316\u7684\u524d\u63d0\u3002</p>"},{"location":"web3/dapp/gas_optimization_guide_part1_gas_mechanism/#gas","title":"\u4e00\u3001Gas \u662f\u4ec0\u4e48","text":"<p>Gas \u662f EVM \u7684\"\u71c3\u6599\"\uff0c\u7528\u4e8e\u8861\u91cf\u8ba1\u7b97\u5de5\u4f5c\u91cf\u3002\u5176\u8bbe\u8ba1\u76ee\u7684\u4e3b\u8981\u5305\u62ec\uff1a</p> <ul> <li>\u9632\u6b62\u65e0\u9650\u5faa\u73af\uff1a\u5fc5\u987b\u4ed8\u8d39\u624d\u80fd\u6267\u884c\u4ee3\u7801\uff0c\u4ece\u673a\u5236\u4e0a\u963b\u6b62\u6076\u610f\u6216\u65e0\u7a77\u8ba1\u7b97</li> <li>\u516c\u5e73\u5206\u914d\u533a\u5757\u7a7a\u95f4\uff1a\u533a\u5757\u7a7a\u95f4\u6709\u9650\uff0c\u901a\u8fc7\u7ade\u4ef7\u673a\u5236\u5206\u914d\u6267\u884c\u6743</li> <li>\u53cd\u6620\u771f\u5b9e\u7684\u8ba1\u7b97\u6210\u672c\uff1a\u64cd\u4f5c\u8d8a\u590d\u6742\uff0c\u5bf9\u7f51\u7edc\u8d1f\u62c5\u8d8a\u91cd\uff0c\u5bf9\u5e94 Gas \u8d8a\u9ad8</li> </ul> <p>EVM \u7684\u57fa\u672c\u8ba1\u8d39\u89c4\u5219\uff1a\u6bcf\u6761 EVM \u6307\u4ee4\u90fd\u6709\u56fa\u5b9a\u7684 Gas \u6210\u672c\uff0c\u4e00\u7b14\u4ea4\u6613\u7684\u603b Gas \u6d88\u8017\u7b49\u4e8e\u6240\u6709\u6267\u884c\u6307\u4ee4\u7684\u6210\u672c\u4e4b\u548c\u3002</p> <p>\u4ee5\u592a\u574a\u4e2d\u7684\u8ba1\u91cf\u5355\u4f4d\uff1a</p> \u5355\u4f4d \u76f8\u5f53\u4e8e \u7528\u9014 \u79d1\u5b66\u8ba1\u6570\u6cd5 1 ETH 1 Ether \u8d26\u6237\u4f59\u989d\u3001\u8f6c\u8d26\u91d1\u989d 10^0 ETH 1 Gwei 0.000000001 ETH \u8ba1\u7b97 Gas \u4ef7\u683c 10^-9 ETH 1 wei 0.000000000000000001 ETH \u6700\u5c0f\u5355\u4f4d 10^-18 ETH <p>wei\uff08\u6700\u5c0f\u5355\u4f4d\uff09\uff1a\u5408\u7ea6\u4e0e\u534f\u8bae\u5c42\u7edf\u4e00\u4f7f\u7528\u6574\u6570\u8fd0\u7b97\uff0c\u6240\u6709\u91d1\u989d\u6700\u7ec8\u90fd\u4ee5 wei \u4e3a\u5355\u4f4d\u5b58\u50a8\u548c\u8ba1\u7b97\uff0c\u907f\u514d\u6d6e\u70b9\u6570\u7cbe\u5ea6\u95ee\u9898\u3002</p> <p>gwei\uff08\u6700\u5e38\u7528\u5355\u4f4d\uff09\uff1a\u8fd9\u662f\u65e5\u5e38\u4f7f\u7528\u6700\u9891\u7e41\u7684\u5355\u4f4d\uff0c\u4e3b\u8981\u7528\u4e8e\u8868\u793a Gas \u4ef7\u683c\u3002\u5f53\u4f60\u5728\u94b1\u5305\uff08\u5982 MetaMask\uff09\u8bbe\u7f6e\u4ea4\u6613\u624b\u7eed\u8d39\u65f6\uff0c\u770b\u5230\u7684 \"Gas Price\" \u6216 \"Max Priority Fee\" \u901a\u5e38\u5c31\u662f\u4ee5 gwei \u4e3a\u5355\u4f4d\u3002\u4f8b\u5982\uff0c\"Gas Price: 20 gwei\" \u610f\u5473\u7740\u4f60\u613f\u610f\u4e3a\u6bcf\u4e2a\u8ba1\u7b97\u6b65\u9aa4\u652f\u4ed8 20 gwei\u3002</p> <p>ETH\uff08\u6807\u51c6\u5355\u4f4d\uff09\uff1a\u7528\u4e8e\u8868\u793a\u8d26\u6237\u4f59\u989d\u3001\u8f6c\u8d26\u91d1\u989d\u3001\u4ee3\u5e01\u4ef7\u683c\u7b49\u5b8f\u89c2\u6570\u503c\u3002\u6211\u4eec\u5e73\u65f6\u8bf4\"\u6211\u6709\u4e00\u4e2a\u4ee5\u592a\u5e01\"\uff0c\u6307\u7684\u5c31\u662f 1 ETH\u3002</p>"},{"location":"web3/dapp/gas_optimization_guide_part1_gas_mechanism/#_1","title":"\u4e8c\u3001\u4ea4\u6613\u8d39\u7528\u6784\u6210","text":"<p>\u4e00\u7b14\u4ea4\u6613\u7684 Gas \u6d88\u8017\u5206\u4e3a\u4e24\u90e8\u5206\uff1a\u603b Gas = Intrinsic Gas + Execution Gas</p> <p>Intrinsic Gas\uff08\u56fa\u6709\u6210\u672c\uff09</p> <p>Intrinsic Gas \u672c\u8d28\u4e0a\u662f\u5728\u4e3a\"\u4ea4\u6613\u8fdb\u5165 EVM \u6267\u884c\u73af\u5883\u4e4b\u524d\"\u7684\u884c\u4e3a\u4ed8\u8d39\uff0c\u5b83\u662f\u4ea4\u6613\u672c\u8eab\u7684\u57fa\u7840\u6210\u672c\uff0c\u4e0e\u5408\u7ea6\u6267\u884c\u65e0\u5173\u3002\u5305\u62ec\uff1a\u4ea4\u6613\u7b7e\u540d\u9a8c\u8bc1\u3001nonce \u6821\u9a8c\u3001\u8d26\u6237\u5b58\u5728\u6027\u68c0\u67e5\u3001calldata \u5b57\u8282\u62f7\u8d1d\u7b49\u3002</p> \u7ec4\u6210\u90e8\u5206 Gas \u6210\u672c \u57fa\u7840\u8d39\u7528 21,000 \u6bcf\u5b57\u8282\u96f6\u503c calldata 4 \u6bcf\u5b57\u8282\u975e\u96f6\u503c calldata 16 \u521b\u5efa\u5408\u7ea6\u989d\u5916\u8d39\u7528 32,000 <p>\u793a\u4f8b\uff1a\u4e00\u7b14\u7b80\u5355\u7684 ETH \u8f6c\u8d26\uff0ccalldata \u4e3a\u7a7a\uff0c\u6d88\u8017 21,000 Gas\u3002</p> <p>Execution Gas\uff08\u6267\u884c\u6210\u672c\uff09</p> <p>\u5408\u7ea6\u4ee3\u7801\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u6bcf\u6761\u6307\u4ee4\u7684 Gas \u6210\u672c\u7d2f\u52a0\u3002</p> <p>EVM \u4e0d\u5173\u5fc3\u4f60\u5728\u505a\u4ec0\u4e48\u4e1a\u52a1\uff0c\u5b83\u53ea\u5bf9\u4e09\u4ef6\u4e8b\u60c5\u6536\u8d39\uff1a</p> <ul> <li>\u4f60\u8f93\u5165\u4e86\u591a\u5c11\u5b57\u8282</li> <li>\u4f60\u6267\u884c\u4e86\u591a\u5c11\u6307\u4ee4</li> <li>\u4f60\u662f\u5426\u6539\u53d8\u4e86\u5168\u7f51\u72b6\u6001</li> </ul> <p>\u5728\u6df1\u5165\u7ec6\u8282\u4e4b\u524d\uff0c\u5148\u8bb0\u4f4f\u8fd9\u4e2a\u6a21\u578b\u3002\u4ee5\u592a\u574a\u4e0a\u4efb\u4f55\u4e00\u7b14\u4ea4\u6613\u7684 Gas \u6d88\u8017\uff0c\u90fd\u53ef\u4ee5\u5f52\u5165\u4e09\u4e2a\u6765\u6e90\uff1a</p> <pre><code>       \u5b58\u50a8\u6210\u672c\n       \uff08\u6700\u8d35\uff09\n          /\\\n         /  \\\n        /    \\\n       /      \\\n      /________\\\n \u6267\u884c\u6210\u672c    \u6570\u636e\u6210\u672c\n \uff08\u4e2d\u7b49\uff09   \uff08\u6309\u5b57\u8282\uff09\n</code></pre> \u6210\u672c\u7c7b\u578b \u6765\u6e90 \u91cf\u7ea7 \u5b58\u50a8\u6210\u672c \u8bfb\u5199 Storage\uff08SLOAD/SSTORE\uff09 100 ~ 22,100 Gas \u6267\u884c\u6210\u672c \u8fd0\u7b97\u6307\u4ee4\uff08ADD/MUL/JUMP \u7b49\uff09 3 ~ 10 Gas \u6570\u636e\u6210\u672c Calldata\uff08\u4ea4\u6613\u8f93\u5165\u6570\u636e\uff09\u3001Log\uff08\u4e8b\u4ef6\u65e5\u5fd7\uff09 Calldata\uff1a4 Gas/\u96f6\u5b57\u8282\uff0c16 Gas/\u975e\u96f6\u5b57\u8282Log\uff1a375 \u57fa\u7840 + 375/topic + 8/\u6570\u636e\u5b57\u8282 <p>\u5728\u5927\u591a\u6570\u9700\u8981\u5199\u5165\u72b6\u6001\u7684\u4e1a\u52a1\u5408\u7ea6\u4e2d\uff0c\u5b58\u50a8\u8bfb\u5199\u5f80\u5f80\u662f\u6210\u672c\u5927\u5934\uff0c\u6240\u4ee5\u6211\u4eec\u9ed8\u8ba4\u5148\u4ece Storage \u627e\u70ed\u70b9\u3002\u4f46\u7eaf\u8bfb\u5408\u7ea6\u3001\u7b7e\u540d\u9a8c\u8bc1\u5408\u7ea6\u3001\u6279\u91cf\u64cd\u4f5c\u5408\u7ea6\u53ef\u80fd\u5448\u73b0\u4e0d\u540c\u7684\u6210\u672c\u5206\u5e03\uff0c\u5177\u4f53\u95ee\u9898\u5177\u4f53\u5206\u6790\u3002</p>"},{"location":"web3/dapp/gas_optimization_guide_part1_gas_mechanism/#eip-1559","title":"\u4e09\u3001EIP-1559 \u8d39\u7528\u6a21\u578b","text":"<p>2021 \u5e74 8 \u6708\u4f26\u6566\u5347\u7ea7\u540e\uff0c\u5728 EIP-1559 \u673a\u5236\u4e0b\uff0c\u4ea4\u6613\u8d39\u7528\u8ba1\u7b97\u65b9\u5f0f\u4e3a\uff1a</p> <p>\u4ea4\u6613\u8d39\u7528 = Gas Used \u00d7 (Base Fee + Priority Fee)</p> \u8d39\u7528\u7c7b\u578b \u8bf4\u660e Gas Used \u4ea4\u6613\u5b9e\u9645\u6d88\u8017\u7684 Gas \u6570\u91cf Base Fee \u5f53\u524d\u533a\u5757\u7684\u57fa\u7840\u8d39\u7528\uff08\u5355\u4f4d\uff1awei/gas \u6216 gwei/gas\uff09\uff0c\u7531\u7f51\u7edc\u6839\u636e\u62e5\u5835\u7a0b\u5ea6\u52a8\u6001\u8c03\u6574\uff0c\u4f1a\u88ab\u9500\u6bc1 Priority Fee \u7528\u6237\u613f\u610f\u652f\u4ed8\u7ed9\u9a8c\u8bc1\u8005\u7684\u6700\u9ad8\u5c0f\u8d39\uff08\u5355\u4f4d\uff1awei/gas \u6216 gwei/gas\uff09\uff0c\u5b9e\u9645\u652f\u4ed8\u91d1\u989d\u53ef\u80fd\u4f4e\u4e8e\u8be5\u503c <p>\u9700\u8981\u6ce8\u610f\uff1aEIP-1559 \u2260 Gas \u4f18\u5316\uff0c\u5b83\u53ea\u662f\u5b9a\u4ef7\u6a21\u578b\uff0c\u771f\u6b63\u7684\u4f18\u5316\u53d1\u751f\u5728 EVM opcode \u5c42\u3002</p> <p>Gas \u4f18\u5316\u53d1\u751f\u5728 opcode \u5c42\u3001storage \u5e03\u5c40\u5c42\u3001calldata \u4e0e memory \u5c42\uff0c\u800c EIP-1559 \u53ea\u89e3\u51b3\"\u6bcf\u5355\u4f4d Gas \u591a\u5c11\u94b1\"\u7684\u95ee\u9898\u3002</p> <p>Max Fee \u548c Max Priority Fee</p> <p>\u4e3a\u4e86\u4fdd\u62a4\u7528\u6237\uff0cEIP-1559 \u5f15\u5165\u4e86\u4e24\u4e2a\u4e0a\u9650\u53c2\u6570\uff1a</p> <ul> <li>Max Fee Per Gas\uff1a\u7528\u6237\u613f\u610f\u652f\u4ed8\u7684\u6700\u9ad8\u603b\u8d39\u7528\uff08\u5305\u62ec\u57fa\u7840\u8d39\u7528\u548c\u4f18\u5148\u8d39\u7528\uff09</li> <li>Max Priority Fee Per Gas\uff1a\u7528\u6237\u613f\u610f\u652f\u4ed8\u7684\u6700\u9ad8\u4f18\u5148\u8d39\u7528</li> </ul> <p>\u5b9e\u9645\u652f\u4ed8\u7684\u8d39\u7528\u8ba1\u7b97\u62c6\u89e3\u5982\u4e0b\uff1a</p> <p>\u7b2c\u4e00\u6b65\uff0c\u5b9a\u4e49\u6709\u6548\u5c0f\u8d39\uff1a</p> <pre><code>effectivePriorityFee = min(MaxPriorityFee, MaxFee \u2212 BaseFee)\n</code></pre> <p>\u7b2c\u4e8c\u6b65\uff0c\u5b9a\u4e49\u6700\u7ec8 Gas Price\uff1a</p> <pre><code>effectiveGasPrice = BaseFee + effectivePriorityFee\n</code></pre> <p>\u6700\u7ec8\u8d39\u7528\uff1a</p> <pre><code>txFee = gasUsed \u00d7 effectiveGasPrice\n</code></pre> <p>\u8fd9\u4e00\u6b65\u62c6\u89e3\u5728\u6559\u5b66\u4e2d\u975e\u5e38\u91cd\u8981\uff0c\u56e0\u4e3a\u533a\u5757\u6d4f\u89c8\u5668\u3001RPC \u8fd4\u56de\u503c\u3001EVM trace\u3001receipt.effectiveGasPrice \u5168\u90e8\u90fd\u5728\u4f7f\u7528\u8fd9\u4e2a\u4e2d\u95f4\u53d8\u91cf\u3002</p> <p>\u4e0a\u8ff0\u8fc7\u7a0b\u5408\u5728\u4e00\u8d77\u7684\u8ba1\u7b97\u516c\u5f0f\u4e3a\uff1a</p> <pre><code>\u5b9e\u9645\u8d39\u7528 = Gas Used \u00d7 min(Max Fee, Base Fee + min(Max Priority Fee, Max Fee - Base Fee))\n</code></pre> <p>\u591a\u652f\u4ed8\u7684\u90e8\u5206\u4f1a\u81ea\u52a8\u9000\u8fd8\u7ed9\u7528\u6237\u3002</p> <p>\u52a8\u6001\u8c03\u6574\u673a\u5236</p> <ul> <li>\u533a\u5757\u5229\u7528\u7387 &gt; 50%\uff1aBase Fee \u4e0a\u6da8\uff08\u6700\u591a +12.5%\uff09</li> <li>\u533a\u5757\u5229\u7528\u7387 &lt; 50%\uff1aBase Fee \u4e0b\u964d\uff08\u6700\u591a -12.5%\uff09</li> </ul> <p>EIP-1559 \u7684\u8bbe\u8ba1\u662f\u8ba9\u533a\u5757\u5728\u77ed\u671f\u5185\u53ef\u4ee5 0.5x \u5230 2x \u6446\u52a8\uff0c\u4f46\u957f\u671f\u7a33\u5b9a\u5728 targetGasUsed \u9644\u8fd1\u3002</p> <p>Base Fee \u7684\u8c03\u6574\u4f9d\u636e\u662f\u533a\u5757 gasUsed \u4e0e targetGasUsed \u7684\u504f\u79bb\u7a0b\u5ea6\uff0c\u800c\u4e0d\u662f\u7b80\u5355\u7684\u767e\u5206\u6bd4\u89c4\u5219\u3002</p> <p>\u8d39\u7528\u8ba1\u7b97\u793a\u4f8b</p> <p>\u5047\u8bbe\uff1a</p> <ul> <li>Gas Used = 21,000\uff08\u7b80\u5355\u8f6c\u8d26\uff09</li> <li>Base Fee = 30 gwei</li> <li>Priority Fee = 2 gwei</li> <li>Max Fee = 100 gwei</li> <li>Max Priority Fee = 2 gwei</li> </ul> <p>\u8ba1\u7b97\u8fc7\u7a0b\uff1a</p> <ul> <li>\u5b9e\u9645\u4f18\u5148\u8d39\u7528 = min(2 gwei, 100 gwei - 30 gwei) = 2 gwei</li> <li>\u5b9e\u9645\u603b\u8d39\u7528\u6bcf Gas = min(100 gwei, 30 gwei + 2 gwei) = 32 gwei</li> <li>\u4ea4\u6613\u603b\u8d39\u7528 = 21,000 \u00d7 32 gwei = 672,000 gwei = 0.000672 ETH</li> </ul> <p>\u5176\u4e2d\uff1a</p> <ul> <li>\u57fa\u7840\u8d39\u7528\uff1a21,000 \u00d7 30 gwei = 630,000 gwei\uff08\u88ab\u9500\u6bc1\uff09</li> <li>\u4f18\u5148\u8d39\u7528\uff1a21,000 \u00d7 2 gwei = 42,000 gwei\uff08\u652f\u4ed8\u7ed9\u9a8c\u8bc1\u8005\uff09</li> </ul> <p>Gas \u4f18\u5316\u7684\u76f4\u63a5\u5f71\u54cd</p> <p>\u4ece\u4e0a\u8ff0\u516c\u5f0f\u53ef\u4ee5\u770b\u51fa\uff0c\u964d\u4f4e Gas Used \u53ef\u4ee5\u76f4\u63a5\u6309\u6bd4\u4f8b\u51cf\u5c11\u4ea4\u6613\u8d39\u7528\u3002\u5982\u679c\u80fd\u5c06\u5408\u7ea6\u7684 Gas \u6d88\u8017\u4ece 100,000 \u964d\u4f4e\u5230 80,000\uff08\u51cf\u5c11 20%\uff09\uff0c\u90a3\u4e48\u7528\u6237\u7684\u4ea4\u6613\u8d39\u7528\u4e5f\u4f1a\u76f8\u5e94\u51cf\u5c11 20%\u3002</p> <p>\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48 Gas \u4f18\u5316\u5982\u6b64\u91cd\u8981\u2014\u2014\u5b83\u76f4\u63a5\u5f71\u54cd\u5230\u6bcf\u4e00\u4f4d\u7528\u6237\u7684\u94b1\u5305\u3002</p>"},{"location":"web3/dapp/gas_optimization_guide_part1_gas_mechanism/#gas_1","title":"\u56db\u3001\u64cd\u4f5c\u7801 Gas \u6210\u672c\u5206\u7ea7","text":"<p>EVM \u64cd\u4f5c\u7801\u7684 Gas \u6210\u672c\u53cd\u6620\u4e86\u5176\u8ba1\u7b97\u590d\u6742\u5ea6\uff1a</p> \u7b49\u7ea7 Gas \u8303\u56f4 \u5178\u578b\u64cd\u4f5c \u6700\u4fbf\u5b9c 2-3 ADD, SUB, LT, GT, POP \u4fbf\u5b9c 3-5 MUL, DIV, MLOAD, MSTORE \u4e2d\u7b49 10-30 JUMP, JUMPI, CALLDATALOAD \u8f83\u8d35 100-700 BALANCE, EXTCODESIZE, CALL\uff08\u70ed\u8bbf\u95ee\uff09 \u6602\u8d35 2100-2600 SLOAD, CALL\uff08\u51b7\u8bbf\u95ee\uff09 \u975e\u5e38\u6602\u8d35 5000-22100 SSTORE <p>\u5173\u952e\u89c2\u5bdf\uff1a\u5b58\u50a8\u64cd\u4f5c\uff08SLOAD/SSTORE\uff09\u662f\u6700\u6602\u8d35\u7684\uff0c\u56e0\u4e3a\u5b83\u4eec\u6d89\u53ca\u5168\u7f51\u72b6\u6001\u7684\u8bfb\u5199\u3002</p> <p>SLOAD \u8d35\uff0c\u56e0\u4e3a\u9700\u8981\u8bbf\u95ee\u5168\u5c40\u72b6\u6001\u6811\uff1bSSTORE \u66f4\u8d35\uff0c\u56e0\u4e3a\u4f1a\u6539\u53d8\u5171\u8bc6\u72b6\u6001\uff0c\u5f71\u54cd\u6240\u6709\u5168\u8282\u70b9\u3002Gas \u672c\u8d28\u4e0d\u662f CPU \u65f6\u95f4\uff0c\u800c\u662f\u5bf9\u5168\u7f51\u8d1f\u62c5\u7684\u5b9a\u4ef7\u3002</p> <p>\u5f53\u4f60\u60f3\u5224\u65ad\u300c\u54ea\u884c\u4ee3\u7801\u6700\u8d35\u300d\uff0c\u7528\u8fd9\u4e2a\u5feb\u901f\u68c0\u67e5\u987a\u5e8f\uff1a</p> <ol> <li>\u6709 Storage \u5199\u5165\u5417\uff1f \u2192 \u7b2c\u4e00\u4f18\u5148\u7ea7\u70ed\u70b9</li> <li>\u6709 Storage \u8bfb\u53d6\u5417\uff1f \u2192 \u7b2c\u4e8c\u4f18\u5148\u7ea7\u70ed\u70b9</li> <li>\u6709\u5916\u90e8\u8c03\u7528\u5417\uff1f \u2192 \u68c0\u67e5\u662f\u5426\u53ef\u4ee5\u5408\u5e76\u6216\u7f13\u5b58</li> <li>\u6709\u5faa\u73af\u5417\uff1f \u2192 \u68c0\u67e5\u5faa\u73af\u5185\u662f\u5426\u6709\u4e0a\u8ff0\u64cd\u4f5c</li> </ol> <p>\u5148\u627e SSTORE\uff0c\u518d\u627e SLOAD\uff0c\u518d\u627e\u5916\u90e8\u8c03\u7528\uff0c\u6700\u540e\u624d\u4f18\u5316\u8ba1\u7b97\u6307\u4ee4\u3002</p>"},{"location":"web3/dapp/gas_optimization_guide_part1_gas_mechanism/#eip-2929","title":"\u4e94\u3001\u51b7/\u70ed\u8bbf\u95ee\u673a\u5236\uff08EIP-2929\uff09","text":"<p>2021 \u5e74\u67cf\u6797\u5347\u7ea7\u5f15\u5165\u4e86\"\u8bbf\u95ee\u5217\u8868\"\u6982\u5ff5\uff0c\u533a\u5206\u51b7\u8bbf\u95ee\u548c\u70ed\u8bbf\u95ee\u3002</p> <p>\u540c\u4e00\u7b14\u4ea4\u6613\u4e2d\uff1a</p> <ul> <li>\u9996\u6b21\u8bbf\u95ee\u67d0\u4e2a\u5730\u5740\u6216\u5b58\u50a8\u69fd \u2192 \u51b7\u8bbf\u95ee\uff08\u8d35\uff09</li> <li>\u518d\u6b21\u8bbf\u95ee\u540c\u4e00\u5730\u5740\u6216\u5b58\u50a8\u69fd \u2192 \u70ed\u8bbf\u95ee\uff08\u4fbf\u5b9c\uff09</li> </ul> <p>\u51b7\u8bbf\u95ee\u8d35\u7684\u539f\u56e0\u662f EVM \u9700\u8981\u4ece\u5e95\u5c42\u6570\u636e\u5e93\u52a0\u8f7d\u6570\u636e\u5230\u5185\u5b58\uff0c\u70ed\u8bbf\u95ee\u4fbf\u5b9c\u662f\u56e0\u4e3a\u6570\u636e\u5df2\u7ecf\u5728\u5185\u5b58\u4e2d\u4e86\u3002</p> <p>\u51b7/\u70ed\u72b6\u6001\u662f\u4ea4\u6613\u7ea7\u522b\u7684\u6982\u5ff5\uff0c\u4e0d\u662f\u533a\u5757\u7ea7\u522b\u3002\u6bcf\u7b14\u65b0\u4ea4\u6613\u5f00\u59cb\u65f6\uff0c\u6240\u6709\u8bbf\u95ee\u90fd\u91cd\u65b0\u53d8\u6210\u300c\u51b7\u300d\u3002</p> <p>\u5bf9 storage slot \u800c\u8a00\uff1a</p> \u64cd\u4f5c Gas cold SLOAD 2100 warm SLOAD 100 <p>EIP-2929 \u672c\u8d28\u662f\u5728\u60e9\u7f5a\"\u4e0d\u53ef\u9884\u6d4b\u7684\u72b6\u6001\u8bbf\u95ee\"\u3002\u7b2c\u4e00\u6b21\u8bbf\u95ee\u8d35\uff0c\u4e0d\u662f\u56e0\u4e3a\u6162\uff0c\u800c\u662f\u56e0\u4e3a\u8282\u70b9\u65e0\u6cd5\u63d0\u524d\u7f13\u5b58\u3002</p>"},{"location":"web3/dapp/gas_optimization_guide_part1_gas_mechanism/#sstore-eip-2200","title":"\u516d\u3001SSTORE \u7684\u6838\u5fc3\u5b9a\u4ef7\uff08EIP-2200\uff09","text":"\u573a\u666f Gas \u6210\u672c \u8bf4\u660e 0 \u2192 \u975e\u96f6 22,100 \u521b\u5efa\u65b0\u5b58\u50a8\u69fd \u975e\u96f6 \u2192 \u975e\u96f6\uff08\u4e0d\u540c\u503c\uff09 5,000 \u4fee\u6539\u73b0\u6709\u503c \u975e\u96f6 \u2192 0 5,000\uff0c\u9000\u6b3e \u6e05\u9664\u5b58\u50a8\u69fd 0/\u975e\u96f6 \u2192 \u76f8\u540c\u503c 100 \u65e0\u5b9e\u9645\u53d8\u5316 <p>SSTORE \u7684 Gas \u4e3b\u8981\u7531\u300c\u5199\u5165\u524d\u540e slot \u503c\u7684\u53d8\u5316\u7c7b\u578b\u300d\u51b3\u5b9a\uff0c\u800c\u4e0d\u662f cold/warm\u3002\u4f8b\u5982\uff1a</p> <pre><code>_status = 2; // ~5000 gas\n_status = 1; // ~5000 gas\n</code></pre> <p>\u8fd9\u4e24\u4e2a\u90fd\u662f\u975e 0 \u2192 \u975e 0 \u7684 SSTORE\uff0c\u5373\u4f7f\u7b2c\u4e8c\u6b21\u662f warm slot\uff0c\u4f9d\u7136\u662f ~5000 Gas\uff0c\u800c\u4e0d\u662f 2900\u3002</p> \u6982\u5ff5 \u9002\u7528\u6307\u4ee4 \u51b3\u5b9a\u56e0\u7d20 cold/warm SLOAD\u3001slot \u8bbf\u95ee \u672c\u4ea4\u6613\u4e2d\u662f\u5426\u9996\u6b21\u8bbf\u95ee\u8be5 slot SSTORE \u6267\u884c\u6210\u672c SSTORE slot \u7684\u300c\u539f\u59cb\u503c \u2192 \u65b0\u503c\u300d\u53d8\u5316\u7c7b\u578b <p>SSTORE \u2260 SLOAD + \u5199\u5165\uff0cSSTORE \u662f\u4e00\u4e2a\u539f\u5b50\u8bed\u4e49\u64cd\u4f5c\uff0c\u4ee5\u72b6\u6001\u53d8\u5316\u4e3a\u8ba1\u4ef7\u5355\u4f4d\uff0c\u800c\u4e0d\u662f\u4ee5\u6307\u4ee4\u6267\u884c\u4e3a\u8ba1\u4ef7\u5355\u4f4d\u3002</p>"},{"location":"web3/dapp/gas_optimization_guide_part1_gas_mechanism/#gas_2","title":"\u4e03\u3001Gas \u9000\u6b3e\u673a\u5236","text":"<p>\u9000\u6b3e\u673a\u5236\u7684\u6f14\u8fdb\u5386\u7a0b\uff1a</p> <p>\u6700\u65e9\u7248\u672c\uff1a\u975e\u96f6\u21920 = 15,000 refund\uff0crefund cap = 1/2</p> <p>EIP-2200\uff1arefund cap \u964d\u4e3a 1/5</p> <p>EIP-3529\uff1a\u975e\u96f6\u21920 refund \u4ece 15,000 \u2192 4,800\uff0cSELFDESTRUCT refund \u79fb\u9664</p> <p>\u5728 London \u5347\u7ea7\u540e\u7684 EIP-3529 \u4e2d\uff0cSSTORE \u4ece\u975e\u96f6\u503c\u5199\u4e3a 0 \u65f6\u4ecd\u53ef\u83b7\u5f97 Gas \u9000\u6b3e\uff0c\u4f46\u9000\u6b3e\u91d1\u989d\u4ece\u539f\u672c\u7684 15,000 Gas \u5927\u5e45\u524a\u51cf\u4e3a 4,800 Gas\u3002\u540c\u65f6\uff0c\u5355\u7b14\u4ea4\u6613\u4e2d\u53ef\u5b9e\u9645\u83b7\u5f97\u7684\u9000\u6b3e\u603b\u91cf\u4ecd\u53d7\u9000\u6b3e\u4e0a\u9650\u9650\u5236\uff0c\u5373\u4e0d\u8d85\u8fc7\u8be5\u4ea4\u6613\u5b9e\u9645\u6d88\u8017 Gas\uff08gasUsed\uff09\u7684 20%\u3002</p> <p>EIP-3529 \u540e\u7684\u89c4\u5219</p> \u64cd\u4f5c \u9000\u6b3e\u989d\u5ea6 SSTORE \u6e05\u96f6\uff08\u975e\u96f6 \u2192 0\uff09 4,800 SELFDESTRUCT \u4e0d\u518d\u6709\u9000\u6b3e <p>\u9000\u6b3e\u4e0a\u9650\uff1a\u6700\u591a\u9000\u8fd8\u4ea4\u6613\u603b Gas \u7684 20%\u3002</p> <p>\u4e3a\u4ec0\u4e48\u6709\u9000\u6b3e\u4e0a\u9650\uff1f</p> <p>\u5386\u53f2\u4e0a\u51fa\u73b0\u8fc7\u300cGas Token\u300d\u5957\u5229\uff1a\u5728 Gas \u4fbf\u5b9c\u65f6\u5199\u5165\u5927\u91cf\u5b58\u50a8\uff0c\u5728 Gas \u8d35\u65f6\u6e05\u9664\u83b7\u53d6\u9000\u6b3e\u3002EIP-3529 \u5c06\u9000\u6b3e\u4e0a\u9650\u4ece 50% \u964d\u5230 20%\uff0c\u57fa\u672c\u5835\u6b7b\u4e86\u8fd9\u6761\u8def\u3002</p> <p>\u9000\u6b3e\u4e0d\u662f\u300c\u8fd4\u73b0\u300d\uff0c\u800c\u662f\u300c\u62b5\u6263\u300d\u2014\u2014\u5b83\u76f4\u63a5\u51cf\u5c11 Gas Used\uff0c\u4f46\u4f60\u4e0d\u4f1a\u5728\u94b1\u5305\u91cc\u770b\u5230\u4e00\u7b14\u9000\u6b3e\u3002</p> <p>\u4e0d\u8981\u4e3a\u4e86\u9000\u6b3e\u800c\u523b\u610f\u6e05\u96f6\u3002\u6e05\u96f6\u7684 5,000 Gas \u6210\u672c + 4,800 \u9000\u6b3e = \u51c0\u6210\u672c 200 Gas\uff0c\u770b\u8d77\u6765\u5f88\u4fbf\u5b9c\u3002\u4f46\u5982\u679c\u4e0b\u6b21\u8fd8\u8981\u7528\u8fd9\u4e2a\u69fd\uff0c\u4f60\u53c8\u8981\u4ed8 22,100 Gas \u4ece 0 \u5199\u5165\u975e\u96f6\u3002\u53ea\u6709\u5f53\u4f60\u786e\u5b9a\u8fd9\u4e2a\u5b58\u50a8\u69fd\u300c\u6c38\u8fdc\u4e0d\u4f1a\u518d\u7528\u300d\u65f6\uff0c\u6e05\u96f6\u624d\u662f\u5212\u7b97\u7684\u3002</p>"},{"location":"web3/dapp/gas_optimization_guide_part1_gas_mechanism/#gas_3","title":"\u516b\u3001Gas \u6d88\u8017\u9884\u6d4b\u5fc3\u6cd5","text":"<p>\u5224\u65ad\u4e00\u6bb5\u4ee3\u7801\u662f\u5426\u6602\u8d35\uff0c\u53ea\u95ee\u4e09\u4e2a\u95ee\u9898\uff1a</p> <ol> <li>\u662f\u5426\u5199 storage</li> <li>\u662f\u5426\u9996\u6b21\u8bbf\u95ee slot</li> <li>\u662f\u5426\u5199\u5165\u975e\u96f6\u503c</li> </ol> <p>\u4e09\u8005\u540c\u65f6\u6ee1\u8db3\uff0c\u5fc5\u7136\u662f Gas hotspot\u3002</p> <p>\u518d\u4f8b\u5982\uff1afor \u5faa\u73af\u672c\u8eab\u51e0\u4e4e\u4e0d\u8d35\uff0c\u771f\u6b63\u6602\u8d35\u7684\u662f\u5faa\u73af\u91cc\u7684 SLOAD \u4e0e SSTORE\u3002memory \u6269\u5c55\u867d\u6709\u4e8c\u6b21\u9879\uff0c\u4f46\u4ecd\u8fdc\u4fbf\u5b9c\u4e8e storage\u3002</p> <p>\u8fd9\u7c7b\u7ecf\u9a8c\u89c4\u5219\u7684\u4ef7\u503c\uff0c\u8fdc\u9ad8\u4e8e\u4efb\u4f55\u8868\u683c\u3002</p> <p>\u6ce8\u610f\u590d\u6742\u6027\u548c\u53ef\u8bfb\u6027</p> <p>Gas \u4f18\u5316\u901a\u5e38\u4f1a\u4f7f\u4ee3\u7801\u53d8\u5f97\u66f4\u96be\u8bfb\u548c\u66f4\u590d\u6742\u3002\u4e00\u4e2a\u597d\u7684\u5de5\u7a0b\u5e08\u5fc5\u987b\u5728\u4e3b\u89c2\u4e0a\u6743\u8861\u54ea\u4e9b\u4f18\u5316\u662f\u503c\u5f97\u7684\uff0c\u54ea\u4e9b\u4e0d\u662f\u3002</p>"},{"location":"web3/dapp/gas_optimization_guide_part1_gas_mechanism/#_2","title":"\u5c0f\u7ed3","text":"<p>\u672c\u7bc7\u4ecb\u7ecd\u4e86 Gas \u673a\u5236\u7684\u6838\u5fc3\u539f\u7406\uff1a</p> <ul> <li>Gas \u662f EVM \u8861\u91cf\u8ba1\u7b97\u5de5\u4f5c\u91cf\u7684\u71c3\u6599\uff0c\u4ea4\u6613\u8d39\u7528\u7531 Intrinsic Gas \u548c Execution Gas \u4e24\u90e8\u5206\u6784\u6210\u3002</li> <li>EIP-1559 \u5b9a\u4ef7\u6a21\u578b\u901a\u8fc7 Base Fee \u548c Priority Fee \u8ba1\u7b97\u6700\u7ec8\u8d39\u7528\uff0c\u4f46\u771f\u6b63\u7684 Gas \u4f18\u5316\u53d1\u751f\u5728 opcode \u5c42\u3002</li> <li>\u5728\u6240\u6709\u64cd\u4f5c\u4e2d\uff0c\u5b58\u50a8\u8bfb\u5199\uff08SLOAD/SSTORE\uff09\u662f\u6700\u6602\u8d35\u7684\uff0c\u5176\u4e2d\u4ece 0 \u5199\u5165\u975e\u96f6\u503c\u7684\u6210\u672c\u9ad8\u8fbe 22,100 Gas\u3002</li> <li>\u51b7\u70ed\u8bbf\u95ee\u673a\u5236\u548c\u9000\u6b3e\u89c4\u5219\u8fdb\u4e00\u6b65\u5f71\u54cd\u5b9e\u9645\u6210\u672c\u3002</li> </ul> <p>\u4e0b\u4e00\u7bc7\u6211\u4eec\u5c06\u901a\u8fc7\u4e00\u4e2a\u771f\u5b9e\u7684\u94fe\u4e0a\u5b9e\u9a8c\uff0c\u9a8c\u8bc1\u672c\u7bc7\u4ecb\u7ecd\u7684 EIP-1559 \u8d39\u7528\u8ba1\u7b97\u89c4\u5219\uff0c\u76f4\u89c2\u611f\u53d7\u4e0d\u540c\u5b58\u50a8\u64cd\u4f5c\u7684 Gas \u5dee\u5f02\u3002</p> <p>\u7cfb\u5217\u5bfc\u822a\uff1a</p> <ul> <li>\u7b2c\u4e00\u7bc7\uff1aGas \u4f18\u5316\u6307\u5357\uff08\u4e00\uff09\uff1aGas \u673a\u5236\u539f\u7406\uff08\u672c\u7bc7\uff09</li> <li>\u7b2c\u4e8c\u7bc7\uff1aGas \u4f18\u5316\u6307\u5357\uff08\u4e8c\uff09\uff1aEIP-1559 \u4ea4\u6613\u89e3\u6790</li> <li>\u7b2c\u4e09\u7bc7\uff1aGas \u4f18\u5316\u6307\u5357\uff08\u4e09\uff09\uff1a\u5b58\u50a8\u4f18\u5316</li> <li>\u7b2c\u56db\u7bc7\uff1aGas \u4f18\u5316\u6307\u5357\uff08\u56db\uff09\uff1a\u8ba1\u7b97\u4f18\u5316</li> <li>\u7b2c\u4e94\u7bc7\uff1aGas \u4f18\u5316\u6307\u5357\uff08\u4e94\uff09\uff1aGas \u8bc4\u4f30\u4e0e\u6d4b\u91cf</li> </ul>"},{"location":"web3/dapp/gas_optimization_guide_part2_eip1559_transaction_analysis/","title":"Gas \u4f18\u5316\u6307\u5357\uff08\u4e8c\uff09\uff1aEIP-1559 \u4ea4\u6613\u89e3\u6790","text":"<p> \u7ea6 1673 \u4e2a\u5b57  26 \u884c\u4ee3\u7801  4 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 6 \u5206\u949f</p> <p>\u672c\u7bc7\u662f Gas \u4f18\u5316\u7cfb\u5217\u7684\u7b2c\u4e8c\u7bc7\uff0c\u901a\u8fc7\u4e00\u4e2a\u771f\u5b9e\u7684\u94fe\u4e0a\u5b9e\u9a8c\uff0c\u9a8c\u8bc1\u4e0a\u4e00\u7bc7\u4ecb\u7ecd\u7684 EIP-1559 \u8d39\u7528\u8ba1\u7b97\u89c4\u5219\u3002</p> <p>\u6211\u4eec\u5c06\u90e8\u7f72\u4e00\u4e2a\u7b80\u5355\u7684 GasDemo \u5408\u7ea6\uff0c\u6267\u884c\u4e09\u7b14\u4e0d\u540c\u7c7b\u578b\u7684\u5b58\u50a8\u5199\u5165\u4ea4\u6613\uff0c\u9010\u4e00\u62c6\u89e3 Etherscan \u622a\u56fe\u4e2d\u7684\u5404\u4e2a\u6570\u5b57\u662f\u5982\u4f55\u8ba1\u7b97\u5f97\u51fa\u7684\u3002</p>"},{"location":"web3/dapp/gas_optimization_guide_part2_eip1559_transaction_analysis/#_1","title":"\u4e00\u3001\u5b9e\u9a8c\u5408\u7ea6","text":"<p>\u6f14\u793a\uff1a\u4e00\u7b14 Type 2\uff08EIP-1559\uff09\u4ea4\u6613\u7684\u5b9e\u9645\u7ed3\u7b97\u4ef7\u683c\u662f\u5982\u4f55\u4ece Base/Max/Priority \u63a8\u5bfc\u51fa\u6765\u7684\uff0c\u5e76\u4e14\u7528 <code>Gas Used</code> \u76f4\u63a5\u7b97\u51fa <code>Transaction Fee / Burnt / Txn Savings</code>\u3002</p> <pre><code>// SPDX-License-Identifier: MIT\npragma solidity ^0.8.28;\n\ncontract GasDemo {\n    uint256 public value1;\n    uint256 public value2;\n\n    // \u9996\u6b21\u5199\u5165 VS \u4fee\u6539\n    function setValues(uint256 v1, uint256 v2) public {\n        value1 = v1;    // \u89c2\u5bdf\uff1a\u9996\u6b21 22100\uff0c\u540e\u7eed 5000\n        value2 = v2;\n    }\n\n    // \u51b7\u8bbf\u95ee VS \u70ed\u8bbf\u95ee\n    function readValues() public view returns (uint256, uint256) {\n        uint256 a = value1;     // \u51b7\u8bbf\u95ee\uff1a2100\n        uint256 b = value1;     // \u70ed\u8bbf\u95ee\uff1a100\n        return (a, b);\n    }\n\n    // \u6e05\u96f6\u9000\u6b3e\n    function clear() public {\n        value1 = 0;     // \u83b7\u5f97\u9000\u6b3e\n        value2 = 0;\n    }\n}\n</code></pre> <p>GasDemo \u4e3b\u8981\u60f3\u5c55\u793a\u4e09\u4ef6\u4e8b\uff1a</p> <ol> <li>\u9996\u6b21\u5199\u5165 vs \u4fee\u6539\uff08SSTORE 0\u2192\u975e 0 vs \u975e 0\u2192\u975e 0\uff09</li> <li>\u51b7\u8bbf\u95ee vs \u70ed\u8bbf\u95ee\uff08SLOAD cold vs warm\uff09</li> <li>\u6e05\u96f6\u9000\u6b3e\uff08SSTORE \u975e 0\u21920 \u7684 refund \u673a\u5236\uff09</li> </ol>"},{"location":"web3/dapp/gas_optimization_guide_part2_eip1559_transaction_analysis/#_2","title":"\u4e8c\u3001\u90e8\u7f72\u5408\u7ea6","text":"\u622a\u56fe\u5b57\u6bb5 \u6570\u503c Gas Used 168,895 Gas Price (Effective Gas Price) 1.51857878 gwei Base 0.01857878 gwei Max 1.527578327 gwei Max Priority 1.5 gwei Transaction Fee 0.0002564803630481 ETH Burnt 0.0000031378630481 ETH Txn Savings 0.000001519978490565 ETH <p>2.1 \u6709\u6548\u6210\u4ea4\u4ef7\uff08Effective Gas Price\uff09\u600e\u4e48\u6765\u7684\uff1f</p> <p>EIP-1559 \u4e0b\uff0c\u7528\u6237\u63d0\u4ea4\u7684\u53c2\u6570\u662f\uff1a</p> <ul> <li>maxFeePerGas\uff08\u622a\u56fe\u91cc\u7684 Max\uff09</li> <li>maxPriorityFeePerGas\uff08\u622a\u56fe\u91cc\u7684 Max Priority\uff09</li> </ul> <p>\u94fe\u4e0a\u7ed3\u7b97\u4f7f\u7528\uff1a</p> <ul> <li>effectivePriorityFee = min(maxPriorityFeePerGas, maxFeePerGas - baseFeePerGas)</li> <li>effectiveGasPrice = baseFeePerGas + effectivePriorityFee</li> </ul> <p>\u4ee3\u5165\u622a\u56fe\uff1a</p> <ul> <li>baseFee = 0.01857878</li> <li>maxFee = 1.527578327</li> <li>maxPriority = 1.5</li> </ul> <p>\u5148\u770b maxFee - baseFee\uff1a</p> <ul> <li>1.527578327 - 0.01857878 = 1.509...\uff0c\u660e\u663e\u5927\u4e8e 1.5</li> <li>\u6240\u4ee5 effectivePriorityFee = 1.5 gwei</li> <li>\u56e0\u6b64 effectiveGasPrice = 0.01857878 + 1.5 = 1.51857878 gwei</li> </ul> <p>\u8fd9\u5c31\u7cbe\u786e\u5339\u914d\u4e86\u622a\u56fe\u91cc\u7684 Gas Price = 1.51857878 gwei\u3002</p> <p>2.2 Transaction Fee \u9a8c\u7b97</p> \\[ \\text{Tx Fee} = \\text{GasUsed} \\times \\text{effectiveGasPrice} \\] <p>\u628a gwei \u6362\u6210 ETH\uff1a</p> \\[ 1\\text{ gwei}=10^{-9}\\text{ ETH} \\] \\[ 168{,}895 \\times 1.51857878 \\times 10^{-9} = 0.0002564803630481\\text{ ETH} \\] <p>\u4e0e\u622a\u56fe\u7684 Transaction Fee \u5b8c\u5168\u4e00\u81f4\u3002</p> <p>2.3 Burnt\uff08\u9500\u6bc1\uff09\u9a8c\u7b97</p> <p>EIP-1559 \u4e0b\uff1a</p> \\[ \\text{Burnt} = \\text{GasUsed} \\times \\text{baseFee} \\] \\[ 168{,}895 \\times 0.01857878 \\times 10^{-9} = 0.0000031378630481\\text{ ETH} \\] <p>\u4e0e\u622a\u56fe\u7684 Burnt \u5b8c\u5168\u4e00\u81f4\u3002</p> <p>2.4 Txn Savings\uff08\"\u7701\u4e0b\u7684\u94b1\"\uff09\u5230\u5e95\u662f\u4ec0\u4e48\uff1f</p> <p>\u8fd9\u4e0d\u662f\"\u6e05\u96f6\u9000\u6b3e\"\u7684 refund\uff0c\u800c\u662f EIP-1559 \u7684 maxFee \u591a\u4ed8\u90e8\u5206\u9000\u56de\uff1a\u7528\u6237\u613f\u610f\u6700\u591a\u4ed8 maxFee\uff0c\u4f46\u5b9e\u9645\u53ea\u9700\u8981\u4ed8 effectiveGasPrice\uff0c\u5dee\u989d\u6309 gasUsed \u9000\u56de\uff1a</p> \\[ \\text{Txn Savings} = \\text{GasUsed} \\times (\\text{maxFee} - \\text{effectiveGasPrice}) \\] \\[ 168{,}895 \\times (1.527578327 - 1.51857878) \\times 10^{-9} = 0.000001519978490565\\text{ ETH} \\] <p>\u4e0e\u622a\u56fe\u5b8c\u5168\u4e00\u81f4\u3002</p>"},{"location":"web3/dapp/gas_optimization_guide_part2_eip1559_transaction_analysis/#setvalues","title":"\u4e09\u3001\u4e24\u6b21\u8c03\u7528 setValues \u51fd\u6570","text":"<p>\u7b2c 1 \u6b21\u8c03\u7528 setValues(100, 200) \u51fd\u6570\uff1a</p> <p></p> <p>\u7b2c 2 \u6b21\u8c03\u7528 setValues(101, 201) \u51fd\u6570\uff1a</p> <p></p> <p>\u4e24\u6b21\u8c03\u7528\u7684\u5173\u952e\u4fe1\u606f\u5bf9\u6bd4\uff08\u5148\u7ed9\u7ed3\u8bba\uff09\uff1a</p> \u9879\u76ee \u7b2c 1 \u6b21\u8c03\u7528 \u7b2c 2 \u6b21\u8c03\u7528 \u8c03\u7528\u53c2\u6570 setValues(100, 200) setValues(101, 201) Gas Used 66,186 31,986 Effective Gas Price \u2248 1.5207 gwei \u2248 1.5205 gwei Transaction Fee \u2248 0.00010065 ETH \u2248 0.00004863 ETH Txn Type Type 2 (EIP-1559) Type 2 (EIP-1559) \u5dee\u503c \u2248 34,200 gas \u2014 <p>\u8fd9\u4e24\u7b14\u4ea4\u6613\u7684 Gas \u5dee\u503c\u5728\u6570\u503c\u4e0a\u7cbe\u786e\u7b49\u4e8e 2 \u4e2a slot \u7684 22,100 \u4e0e 5,000 \u7684\u5dee\u989d\uff0c\u56e0\u6b64\u5dee\u5f02\u51e0\u4e4e\u5b8c\u5168\u7531 SSTORE \u72b6\u6001\u8f6c\u79fb\u7c7b\u578b\u51b3\u5b9a\u3002</p> <p>\u8fd9\u8bf4\u660e\uff1a\u8fd9\u4e2a\u5408\u7ea6 + \u8fd9\u4e24\u7b14\u4ea4\u6613\uff0c\u5b8c\u7f8e\u547d\u4e2d\u4e86 Solidity/EVM \u7684 SSTORE \u6210\u672c\u6a21\u578b\u3002</p> <p>\u8fd9\u4e24\u5f20\u56fe\u975e\u5e38\u9002\u5408\u7528\u6765\u8bb2\uff1a</p> <ol> <li>\u4e3a\u4ec0\u4e48 storage \u5199\u5165\u8fd9\u4e48\u8d35</li> <li>\u4e3a\u4ec0\u4e48\"\u4e0d\u8981\u968f\u4fbf\u5199 storage\"</li> <li>\u4e3a\u4ec0\u4e48\"\u7b2c\u4e00\u6b21\u5199\"\u548c\"\u6539\u5199\"\u662f\u4e24\u4e2a\u4e16\u754c</li> <li>EIP-1559 \u2260 Gas \u4f18\u5316\u2014\u2014\u5b83\u53ea\u662f\u5b9a\u4ef7\u6a21\u578b\uff0c\u771f\u6b63\u7684\u4f18\u5316\u53d1\u751f\u5728 EVM opcode \u5c42</li> </ol>"},{"location":"web3/dapp/gas_optimization_guide_part2_eip1559_transaction_analysis/#clear","title":"\u56db\u3001\u8c03\u7528 clear \u51fd\u6570","text":"<p>\u628a\u622a\u56fe\u91cc\u7684\u6bcf\u4e00\u4e2a\u5173\u952e\u6570\u5b57\uff0c\u548c EVM \u7684 SSTORE(non-0 \u2192 0) + London \u4e4b\u540e\u7684 refund \u89c4\u5219\u7cbe\u786e\u5bf9\u9f50\u3002</p> \u622a\u56fe\u5b57\u6bb5 \u6570\u503c Gas Used 24,986 Gas Limit 31,510 (\u4f7f\u7528\u7387 79.3%) Effective Gas Price 1.521004001 gwei Transaction Fee 0.000038003805968986 ETH Base Fee 0.021004001 gwei Priority Fee 1.5 gwei Txn Type Type 2 (EIP-1559) <p>\u548c\u524d\u4e24\u7b14 setValues \u4e00\u6837\uff1a\u4ef7\u683c\u51e0\u4e4e\u6ca1\u53d8\uff0c\u5dee\u5f02\u5168\u90e8\u6765\u81ea Gas Used\u3002</p> <p>4.1 \u4e24\u7c7b Savings \u5fc5\u987b\u5206\u5f00</p> <p>Txn Savings \u2260 \u6e05\u96f6 refund</p> <p>\u622a\u56fe\u91cc Txn Savings: 0.00000190903883924 ETH</p> <p>\u8fd9\u662f (maxFeePerGas \u2212 effectiveGasPrice) \u00d7 gasUsed\uff0c\u5b83\u53ea\u662f EIP-1559 \u7684\"\u591a\u62a5 maxFee \u6ca1\u7528\u5b8c\uff0c\u9000\u7ed9\u4f60\"\uff0c\u800c\u4e0d\u662f EVM \u7684 SSTORE refund\u3002</p> <ul> <li>Txn Savings \u4ecd\u7136\u662f EIP-1559 \u7684 maxFee \u5dee\u989d\u9000\u56de</li> <li>SSTORE refund \u4e0d\u4f1a\u4ee5 ETH \u5b57\u6bb5\u76f4\u63a5\u5c55\u793a\uff0c\u6548\u679c\u4f53\u73b0\u5728 Gas Used \u53d8\u5c0f</li> </ul> <p>4.2 \u7528 refund \u4e0a\u9650\u53cd\u63a8 clear \u7684\u771f\u5b9e\u6d88\u8017</p> <p>clear \u6709\u4e24\u4e2a\u975e 0 \u5230 0 \u7684\u5199\u5165\u3002London \u4e4b\u540e\uff0c\u5355\u6b21\u6e05\u96f6\u7684 refund \u989d\u5ea6\u662f 4,800 Gas\uff0c\u56e0\u6b64\u7406\u8bba refund \u603b\u989d\uff1a</p> \\[ R=2\u00d74{,}800=9{,}600 \\] <p>\u4f46 refund \u6709\u4e0a\u9650\uff1a</p> \\[ refundApplied\\le \\frac{gasUsedBeforeRefund}{5} \\] <p>\u8bbe clear \u8fd9\u7b14\u4ea4\u6613\u5728\u5e94\u7528 refund \u4e4b\u524d\u7684\u6d88\u8017\u4e3a G\uff0c\u6700\u7ec8\u4f60\u5728 Etherscan \u770b\u5230\u7684 Gas Used \u4e3a 24,986\uff0c\u6ee1\u8db3\uff1a</p> \\[ 24{,}986=G-\\min(9{,}600,\\ \\frac{G}{5}) \\] <p>\u5982\u679c refund \u603b\u989d\u5927\u4e8e\u4e0a\u9650\uff0c\u5219\u5b9e\u9645\u5e94\u7528\u7684 refund \u7b49\u4e8e G/5\uff0c\u4e8e\u662f\uff1a</p> \\[ 24{,}986=G-\\frac{G}{5}=\\frac{4G}{5} \\] \\[ G=24{,}986\\times \\frac{5}{4}=31{,}232.5 \\] <p>\u8fd9\u7ed9\u51fa\u4e00\u4e2a\u975e\u5e38\u6f02\u4eae\u7684\u89e3\u91ca\uff1aclear \u5728\u5e94\u7528 refund \u4e4b\u524d\u7684\u6d88\u8017\u5927\u7ea6\u662f 31,233 Gas\uff0c\u7531\u4e8e\u4e0a\u9650\u9650\u5236\uff0c\u5b9e\u9645\u80fd\u62b5\u6263\u7684 refund \u5927\u7ea6\u662f 6,246 Gas\uff0c\u5269\u4f59 refund \u65e0\u6cd5\u7528\u5b8c\uff0c\u6240\u4ee5\u4f60\u770b\u5230\u7684 Gas Used \u4e0d\u662f 10,000 \u7ea7\u522b\uff0c\u800c\u662f 24,986\u3002</p> <p>4.3 \u4e3a\u4ec0\u4e48 clear \u770b\u8d77\u6765\u6bd4\u7b2c\u4e8c\u6b21 setValues \u8fd8\u4fbf\u5b9c</p> <p>\u628a\u7b2c\u4e8c\u6b21 setValues \u4e0e clear \u653e\u5728\u4e00\u8d77\uff1a</p> \u4ea4\u6613 Gas Used setValues(101,201) 31,986 clear() 24,986 <p>\u53ef\u4ee5\u7ed9\u51fa\u4e00\u6761\u66f4\u7cbe\u786e\u7684\u4e3b\u7ebf\uff1aclear \u7684\u6267\u884c\u524d\u6210\u672c\u4e0e\u4e00\u6b21\u5e38\u89c4\u5199\u5165\u5904\u5728\u540c\u4e00\u6570\u91cf\u7ea7\uff0cclear \u89e6\u53d1\u4e86 refund \u62b5\u6263\uff0c\u62b5\u6263\u989d\u5ea6\u53d7 1/5 \u4e0a\u9650\u9650\u5236\uff0c\u56e0\u6b64\u53ea\u62b5\u6263\u4e86\u4e00\u90e8\u5206\uff0c\u6700\u7ec8 Gas Used \u964d\u5230\u4e86 24,986\u3002</p> <p>4.4 \u628a\u4e09\u7b14\u4ea4\u6613\u653e\u5728\u4e00\u8d77\uff0c\u770b\u4e00\u6761\u5b8c\u6574\u4e3b\u7ebf</p> \u64cd\u4f5c storage \u53d8\u5316 Gas Used \u7b2c 1 \u6b21 setValues 0 \u2192 \u975e 0\uff0c\u5171 2 \u6b21 66,186 \u7b2c 2 \u6b21 setValues \u975e 0 \u2192 \u975e 0\uff0c\u5171 2 \u6b21 31,986 clear() \u975e 0 \u2192 0\uff0c\u5171 2 \u6b21 24,986 <p>\u8fd9\u4e09\u7b14\u4ea4\u6613\u628a SSTORE \u4e09\u79cd\u5173\u952e\u72b6\u6001\u8f6c\u79fb\u5728\u771f\u5b9e\u94fe\u4e0a\u5b8c\u6574\u8dd1\u901a\uff0c\u5e76\u4e14\u5206\u522b\u5448\u73b0\u51fa\u7b26\u5408\u9884\u671f\u7684\u6570\u91cf\u7ea7\u5dee\u5f02\u3002</p> <p>\u8fd9\u6b63\u597d\u5bf9\u5e94\u6211\u4eec\u5728\u4ee3\u7801\u91cc\u60f3\u6f14\u793a\u7684\u4e09\u4ef6\u4e8b\uff1a</p> <ol> <li>\u9996\u6b21\u5199\u5165\u6700\u8d35</li> <li>\u6539\u5199\u660e\u663e\u4fbf\u5b9c</li> <li>\u6e05\u96f6\u53ef\u4ee5\u7701 Gas\uff0c\u4f46 refund \u5df2\u88ab\u4e25\u683c\u9650\u5236</li> </ol> <p>4.5 \u8fd9\u7b14 clear() \u4ea4\u6613\u7684\"\u6559\u5b66\u7ea7\u7ed3\u8bba\"</p> <p>\u8fd9\u5f20\u622a\u56fe\u975e\u5e38\u9002\u5408\u7528\u6765\u8bb2\u4e00\u53e5\u8bdd\uff1aLondon \u4e4b\u540e\uff0cdelete storage \u4e0d\u518d\u662f\"\u8fd4\u94b1\u64cd\u4f5c\"\uff0c\u800c\u53ea\u662f\"\u5c11\u70e7\u4e00\u70b9 Gas\"\u3002</p>"},{"location":"web3/dapp/gas_optimization_guide_part2_eip1559_transaction_analysis/#_3","title":"\u5c0f\u7ed3","text":"<p>\u672c\u7bc7\u901a\u8fc7\u771f\u5b9e\u7684\u94fe\u4e0a\u4ea4\u6613\u6570\u636e\uff0c\u5b8c\u6574\u9a8c\u8bc1\u4e86 EIP-1559 \u7684\u8d39\u7528\u8ba1\u7b97\u89c4\u5219\uff1aeffectiveGasPrice \u7531 baseFee + effectivePriorityFee \u6784\u6210\uff0cTransaction Fee\u3001Burnt\u3001Txn Savings \u4e09\u4e2a\u6570\u503c\u90fd\u53ef\u4ee5\u7cbe\u786e\u63a8\u5bfc\u3002\u66f4\u91cd\u8981\u7684\u662f\uff0c\u6211\u4eec\u901a\u8fc7\u4e09\u7b14\u5b58\u50a8\u5199\u5165\u4ea4\u6613\uff0c\u76f4\u89c2\u5c55\u793a\u4e86 SSTORE \u4e09\u79cd\u72b6\u6001\u8f6c\u79fb\u7684 Gas \u5dee\u5f02\u2014\u2014\u9996\u6b21\u5199\u5165\uff0866,186 Gas\uff09\u3001\u4fee\u6539\uff0831,986 Gas\uff09\u3001\u6e05\u96f6\uff0824,986 Gas\uff09\u3002</p> <p>\u6838\u5fc3\u7ed3\u8bba\uff1aEIP-1559 \u51b3\u5b9a Gas \u7684\u4ef7\u683c\uff0cEVM \u6267\u884c\u51b3\u5b9a Gas \u7684\u6570\u91cf\uff0c\u4e24\u8005\u5b8c\u5168\u72ec\u7acb\uff0c\u5374\u5728\u6700\u7ec8\u8d39\u7528\u4e2d\u76f8\u4e58\u3002</p> <p>\u4e0b\u4e00\u7bc7\u6211\u4eec\u5c06\u8fdb\u5165\u5b58\u50a8\u4f18\u5316\u5b9e\u6218\uff0c\u5b66\u4e60\u53d8\u91cf\u6253\u5305\u3001\u7ed3\u6784\u4f53\u6253\u5305\u3001constant/immutable\u3001\u5b58\u50a8\u6307\u9488\u7b49\u6280\u5de7\uff0c\u5e76\u901a\u8fc7\u4e00\u4e2a\u6559\u5b66\u7248\u7528\u6237\u7ba1\u7406\u5408\u7ea6\u6f14\u793a\u5b8c\u6574\u7684\u4f18\u5316\u8fc7\u7a0b\u3002</p> <p>\u7cfb\u5217\u5bfc\u822a\uff1a</p> <ul> <li>\u7b2c\u4e00\u7bc7\uff1aGas \u4f18\u5316\u6307\u5357\uff08\u4e00\uff09\uff1aGas \u673a\u5236\u539f\u7406</li> <li> <p>\u7b2c\u4e8c\u7bc7\uff1aGas \u4f18\u5316\u6307\u5357\uff08\u4e8c\uff09\uff1aEIP-1559 \u4ea4\u6613\u89e3\u6790\uff08\u672c\u7bc7\uff09</p> </li> <li> <p>\u7b2c\u4e09\u7bc7\uff1aGas \u4f18\u5316\u6307\u5357\uff08\u4e09\uff09\uff1a\u5b58\u50a8\u4f18\u5316</p> </li> <li>\u7b2c\u56db\u7bc7\uff1aGas \u4f18\u5316\u6307\u5357\uff08\u56db\uff09\uff1a\u8ba1\u7b97\u4f18\u5316</li> <li>\u7b2c\u4e94\u7bc7\uff1aGas \u4f18\u5316\u6307\u5357\uff08\u4e94\uff09\uff1aGas \u8bc4\u4f30\u4e0e\u6d4b\u91cf</li> </ul>"},{"location":"web3/dapp/gas_optimization_guide_part3_storage_optimization/","title":"Gas \u4f18\u5316\u6307\u5357\uff08\u4e09\uff09\uff1a\u5b58\u50a8\u4f18\u5316","text":"<p> \u7ea6 2020 \u4e2a\u5b57  350 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 11 \u5206\u949f</p> <p>\u672c\u7bc7\u662f Gas \u4f18\u5316\u7cfb\u5217\u7684\u7b2c\u4e09\u7bc7\uff0c\u805a\u7126\u4e8e\u5b58\u50a8\u5c42\u9762\u7684 Gas \u4f18\u5316\u3002</p> <p>\u5b58\u50a8\u8bfb\u5199\u662f EVM \u4e2d\u6700\u6602\u8d35\u7684\u64cd\u4f5c\uff0c\u672c\u7bc7\u5c06\u4ecb\u7ecd\u53d8\u91cf\u6253\u5305\u3001\u7ed3\u6784\u4f53\u6253\u5305\u3001constant/immutable\u3001\u7f13\u5b58\u5b58\u50a8\u53d8\u91cf\u3001\u77ac\u65f6\u5b58\u50a8\u7b49\u6838\u5fc3\u6280\u5de7\uff0c\u5e76\u901a\u8fc7\u4e00\u4e2a\u6559\u5b66\u7248\u7528\u6237\u7ba1\u7406\u5408\u7ea6\uff08UserManagerV1 \u2192 UserManagerV2\uff09\u6f14\u793a\u5b8c\u6574\u7684\u5b58\u50a8\u4f18\u5316\u8fc7\u7a0b\u3002</p>"},{"location":"web3/dapp/gas_optimization_guide_part3_storage_optimization/#_1","title":"\u4e00\u3001\u4e3a\u4ec0\u4e48\u5b58\u50a8\u4f18\u5316\u6700\u91cd\u8981","text":"<p>\u5b58\u50a8\u4f18\u5316\u7684\u6838\u5fc3\u76ee\u6807\u4e0d\u662f\"\u5c11\u5199\u4e00\u70b9\"\uff0c\u800c\u662f\u7cfb\u7edf\u6027\u5730\u51cf\u5c11\u4e09\u7c7b\u6210\u672c\uff1a</p> <ol> <li>\u51cf\u5c11 0 \u2192 \u975e 0 \u7684\u9996\u6b21\u5199\u5165\u6b21\u6570</li> <li>\u51cf\u5c11\u6bcf\u7b14\u4ea4\u6613\u89e6\u8fbe\u7684 cold slot \u6570\u91cf\uff08\u5373\u65b0 slot \u6570\u91cf\uff09</li> <li>\u51cf\u5c11\u5bf9\u540c\u4e00 slot \u7684\u91cd\u590d\u5199\u5165\u6b21\u6570\uff0c\u5c24\u5176\u662f read-modify-write</li> </ol> <p>\u4f18\u5316\u5b58\u50a8\u662f Gas \u4f18\u5316\u7684\u6838\u5fc3\u3002</p> <p>\u56de\u987e\u5b58\u50a8\u6210\u672c\uff1a</p> \u64cd\u4f5c Gas \u6210\u672c SLOAD\uff08\u51b7\uff09 2,100 SLOAD\uff08\u70ed\uff09 100 SSTORE\uff080 \u2192 \u975e\u96f6\uff09 22,100 SSTORE\uff08\u975e\u96f6 \u2192 \u975e\u96f6\uff09 5,000 SSTORE\uff08\u975e\u96f6 \u2192 0\uff09 5,000\uff0c\u9000\u6b3e MLOAD/MSTORE 3 ADD/SUB 3 <p>\u7ed3\u8bba\uff1a\u5728\u591a\u6570\u5199\u72b6\u6001\u5408\u7ea6\u4e2d\uff0cstorage \u6210\u672c\u5f80\u5f80\u51b3\u5b9a\u4ea4\u6613\u6210\u672c\u4e0a\u9650\u3002</p> <p>\u672c\u7ae0\u7684\u6280\u5de7\u6309\u76ee\u6807\u53ef\u5206\u4e3a\u4e09\u7c7b\uff1a</p> <p>A. \u51cf\u5c11\u69fd\u4f4d\u6570\u91cf\u4e0e cold \u89e6\u8fbe\uff1a\u53d8\u91cf\u6253\u5305\u3001\u7ed3\u6784\u4f53\u6253\u5305\u3001\u7c7b\u578b\u7cbe\u7b80</p> <p>B. \u51cf\u5c11\u8bfb\u5199\u6b21\u6570\uff1astorage \u6307\u9488\u4e0e\u60f0\u6027\u8bfb\u53d6\u3001\u7f13\u5b58 SLOAD\u3001\u5408\u5e76\u5199\u5165</p> <p>C. \u907f\u514d\u6602\u8d35\u72b6\u6001\u8f6c\u79fb\uff1a\u907f\u514d 0 \u2192 \u975e 0\u3001\u5408\u7406\u4f7f\u7528 transient \u66ff\u4ee3\u4ea4\u6613\u5185\u9501</p>"},{"location":"web3/dapp/gas_optimization_guide_part3_storage_optimization/#_2","title":"\u4e8c\u3001\u53d8\u91cf\u6253\u5305","text":"<p>EVM \u6bcf\u4e2a storage slot \u4e3a 32 \u5b57\u8282\uff0c\u5c0f\u4e8e 32 \u5b57\u8282\u7684\u53d8\u91cf\u53ef\u4ee5\u6309\u58f0\u660e\u987a\u5e8f\u6253\u5305\u3002</p> <p>\u6ce8\u610f\uff1a\u6253\u5305\u51cf\u5c11\u69fd\u4f4d\u6570\u91cf\uff0c\u4f46\u5bf9\u540c\u4e00 slot \u7684\u5355\u5b57\u6bb5\u5199\u5165\u53ef\u80fd\u89e6\u53d1 read-modify-write\u3002\u53ea\u6709\u5f53\u8bfb\u5199\u6a21\u5f0f\u5339\u914d\u65f6\uff0c\u6253\u5305\u624d\u7a33\u5b9a\u7701 Gas\u3002</p> <p>\u63a8\u8350\u89c4\u5219\uff1a</p> <ul> <li>\u8bfb\u591a\u5199\u5c11\uff0c\u4e14\u7ecf\u5e38\u4e00\u8d77\u8bfb\u53d6\u7684\u5b57\u6bb5\u9002\u5408\u6253\u5305</li> <li>\u9ad8\u9891\u72ec\u7acb\u66f4\u65b0\u7684\u5b57\u6bb5\u8c28\u614e\u6253\u5305\uff0c\u5426\u5219\u4f1a\u653e\u5927 slot \u91cd\u5199\u6b21\u6570</li> </ul> <pre><code>// \u274c \u672a\u4f18\u5316\uff1a3 \u4e2a\u69fd\u4f4d\ncontract Unpacked {\n    uint64 a;    // slot 0\uff08\u72ec\u5360\uff09\n    uint256 b;   // slot 1\n    uint64 c;    // slot 2\uff08\u72ec\u5360\uff09\n}\n\n// \u2705 \u4f18\u5316\u540e\uff1a2 \u4e2a\u69fd\u4f4d\ncontract Packed {\n    uint64 a;    // slot 0\n    uint64 c;    // slot 0\uff08\u4e0e a \u6253\u5305\uff09\n    uint256 b;   // slot 1\n}\n</code></pre> <p>\u5e38\u89c1\u6253\u5305\u7ec4\u5408\uff1a</p> \u7ec4\u5408 \u603b\u5927\u5c0f \u69fd\u4f4d\u6570 address + uint96 160 + 96 = 256 1 address + uint64 + bool 160 + 64 + 8 = 232 1 uint128 + uint128 128 + 128 = 256 1 uint64 \u00d7 4 64 \u00d7 4 = 256 1"},{"location":"web3/dapp/gas_optimization_guide_part3_storage_optimization/#_3","title":"\u4e09\u3001\u7ed3\u6784\u4f53\u6253\u5305","text":"<p>\u7ed3\u6784\u4f53\u6210\u5458\u540c\u6837\u53ef\u4ee5\u6253\u5305\uff0c\u4f46\u9700\u8981\u6ce8\u610f\u58f0\u660e\u987a\u5e8f\u3002</p> <pre><code>// \u274c \u672a\u4f18\u5316\uff1a3 \u4e2a\u69fd\u4f4d\nstruct User {\n    uint64 timestamp;  // slot n\n    uint256 balance;   // slot n+1\uff08\u65e0\u6cd5\u6253\u5305\uff09\n    address owner;     // slot n+2\n}\n\n// \u2705 \u4f18\u5316\u540e\uff1a2 \u4e2a\u69fd\u4f4d\nstruct User {\n    uint64 timestamp;  // slot n\n    address owner;     // slot n\uff08\u4e0e timestamp \u6253\u5305\uff0c\u5171 224 \u4f4d\uff09\n    uint256 balance;   // slot n+1\n}\n</code></pre> <p>\u8282\u7701\uff1a\u8bfb\u5199\u7ed3\u6784\u4f53\u65f6\u51cf\u5c11 1 \u6b21 SLOAD/SSTORE\u3002</p>"},{"location":"web3/dapp/gas_optimization_guide_part3_storage_optimization/#constant-immutable","title":"\u56db\u3001constant \u548c immutable","text":"<p>\u4e0d\u53d8\u7684\u503c\u5e94\u8be5\u58f0\u660e\u4e3a constant \u6216 immutable\uff0c\u56e0\u4e3a\u5b83\u4eec\u4e0d\u5360\u7528 storage slot\uff0c\u8bfb\u53d6\u6765\u81ea code \u800c\u4e0d\u662f SLOAD\u3002</p> \u7c7b\u578b \u7279\u70b9 \u5b58\u50a8\u4f4d\u7f6e \u666e\u901a\u53d8\u91cf \u53ef\u4fee\u6539 \u5b58\u50a8\u69fd constant \u7f16\u8bd1\u65f6\u786e\u5b9a\uff0c\u4e0d\u53ef\u6539 \u5b57\u8282\u7801 immutable \u90e8\u7f72\u65f6\u786e\u5b9a\uff0c\u4e0d\u53ef\u6539 \u5b57\u8282\u7801 <p>constant\uff1a\u5fc5\u987b\u5728\u7f16\u8bd1\u65f6\u786e\u5b9a\uff0c\u76f4\u63a5\u5185\u8054\u5230\u5b57\u8282\u7801\uff0c\u4e0d\u5206\u914d storage slot\u3002\u5bf9 constant \u7684\"\u8bfb\u53d6\"\u4e0d\u662f SLOAD\uff0c\u800c\u662f PUSH32 \u7b49\u4fbf\u5b9c\u6307\u4ee4\uff0c\u8fd0\u884c\u65f6\u7701\u6389\u6bcf\u6b21\u8bfb\u53d6\u7684 SLOAD\uff08\u5c24\u5176\u662f cold \u7684 2100 \u91cf\u7ea7\uff09\u3002\u9002\u7528\u573a\u666f\uff1a\u624b\u7eed\u8d39\u5206\u6bcd\u3001\u56fa\u5b9a\u500d\u7387\u3001\u7c7b\u578b hash \u7b49\u534f\u8bae\u7ea7\u6c38\u4e0d\u53d8\u53c2\u6570\u3002</p> <p>immutable\uff1a\u90e8\u7f72\u65f6\u786e\u5b9a\uff0c\u6784\u9020\u51fd\u6570\u6267\u884c\u5b8c\u540e\u56fa\u5b9a\uff0c\u5b58\u8fdb\u5408\u7ea6\u4ee3\u7801\u800c\u4e0d\u662f storage\u3002\u8bfb\u53d6\u6210\u672c\u662f\"\u4ece code \u53d6\u5e38\u91cf\"\uff0c\u6bd4 SLOAD \u4fbf\u5b9c\u3002\u9002\u7528\u573a\u666f\uff1aowner\uff08\u4e0d\u9700\u8981\u53ef\u5347\u7ea7\u7684\u5408\u7ea6\uff09\u3001\u5916\u90e8\u4f9d\u8d56\u5408\u7ea6\u5730\u5740\uff08weth\u3001router\u3001oracle \u7b49\uff09\u3001\u90e8\u7f72\u65f6\u51b3\u5b9a\u7684\u8d39\u7387\u53c2\u6570\u3002</p> <pre><code>// \u274c \u6d6a\u8d39\u5b58\u50a8\ncontract Bad {\n    uint256 MAX_SUPPLY = 10000;  // \u5360\u7528 slot 0\n\n    function getMax() external view returns (uint256) {\n        return MAX_SUPPLY;  // SLOAD: 2100 gas\n    }\n}\n\n// \u2705 \u96f6\u5b58\u50a8\u6210\u672c\ncontract Good {\n    uint256 constant MAX_SUPPLY = 10000;  // \u5d4c\u5165\u5b57\u8282\u7801\n\n    function getMax() external pure returns (uint256) {\n        return MAX_SUPPLY;  // \u65e0 SLOAD\uff0c\u7ea6 3 gas\n    }\n}\n</code></pre>"},{"location":"web3/dapp/gas_optimization_guide_part3_storage_optimization/#_4","title":"\u4e94\u3001\u7f13\u5b58\u5b58\u50a8\u53d8\u91cf","text":"<p>Solidity \u4e0d\u4f1a\u81ea\u52a8\u7f13\u5b58\u5b58\u50a8\u8bfb\u53d6\uff0c\u591a\u6b21\u8bfb\u53d6\u540c\u4e00\u53d8\u91cf\uff0c\u6bcf\u6b21\u90fd\u4f1a\u6267\u884c SLOAD\u3002</p> <p>\u540c\u4e00\u7b14\u4ea4\u6613\u5185\uff0c\u5bf9\u540c\u4e00 slot \u7684\u91cd\u590d\u8bfb\u53d6\uff0c\u7b2c\u4e00\u6b21\u662f cold\uff0c\u540e\u7eed\u662f warm\u3002\u7f13\u5b58\u80fd\u907f\u514d\u540e\u7eed warm SLOAD \u7684 100 Gas\uff0c\u540c\u65f6\u4e5f\u51cf\u5c11\u91cd\u590d\u8bfb\u53d6\u7684\u5b57\u8282\u7801\u8def\u5f84\u3002</p> <pre><code>// \u274c \u591a\u6b21\u8bfb\u53d6\nfunction increment() public {\n    require(count &lt; 10);    // SLOAD #1\n    count = count + 1;      // SLOAD #2 + SSTORE\n}\n\n// \u2705 \u7f13\u5b58\u540e\u5355\u6b21\u8bfb\u53d6\nfunction increment() public {\n    uint256 _count = count; // SLOAD #1\uff08\u7f13\u5b58\u5230\u5185\u5b58\uff09\n    require(_count &lt; 10);   // \u8bfb\u5185\u5b58\n    count = _count + 1;     // SSTORE\n}\n</code></pre>"},{"location":"web3/dapp/gas_optimization_guide_part3_storage_optimization/#transient-storage","title":"\u516d\u3001\u77ac\u65f6\u5b58\u50a8\uff08Transient Storage\uff09","text":"<p>2024 \u5e74 Cancun \u5347\u7ea7\u5f15\u5165\u7684\u65b0\u7279\u6027\uff0c\u4f7f\u7528 TSTORE/TLOAD \u64cd\u4f5c\u7801\u3002</p> \u7279\u6027 \u666e\u901a\u5b58\u50a8 \u77ac\u65f6\u5b58\u50a8 \u6301\u4e45\u6027 \u6c38\u4e45 \u4ea4\u6613\u7ed3\u675f\u540e\u6e05\u9664 \u5199\u5165\u6210\u672c 5,000 - 22,100 100 \u8bfb\u53d6\u6210\u672c 100 - 2,100 100 <p>\u77ac\u65f6\u5b58\u50a8\u53ea\u5728 Cancun \u540e\u94fe\u4e0a\u53ef\u7528\uff0c\u4e14\u4ec5\u5728\u540c\u4e00\u7b14\u4ea4\u6613\u5185\u6709\u6548\uff0c\u4e0d\u80fd\u8de8\u4ea4\u6613\u4fdd\u5b58\u72b6\u6001\uff0c\u56e0\u6b64\u53ea\u80fd\u66ff\u6362\"\u4ea4\u6613\u5185\u9501\u4e0e\u4e34\u65f6\u6807\u8bb0\"\uff0c\u4e0d\u80fd\u66ff\u6362\u4e1a\u52a1\u72b6\u6001\u3002</p> <p>\u9002\u7528\u573a\u666f\uff1a\u91cd\u5165\u9501\u3001\u95ea\u7535\u8d37\u72b6\u6001\u3001\u8de8\u5408\u7ea6\u8c03\u7528\u7684\u4e34\u65f6\u6807\u8bb0\u3002</p> <pre><code>// \u274c \u4f20\u7edf\u65b9\u5f0f\ncontract Traditional {\n    uint256 private _status = 1;\n\n    modifier nonReentrant() {\n        require(_status != 2);\n        _status = 2;  // SSTORE: ~5,000 gas\n        _;\n        _status = 1;  // SSTORE: ~5,000 gas\n    }\n}\n\n// \u2705 \u77ac\u65f6\u5b58\u50a8\uff08Solidity 0.8.24+\uff09\ncontract Transient {\n    bool private transient _locked;\n\n    modifier nonReentrant() {\n        require(!_locked);\n        _locked = true;   // TSTORE: 100 gas\n        _;\n        _locked = false;  // TSTORE: 100 gas\n    }\n}\n</code></pre>"},{"location":"web3/dapp/gas_optimization_guide_part3_storage_optimization/#0-0","title":"\u4e03\u3001\u907f\u514d 0 \u5230\u975e 0 \u5199\u5165","text":"<p>\u4ece 0 \u5199\u5165\u975e\u96f6\u503c\u662f\u6700\u8d35\u7684\u64cd\u4f5c\uff0822,100 Gas\uff09\u3002</p> <p>\u907f\u514d\u4ece 0 \u5199\u5165\u975e\u96f6\u7684\u5b9e\u6218\u6280\u5de7\uff1a\u7528 1 \u548c 2 \u4ee3\u66ff 0 \u548c 1 \u4f5c\u4e3a\u72b6\u6001\u6807\u8bb0\u3002OpenZeppelin \u7684 ReentrancyGuard \u5c31\u662f\u8fd9\u6837\u505a\u7684\uff1a</p> <pre><code>uint256 private constant NOT_ENTERED = 1;\nuint256 private constant ENTERED = 2;\nuint256 private _status = NOT_ENTERED;  // \u521d\u59cb\u5316\u4e3a 1\n\nmodifier nonReentrant() {\n    require(_status != ENTERED);\n    _status = ENTERED;  // 1 \u2192 2: 5,000 gas\uff08\u800c\u975e 0 \u2192 1 \u7684 22,100\uff09\n    _;\n    _status = NOT_ENTERED;  // 2 \u2192 1: 5,000 gas\n}\n</code></pre>"},{"location":"web3/dapp/gas_optimization_guide_part3_storage_optimization/#vs","title":"\u516b\u3001\u6620\u5c04 vs \u6570\u7ec4","text":"<p>\u6570\u7ec4\u8bfb\u901a\u5e38\u5305\u542b\u957f\u5ea6\u8bfb\u53d6\u4e0e\u8d8a\u754c\u68c0\u67e5\u7b49\u989d\u5916\u903b\u8f91\uff0c\u8fd9\u9700\u8981\u989d\u5916\u7684 Gas\uff1b\u6620\u5c04\u8bfb\u6ca1\u6709\u8fb9\u754c\u68c0\u67e5\uff0c\u4f46\u6620\u5c04\u65e0\u6cd5\u904d\u5386\u3002\u662f\u5426\u7701 Gas \u4f9d\u8d56\u4e0a\u4e0b\u6587\uff0c\u6570\u503c\u5efa\u8bae\u4ee5\u5b9e\u9645\u7f16\u8bd1\u4ea7\u7269\u4e0e trace \u4e3a\u51c6\u3002</p> <pre><code>// \u6570\u7ec4\u8bfb\u53d6\ncontract UseArray {\n    uint256[] public data;\n\n    function get(uint256 i) external view returns (uint256) {\n        return data[i];  // \u5305\u542b\u8fb9\u754c\u68c0\u67e5\n    }\n}\n\n// \u6620\u5c04\u8bfb\u53d6\ncontract UseMapping {\n    mapping(uint256 =&gt; uint256) public data;\n\n    function get(uint256 i) external view returns (uint256) {\n        return data[i];  // \u65e0\u8fb9\u754c\u68c0\u67e5\n    }\n}\n</code></pre>"},{"location":"web3/dapp/gas_optimization_guide_part3_storage_optimization/#vs_1","title":"\u4e5d\u3001\u5b58\u50a8\u6307\u9488 vs \u5185\u5b58\u590d\u5236","text":"<p>\u5728\u4ecb\u7ecd\u5b8c\u6574\u7684\u4f18\u5316\u6848\u4f8b\u4e4b\u524d\uff0c\u5148\u7406\u89e3\u4e00\u4e2a\u5173\u952e\u6982\u5ff5\uff1a\u5b58\u50a8\u6307\u9488\uff08storage\uff09\u4e0e\u5185\u5b58\u590d\u5236\uff08memory\uff09\u7684\u533a\u522b\u3002</p> \u58f0\u660e\u65b9\u5f0f \u884c\u4e3a Gas \u6d88\u8017 <code>User memory user = users[userId]</code> \u5c06\u6574\u4e2a\u7ed3\u6784\u4f53\u590d\u5236\u5230\u5185\u5b58 \u6bcf\u4e2a\u5b57\u6bb5\u90fd SLOAD <code>User storage user = users[userId]</code> \u521b\u5efa\u4e00\u4e2a\u6307\u9488\uff0c\u6307\u5411\u5b58\u50a8\u4f4d\u7f6e \u4ec5\u58f0\u660e\u65f6\u4e0d\u8bfb\u53d6\u4efb\u4f55\u6570\u636e <pre><code>// memory\uff1a\u590d\u5236\u6574\u4e2a\u7ed3\u6784\u4f53\u5230\u5185\u5b58\nUser memory user = users[userId];\n// \u2192 SLOAD slot n\uff08\u8bfb\u53d6 wallet + lastActive + isActive\uff09\n// \u2192 SLOAD slot n+1\uff08\u8bfb\u53d6 balance\uff09\n// \u2192 \u5373\u4f7f\u53ea\u9700\u8981 balance\uff0c\u4e5f\u4f1a\u8bfb\u53d6\u6240\u6709\u5b57\u6bb5\n\n// storage\uff1a\u53ea\u4fdd\u5b58\u4e00\u4e2a\u6307\u9488\nUser storage user = users[userId];\n// \u2192 \u4e0d\u6267\u884c\u4efb\u4f55 SLOAD\uff08\u60f0\u6027\u52a0\u8f7d\uff09\n// \u2192 \u8bbf\u95ee user.balance \u65f6\u624d SLOAD slot n+1\n// \u2192 \u8bbf\u95ee user.isActive \u65f6\u624d SLOAD slot n\n</code></pre> <p>\u5b58\u50a8\u6307\u9488\u662f\u60f0\u6027\u7684\uff1a\u53ea\u6709\u5728\u8bbf\u95ee\u5177\u4f53\u5b57\u6bb5\u65f6\u624d\u6267\u884c SLOAD\u3002\u5982\u679c\u7ed3\u6784\u4f53\u6709 5 \u4e2a\u69fd\u4f4d\u4f46\u4f60\u53ea\u9700\u8981 1 \u4e2a\u5b57\u6bb5\uff0c\u4f7f\u7528 storage \u53ef\u4ee5\u8282\u7701 80% \u7684\u8bfb\u53d6\u6210\u672c\u3002</p> <p>storage \u5f15\u7528\u53d8\u91cf\uff08T storage ref\uff09\u6307\u5411\u67d0\u4e2a storage \u5bf9\u8c61\u65f6\uff0c\u8d4b\u503c\u5f97\u5230\u7684\u662f\u5f15\u7528/\u522b\u540d\uff0c\u4fee\u6539 ref \u4f1a\u4fee\u6539\u539f storage\u3002\u4ee5 <code>User storage user = users[userId]</code> \u4e3a\u4f8b\uff1a\u4fee\u6539 user \u7684\u5185\u5bb9\uff0c\u7b49\u540c\u4e8e\u4fee\u6539 users[userId]\u3002</p> <p>\u4e0b\u9762\u901a\u8fc7\u4e00\u4e2a\u6781\u7b80\u5408\u7ea6\u6f14\u793a\u8fd9\u4e00\u6982\u5ff5\uff1a</p> <pre><code>// SPDX-License-Identifier: MIT\npragma solidity ^0.8.28;\n\ncontract UserManagerSimple {\n    struct User {\n        address wallet;     // 160 bits\n        uint48 lastActive;  // 48 bits\uff08\u591f\u7528\u6570\u767e\u4e07\u5e74\uff09\n        bool isActive;      // 8 bits\n        // address + uint48 + bool \u603b\u8ba1 216 bits\uff0c\u6253\u5305\u5728\u540c\u4e00\u4e2a slot\n        uint256 balance;    // slot n+1\n    }\n\n    uint256 public userCount;\n    uint256 constant maxUsers = 1000;   // constant \u4e0d\u5360\u69fd\u4f4d\n    mapping(uint256 =&gt; User) public users;\n\n    function updateBalance(uint256 userId, uint256 amount) external {\n        User storage user = users[userId];          // \u5b58\u50a8\u6307\u9488\n        require(user.isActive);                     // \u53ea\u8bfb\u9700\u8981\u7684\u5b57\u6bb5\n        uint256 newBalance = user.balance + amount; // \u7f13\u5b58\n        user.balance = newBalance;\n        user.lastActive = uint48(block.timestamp);\n    }\n}\n</code></pre> <p>\u4f18\u5316\u8981\u70b9\uff1a</p> \u6280\u5de7 \u5e94\u7528 \u7ed3\u6784\u4f53\u6253\u5305 wallet + lastActive + isActive \u6253\u5305\u5230\u4e00\u4e2a\u69fd\u4f4d \u7c7b\u578b\u7cbe\u7b80 lastActive \u4ece uint256 \u6539\u4e3a uint48 constant maxUsers \u6539\u4e3a constant \u5b58\u50a8\u6307\u9488 \u4f7f\u7528 storage \u800c\u975e memory \u7f13\u5b58 \u8ba1\u7b97\u7ed3\u679c\u7f13\u5b58\u540e\u518d\u5199\u5165"},{"location":"web3/dapp/gas_optimization_guide_part3_storage_optimization/#usermanagerv1","title":"\u5341\u3001\u6559\u5b66\u7248\u7528\u6237\u7ba1\u7406\u5408\u7ea6\uff1aUserManagerV1","text":"<p>UserManagerSimple \u53ea\u662f\u4e00\u4e2a\u6781\u7b80\u793a\u4f8b\uff0c\u7528\u4e8e\u6f14\u793a\u5b58\u50a8\u6307\u9488\u7684\u6982\u5ff5\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u5f15\u5165\u4e00\u4e2a\u66f4\u5b8c\u6574\u7684\u6559\u5b66\u5408\u7ea6 UserManagerV1\uff0c\u5b83\u5c06\u4f5c\u4e3a\u540e\u7eed\u6240\u6709\u4f18\u5316\u5de5\u4f5c\u7684\u57fa\u7840\u3002</p> <pre><code>// SPDX-License-Identifier: MIT\npragma solidity ^0.8.28;\n\n/// @title UserManagerV1\n/// @notice \u6559\u5b66\u7248\u7528\u6237\u7ba1\u7406\u5408\u7ea6\uff0c\u7528\u4e8e Gas \u4f18\u5316\u7ec3\u4e60\n/// @dev \u672c\u5408\u7ea6\u4e0d\u8003\u8651\u53ef\u5347\u7ea7\u6027\u3001\u4e0d\u652f\u6301\u5220\u9664\u7528\u6237\u6216\u8fc1\u79fb\u94b1\u5305\uff0c\u4ec5\u7528\u4e8e\u6559\u5b66\u573a\u666f\ncontract UserManagerV1 {\n    // \u4e0b\u4e00\u4e2a\u53ef\u5206\u914d\u7684\u7528\u6237 ID\n    uint256 public nextUserId = 1;\n    // \u6700\u5927\u5141\u8bb8\u521b\u5efa\u7684\u7528\u6237\u6570\u91cf\uff08\u7b49\u4ef7\u4e8e\u6700\u5927 userId\uff09\n    uint256 public constant MAX_USERS = 1000;\n    address public owner;\n\n    /// @notice \u7528\u6237\u7ed3\u6784\u4f53\n    /// @dev isBanned=true \u8868\u793a\u7528\u6237\u88ab\u5c01\u7981\uff0c\u5c01\u7981\u7528\u6237\u65e0\u6cd5\u4fee\u6539\u4f59\u989d\n    struct User {\n        uint256 id;            // \u7528\u6237 ID\uff08\u4e0e mapping \u7684 key \u4fdd\u6301\u4e00\u81f4\uff09\n        uint256 balance;       // \u7528\u6237\u4f59\u989d\uff08\u6559\u5b66\u4e2d\u7528\u4e8e\u6f14\u793a SSTORE \u884c\u4e3a\uff09\n        uint256 lastUpdated;   // \u6700\u8fd1\u4e00\u6b21\u72b6\u6001\u6216\u4f59\u989d\u53d8\u66f4\u7684\u533a\u5757\u65f6\u95f4\u6233\n        address wallet;        // \u7528\u6237\u7ed1\u5b9a\u7684\u94b1\u5305\u5730\u5740\uff08\u4e0d\u53ef\u66f4\u6362\uff09\n        bool isBanned;         // \u662f\u5426\u88ab\u5c01\u7981\n    }\n\n    mapping(uint256 =&gt; User) public users;\n    // wallet =&gt; userId \u7684\u53cd\u5411\u7d22\u5f15\uff0c0 \u8868\u793a\u8be5 wallet \u5c1a\u672a\u6ce8\u518c\n    mapping(address =&gt; uint256) public userIdByWallet;\n\n    event UserCreated(uint256 indexed userId, address indexed wallet, uint256 balance, uint256 lastUpdated);\n    event BalanceUpdated(uint256 indexed userId, uint256 balance, uint256 lastUpdated);\n    event OwnershipTransferred(address indexed oldOwner, address indexed newOwner);\n\n    /// @dev status == true \u8868\u793a isBanned == true\uff08\u7528\u6237\u88ab\u5c01\u7981\uff09\n    event UserStatusChanged(uint256 indexed userId, bool status, uint256 lastUpdated);\n\n    error Unauthorized(address owner, address caller);\n    error MaxUsersReached(uint256 maxUsers, uint256 nextUserId);\n    error InvalidWallet(address wallet);\n    error WalletExisted(address wallet);\n    error NotExist(uint256 userId);\n    error BannedUser(uint256 userId);\n    error ZeroAddress();\n\n    /// @notice \u6784\u9020\u51fd\u6570\uff0c\u90e8\u7f72\u8005\u6210\u4e3a\u521d\u59cb owner\n    constructor() {\n        owner = msg.sender;\n    }\n\n    /// @notice \u4ec5\u5141\u8bb8 owner \u8c03\u7528\u7684\u4fee\u9970\u5668\n    modifier onlyOwner() {\n        if (msg.sender != owner) revert Unauthorized(owner, msg.sender);\n        _;\n    }\n\n    /// @notice \u521b\u5efa\u4e00\u4e2a\u65b0\u7528\u6237\u8d26\u6237\n    /// @param wallet \u7528\u6237\u7ed1\u5b9a\u7684\u94b1\u5305\u5730\u5740\uff08\u5fc5\u987b\u552f\u4e00\uff0c\u4e14\u4e0d\u53ef\u4e3a 0 \u5730\u5740\uff09\n    function createUserAccount(address wallet) public onlyOwner {\n        if (nextUserId &gt; MAX_USERS) { revert MaxUsersReached(MAX_USERS, nextUserId); }\n        if (wallet == address(0)) revert InvalidWallet(wallet);\n        if (userIdByWallet[wallet] != 0) revert WalletExisted(wallet);\n\n        uint256 newUserId = nextUserId;\n        users[newUserId].id = newUserId;\n        users[newUserId].balance = 0;\n        users[newUserId].lastUpdated = block.timestamp;\n        users[newUserId].wallet = wallet;\n        users[newUserId].isBanned = false;\n        // \u5efa\u7acb wallet \u2192 userId \u7684\u53cd\u5411\u7d22\u5f15\n        userIdByWallet[wallet] = newUserId;\n\n        emit UserCreated(newUserId, wallet, users[newUserId].balance, users[newUserId].lastUpdated);\n        unchecked { nextUserId = newUserId + 1; }\n    }\n\n    /// @notice \u8bbe\u7f6e\uff08\u8986\u76d6\uff09\u7528\u6237\u4f59\u989d\n    function setBalance(uint256 userId, uint256 amount) public onlyOwner {\n        if (users[userId].wallet == address(0)) revert NotExist(userId);\n        if (users[userId].isBanned) revert BannedUser(userId);\n\n        users[userId].balance = amount;\n        users[userId].lastUpdated = block.timestamp;\n\n        emit BalanceUpdated(userId, users[userId].balance, users[userId].lastUpdated);\n    }\n\n    /// @notice \u4fee\u6539\u7528\u6237\u5c01\u7981\u72b6\u6001\n    /// @param status true \u8868\u793a\u5c01\u7981\uff0cfalse \u8868\u793a\u89e3\u5c01\n    function changeStatus(uint256 userId, bool status) public onlyOwner {\n        if (users[userId].wallet == address(0)) revert NotExist(userId);\n\n        users[userId].isBanned = status;\n        users[userId].lastUpdated = block.timestamp;\n\n        emit UserStatusChanged(userId, users[userId].isBanned, users[userId].lastUpdated);\n    }\n\n    /// @notice \u68c0\u67e5 wallet \u2192 userId \u2192 wallet \u7684\u6620\u5c04\u4e0d\u53d8\u5f0f\u662f\u5426\u6210\u7acb\n    /// @dev \u6559\u5b66\u7528\u51fd\u6570\uff0c\u7528\u4e8e\u7406\u89e3\u53cc\u5411\u7d22\u5f15\u7684\u4e00\u81f4\u6027\n    function checkIfWalletMappedCorrectly(address wallet) public view returns (bool) {\n        uint256 id = userIdByWallet[wallet];\n        return (id != 0 &amp;&amp; users[id].wallet == wallet);\n    }\n\n    /// @notice \u8f6c\u79fb\u7ba1\u7406\u5458\u6743\u9650\n    function transferOwnership(address newOwner) public onlyOwner {\n        if (newOwner == address(0)) revert ZeroAddress();\n\n        emit OwnershipTransferred(owner, newOwner);\n        owner = newOwner;\n    }\n}\n</code></pre> <p>UserManagerV1 \u5b58\u5728\u4ee5\u4e0b\u53ef\u4f18\u5316\u70b9\uff1a</p> <ul> <li>\u7ed3\u6784\u4f53\u5b57\u6bb5\u672a\u6253\u5305\uff0c\u5360\u7528\u8fc7\u591a\u69fd\u4f4d</li> <li>\u672a\u4f7f\u7528 storage \u6307\u9488\uff0c\u5b58\u5728\u591a\u6b21\u91cd\u590d SLOAD</li> <li>\u9010\u5b57\u6bb5\u8d4b\u503c\u53ef\u80fd\u5bfc\u81f4\u5bf9\u540c\u4e00 packed slot \u591a\u6b21 read-modify-write</li> <li>\u4e8b\u4ef6\u53c2\u6570\u4ece storage \u8bfb\u53d6\uff0c\u589e\u52a0\u989d\u5916 SLOAD</li> </ul>"},{"location":"web3/dapp/gas_optimization_guide_part3_storage_optimization/#usermanagerv2","title":"\u5341\u4e00\u3001UserManagerV2\uff1a\u5b58\u50a8\u4f18\u5316\u7248","text":"<pre><code>// SPDX-License-Identifier: MIT\npragma solidity ^0.8.28;\n\n/// @title UserManagerV2\n/// @notice Gas \u4f18\u5316\u7248\uff08\u5b58\u50a8\u4f18\u5316\uff09\ncontract UserManagerV2 {\n    uint16 public nextUserId = 1;\n    uint16 constant MAX_USERS = 1000;\n    address public owner;\n\n    struct User {\n        uint16 id;             // \u7528\u6237 ID\uff08\u4e0e mapping \u7684 key \u4fdd\u6301\u4e00\u81f4\uff09\n        address wallet;        // \u7528\u6237\u7ed1\u5b9a\u7684\u94b1\u5305\u5730\u5740\uff08\u4e0d\u53ef\u66f4\u6362\uff09\n        uint64 lastUpdated;    // \u6700\u8fd1\u4e00\u6b21\u72b6\u6001\u6216\u4f59\u989d\u53d8\u66f4\u7684\u533a\u5757\u65f6\u95f4\u6233\n        bool isBanned;         // \u662f\u5426\u88ab\u5c01\u7981\n        uint256 balance;       // \u7528\u6237\u4f59\u989d\n    }\n\n    mapping(uint16 =&gt; User) public users;\n    mapping(address =&gt; uint16) public userIdByWallet;\n\n    event UserCreated(uint16 indexed userId, address indexed wallet, uint256 balance, uint64 lastUpdated);\n    event BalanceUpdated(uint16 indexed userId, uint256 balance, uint64 lastUpdated);\n    event OwnershipTransferred(address indexed oldOwner, address indexed newOwner);\n    event UserStatusChanged(uint16 indexed userId, bool status, uint64 lastUpdated);\n\n    error Unauthorized(address owner, address caller);\n    error MaxUsersReached(uint16 maxUsers, uint16 nextUserId);\n    error InvalidWallet(address wallet);\n    error WalletExisted(address wallet);\n    error NotExist(uint16 userId);\n    error BannedUser(uint16 userId);\n    error ZeroAddress();\n\n    constructor() {\n        owner = msg.sender;\n    }\n\n    modifier onlyOwner() {\n        if (msg.sender != owner) revert Unauthorized(owner, msg.sender);\n        _;\n    }\n\n    function createUserAccount(address wallet) public onlyOwner {\n        uint16 newUserId = nextUserId;\n        uint64 ts = uint64(block.timestamp);\n\n        if (newUserId &gt; MAX_USERS) { revert MaxUsersReached(MAX_USERS, newUserId); }\n        if (wallet == address(0)) revert InvalidWallet(wallet);\n        if (userIdByWallet[wallet] != 0) revert WalletExisted(wallet);\n\n        users[newUserId] = User({\n            id: newUserId,\n            wallet: wallet,\n            lastUpdated: ts,\n            isBanned: false,\n            balance: 0\n        });\n\n        userIdByWallet[wallet] = newUserId;\n\n        emit UserCreated(newUserId, wallet, 0, ts);\n        unchecked { nextUserId = newUserId + 1; }\n    }\n\n    function setBalance(uint16 userId, uint256 amount) public onlyOwner {\n        User storage u = users[userId];\n\n        if (u.wallet == address(0)) revert NotExist(userId);\n        if (u.isBanned) revert BannedUser(userId);\n\n        u.balance = amount;\n        u.lastUpdated = uint64(block.timestamp);\n\n        emit BalanceUpdated(userId, u.balance, u.lastUpdated);\n    }\n\n    function changeStatus(uint16 userId, bool status) public onlyOwner {\n        User storage u = users[userId];\n\n        if (u.wallet == address(0)) revert NotExist(userId);\n\n        u.isBanned = status;\n        u.lastUpdated = uint64(block.timestamp);\n\n        emit UserStatusChanged(userId, u.isBanned, u.lastUpdated);\n    }\n\n    function checkIfWalletMappedCorrectly(address wallet) public view returns (bool) {\n        uint16 id = userIdByWallet[wallet];\n        return (id != 0 &amp;&amp; users[id].wallet == wallet);\n    }\n\n    function transferOwnership(address newOwner) public onlyOwner {\n        if (newOwner == address(0)) revert ZeroAddress();\n\n        emit OwnershipTransferred(owner, newOwner);\n        owner = newOwner;\n    }\n}\n</code></pre> <p>V1 \u2192 V2 \u6838\u5fc3\u4f18\u5316\u70b9</p> \u4f18\u5316\u9879 V1 V2 \u7ed3\u6784\u4f53\u5b57\u6bb5\u6392\u5217 \u672a\u6253\u5305\uff0c\u6bcf\u5b57\u6bb5\u72ec\u5360\u69fd\u4f4d id + wallet + lastUpdated + isBanned \u6253\u5305 \u7c7b\u578b\u7cbe\u7b80 uint256 userId/timestamp uint16 userId, uint64 timestamp \u5b58\u50a8\u6307\u9488 \u76f4\u63a5\u8bbf\u95ee users[userId] User storage u = users[userId] \u7ed3\u6784\u4f53\u8d4b\u503c \u9010\u5b57\u6bb5\u8d4b\u503c \u4e00\u6b21\u6027 struct \u8d4b\u503c \u4e8b\u4ef6\u53c2\u6570 \u4ece storage \u8bfb\u53d6 \u4f7f\u7528\u5c40\u90e8\u53d8\u91cf <p>\u5728 EVM \u5c42\u9762\uff0c\u7ed9\u540c\u4e00 slot \u4e0d\u540c\u5b57\u6bb5\u8d4b\u503c\uff0c\u7f16\u8bd1\u5668\u901a\u5e38\u4f1a\u505a read-modify-write\uff1a\u7b2c\u4e00\u6b21\u628a slot \u4ece 0 \u5199\u6210\u975e\u96f6\uff08\u6602\u8d35 0\u2192\u975e\u96f6\uff09\uff0c\u4e4b\u540e\u6bcf\u6b21\u518d\u6539\u540c\u4e00 slot \u90fd\u662f\u975e\u96f6\u2192\u975e\u96f6\uff08\u4ecd\u8981\u4ed8 SSTORE \u6210\u672c\uff09\u3002\u8fd9\u6b63\u662f\"\u7ed3\u6784\u4f53\u6253\u5305\"\u7ecf\u5e38\u88ab\u5ffd\u7565\u7684\u526f\u4f5c\u7528\uff1a\u6253\u5305\u7701\u69fd\u4f4d\uff0c\u4f46\u5982\u679c\u5199\u5165\u65b9\u5f0f\u4e0d\u5f53\uff0c\u4f1a\u5bfc\u81f4\u5bf9\u540c\u4e00\u4e2a\u69fd\u4f4d\u53cd\u590d SSTORE\u3002</p> <p>\u5efa\u8bae\u7528\u4e00\u6b21\u6027 struct \u8d4b\u503c\uff0c\u8ba9\u7f16\u8bd1\u5668\u66f4\u5bb9\u6613\u751f\u6210\u6bcf\u4e2a slot \u4e00\u6b21 SSTORE\u3002</p>"},{"location":"web3/dapp/gas_optimization_guide_part3_storage_optimization/#_5","title":"\u5c0f\u7ed3","text":"<p>\u672c\u7bc7\u4ecb\u7ecd\u4e86\u5b58\u50a8\u4f18\u5316\u7684\u6838\u5fc3\u6280\u5de7\uff1a</p> <ul> <li>\u53d8\u91cf\u6253\u5305\u548c\u7ed3\u6784\u4f53\u6253\u5305\u53ef\u4ee5\u51cf\u5c11\u69fd\u4f4d\u6570\u91cf\uff1b</li> <li>constant \u548c immutable \u53ef\u4ee5\u5b8c\u5168\u907f\u514d SLOAD\uff1b</li> <li>\u7f13\u5b58\u5b58\u50a8\u53d8\u91cf\u53ef\u4ee5\u51cf\u5c11\u91cd\u590d\u8bfb\u53d6\uff1b</li> <li>\u77ac\u65f6\u5b58\u50a8\u53ef\u4ee5\u5927\u5e45\u964d\u4f4e\u4ea4\u6613\u5185\u9501\u7684\u6210\u672c\uff1b</li> <li>\u907f\u514d 0\u2192\u975e 0 \u5199\u5165\u53ef\u4ee5\u8282\u7701 17,100 Gas\uff1b</li> </ul> <p>\u901a\u8fc7 UserManagerV1 \u2192 UserManagerV2 \u7684\u6f14\u793a\uff0c\u6211\u4eec\u770b\u5230\u4e86\u5982\u4f55\u7cfb\u7edf\u6027\u5730\u5e94\u7528\u8fd9\u4e9b\u6280\u5de7\u3002</p> <p>\u4e0b\u4e00\u7bc7\u6211\u4eec\u5c06\u5728 UserManagerV2 \u7684\u57fa\u7840\u4e0a\u7ee7\u7eed\u8fdb\u884c\u8ba1\u7b97\u5c42\u9762\u7684\u4f18\u5316\uff0c\u5305\u62ec\u5faa\u73af\u4f18\u5316\u3001\u77ed\u8def\u6c42\u503c\u3001\u81ea\u5b9a\u4e49\u9519\u8bef\u7b49\u6280\u5de7\uff0c\u5b8c\u6210 UserManagerV3 \u7684\u5f00\u53d1\u3002</p> <p>\u7cfb\u5217\u5bfc\u822a\uff1a</p> <ul> <li>\u7b2c\u4e00\u7bc7\uff1aGas \u4f18\u5316\u6307\u5357\uff08\u4e00\uff09\uff1aGas \u673a\u5236\u539f\u7406</li> <li>\u7b2c\u4e8c\u7bc7\uff1aGas \u4f18\u5316\u6307\u5357\uff08\u4e8c\uff09\uff1aEIP-1559 \u4ea4\u6613\u89e3\u6790</li> <li> <p>\u7b2c\u4e09\u7bc7\uff1aGas \u4f18\u5316\u6307\u5357\uff08\u4e09\uff09\uff1a\u5b58\u50a8\u4f18\u5316\uff08\u672c\u7bc7\uff09</p> </li> <li> <p>\u7b2c\u56db\u7bc7\uff1aGas \u4f18\u5316\u6307\u5357\uff08\u56db\uff09\uff1a\u8ba1\u7b97\u4f18\u5316</p> </li> <li>\u7b2c\u4e94\u7bc7\uff1aGas \u4f18\u5316\u6307\u5357\uff08\u4e94\uff09\uff1aGas \u8bc4\u4f30\u4e0e\u6d4b\u91cf</li> </ul>"},{"location":"web3/dapp/gas_optimization_guide_part4_computation_optimization/","title":"Gas \u4f18\u5316\u6307\u5357\uff08\u56db\uff09\uff1a\u8ba1\u7b97\u4f18\u5316","text":"<p> \u7ea6 1601 \u4e2a\u5b57  168 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 7 \u5206\u949f</p> <p>\u672c\u7bc7\u662f Gas \u4f18\u5316\u7cfb\u5217\u7684\u7b2c\u56db\u7bc7\uff0c\u805a\u7126\u4e8e\u8ba1\u7b97\u5c42\u9762\u7684 Gas \u4f18\u5316\u3002</p> <p>\u672c\u7bc7\u5c06\u4ecb\u7ecd\u5faa\u73af\u4f18\u5316\u3001\u77ed\u8def\u6c42\u503c\u3001\u81ea\u5b9a\u4e49\u9519\u8bef\u3001\u4f4d\u8fd0\u7b97\u7b49\u6280\u5de7\uff0c\u5e76\u5728 UserManagerV2 \u7684\u57fa\u7840\u4e0a\u5b8c\u6210 UserManagerV3 \u7684\u8ba1\u7b97\u4f18\u5316\u3002</p>"},{"location":"web3/dapp/gas_optimization_guide_part4_computation_optimization/#_1","title":"\u4e00\u3001\u8ba1\u7b97\u4f18\u5316\u7684\u4ef7\u503c","text":"<p>\u8ba1\u7b97\u64cd\u4f5c\u901a\u5e38\u8fdc\u4fbf\u5b9c\u4e8e storage\uff0c\u4f46\u5728\u5faa\u73af\u4e0e\u9ad8\u9891\u51fd\u6570\u4e2d\uff0c\u8ba1\u7b97\u6210\u672c\u4f1a\u7ebf\u6027\u7d2f\u8ba1\u3002\u8ba1\u7b97\u4f18\u5316\u7684\u4ef7\u503c\u4e3b\u8981\u4f53\u73b0\u5728\u4e24\u7c7b\u573a\u666f\uff1a</p> <ol> <li>\u5faa\u73af\u6b21\u6570\u5927\uff0c\u6279\u91cf\u5904\u7406\u591a\u5143\u7d20</li> <li>storage \u70ed\u70b9\u5df2\u7ecf\u538b\u4f4e\uff0c\u8ba1\u7b97\u6210\u4e3a\u65b0\u7684\u74f6\u9888</li> </ol>"},{"location":"web3/dapp/gas_optimization_guide_part4_computation_optimization/#_2","title":"\u4e8c\u3001\u5faa\u73af\u4f18\u5316","text":"<p>\u5faa\u73af\u4f18\u5316\u7684\u76ee\u6807\u662f\u51cf\u5c11\u6bcf\u6b21\u8fed\u4ee3\u7684\u989d\u5916\u5f00\u9500\uff0c\u5c24\u5176\u662f\u907f\u514d\u91cd\u590d\u89e6\u53d1\u6602\u8d35\u8def\u5f84\u3002</p> <p>\u7f13\u5b58\u957f\u5ea6\u4e0e\u5e38\u7528\u503c\uff1a\u628a arr.length \u7b49\u91cd\u590d\u8bfb\u53d6\u7684\u503c\u7f13\u5b58\u5230\u5c40\u90e8\u53d8\u91cf\uff0c\u51cf\u5c11\u8fed\u4ee3\u4e2d\u7684\u989d\u5916\u6307\u4ee4\u8def\u5f84\u3002</p> <p>\u7528 unchecked \u5305\u88f9\u9012\u589e\u64cd\u4f5c\uff1aSolidity 0.8+ \u9ed8\u8ba4\u68c0\u67e5\u7b97\u672f\u6ea2\u51fa\uff0c\u8fd9\u9700\u8981\u989d\u5916\u6307\u4ee4\u3002\u5728\u786e\u4fdd\u4e0d\u4f1a\u6ea2\u51fa\u7684\u573a\u666f\uff0c\u53ef\u4ee5\u7528 unchecked \u8df3\u8fc7\u68c0\u67e5\u3002</p> <p>\u9012\u589e\u524d\u7f6e\uff1a\u524d\u7f6e\u9012\u589e <code>++i</code> \u6bd4\u540e\u7f6e\u9012\u589e <code>i++</code> \u7565\u7701 Gas\u3002\u8865\u5145\uff1a\u5bf9 0.8 \u7cfb\u5217\u800c\u8a00\uff0c\u5dee\u5f02\u7ecf\u5e38\u88ab\u7f16\u8bd1\u5668\u4f18\u5316\u6389\uff0c\u5c24\u5176\u5728\u4f18\u5316\u5668\u5f00\u542f\u65f6\u3002</p> <pre><code>function sumOptimized(uint256[] calldata arr) external pure returns (uint256 total) {\n    uint256 len = arr.length;\n    for (uint256 i; i &lt; len; ) {\n        total += arr[i];\n        unchecked { ++i; }\n    }\n}\n</code></pre>"},{"location":"web3/dapp/gas_optimization_guide_part4_computation_optimization/#_3","title":"\u4e09\u3001\u77ed\u8def\u6c42\u503c","text":"<p>\u903b\u8f91\u8fd0\u7b97\u7b26 <code>&amp;&amp;</code> \u548c <code>||</code> \u4f1a\u77ed\u8def\u6c42\u503c\uff1a</p> <ul> <li><code>A &amp;&amp; B</code>\uff1a\u5982\u679c A \u4e3a false\uff0c\u4e0d\u8ba1\u7b97 B</li> <li><code>A || B</code>\uff1a\u5982\u679c A \u4e3a true\uff0c\u4e0d\u8ba1\u7b97 B</li> </ul> <p>\u4f18\u5316\u539f\u5219\uff1a\u628a\u66f4\u4fbf\u5b9c\u7684\u3001\u66f4\u53ef\u80fd\u77ed\u8def\u7684\u6761\u4ef6\u653e\u524d\u9762\u3002</p> <p>\u77ed\u8def\u4f18\u5316\u7684\u4ef7\u503c\u4e0d\u662f\u8282\u7701\u4e00\u6b21\u6bd4\u8f83\u64cd\u4f5c\uff0c\u800c\u662f\u907f\u514d\u89e6\u53d1\u66f4\u6602\u8d35\u7684\u8def\u5f84\uff0c\u4f8b\u5982 SLOAD\u3001\u5916\u90e8\u8c03\u7528\u6216\u54c8\u5e0c\u8ba1\u7b97\u3002</p> <pre><code>// \u274c \u6602\u8d35\u64cd\u4f5c\u5728\u524d\nfunction check(uint256 id) external view returns (bool) {\n    // balanceOf \u9700\u8981 SLOAD\uff0c\u5373\u4f7f id == 0 \u4e5f\u4f1a\u6267\u884c\n    return balanceOf[id] &gt; 0 &amp;&amp; id != 0;\n}\n\n// \u2705 \u4fbf\u5b9c\u64cd\u4f5c\u5728\u524d\nfunction check(uint256 id) external view returns (bool) {\n    // id != 0 \u53ea\u9700\u6808\u64cd\u4f5c\uff0c\u5982\u679c\u4e3a false \u5c31\u77ed\u8def\n    return id != 0 &amp;&amp; balanceOf[id] &gt; 0;\n}\n</code></pre>"},{"location":"web3/dapp/gas_optimization_guide_part4_computation_optimization/#_4","title":"\u56db\u3001\u81ea\u5b9a\u4e49\u9519\u8bef","text":"<p>\u81ea\u5b9a\u4e49\u9519\u8bef\u51cf\u5c11\u90e8\u7f72\u5b57\u8282\u7801\u4e0e revert data\uff0c\u901a\u5e38\u6bd4 require \u5b57\u7b26\u4e32\u66f4\u7701 Gas\uff0c\u5e76\u4e14\u66f4\u5229\u4e8e\u524d\u7aef\u7ed3\u6784\u5316\u89e3\u6790\u3002</p> \u65b9\u5f0f \u5b58\u50a8\u5185\u5bb9 \u5927\u5c0f require(\"message\") \u9519\u8bef\u9009\u62e9\u5668 + \u5b57\u7b26\u4e32 64+ \u5b57\u8282 revert CustomError() \u9519\u8bef\u9009\u62e9\u5668 4 \u5b57\u8282 <pre><code>// \u274c \u5b57\u7b26\u4e32\u9519\u8bef\nfunction withdraw(uint256 amount) external {\n    require(amount &lt;= balance, \"Insufficient balance\");\n    // ...\n}\n\n// \u2705 \u81ea\u5b9a\u4e49\u9519\u8bef\nerror InsufficientBalance(uint256 available, uint256 required);\n\nfunction withdraw(uint256 amount) external {\n    if (amount &gt; balance) {\n        revert InsufficientBalance(balance, amount);\n    }\n    // ...\n}\n</code></pre>"},{"location":"web3/dapp/gas_optimization_guide_part4_computation_optimization/#_5","title":"\u4e94\u3001\u4f4d\u8fd0\u7b97\u4f18\u5316","text":"<p>\u73b0\u4ee3\u7f16\u8bd1\u5668\u4f1a\u81ea\u52a8\u4f18\u5316\u5e38\u91cf\u4e58\u9664\uff0c\u624b\u52a8\u4f18\u5316\u7684\u6536\u76ca\u6709\u9650\uff0c\u4f4d\u8fd0\u7b97\u4e0d\u662f\"\u901a\u7528\u7701 Gas \u79d8\u7c4d\"\u3002</p> <p>\u4f4d\u8fd0\u7b97\u4f18\u5316\u5728 EVM \u4e0a\u7684\u4ef7\u503c\u4e3b\u8981\u6765\u81ea\u4e24\u4e2a\u5730\u65b9\uff1abit packing \u4e0e bitmap \u7c7b\u6570\u636e\u7ed3\u6784\uff0c\u4ee5\u53ca\u907f\u514d\u5206\u652f\u6216\u5b9e\u73b0 mask \u63d0\u53d6\u3002\u5982\u679c\u53ea\u662f\u628a x \u4e58 8 \u5199\u6210\u5de6\u79fb\uff0c\u591a\u6570\u60c5\u51b5\u4e0b\u6536\u76ca\u5f88\u6709\u9650\u3002</p> <p>\u4e58\u9664 2 \u7684\u5e42\u6b21</p> <pre><code>x * 2   \u2192   x &lt;&lt; 1\nx / 2   \u2192   x &gt;&gt; 1\nx * 8   \u2192   x &lt;&lt; 3\nx / 256 \u2192   x &gt;&gt; 8\n</code></pre> <p>\u53d6\u6a21 2 \u7684\u5e42\u6b21</p> <pre><code>x % 2   \u2192   x &amp; 1\nx % 256 \u2192   x &amp; 0xff\n</code></pre> <p>\u5224\u65ad\u5947\u5076</p> <pre><code>// \u4f20\u7edf\u65b9\u5f0f\nbool isEven = (x % 2 == 0);\n\n// \u4f4d\u8fd0\u7b97\nbool isEven = (x &amp; 1 == 0);\n</code></pre> <p>\u4f4d\u8fd0\u7b97\u7b26\u4e00\u89c8</p> \u8fd0\u7b97 \u8fd0\u7b97\u7b26 \u542b\u4e49 \u4e0e <code>&amp;</code> \u4e24\u4f4d\u90fd\u4e3a 1 \u624d\u4e3a 1 \u6216 <code>\\|</code> \u4efb\u610f\u4e00\u4f4d\u4e3a 1 \u5373\u4e3a 1 \u5f02\u6216 <code>^</code> \u4e24\u4f4d\u4e0d\u540c\u624d\u4e3a 1 \u975e <code>~</code> \u6309\u4f4d\u53d6\u53cd \u5de6\u79fb <code>&lt;&lt;</code> \u6240\u6709\u4f4d\u5411\u5de6\u79fb\u52a8 \u53f3\u79fb <code>&gt;&gt;</code> \u6240\u6709\u4f4d\u5411\u53f3\u79fb\u52a8\uff08\u7b97\u672f\u53f3\u79fb\uff09 <p>\u6ce8\u610f\uff1a<code>&amp;&amp;</code> / <code>||</code> \u662f\u903b\u8f91\u8fd0\u7b97\uff0c\u4e0d\u662f\u4f4d\u8fd0\u7b97\u3002</p>"},{"location":"web3/dapp/gas_optimization_guide_part4_computation_optimization/#_6","title":"\u516d\u3001\u5df2\u8fc7\u65f6\u7684\u6280\u5de7","text":"<p>\u4ee5\u4e0b\u6280\u5de7\u5728\u65e9\u671f\u7248\u672c\u6709\u6548\uff0c\u73b0\u5728\u5df2\u4e0d\u518d\u63a8\u8350\uff1a</p> \u6280\u5de7 \u72b6\u6001 \u539f\u56e0 Gas Token \u274c \u5931\u6548 EIP-3529 \u524a\u51cf\u4e86\u9000\u6b3e\u4e0a\u9650 \u77ed\u5b57\u7b26\u4e32\u6253\u5305 \u26a0\ufe0f \u7f16\u8bd1\u5668\u5df2\u4f18\u5316 Solidity 0.8+ \u81ea\u52a8\u5904\u7406 <code>&gt; 0</code> \u6539 <code>!= 0</code> \u26a0\ufe0f \u6536\u76ca\u6781\u5c0f \u7f16\u8bd1\u5668\u901a\u5e38\u4f1a\u4f18\u5316 <code>i++</code> \u6539 <code>++i</code> \u26a0\ufe0f \u6536\u76ca\u6781\u5c0f \u5728 unchecked \u5757\u5916\u5dee\u5f02\u4e0d\u5927"},{"location":"web3/dapp/gas_optimization_guide_part4_computation_optimization/#usermanagerv3","title":"\u4e03\u3001UserManagerV3\uff1a\u8ba1\u7b97\u4f18\u5316\u7248","text":"<p>\u5728 UserManagerV2 \u7684\u57fa\u7840\u4e0a\uff0c\u6211\u4eec\u7ee7\u7eed\u8fdb\u884c\u8ba1\u7b97\u5c42\u9762\u7684\u4f18\u5316\uff1a</p> <pre><code>// SPDX-License-Identifier: MIT\npragma solidity ^0.8.28;\n\n/// @title UserManagerV3\n/// @notice Gas \u4f18\u5316\u7248\uff08\u5b58\u50a8\u4f18\u5316\u3001\u8ba1\u7b97\u4f18\u5316\uff09\ncontract UserManagerV3 {\n    uint16 public nextUserId = 1;\n    uint16 constant MAX_USERS = 1000;\n    address public owner;\n\n    struct User {\n        uint16 id;             // \u7528\u6237 ID\uff08\u4e0e mapping \u7684 key \u4fdd\u6301\u4e00\u81f4\uff09\n        address wallet;        // \u7528\u6237\u7ed1\u5b9a\u7684\u94b1\u5305\u5730\u5740\uff08\u4e0d\u53ef\u66f4\u6362\uff09\n        uint64 lastUpdated;    // \u6700\u8fd1\u4e00\u6b21\u72b6\u6001\u6216\u4f59\u989d\u53d8\u66f4\u7684\u533a\u5757\u65f6\u95f4\u6233\n        bool isBanned;         // \u662f\u5426\u88ab\u5c01\u7981\n        uint256 balance;       // \u7528\u6237\u4f59\u989d\n    }\n\n    mapping(uint16 =&gt; User) public users;\n    mapping(address =&gt; uint16) public userIdByWallet;\n\n    event UserCreated(uint16 indexed userId, address indexed wallet, uint256 balance, uint64 lastUpdated);\n    event BalanceUpdated(uint16 indexed userId, uint256 balance, uint64 lastUpdated);\n    event OwnershipTransferred(address indexed oldOwner, address indexed newOwner);\n    event UserStatusChanged(uint16 indexed userId, bool status, uint64 lastUpdated);\n\n    error Unauthorized(address owner, address caller);\n    error MaxUsersReached(uint16 maxUsers, uint16 nextUserId);\n    error InvalidWallet(address wallet);\n    error WalletExisted(address wallet);\n    error NotExist(uint16 userId);\n    error BannedUser(uint16 userId);\n    error ZeroAddress();\n\n    constructor() {\n        owner = msg.sender;\n    }\n\n    modifier onlyOwner() {\n        if (msg.sender != owner) revert Unauthorized(owner, msg.sender);\n        _;\n    }\n\n    function createUserAccount(address wallet) public onlyOwner {\n        uint16 newUserId = nextUserId;\n\n        if (newUserId &gt; MAX_USERS) { revert MaxUsersReached(MAX_USERS, newUserId); }\n        if (wallet == address(0)) revert InvalidWallet(wallet);\n        if (userIdByWallet[wallet] != 0) revert WalletExisted(wallet);\n\n        uint64 ts = uint64(block.timestamp);\n        users[newUserId] = User({\n            id: newUserId,\n            wallet: wallet,\n            lastUpdated: ts,\n            isBanned: false,\n            balance: 0\n        });\n\n        userIdByWallet[wallet] = newUserId;\n\n        emit UserCreated(newUserId, wallet, 0, ts);\n        unchecked { nextUserId = newUserId + 1; }\n    }\n\n    function setBalance(uint16 userId, uint256 amount) public onlyOwner {\n        User storage u = users[userId];\n\n        if (u.wallet == address(0)) revert NotExist(userId);\n        if (u.isBanned) revert BannedUser(userId);\n\n        uint64 ts = uint64(block.timestamp);\n        u.balance = amount;\n        u.lastUpdated = ts;\n\n        emit BalanceUpdated(userId, amount, ts);\n    }\n\n    function changeStatus(uint16 userId, bool status) public onlyOwner {\n        User storage u = users[userId];\n\n        if (u.wallet == address(0)) revert NotExist(userId);\n\n        uint64 ts = uint64(block.timestamp);\n        u.isBanned = status;\n        u.lastUpdated = ts;\n\n        emit UserStatusChanged(userId, status, ts);\n    }\n\n    function checkIfWalletMappedCorrectly(address wallet) public view returns (bool) {\n        uint16 id = userIdByWallet[wallet];\n        return (id != 0 &amp;&amp; users[id].wallet == wallet);\n    }\n\n    function transferOwnership(address newOwner) public onlyOwner {\n        if (newOwner == address(0)) revert ZeroAddress();\n\n        emit OwnershipTransferred(owner, newOwner);\n        owner = newOwner;\n    }\n}\n</code></pre> <p>V2 \u2192 V3 \u6838\u5fc3\u4f18\u5316\u70b9</p> <p>\u5bf9\u6bd4 V2 \u7684 changeStatus \u51fd\u6570\uff1a</p> <pre><code>// V2 \u7248\u672c\nfunction changeStatus(uint16 userId, bool status) public onlyOwner {\n    User storage u = users[userId];\n    if (u.wallet == address(0)) revert NotExist(userId);\n\n    u.isBanned = status;\n    u.lastUpdated = uint64(block.timestamp);\n\n    emit UserStatusChanged(userId, u.isBanned, u.lastUpdated);\n}\n\n// V3 \u7248\u672c\nfunction changeStatus(uint16 userId, bool status) public onlyOwner {\n    User storage u = users[userId];\n    if (u.wallet == address(0)) revert NotExist(userId);\n\n    uint64 ts = uint64(block.timestamp);\n    u.isBanned = status;\n    u.lastUpdated = ts;\n\n    emit UserStatusChanged(userId, status, ts);\n}\n</code></pre> <p>V3 \u7248\u672c\u5c06\u4e8b\u4ef6\u53c2\u6570\u4ece storage \u8bfb\u53d6\u6539\u4e3a\u4f7f\u7528\u5c40\u90e8\u53d8\u91cf\uff0c\u51cf\u5c11\u4e86\u989d\u5916\u7684 SLOAD\u3002</p>"},{"location":"web3/dapp/gas_optimization_guide_part4_computation_optimization/#_7","title":"\u516b\u3001\u4e8b\u4ef6\u53c2\u6570\u4f7f\u7528\u5c40\u90e8\u53d8\u91cf\u7684\u5b89\u5168\u6027","text":"<p>\u4f60\u53ef\u80fd\u4f1a\u62c5\u5fc3\uff1a\u5982\u679c\u4e8b\u4ef6\u53c2\u6570\u4f7f\u7528\u5c40\u90e8\u53d8\u91cf\u800c\u975e storage \u8bfb\u53d6\uff0c\u4f1a\u4e0d\u4f1a\u51fa\u73b0\"storage \u6ca1\u5199\u6210\u529f\uff0c\u4f46\u4e8b\u4ef6\u91cc\u5374\u50cf\u5199\u6210\u529f\u4e86\u4e00\u6837\"\u7684\u4e0d\u4e00\u81f4\u60c5\u51b5\uff1f</p> <p>\u7b54\u6848\u662f\uff1a\u5728\u6b63\u5e38 Solidity \u6267\u884c\u4e2d\uff0c\u8fd9\u79cd\u4e0d\u4e00\u81f4\u4e0d\u4f1a\u53d1\u751f\u3002\u6838\u5fc3\u89c4\u5219\u5982\u4e0b\uff1a</p> <p>\u89c4\u5219 1\uff1a\u53ea\u8981\u4ea4\u6613\u6ca1\u6709\u56de\u6eda\uff0cemit \u4e4b\u524d\u7684 storage \u5199\u5165\u4e5f\u5fc5\u7136\u53d1\u751f\u8fc7\u3002\u65e5\u5fd7\u4e0e storage \u662f\u540c\u4e00\u6761\u6267\u884c\u8def\u5f84\u7684\u526f\u4ea7\u54c1\u3002EVM \u6309\u987a\u5e8f\u6267\u884c\uff0c\u5982\u679c\u5199\u5165\u65f6\u53d1\u751f\u9519\u8bef\uff08out-of-gas\u3001revert\uff09\uff0c\u6574\u4e2a\u8c03\u7528\u4f1a\u56de\u6eda\uff0c\u5305\u62ec storage \u66f4\u6539\u548c\u4e8b\u4ef6\u65e5\u5fd7\u3002</p> <p>\u89c4\u5219 2\uff1a\u4e8b\u4ef6\u53c2\u6570\u7528\u5c40\u90e8\u53d8\u91cf\u7684\u5e38\u89c1\u6536\u76ca\u662f\u51cf\u5c11\u989d\u5916 SLOAD\uff0c\u5e76\u4e14\u66f4\u8d34\u8fd1\u4e8b\u4ef6\u8bed\u4e49\u2014\u2014\u4e8b\u4ef6\u8bb0\u5f55\u7684\u662f\u52a8\u4f5c\u7684\u8f93\u5165\uff0c\u800c\u4e0d\u662f\u6700\u7ec8\u72b6\u6001\u5feb\u7167\u3002</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u8fb9\u754c\u60c5\u51b5\u5305\u62ec\uff1a\u540c\u4e00\u7b14\u4ea4\u6613\u540e\u9762\u53c8\u628a\u503c\u6539\u56de\u53bb\u3001\u4f7f\u7528 delegatecall \u5bfc\u81f4 storage \u5199\u5728\u53e6\u4e00\u4e2a\u5408\u7ea6\u3001\u7528\u5185\u8054\u6c47\u7f16\u4f2a\u9020\u65e5\u5fd7\u7b49\u3002\u4f46\u8fd9\u4e9b\u90fd\u4e0d\u662f\u6b63\u5e38 Solidity emit \u7684\u95ee\u9898\uff0c\u800c\u662f\u7279\u5b9a\u573a\u666f\u4e0b\u7684\"\u8ba4\u77e5\u9677\u9631\"\u3002</p>"},{"location":"web3/dapp/gas_optimization_guide_part4_computation_optimization/#_8","title":"\u4e5d\u3001\u603b\u7ed3\u4e0e\u5c55\u671b","text":"<p>\u672c\u7bc7\u4ecb\u7ecd\u7684\u8ba1\u7b97\u4f18\u5316\u6280\u5de7\u5305\u62ec\uff1a</p> \u6280\u5de7 \u5e94\u7528\u573a\u666f \u5faa\u73af\u4f18\u5316 \u7f13\u5b58\u957f\u5ea6\u3001unchecked \u9012\u589e\u3001\u524d\u7f6e\u9012\u589e \u77ed\u8def\u6c42\u503c \u4fbf\u5b9c\u6761\u4ef6\u524d\u7f6e\uff0c\u907f\u514d\u89e6\u53d1\u6602\u8d35\u8def\u5f84 \u81ea\u5b9a\u4e49\u9519\u8bef \u51cf\u5c11\u90e8\u7f72\u5b57\u8282\u7801\u4e0e revert data \u4f4d\u8fd0\u7b97 bit packing\u3001bitmap\u3001mask \u63d0\u53d6 \u4e8b\u4ef6\u53c2\u6570 \u4f7f\u7528\u5c40\u90e8\u53d8\u91cf\u51cf\u5c11 SLOAD <p>\u901a\u8fc7 UserManagerV1 \u2192 V2\uff08\u5b58\u50a8\u4f18\u5316\uff09\u2192 V3\uff08\u8ba1\u7b97\u4f18\u5316\uff09\u7684\u6f14\u8fdb\uff0c\u6211\u4eec\u5b8c\u6210\u4e86\u4e00\u4e2a\u6559\u5b66\u5408\u7ea6\u7684\u5b8c\u6574\u4f18\u5316\u6d41\u7a0b\u3002</p> <p>\u8fdb\u4e00\u6b65\u4f18\u5316\u65b9\u5411</p> <p>\u5408\u7ea6 Gas \u4f18\u5316\u8fd8\u53ef\u4ee5\u4ece\u4ee5\u4e0b\u65b9\u9762\u8003\u8651\uff0c\u4f46\u672c\u7cfb\u5217\u6682\u4e0d\u6d89\u53ca\uff1a</p> <ul> <li>\u67b6\u6784\u5c42\u9762\uff1a\u5408\u7ea6\u62c6\u5206\u3001\u4ee3\u7406\u6a21\u5f0f\u3001\u6279\u91cf\u64cd\u4f5c\u5408\u5e76</li> <li>\u5185\u8054\u6c47\u7f16\uff1a\u76f4\u63a5\u64cd\u4f5c EVM \u6307\u4ee4\uff0c\u7ed5\u8fc7 Solidity \u62bd\u8c61\u5c42</li> <li>\u7f16\u8bd1\u5668\u4f18\u5316\uff1a\u8c03\u6574 optimizer runs \u53c2\u6570\u3001\u4f7f\u7528 via-ir \u7f16\u8bd1\u7ba1\u9053</li> </ul> <p>\u8fd9\u4e9b\u9ad8\u7ea7\u4f18\u5316\u6280\u5de7\u9700\u8981\u66f4\u6df1\u5165\u7684 EVM \u77e5\u8bc6\uff0c\u9002\u5408\u5728\u638c\u63e1\u57fa\u7840\u4f18\u5316\u540e\u8fdb\u4e00\u6b65\u5b66\u4e60\u3002</p>"},{"location":"web3/dapp/gas_optimization_guide_part4_computation_optimization/#_9","title":"\u5c0f\u7ed3","text":"<p>\u672c\u7bc7\u4ecb\u7ecd\u4e86\u8ba1\u7b97\u5c42\u9762\u7684 Gas \u4f18\u5316\u6280\u5de7\uff1a</p> <ul> <li>\u5faa\u73af\u4f18\u5316\u901a\u8fc7\u7f13\u5b58\u957f\u5ea6\u548c unchecked \u9012\u589e\u51cf\u5c11\u5f00\u9500\uff1b</li> <li>\u77ed\u8def\u6c42\u503c\u901a\u8fc7\u6761\u4ef6\u6392\u5e8f\u907f\u514d\u89e6\u53d1\u6602\u8d35\u8def\u5f84\uff1b</li> <li>\u81ea\u5b9a\u4e49\u9519\u8bef\u6bd4 require \u5b57\u7b26\u4e32\u66f4\u7701 Gas\uff1b</li> <li>\u4f4d\u8fd0\u7b97\u5728\u7279\u5b9a\u573a\u666f\u4e0b\u6709\u4f18\u5316\u4ef7\u503c\u3002</li> </ul> <p>\u901a\u8fc7 UserManagerV2 \u2192 UserManagerV3 \u7684\u6f14\u793a\uff0c\u6211\u4eec\u770b\u5230\u4e86\u5982\u4f55\u5728\u5b58\u50a8\u4f18\u5316\u7684\u57fa\u7840\u4e0a\u8fdb\u4e00\u6b65\u8fdb\u884c\u8ba1\u7b97\u4f18\u5316\u3002</p> <p>\u4e0b\u4e00\u7bc7\u6211\u4eec\u5c06\u4ecb\u7ecd Gas \u8bc4\u4f30\u4e0e\u6d4b\u91cf\u5de5\u5177\uff0c\u5b66\u4e60\u5982\u4f55\u4f7f\u7528 Foundry \u7684 Gas Report\u3001Snapshots \u548c gasleft() \u6765\u9a8c\u8bc1\u4f18\u5316\u6548\u679c\uff0c\u5e76\u5bf9\u6574\u4e2a\u7cfb\u5217\u8fdb\u884c\u603b\u7ed3\u3002</p> <p>\u7cfb\u5217\u5bfc\u822a\uff1a</p> <ul> <li>\u7b2c\u4e00\u7bc7\uff1aGas \u4f18\u5316\u6307\u5357\uff08\u4e00\uff09\uff1aGas \u673a\u5236\u539f\u7406</li> <li>\u7b2c\u4e8c\u7bc7\uff1aGas \u4f18\u5316\u6307\u5357\uff08\u4e8c\uff09\uff1aEIP-1559 \u4ea4\u6613\u89e3\u6790</li> <li> <p>\u7b2c\u4e09\u7bc7\uff1aGas \u4f18\u5316\u6307\u5357\uff08\u4e09\uff09\uff1a\u5b58\u50a8\u4f18\u5316</p> </li> <li> <p>\u7b2c\u56db\u7bc7\uff1aGas \u4f18\u5316\u6307\u5357\uff08\u56db\uff09\uff1a\u8ba1\u7b97\u4f18\u5316\uff08\u672c\u7bc7\uff09</p> </li> <li>\u7b2c\u4e94\u7bc7\uff1aGas \u4f18\u5316\u6307\u5357\uff08\u4e94\uff09\uff1aGas \u8bc4\u4f30\u4e0e\u6d4b\u91cf</li> </ul>"},{"location":"web3/dapp/gas_optimization_guide_part5_gas_measurement/","title":"Gas \u4f18\u5316\u6307\u5357\uff08\u4e94\uff09\uff1aGas \u8bc4\u4f30\u4e0e\u6d4b\u91cf","text":"<p> \u7ea6 1159 \u4e2a\u5b57  5 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 4 \u5206\u949f</p> <p>\u672c\u7bc7\u662f Gas \u4f18\u5316\u7cfb\u5217\u7684\u6700\u540e\u4e00\u7bc7\uff0c\u805a\u7126\u4e8e Gas \u8bc4\u4f30\u4e0e\u6d4b\u91cf\u5de5\u5177\u3002</p> <p>\u5728\u8fdb\u884c Gas \u4f18\u5316\u4e4b\u524d\uff0c\u9996\u5148\u9700\u8981\u51c6\u786e\u5730\u6d4b\u91cf\u548c\u8bc4\u4f30\u4ee3\u7801\u7684 Gas \u6d88\u8017\u3002</p> <p>\u672c\u7bc7\u5c06\u4ecb\u7ecd Foundry \u63d0\u4f9b\u7684\u4e09\u79cd Gas \u6d4b\u91cf\u5de5\u5177\uff1aGas Report\u3001Gas Snapshots \u548c gasleft()\uff0c\u5e2e\u52a9\u4f60\u5efa\u7acb\u5b8c\u6574\u7684 Gas \u6d4b\u91cf\u6d41\u7a0b\u3002\u6700\u540e\uff0c\u6211\u4eec\u5c06\u56de\u987e\u6574\u4e2a\u7cfb\u5217\u7684\u6838\u5fc3\u5185\u5bb9\u3002</p>"},{"location":"web3/dapp/gas_optimization_guide_part5_gas_measurement/#gas","title":"\u4e00\u3001\u4e3a\u4ec0\u4e48\u9700\u8981 Gas \u6d4b\u91cf","text":"<p>Gas \u6d4b\u91cf\u7684\u4f5c\u7528\uff1a</p> <ul> <li>\u5efa\u7acb\u57fa\u7ebf\uff1a\u4e86\u89e3\u5f53\u524d\u4ee3\u7801\u7684 Gas \u6d88\u8017\u60c5\u51b5</li> <li>\u8bc6\u522b\u74f6\u9888\uff1a\u627e\u51fa\u6700\u6d88\u8017 Gas \u7684\u64cd\u4f5c</li> <li>\u9a8c\u8bc1\u4f18\u5316\u6548\u679c\uff1a\u5bf9\u6bd4\u4f18\u5316\u524d\u540e\u7684\u5dee\u5f02</li> <li>\u9632\u6b62\u6027\u80fd\u9000\u5316\uff1a\u5728 CI/CD \u4e2d\u76d1\u63a7 Gas \u6d88\u8017\u53d8\u5316</li> </ul>"},{"location":"web3/dapp/gas_optimization_guide_part5_gas_measurement/#foundry-gas-report","title":"\u4e8c\u3001\u4f7f\u7528 Foundry \u7684 Gas Report","text":"<p>Gas Report \u53ef\u4ee5\u81ea\u52a8\u7edf\u8ba1\u6d4b\u8bd5\u4e2d\u6bcf\u4e2a\u51fd\u6570\u7684 Gas \u6d88\u8017\u3002</p> <p>\u8fd0\u884c\u6307\u4ee4\uff1a</p> <pre><code>forge test --gas-report\n</code></pre> <p>Gas Report \u4f1a\u8f93\u51fa\u6bcf\u4e2a\u5408\u7ea6\u51fd\u6570\u7684 min/avg/max Gas \u6d88\u8017\uff0c\u9002\u5408\u6574\u4f53\u6027\u80fd\u8bc4\u4f30\u3002</p>"},{"location":"web3/dapp/gas_optimization_guide_part5_gas_measurement/#gas-snapshots","title":"\u4e09\u3001\u4f7f\u7528 Gas Snapshots","text":"<p>Gas Snapshots \u662f Foundry \u7684\u53e6\u4e00\u4e2a\u5f3a\u5927\u529f\u80fd\uff0c\u7528\u4e8e\u8ffd\u8e2a Gas \u53d8\u5316\uff0c\u9002\u5408 CI/CD \u96c6\u6210\u3002</p> <p>\u6ce8\u610f\uff1aGas Report \u7edf\u8ba1\u7684\u662f\u5408\u7ea6\u51fd\u6570\u8c03\u7528\u7684\u7edf\u8ba1\uff0c\u662f\u5408\u7ea6\u51fd\u6570\u672c\u4f53 gas \u7edf\u8ba1\uff0c\u800c snapshot \u8bb0\u5f55\u7684\u662f\u6d4b\u8bd5\u51fd\u6570\u6574\u4f53 gas\uff0c\u662f\u6574\u6761\u6d4b\u8bd5\u7528\u4f8b\u7684 gas\uff0c\u5305\u62ec setUp\uff0cconsole.log\uff0c\u65ad\u8a00\u7b49\u3002</p> <p>3.1 \u521b\u5efa\u57fa\u7ebf\u5feb\u7167</p> <pre><code>forge snapshot\n</code></pre> <p>\u9ed8\u8ba4\u4f1a\u5728\u9879\u76ee\u6839\u76ee\u5f55\u751f\u6210\u4e00\u4e2a <code>.gas-snapshot</code> \u6587\u4ef6\uff0c\u8bb0\u5f55\u6bcf\u4e2a\u6d4b\u8bd5\u7684 Gas \u6d88\u8017\u3002</p> <p>3.2 \u4fee\u6539\u4ee3\u7801\u540e\u5bf9\u6bd4</p> <p>\u5047\u8bbe\u4f60\u4fee\u6539\u4e86\u4ee3\u7801\uff0c\u518d\u6b21\u8fd0\u884c\uff1a</p> <pre><code>forge snapshot --diff\n</code></pre> <p>Foundry \u4f1a\u81ea\u52a8\u5bf9\u6bd4\u5e76\u663e\u793a\u5dee\u5f02\u3002</p> <p>3.3 CI \u68c0\u67e5</p> <p>\u5728 PR \u4e2d\u81ea\u52a8\u68c0\u67e5 Gas \u662f\u5426\u9000\u5316\uff1a</p> <pre><code>forge snapshot --check\n</code></pre> <p>\u5982\u679c\u4efb\u4f55\u6d4b\u8bd5\u7684 Gas \u589e\u52a0\uff0c\u547d\u4ee4\u8fd4\u56de\u975e\u96f6\u9000\u51fa\u7801\u3002</p> <p>3.4 \u6700\u4f73\u5b9e\u8df5</p> <ul> <li>\u2705 \u5c06 <code>.gas-snapshot</code> \u63d0\u4ea4\u5230 Git</li> <li>\u2705 PR \u5ba1\u67e5\u65f6\u5173\u6ce8 Gas \u53d8\u5316</li> <li>\u2705 \u8bbe\u7f6e CI \u81ea\u52a8\u68c0\u67e5</li> </ul>"},{"location":"web3/dapp/gas_optimization_guide_part5_gas_measurement/#gasleft","title":"\u56db\u3001\u4f7f\u7528 gasleft() \u7cbe\u786e\u6d4b\u91cf","text":"<p><code>gasleft()</code> \u662f Solidity \u5185\u7f6e\u51fd\u6570\uff0c\u8fd4\u56de\u5f53\u524d\u5269\u4f59\u7684 Gas \u6570\u91cf\uff0c\u53ef\u4ee5\u7528\u6765\u7cbe\u786e\u6d4b\u91cf\u7279\u5b9a\u4ee3\u7801\u6bb5\u7684 Gas \u6d88\u8017\u3002</p> <p>4.1 \u8fd0\u884c\u7cbe\u786e\u5bf9\u6bd4\u6d4b\u8bd5</p> <pre><code>forge test --match-test xxx -vv\n</code></pre> <p>4.2 \u6ce8\u610f\u4e8b\u9879</p> <ul> <li>\u6d4b\u91cf\u5f00\u9500\uff1a<code>gasleft()</code> \u672c\u8eab\u6d88\u8017\u7ea6 2 Gas\uff0c\u5728\u7cbe\u786e\u6d4b\u91cf\u65f6\u9700\u8981\u8003\u8651</li> <li>\u7f16\u8bd1\u5668\u4f18\u5316\uff1a\u67d0\u4e9b\u60c5\u51b5\u4e0b\u7f16\u8bd1\u5668\u53ef\u80fd\u4f1a\u4f18\u5316\u6389\u672a\u4f7f\u7528\u7684\u4ee3\u7801</li> <li>\u5916\u90e8\u8c03\u7528\u5f71\u54cd\uff1a\u8de8\u5408\u7ea6\u8c03\u7528\u65f6\uff0cGas \u7684\u8ba1\u7b97\u53ef\u80fd\u66f4\u590d\u6742</li> <li>\u4e0a\u4e0b\u6587\u4f9d\u8d56\uff1a\u6d4b\u91cf\u7ed3\u679c\u53ef\u80fd\u53d7\u5230\u8c03\u7528\u4e0a\u4e0b\u6587\u7684\u5f71\u54cd\uff08\u5982\u5b58\u50a8\u69fd\u7684\u51b7/\u70ed\u72b6\u6001\uff0c\u5bfc\u81f4\u540c\u4e00\u6d4b\u8bd5\u4e2d\u5148\u540e\u8c03\u7528\u7684 Gas \u4e0d\u540c\uff09</li> </ul>"},{"location":"web3/dapp/gas_optimization_guide_part5_gas_measurement/#_1","title":"\u4e94\u3001\u4e09\u79cd\u65b9\u6cd5\u5bf9\u6bd4","text":"\u65b9\u6cd5 \u4f18\u70b9 \u7f3a\u70b9 \u9002\u7528\u573a\u666f Gas Report \u81ea\u52a8\u5316\u3001\u5168\u9762\u3001\u663e\u793a min/avg/max \u7c92\u5ea6\u8f83\u7c97 \u6574\u4f53\u6027\u80fd\u8bc4\u4f30 Gas Snapshots \u8ffd\u8e2a\u53d8\u5316\u3001CI \u96c6\u6210\u3001\u7248\u672c\u5bf9\u6bd4 \u9700\u8981\u7ef4\u62a4\u5feb\u7167\u6587\u4ef6 \u9632\u6b62\u6027\u80fd\u9000\u5316 gasleft() \u7cbe\u786e\u3001\u7075\u6d3b\u3001\u53ef\u81ea\u5b9a\u4e49\u8f93\u51fa \u9700\u8981\u5199\u6d4b\u8bd5\u4ee3\u7801 \u7ec6\u7c92\u5ea6\u5bf9\u6bd4 <p>\u63a8\u8350\u505a\u6cd5</p> <ol> <li>\u5efa\u7acb\u57fa\u7ebf\uff1a\u5728\u4f18\u5316\u524d\u5148\u6d4b\u91cf\u5f53\u524d\u6027\u80fd</li> <li>\u4f7f\u7528\u591a\u79cd\u5de5\u5177\uff1a\u7ed3\u5408 Gas Report\u3001Snapshot \u548c gasleft()</li> <li>\u7248\u672c\u63a7\u5236\uff1a\u63d0\u4ea4 <code>.gas-snapshot</code> \u6587\u4ef6</li> <li>\u5173\u6ce8\u5173\u952e\u8def\u5f84\uff1a\u91cd\u70b9\u4f18\u5316\u9ad8\u9891\u8c03\u7528\u7684\u51fd\u6570</li> <li>\u9a8c\u8bc1\u4f18\u5316\u6548\u679c\uff1a\u4f18\u5316\u540e\u5fc5\u987b\u518d\u6b21\u6d4b\u91cf</li> </ol> <p>\u63a8\u8350\u7ec4\u5408</p> <ul> <li>\u65e5\u5e38\u5f00\u53d1\uff1aGas Report\uff08\u5feb\u901f\u67e5\u770b\uff09</li> <li>\u7248\u672c\u63a7\u5236\uff1aSnapshots\uff08\u8ffd\u8e2a\u53d8\u5316\uff09</li> <li>\u7cbe\u7ec6\u4f18\u5316\uff1agasleft()\uff08\u7cbe\u786e\u5bf9\u6bd4\uff09</li> </ul>"},{"location":"web3/dapp/gas_optimization_guide_part5_gas_measurement/#_2","title":"\u516d\u3001\u5de5\u5177\u901f\u67e5\u8868","text":"\u5de5\u5177 \u547d\u4ee4 \u573a\u666f Gas Report <code>forge test --gas-report</code> \u6574\u4f53\u8bc4\u4f30 \u521b\u5efa Snapshot <code>forge snapshot</code> \u5efa\u7acb\u57fa\u7ebf \u5bf9\u6bd4 Snapshot <code>forge snapshot --diff</code> \u9a8c\u8bc1\u4f18\u5316 \u68c0\u67e5 Snapshot <code>forge snapshot --check</code> CI \u96c6\u6210 \u7cbe\u786e\u6d4b\u91cf <code>gasleft()</code> + <code>-vv</code> \u7ec6\u7c92\u5ea6\u5bf9\u6bd4"},{"location":"web3/dapp/gas_optimization_guide_part5_gas_measurement/#_3","title":"\u4e03\u3001\u7cfb\u5217\u603b\u7ed3","text":"<p>\u81f3\u6b64\uff0c\u6211\u4eec\u5b8c\u6210\u4e86\u6574\u4e2a Gas \u4f18\u5316\u7cfb\u5217\u7684\u5b66\u4e60\u3002</p> <p>\u5b66\u5b8c\u672c\u7cfb\u5217\uff0c\u4f60\u5c06\u638c\u63e1\uff1a</p> <ol> <li>\u7406\u8bba\u57fa\u7840\uff1a\u6df1\u5165\u7406\u89e3 Gas \u673a\u5236\u3001EIP-1559 \u5b9a\u4ef7\u6a21\u578b\u3001\u64cd\u4f5c\u7801\u6210\u672c\u5206\u7ea7</li> <li>\u5b58\u50a8\u4f18\u5316\uff1a\u53d8\u91cf\u6253\u5305\u3001\u7ed3\u6784\u4f53\u6253\u5305\u3001constant/immutable\u3001\u5b58\u50a8\u6307\u9488\u3001\u77ac\u65f6\u5b58\u50a8</li> <li>\u8ba1\u7b97\u4f18\u5316\uff1a\u5faa\u73af\u4f18\u5316\u3001\u77ed\u8def\u6c42\u503c\u3001\u81ea\u5b9a\u4e49\u9519\u8bef\u3001\u4f4d\u8fd0\u7b97</li> <li>\u6d4b\u91cf\u5de5\u5177\uff1a\u4f7f\u7528 Foundry \u7684 Gas Report\u3001Snapshots\u3001gasleft() \u9a8c\u8bc1\u4f18\u5316\u6548\u679c</li> <li>\u5b9e\u6218\u7ecf\u9a8c\uff1a\u901a\u8fc7 UserManager \u5408\u7ea6\u7684\u5b8c\u6574\u4f18\u5316\u6d41\u7a0b\uff08V1\u2192V2\u2192V3\uff09\uff0c\u638c\u63e1\u7cfb\u7edf\u6027\u7684\u4f18\u5316\u65b9\u6cd5</li> </ol> <p>Gas \u4f18\u5316\u662f\u4e00\u95e8\u5e73\u8861\u7684\u827a\u672f\u3002\u4f18\u5316\u901a\u5e38\u4f1a\u4f7f\u4ee3\u7801\u53d8\u5f97\u66f4\u96be\u8bfb\u548c\u66f4\u590d\u6742\uff0c\u4e00\u4e2a\u597d\u7684\u5de5\u7a0b\u5e08\u5fc5\u987b\u5728\u53ef\u8bfb\u6027\u3001\u53ef\u7ef4\u62a4\u6027\u548c Gas \u6548\u7387\u4e4b\u95f4\u505a\u51fa\u6743\u8861\u3002\u8bb0\u4f4f\uff1a\u5148\u6d4b\u91cf\uff0c\u518d\u4f18\u5316\uff0c\u6700\u540e\u9a8c\u8bc1\u3002</p> <p>\u7cfb\u5217\u5bfc\u822a\uff1a</p> <ul> <li>\u7b2c\u4e00\u7bc7\uff1aGas \u4f18\u5316\u6307\u5357\uff08\u4e00\uff09\uff1aGas \u673a\u5236\u539f\u7406</li> <li>\u7b2c\u4e8c\u7bc7\uff1aGas \u4f18\u5316\u6307\u5357\uff08\u4e8c\uff09\uff1aEIP-1559 \u4ea4\u6613\u89e3\u6790</li> <li> <p>\u7b2c\u4e09\u7bc7\uff1aGas \u4f18\u5316\u6307\u5357\uff08\u4e09\uff09\uff1a\u5b58\u50a8\u4f18\u5316</p> </li> <li> <p>\u7b2c\u56db\u7bc7\uff1aGas \u4f18\u5316\u6307\u5357\uff08\u56db\uff09\uff1a\u8ba1\u7b97\u4f18\u5316</p> </li> <li>\u7b2c\u4e94\u7bc7\uff1aGas \u4f18\u5316\u6307\u5357\uff08\u4e94\uff09\uff1aGas \u8bc4\u4f30\u4e0e\u6d4b\u91cf\uff08\u672c\u7bc7\uff09</li> </ul>"},{"location":"web3/dapp/hardhat_tutorial_240415/","title":"Hardhat \u5165\u95e8\u6307\u5357\uff0825\u5e74\u66f4\u65b0\u7248\uff09","text":"<p>\u8bf4\u660e\uff1a\u539f\u7248\u53d1\u5e03\u4e8e 2024-04-15\uff0c\u57fa\u4e8e Node 20.x\uff0cUbuntu 20.04 \u7cfb\u7edf\u5f00\u53d1\uff0c\u6700\u65b0\u7248\u66f4\u65b0\u4e8e2025-12-12\uff0c\u57fa\u4e8e Node 22.x\uff0cUbuntu 24.04 \u7cfb\u7edf\u5f00\u53d1\u3002</p> <p>Hardhat \u662f\u4e00\u4e2a\u4ee5 Node.js/JavaScript \u751f\u6001\u4e3a\u6838\u5fc3\u7684\u4ee5\u592a\u574a\u667a\u80fd\u5408\u7ea6\u5f00\u53d1\u73af\u5883\uff0c\u5e2e\u52a9\u5f00\u53d1\u8005\u628a\u300c\u5199\u5408\u7ea6 \u2192 \u7f16\u8bd1 \u2192 \u6d4b\u8bd5 \u2192 \u672c\u5730\u8c03\u8bd5 \u2192 \u90e8\u7f72\u5230\u6d4b\u8bd5\u7f51/\u4e3b\u7f51\u300d\u8fd9\u4e00\u7cfb\u5217\u91cd\u590d\u5de5\u4f5c\u81ea\u52a8\u5316\u4e0e\u5de5\u7a0b\u5316\uff1b\u5b83\u5185\u7f6e Hardhat Network\uff08\u672c\u5730\u4ee5\u592a\u574a\u7f51\u7edc\uff09\uff0c\u7528\u4e8e\u90e8\u7f72\u3001\u8dd1\u6d4b\u8bd5\u3001\u8c03\u8bd5\u5408\u7ea6\u903b\u8f91\u3002  </p> <p>\u5728 Hardhat \u7684\u8bbe\u8ba1\u91cc\uff1a</p> <ul> <li>\u5728\u547d\u4ee4\u884c\u6bcf\u8dd1\u4e00\u6b21 <code>npx hardhat xxx</code>\uff0c\u672c\u8d28\u4e0a\u662f\u5728\u6267\u884c\u4e00\u4e2a task\uff1b</li> <li>\u5927\u90e8\u5206\u80fd\u529b\u7531 plugins \u63d0\u4f9b\uff08\u4f8b\u5982 ethers \u96c6\u6210\u3001chai-matchers\u3001Ignition \u90e8\u7f72\u7b49\uff09\uff0c\u5b98\u65b9\u63a8\u8350\u521d\u5b66\u8005\u4f7f\u7528 <code>@nomicfoundation/hardhat-toolbox</code> \u4e00\u63fd\u5b50\u63d2\u4ef6\u3002</li> </ul>"},{"location":"web3/dapp/hardhat_tutorial_240415/#_1","title":"\u4e00\u3001\u914d\u7f6e\u73af\u5883","text":"<p>\u5728 Windows \u7cfb\u7edf\u4f7f\u7528 VS Code \u914d\u7f6e Ubuntu 24.04 \u4e0a\u7684\u5f00\u53d1\u73af\u5883\u3002</p> <p>\u5b89\u88c5 22.x \u7248 Node.js\uff1a</p> <pre><code>curl -fsSL https://deb.nodesource.com/setup_22.x | sudo -E bash -\nsudo apt-get install -y nodejs\n\n# \u67e5\u770b\u5b89\u88c5\u7684\u7248\u672c\n&lt;div markdown=\"1\" style=\"margin-top: -30px; font-size: 0.75em; opacity: 0.7;\"&gt;\n:material-circle-edit-outline: \u7ea6 1140 \u4e2a\u5b57 :fontawesome-solid-code: 189 \u884c\u4ee3\u7801 :material-clock-time-two-outline: \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 6 \u5206\u949f\n&lt;/div&gt;\nnode -v\nnpm -v\n</code></pre>"},{"location":"web3/dapp/hardhat_tutorial_240415/#hardhat","title":"\u4e8c\u3001\u521b\u5efa Hardhat \u9879\u76ee","text":"<p>\u4f7f\u7528 Node.js \u7684\u5305\u7ba1\u7406\u5668 <code>npm</code> \u6765\u5b89\u88c5 hardhat\uff1a</p> <p>\u521d\u59cb\u5316\u9879\u76ee\u76ee\u5f55\u4e0e npm \u5de5\u7a0b\uff1a</p> <pre><code>mkdir hardhat-tutorial\ncd hardhat-tutorial\nnpm init\n</code></pre> <p>\u5b89\u88c5 Hardhat v2\uff08\u5b98\u65b9\u6559\u7a0b\u4f7f\u7528 <code>hardhat@hh2</code> \u8fd9\u4e2a\u6807\u7b7e\u6765\u9501\u5b9a v2\uff09\uff1a</p> <pre><code>npm install --save-dev hardhat@hh2 # \u8be5\u8fc7\u7a0b\u53ef\u80fd\u6bd4\u8f83\u82b1\u65f6\u95f4\n</code></pre> <p>\u521d\u59cb\u5316 Hardhat \u914d\u7f6e\u6587\u4ef6\uff1a</p> <pre><code>npx hardhat init    # \u9009\u62e9\uff1aCreate an empty hardhat.config.js\n</code></pre> <p>\u5b89\u88c5\u5b98\u65b9\u63a8\u8350\u63d2\u4ef6\u96c6\u5408 hardhat-toolbox\uff1a</p> <pre><code>npm install --save-dev @nomicfoundation/hardhat-toolbox@hh2\n</code></pre> <p>\u5728 hardhat.config.js \u6587\u4ef6\u4e2d\u6dfb\u52a0 <code>require(\"@nomicfoundation/hardhat-toolbox\");</code>\uff0c\u8fd9\u4e00\u6b65\u5b8c\u6210\u540e\uff0chardhat.config.js \u5982\u4e0b\uff1a</p> <pre><code>require(\"@nomicfoundation/hardhat-toolbox\");\n\n/** @type import('hardhat/config').HardhatUserConfig */\nmodule.exports = {\n  solidity: \"0.8.28\",\n};\n</code></pre> <p>\u8865\u5145\uff1a\u5982\u679c\u4f7f\u7528 npm install --save-dev hardhat \u5b89\u88c5 hardhat \u592a\u6162\uff0c\u53ef\u4ee5\u4f7f\u7528 yarn add --dev hardhat \u6765\u5b89\u88c5\u3002</p> <p>\u5b89\u88c5 yarn \u6307\u4ee4\u5982\u4e0b\uff1a<code>yarn</code> \u5b98\u65b9\u63d0\u4f9b\u4e86\u4e00\u4e2a APT \u4ed3\u5e93\uff0c\u53ef\u4ee5\u901a\u8fc7\u5b83\u6765\u5b89\u88c5 <code>yarn</code>\uff0c\u914d\u7f6e\u4ed3\u5e93\u5e76\u5bfc\u5165 Yarn \u7684 GPG \u516c\u94a5\uff1a</p> <pre><code>curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -\necho \"deb https://dl.yarnpkg.com/debian/ stable main\" | sudo tee /etc/apt/sources.list.d/yarn.list\nsudo apt-get update\nsudo apt-get install yarn\nyarn --version\n</code></pre>"},{"location":"web3/dapp/hardhat_tutorial_240415/#_2","title":"\u4e09\u3001\u521b\u5efa &amp; \u7f16\u8bd1\u667a\u80fd\u5408\u7ea6","text":"<p>\u5728\u9879\u76ee\u6839\u76ee\u5f55\u4e2d\u65b0\u5efa\u4e00\u4e2a <code>contracts</code> \u76ee\u5f55\uff0c\u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5\u5728 <code>contracts</code> \u76ee\u5f55\u4e2d\u7f16\u5199\u6211\u4eec\u7684\u5408\u7ea6\u4ee3\u7801\uff0c\u4ee5\u4e0b MiniToken.sol \u53c2\u8003\u81ea Hardhat \u5b98\u65b9\u6559\u7a0b\uff1a</p> <pre><code>// SPDX-License-Identifier:MIT\npragma solidity ^0.8.28;\nimport \"hardhat/console.sol\";\n\ncontract MiniToken {\n    string public name = \"Mini Hardhat Token\";\n    string public symbol = \"MHT\";\n    uint256 public totalSupply = 1000000;\n\n    address public owner;\n    mapping(address =&gt; uint256) private balances;\n\n    event Transfer(address indexed from, address indexed to, uint256 value);\n\n    constructor() {\n        owner = msg.sender;\n        balances[msg.sender] = totalSupply;\n    }\n\n    function balanceOf(address account) external view returns (uint256) {\n        return balances[account];\n    }\n\n    function transfer(address to, uint256 amount) external {\n        require(balances[msg.sender] &gt;= amount, \"Not enough tokens\");\n        balances[msg.sender] -= amount;\n        balances[to] += amount;\n\n        emit Transfer(msg.sender, to, amount);\n    }\n}\n</code></pre> <p>\u6ce8\uff1a\u53ef\u4ee5\u5728 VS Code \u4e2d\u5b89\u88c5 hardhat \u7684\u6269\u5c55\u7a0b\u5e8f Solidity by Nomic Foundation\u3002</p> <p>\u5408\u7ea6\u4ee3\u7801\u7f16\u5199\u5b8c\u540e\uff0c\u4f7f\u7528 <code>npx hardhat compile</code> \u6307\u4ee4\u7f16\u8bd1\u3002</p>"},{"location":"web3/dapp/hardhat_tutorial_240415/#hardhat-network","title":"\u56db\u3001\u7f16\u5199\u6d4b\u8bd5\u5e76\u8fd0\u884c\uff08\u57fa\u4e8e Hardhat Network\uff09","text":"<p>Hardhat \u9ed8\u8ba4\u7f51\u7edc\u5c31\u662f Hardhat Network\uff0c\u8dd1\u6d4b\u8bd5\u65e0\u9700\u989d\u5916\u542f\u52a8\u8282\u70b9\u6216\u914d\u7f6e\u3002\u5b98\u65b9\u6559\u7a0b\u7528 ethers.js + Mocha + Chai \u6765\u5199\u6d4b\u8bd5\u3002</p> <p>\u5728\u6839\u76ee\u5f55\u4e2d\u65b0\u5efa\u4e00\u4e2a\u76ee\u5f55 <code>test</code>\uff0c\u6dfb\u52a0\u5982\u4e0b MiniToken.js \u6587\u4ef6\uff1a</p> <pre><code>const { expect } = require(\"chai\");\n\ndescribe(\"MiniToken\", function () {\n  it(\"\u90e8\u7f72\u540e\uff1a\u90e8\u7f72\u8005\u5e94\u62ff\u5230\u5168\u90e8 totalSupply\", async function () {\n    const [owner] = await ethers.getSigners();\n    const token = await ethers.deployContract(\"MiniToken\");\n\n    const ownerBalance = await token.balanceOf(owner.address);\n    expect(await token.totalSupply()).to.equal(ownerBalance);\n  });\n\n  it(\"\u8f6c\u8d26\uff1a\u5e94\u80fd\u5728\u4e0d\u540c\u8d26\u6237\u95f4\u8f6c\u79fb\u4f59\u989d\", async function () {\n    const [owner, addr1, addr2] = await ethers.getSigners();\n    const token = await ethers.deployContract(\"MiniToken\");\n\n    await token.transfer(addr1.address, 50);\n    expect(await token.balanceOf(addr1.address)).to.equal(50);\n\n    await token.connect(addr1).transfer(addr2.address, 50);\n    expect(await token.balanceOf(addr2.address)).to.equal(50);\n  });\n\n  it(\"\u5931\u8d25\u7528\u4f8b\uff1a\u4f59\u989d\u4e0d\u8db3\u5e94 revert\", async function () {\n    const [, addr1, addr2] = await ethers.getSigners();\n    const token = await ethers.deployContract(\"MiniToken\");\n\n    await expect(token.connect(addr1).transfer(addr2.address, 1))\n      .to.be.revertedWith(\"Not enough tokens\");\n  });\n});\n</code></pre> <p>\u6267\u884c<code>npx hardhat test</code>\u6307\u4ee4\uff0c\u6d4b\u8bd5\u7ed3\u679c\u5982\u4e0b\uff1a</p> <pre><code>test@DESKTOP-958GQ8P:~/desktop/hardhat-tutorial$ npx hardhat test\n\n\n  MiniToken\n    \u2714 \u90e8\u7f72\u540e\uff1a\u90e8\u7f72\u8005\u5e94\u62ff\u5230\u5168\u90e8 totalSupply (486ms)\n    \u2714 \u8f6c\u8d26\uff1a\u5e94\u80fd\u5728\u4e0d\u540c\u8d26\u6237\u95f4\u8f6c\u79fb\u4f59\u989d\n    \u2714 \u5931\u8d25\u7528\u4f8b\uff1a\u4f59\u989d\u4e0d\u8db3\u5e94 revert\n\n\n  3 passing (537ms)\n</code></pre> <p>\u5b98\u65b9\u6559\u7a0b\u8fd8\u63a8\u8350\u7528 <code>loadFixture</code> \u505a\u6d4b\u8bd5\u5939\u5177\u4e0e\u5feb\u7167\u56de\u6eda\uff0c\u63d0\u9ad8\u6d4b\u8bd5\u901f\u5ea6\u5e76\u51cf\u5c11\u91cd\u590d\u90e8\u7f72\u4ee3\u7801\u3002</p>"},{"location":"web3/dapp/hardhat_tutorial_240415/#hardhat-network_1","title":"\u4e94\u3001\u4f7f\u7528 Hardhat Network \u8c03\u8bd5","text":""},{"location":"web3/dapp/hardhat_tutorial_240415/#51-solidity-consolelog","title":"5.1 \u5728 Solidity \u91cc\u76f4\u63a5 console.log","text":"<p>Hardhat Network \u652f\u6301\u5728 Solidity \u4ee3\u7801\u4e2d\u8c03\u7528 <code>console.log()</code> \u8f93\u51fa\u65e5\u5fd7\u4fe1\u606f\u3001\u5408\u7ea6\u53d8\u91cf\uff0c\u7528\u6cd5\u662f\u5728\u5408\u7ea6\u4ee3\u7801\u4e2d\u5bfc\u5165 <code>import \"hardhat/console.sol\";</code> \u5e76\u5728\u51fd\u6570\u91cc\u6253\u5370\u3002</p> <p>\u793a\u4f8b\uff1a\u7f16\u8f91 <code>contracts/MiniToken.sol</code>\uff0c\u5728 <code>transfer()</code> \u4e2d\u52a0\u5165\u65e5\u5fd7\uff1a</p> <pre><code>import \"hardhat/console.sol\";\n\nfunction transfer(address to, uint256 amount) external {\n    require(balances[msg.sender] &gt;= amount, \"Not enough tokens\");\n\n    console.log(\n        \"Transferring from %s to %s %s tokens\",\n        msg.sender,\n        to,\n        amount\n    );\n\n    balances[msg.sender] -= amount;\n    balances[to] += amount;\n    emit Transfer(msg.sender, to, amount);\n}\n</code></pre> <p>\u518d\u8dd1\u4e00\u6b21\u6d4b\u8bd5\u6307\u4ee4<code>npx hardhat test</code>\uff0c\u4f1a\u5728\u6d4b\u8bd5\u8f93\u51fa\u4e2d\u770b\u5230\u8f6c\u8d26\u65e5\u5fd7\uff1a</p> <pre><code>test@DESKTOP-958GQ8P:~/desktop/hardhat-tutorial$ npx hardhat test\nCompiled 2 Solidity files successfully (evm target: paris).\n\n\n  MiniToken\n    \u2714 \u90e8\u7f72\u540e\uff1a\u90e8\u7f72\u8005\u5e94\u62ff\u5230\u5168\u90e8 totalSupply (471ms)\nTransferring from 0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266 to 0x70997970c51812dc3a010c7d01b50e0d17dc79c8 50 tokens\nTransferring from 0x70997970c51812dc3a010c7d01b50e0d17dc79c8 to 0x3c44cdddb6a900fa2b585dd299e03d12fa4293bc 50 tokens\n    \u2714 \u8f6c\u8d26\uff1a\u5e94\u80fd\u5728\u4e0d\u540c\u8d26\u6237\u95f4\u8f6c\u79fb\u4f59\u989d\n    \u2714 \u5931\u8d25\u7528\u4f8b\uff1a\u4f59\u989d\u4e0d\u8db3\u5e94 revert\n\n\n  3 passing (520ms)\n</code></pre> <p>\u6ce8\u610f\u70b9\uff08\u6765\u81ea Hardhat Network \u53c2\u8003\u6587\u6863\uff09\uff1a</p> <ul> <li><code>console.log</code> \u53ef\u5728 call/transaction \u4e2d\u4f7f\u7528\uff0c<code>view</code> \u53ef\u7528\uff0c\u4f46 <code>pure</code> \u4e0d\u884c\uff1b</li> <li>\u9700\u8981<code>import \"hardhat/console.sol\"</code>\uff1b</li> <li><code>console.log</code> \u6700\u591a\u652f\u6301 4 \u4e2a\u53c2\u6570\uff0c\u4e14\u6709\u660e\u786e\u7684\u7c7b\u578b\u8303\u56f4\u4e0e\u82e5\u5e72\u5355\u53c2 API\u3002</li> </ul>"},{"location":"web3/dapp/hardhat_tutorial_240415/#52","title":"5.2 \u989d\u5916\u8c03\u8bd5\u6293\u624b","text":"<p>\u5931\u8d25\u5806\u6808\uff1aHardhat Network \u9ed8\u8ba4\u4f1a\u5728\u4ea4\u6613\u5931\u8d25\u65f6\u629b\u51fa\u201cJavaScript + Solidity\u201d\u7684\u7ec4\u5408\u5806\u6808\u4fe1\u606f\uff08\u4fbf\u4e8e\u5b9a\u4f4d revert \u89e6\u53d1\u70b9\uff09\u3002</p> <p>in-process vs JSON-RPC node\uff1a\u6d4b\u8bd5\u65f6\u7528\u7684\u662f in-process Hardhat Network\uff1b\u5982\u679c\u7528 <code>node</code> \u4efb\u52a1\u542f\u52a8 JSON-RPC server\uff08\u4fbf\u4e8e\u524d\u7aef/\u94b1\u5305\u8fde\u63a5\uff09\uff0c\u65e5\u5fd7\u4e0e\u884c\u4e3a\u4f1a\u7565\u6709\u4e0d\u540c\uff08\u4f8b\u5982 loggingEnabled \u9ed8\u8ba4\u503c\u5bf9 in-process \u4e0e node \u6709\u5dee\u5f02\uff09\u3002</p>"},{"location":"web3/dapp/hardhat_tutorial_240415/#sepolia","title":"\u516d\u3001\u90e8\u7f72\u5230 Sepolia \u6d4b\u8bd5\u7f51","text":""},{"location":"web3/dapp/hardhat_tutorial_240415/#61-ignition-module","title":"6.1 \u7528 Ignition Module \u63cf\u8ff0\u90e8\u7f72","text":"<p>Ignition \u7684\u90e8\u7f72\u5165\u53e3\u662f Module\uff0c\u653e\u5728 <code>ignition/modules</code> \u76ee\u5f55\u4e0b\u3002</p> <p>\u521b\u5efa <code>ignition/modules/MiniToken.js</code> \u6587\u4ef6\u5982\u4e0b\uff1a</p> <pre><code>const { buildModule } = require(\"@nomicfoundation/hardhat-ignition/modules\");\n\nconst TokenModule = buildModule(\"TokenModule\", (m) =&gt; {\n  const token = m.contract(\"Token\");\n\n  return { token };\n});\n\nmodule.exports = TokenModule;\n</code></pre>"},{"location":"web3/dapp/hardhat_tutorial_240415/#62-sepolia-rpc","title":"6.2 \u914d\u7f6e Sepolia RPC \u4e0e\u79c1\u94a5","text":"<p>\u90e8\u7f72\u5230\u8fdc\u7a0b\u6d4b\u8bd5\u7f51\u7edc\u9700\u8981\u5728 <code>hardhat.config.js</code> \u4e2d\u914d\u7f6e RPC \u4fe1\u606f\uff0c\u7136\u540e\u5728\u90e8\u7f72\u6307\u4ee4\u4e2d\u4f7f\u7528 <code>--network</code>\u53c2\u6570\u544a\u77e5 Hardhat \u8fde\u63a5\u5230\u54ea\u4e2a\u7f51\u7edc\u3002</p> <p>\u6ce8\u518c\u4e00\u4e2a Alchemy \u8d26\u6237\uff0c \u7136\u540e\u521b\u5efa\u4e00\u4e2a Ethereum Sepolia \u7684 App\uff0c\u83b7\u53d6\u8be5 App \u7684 API key\u3002</p> <p>\u4ece\u865a\u62df\u94b1\u5305\u53d1\u51fa\u7684\u6bcf\u4e00\u7b14\u4ea4\u6613\u90fd\u9700\u8981\u4f7f\u7528<code>private key</code>\u6765\u7b7e\u540d\uff0c\u8be5\u6b65\u9aa4\u901a\u8fc7\u628a\u94b1\u5305\u5730\u5740\u7684 private key\u3001alchemy API key \u5b58\u50a8\u5728\u4e00\u4e2a environment file \u4e2d\uff0c\u6765\u4e3a\u7a0b\u5e8f\u63d0\u4f9b\u5fc5\u8981\u7684\u8bbf\u95ee\u6743\u9650\u3002</p> <p>\u901a\u8fc7<code>npm install dotenv</code>\u6307\u4ee4\u5b89\u88c5 dotenv \u6a21\u5757\uff0c\u4ee5\u4fbf\u8bfb\u53d6<code>.env</code>\u6587\u4ef6\uff1a</p> <pre><code>ALCHEMY_API_KEY = \"xxx\"\nSEPOLIA_PRIVATE_KEY = \"xxx\"\n</code></pre> <p>\u6ce8\uff1a\u6d4b\u8bd5\u7528\u7684\u94b1\u5305\u5730\u5740\u4e2d\u4e0d\u8981\u653e\u7f6e\u4efb\u4f55\u771f\u5b9e\u8d44\u4ea7\u3002</p> <p>\u5728<code>hardhat.config.js</code>\u6587\u4ef6\u4e2d\u6dfb\u52a0\u914d\u7f6e\uff0c\u4ee5\u4fbf\u90e8\u7f72\u5230 Sepolia \u6d4b\u8bd5\u7f51\uff1a</p> <pre><code>require(\"@nomicfoundation/hardhat-toolbox\");\nrequire(\"dotenv\").config();\n\nconst { ALCHEMY_API_KEY, SEPOLIA_PRIVATE_KEY } = process.env;\n\n/** @type import('hardhat/config').HardhatUserConfig */\nmodule.exports = {\n  solidity: \"0.8.28\",\n  networks: {\n    sepolia: {\n      url: `https://eth-sepolia.g.alchemy.com/v2/${ALCHEMY_API_KEY}`,\n      accounts: [SEPOLIA_PRIVATE_KEY],\n    },\n  },\n};\n</code></pre>"},{"location":"web3/dapp/hardhat_tutorial_240415/#63","title":"6.3 \u90e8\u7f72\u5408\u7ea6","text":"<p>\u5230\u76ee\u524d\u4e3a\u6b62\uff0c\u5df2\u7ecf\u53ef\u4ee5\u5b8c\u6210\u6700\u540e\u7684\u90e8\u7f72\u4e86\uff0c\u5728\u7ec8\u7aef\u4e2d\u6267\u884c\u5982\u4e0b\u6307\u4ee4\uff1a</p> <pre><code>$ npx hardhat ignition deploy ./ignition/modules/MiniToken.js --network sepolia\n[dotenv@17.2.3] injecting env (2) from .env -- tip: \ud83d\udd10 prevent committing .env to code: https://dotenvx.com/precommit\n\u2714 Confirm deploy to network sepolia (11155111)? \u2026 yes\n[ MiniTokenModule ] Nothing new to deploy based on previous execution stored in ./ignition/deployments/chain-11155111\n\nDeployed Addresses\n\nMiniTokenModule#MiniToken - 0x07831829b9F8182eE65B446adc7cD6Dc0Ba61b6D\n</code></pre> <p>Hardhat \u4e5f\u652f\u6301\u901a\u8fc7\u811a\u672c\u6765\u90e8\u7f72\u5408\u7ea6\u3002\u5728\u9879\u76ee\u6839\u76ee\u5f55\u4e0b\u65b0\u5efa<code>scripts/</code> \u76ee\u5f55\uff0c\u5c06 JS \u7f16\u5199\u7684\u90e8\u7f72\u811a\u672c <code>deploy.js</code> \u653e\u5728\u8be5<code>scripts/</code> \u76ee\u5f55\u4e2d\uff0c\u6700\u540e\u6267\u884c <code>npx hardhat run scripts/deploy.js --network sepolia</code>\u5c31\u53ef\u4ee5\u4e86\u3002</p> <pre><code>const hre = require(\"hardhat\");\n\nasync function main() {\n  const [deployer] = await hre.ethers.getSigners();\n\n  const balance = await hre.ethers.provider.getBalance(deployer.address);\n  console.log(\"Deployer:\", deployer.address);\n  console.log(\"Deployer balance:\", hre.ethers.formatEther(balance), \"ETH\");\n\n  // \u63a8\u8350\u5199\u6cd5\uff1ahardhat-ethers \u63d0\u4f9b ethers.deployContract\n  const token = await hre.ethers.deployContract(\"MiniToken\");\n  await token.waitForDeployment();\n\n  // ethers v6 \u5408\u7ea6\u5730\u5740\u5e38\u7528 token.target\uff08\u6216 await token.getAddress()\uff09\n  console.log(\"MiniToken deployed to:\", token.target);\n\n  const tx = token.deploymentTransaction();\n  console.log(\"Deployment tx hash:\", tx.hash);\n}\n\nmain().catch((err) =&gt; {\n  console.error(err);\n  process.exitCode = 1;\n});\n</code></pre> <p>\u6267\u884c\u7ed3\u679c\u5927\u81f4\u5982\u4e0b\uff1a</p> <pre><code>test@DESKTOP-958GQ8P:~/desktop/hardhat-tutorial$ npx hardhat run scripts/deploy.js --network sepolia\n[dotenv@17.2.3] injecting env (2) from .env -- tip: \u2699\ufe0f  load multiple .env files with { path: ['.env.local', '.env'] }\n[dotenv@17.2.3] injecting env (0) from .env -- tip: \ud83d\udee0\ufe0f  run anywhere with `dotenvx run -- yourcommand`\nDeployer: 0x84B62e4c0766414a867A5aCc7BCa14901B3c713C\nDeployer balance: 0.508237594610744345 ETH\nMiniToken deployed to: 0xEc2E9d1ddEb8d6b1F695c23512afaa70d716458e\nDeployment tx hash: 0x421c29757589388e092d52d48bf65d89060bb725cfc96a9b02497557b64bd8fa\n</code></pre> <p>\u53c2\u8003\u8d44\u6599\uff1aHardhat's tutorial for beginners</p>"},{"location":"web3/dapp/solidity_contract_call_part1_240521/","title":"Solidity \u5408\u7ea6\u95f4\u8c03\u7528\uff08\u4e00\uff09\uff1a\u56db\u79cd\u65b9\u5f0f\u8c03\u7528\u5df2\u90e8\u7f72\u5408\u7ea6","text":"<p> \u7ea6 826 \u4e2a\u5b57  55 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 3 \u5206\u949f</p> <p>\u5f53\u4f60\u7684\u5408\u7ea6\u9700\u8981\u548c\u94fe\u4e0a\u5176\u4ed6\u5408\u7ea6\u4ea4\u4e92\u65f6\uff0c\u8be5\u600e\u4e48\u505a\uff1f\u672c\u7bc7\u4ecb\u7ecd\u6700\u5e38\u7528\u7684\u56db\u79cd\u65b9\u5f0f\u3002</p>"},{"location":"web3/dapp/solidity_contract_call_part1_240521/#receive-fallback","title":"\u524d\u7f6e\u77e5\u8bc6\uff1areceive \u548c fallback","text":"<p>\u5728\u8bb2\u8c03\u7528\u4e4b\u524d\uff0c\u5148\u8ba4\u8bc6\u4e24\u4e2a\u7279\u6b8a\u51fd\u6570\u3002\u5b83\u4eec\u662f\u5408\u7ea6\u7684\"\u540e\u95e8\u5165\u53e3\"\uff0c\u5728\u63a5\u6536 ETH \u548c\u5904\u7406\u5408\u7ea6\u4e2d\u4e0d\u5b58\u5728\u7684\u51fd\u6570\u8c03\u7528\u65f6\u975e\u5e38\u91cd\u8981\u3002</p>"},{"location":"web3/dapp/solidity_contract_call_part1_240521/#receive-eth","title":"receive\uff1a\u4e13\u95e8\u63a5\u6536 ETH","text":"<p>\u5f53\u5408\u7ea6\u6536\u5230\u7eaf ETH \u8f6c\u8d26\uff08\u6ca1\u6709\u9644\u5e26\u4efb\u4f55\u6570\u636e\uff09\u65f6\uff0c<code>receive</code> \u4f1a\u88ab\u89e6\u53d1\u3002</p> <pre><code>receive() external payable {\n    // \u5904\u7406\u6536\u5230\u7684 ETH\n}\n</code></pre> <p>\u8bed\u6cd5\u7279\u70b9\uff1a\u6ca1\u6709 <code>function</code> \u5173\u952e\u5b57\uff0c\u6ca1\u6709\u53c2\u6570\uff0c\u6ca1\u6709\u8fd4\u56de\u503c\uff0c\u5fc5\u987b\u662f <code>external payable</code>\u3002</p>"},{"location":"web3/dapp/solidity_contract_call_part1_240521/#fallback","title":"fallback\uff1a\u515c\u5e95\u51fd\u6570","text":"<p>\u5f53\u8c03\u7528\u5408\u7ea6\u65f6\uff0c\u5982\u679c\u627e\u4e0d\u5230\u5339\u914d\u7684\u51fd\u6570\uff0c\u5c31\u4f1a\u89e6\u53d1 <code>fallback</code>\u3002</p> <pre><code>// \u57fa\u7840\u5f62\u5f0f\nfallback() external payable {}\n\n// \u5e26\u53c2\u6570\u5f62\u5f0f\uff08\u53ef\u4ee5\u8bbf\u95ee calldata \u5e76\u8fd4\u56de\u6570\u636e\uff09\nfallback(bytes calldata input) external payable returns (bytes memory) {\n    return abi.encode(input.length);\n}\n</code></pre>"},{"location":"web3/dapp/solidity_contract_call_part1_240521/#_1","title":"\u89e6\u53d1\u903b\u8f91","text":"<pre><code>                     \u8c03\u7528\u5408\u7ea6\n                        \u2502\n                        \u25bc\n                 msg.data \u662f\u5426\u4e3a\u7a7a\uff1f\n                   /         \\\n                 \u662f            \u5426\n                /               \\\n              \u25bc                  \u25bc\n        receive \u5b58\u5728\uff1f      \u51fd\u6570\u7b7e\u540d\u5339\u914d\uff1f\n          /     \\            /       \\\n        \u662f       \u5426        \u662f         \u5426\n        /         \\        /           \\\n    receive    fallback  \u6267\u884c\u51fd\u6570    fallback\n</code></pre> <p>\u7b80\u5355\u8bb0\u5fc6\uff1a\u7eaf\u8f6c\u8d26\u8d70 receive\uff0c\u5176\u4ed6\u515c\u5e95\u8d70 fallback\u3002</p>"},{"location":"web3/dapp/solidity_contract_call_part1_240521/#_2","title":"\u8c03\u7528\u5df2\u90e8\u7f72\u5408\u7ea6\u9700\u8981\u4ec0\u4e48\uff1f","text":"<p>\u4e24\u6837\u4e1c\u897f\uff1a\u5408\u7ea6\u5730\u5740 + \u8c03\u7528\u63a5\u53e3\u3002</p> <p>\u63a5\u53e3\u544a\u8bc9\u7f16\u8bd1\u5668\uff1a\u8fd9\u4e2a\u5730\u5740\u4e0a\u7684\u5408\u7ea6\u6709\u54ea\u4e9b\u51fd\u6570\u53ef\u4ee5\u8c03\u7528\u3002</p> <pre><code>interface IERC20 {\n    function balanceOf(address account) external view returns (uint256);\n    function transfer(address to, uint256 amount) external returns (bool);\n    // ...\u5176\u4ed6\u51fd\u6570\n}\n</code></pre> <p>\u6709\u4e86\u63a5\u53e3\uff0c\u5c31\u53ef\u4ee5\u5f00\u59cb\u8c03\u7528\u4e86\u3002</p>"},{"location":"web3/dapp/solidity_contract_call_part1_240521/#_3","title":"\u65b9\u5f0f\u4e00\uff1a\u901a\u8fc7\u63a5\u53e3\u8c03\u7528\uff08\u63a8\u8350\uff09","text":"<p>\u8fd9\u662f\u6700\u5e38\u7528\u3001\u6700\u63a8\u8350\u7684\u65b9\u5f0f\uff0c\u7c7b\u578b\u5b89\u5168\uff0c\u4ee3\u7801\u6e05\u6670\u3002</p> <pre><code>import \"./IERC20.sol\";\n\ncontract MyContract {\n    function getBalance(address token, address account) public view returns (uint256) {\n        return IERC20(token).balanceOf(account);\n    }\n}\n</code></pre> <p>\u6838\u5fc3\u8bed\u6cd5\uff1a<code>IERC20(token)</code> \u628a\u5730\u5740\"\u5305\u88c5\"\u6210\u63a5\u53e3\u7c7b\u578b\uff0c\u7136\u540e\u5c31\u80fd\u50cf\u8c03\u7528\u672c\u5730\u51fd\u6570\u4e00\u6837\u8c03\u7528\u5b83\u3002</p>"},{"location":"web3/dapp/solidity_contract_call_part1_240521/#_4","title":"\u65b9\u5f0f\u4e8c\uff1a\u901a\u8fc7\u5408\u7ea6\u7c7b\u578b\u8c03\u7528","text":"<p>\u5982\u679c\u4f60\u6709\u76ee\u6807\u5408\u7ea6\u7684\u5b8c\u6574\u4ee3\u7801\uff0c\u53ef\u4ee5\u76f4\u63a5\u7528\u5408\u7ea6\u7c7b\u578b\u3002</p> <pre><code>import \"./ERC20.sol\";\n\ncontract MyContract {\n    function getBalance(address token, address account) public view returns (uint256) {\n        return ERC20(token).balanceOf(account);\n    }\n}\n</code></pre> <p>\u672c\u8d28\u4e0a\u548c\u63a5\u53e3\u8c03\u7528\u4e00\u6837\u2014\u2014\u90fd\u662f\u544a\u8bc9\u7f16\u8bd1\u5668\"\u8fd9\u4e2a\u5730\u5740\u6709\u54ea\u4e9b\u51fd\u6570\"\u3002</p> <p>\u533a\u522b\uff1a\u63a5\u53e3\u53ea\u58f0\u660e\u51fd\u6570\u7b7e\u540d\uff0c\u5408\u7ea6\u7c7b\u578b\u5305\u542b\u5b8c\u6574\u5b9e\u73b0\u3002\u5982\u679c\u53ea\u9700\u8981\u8c03\u7528\uff0c\u7528\u63a5\u53e3\u66f4\u8f7b\u91cf\u3002</p>"},{"location":"web3/dapp/solidity_contract_call_part1_240521/#_5","title":"\u65b9\u5f0f\u4e09\uff1a\u5b58\u50a8\u5408\u7ea6\u5f15\u7528","text":"<p>\u5f53\u4f60\u9700\u8981\u591a\u6b21\u8c03\u7528\u540c\u4e00\u4e2a\u5408\u7ea6\u65f6\uff0c\u53ef\u4ee5\u628a\u5f15\u7528\u5b58\u4e3a\u72b6\u6001\u53d8\u91cf\u3002</p> <pre><code>import \"./IERC20.sol\";\n\ncontract MyContract {\n    IERC20 public token;  // \u5b58\u50a8\u5408\u7ea6\u5f15\u7528\n\n    constructor(address _token) {\n        token = IERC20(_token);\n    }\n\n    function getBalance(address account) public view returns (uint256) {\n        return token.balanceOf(account);\n    }\n\n    function doTransfer(address to, uint256 amount) public {\n        token.transfer(to, amount);\n    }\n}\n</code></pre> <p>\u597d\u5904\uff1a\u4ee3\u7801\u66f4\u7b80\u6d01\uff0c\u4e0d\u7528\u6bcf\u6b21\u90fd\u4f20\u5730\u5740\u3002</p>"},{"location":"web3/dapp/solidity_contract_call_part1_240521/#call","title":"\u65b9\u5f0f\u56db\uff1a\u4f7f\u7528 call \u8c03\u7528","text":"<p>\u5f53\u4f60\u4e0d\u77e5\u9053\u76ee\u6807\u5408\u7ea6\u7684\u63a5\u53e3\u65f6\uff0c\u53ef\u4ee5\u7528\u5e95\u5c42\u7684 <code>call</code>\u3002</p> <pre><code>contract MyContract {\n    function getBalance(address token, address account) public returns (uint256) {\n        (bool success, bytes memory data) = token.call(\n            abi.encodeWithSignature(\"balanceOf(address)\", account)\n        );\n        require(success, \"Call failed\");\n        return abi.decode(data, (uint256));\n    }\n}\n</code></pre> <p><code>call</code> \u662f <code>address</code> \u7c7b\u578b\u7684\u5e95\u5c42\u65b9\u6cd5\uff0c\u7279\u70b9\u662f\uff1a</p> <ul> <li>\u9700\u8981\u81ea\u5df1\u6784\u9020 calldata</li> <li>\u9700\u8981\u81ea\u5df1\u68c0\u67e5 success</li> <li>\u9700\u8981\u81ea\u5df1\u89e3\u6790\u8fd4\u56de\u503c</li> </ul> <p>\u4ec0\u4e48\u65f6\u5019\u7528 call\uff1f</p> <ul> <li>\u76ee\u6807\u5408\u7ea6\u7684 ABI \u672a\u77e5</li> <li>\u9700\u8981\u66f4\u7075\u6d3b\u7684\u63a7\u5236\uff08\u5982\u6307\u5b9a gas\u3001\u9644\u5e26 ETH\uff09</li> </ul> <p>\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u4f18\u5148\u7528\u63a5\u53e3\u8c03\u7528\uff0c\u66f4\u5b89\u5168\u66f4\u6e05\u6670\u3002</p>"},{"location":"web3/dapp/solidity_contract_call_part1_240521/#_6","title":"\u56db\u79cd\u65b9\u5f0f\u5bf9\u6bd4","text":"\u65b9\u5f0f \u9700\u8981\u63a5\u53e3/\u5408\u7ea6\u4ee3\u7801 \u7c7b\u578b\u5b89\u5168 \u4f7f\u7528\u573a\u666f \u63a5\u53e3\u8c03\u7528 \u9700\u8981\u63a5\u53e3 \u2705 \u65e5\u5e38\u5f00\u53d1\u9996\u9009 \u5408\u7ea6\u7c7b\u578b\u8c03\u7528 \u9700\u8981\u5b8c\u6574\u4ee3\u7801 \u2705 \u6709\u6e90\u7801\u65f6\u53ef\u7528 \u5b58\u50a8\u5f15\u7528 \u9700\u8981\u63a5\u53e3 \u2705 \u9891\u7e41\u8c03\u7528\u540c\u4e00\u5408\u7ea6 call \u8c03\u7528 \u4e0d\u9700\u8981 \u274c ABI \u672a\u77e5\u6216\u9700\u8981\u5e95\u5c42\u63a7\u5236"},{"location":"web3/dapp/solidity_contract_call_part1_240521/#_7","title":"\u5c0f\u7ed3","text":"<p>\u672c\u7bc7\u6211\u4eec\u5b66\u4e60\u4e86\uff1a</p> <ol> <li><code>receive</code> \u548c <code>fallback</code> \u7684\u89e6\u53d1\u903b\u8f91</li> <li>\u56db\u79cd\u8c03\u7528\u5df2\u90e8\u7f72\u5408\u7ea6\u7684\u65b9\u5f0f</li> <li>\u65e5\u5e38\u5f00\u53d1\u63a8\u8350\u4f7f\u7528\u63a5\u53e3\u8c03\u7528</li> </ol> <p>\u4e0b\u4e00\u7bc7\uff0c\u6211\u4eec\u6df1\u5165 <code>call</code> \u7684\u5e95\u5c42\u7ec6\u8282\uff1a\u5982\u4f55\u6784\u9020 calldata\u3001\u4e09\u79cd ABI \u7f16\u7801\u65b9\u5f0f\u7684\u533a\u522b\uff0c\u4ee5\u53ca\u5982\u4f55\u6b63\u786e\u5904\u7406\u8fd4\u56de\u503c\u3002</p> <p>\u7cfb\u5217\u5bfc\u822a</p> <ul> <li>\u7b2c\u4e00\u7bc7\uff1aSolidity \u5408\u7ea6\u95f4\u8c03\u7528\uff08\u4e00\uff09\uff1a\u56db\u79cd\u65b9\u5f0f\u8c03\u7528\u5df2\u90e8\u7f72\u5408\u7ea6\uff08\u672c\u7bc7\uff09</li> <li>\u7b2c\u4e8c\u7bc7\uff1aSolidity \u5408\u7ea6\u95f4\u8c03\u7528\uff08\u4e8c\uff09\uff1a\u5e95\u5c42\u8c03\u7528\u4e0e calldata \u8be6\u89e3</li> <li>\u7b2c\u4e09\u7bc7\uff1aSolidity \u5408\u7ea6\u95f4\u8c03\u7528\uff08\u4e09\uff09\uff1a\u521b\u5efa\u5408\u7ea6\u7684\u4e24\u79cd\u65b9\u5f0f\uff1acreate \u4e0e create2</li> </ul>"},{"location":"web3/dapp/solidity_contract_call_part2_240523/","title":"Solidity \u5408\u7ea6\u95f4\u8c03\u7528\uff08\u4e8c\uff09\uff1a\u5e95\u5c42\u8c03\u7528\u4e0e calldata \u8be6\u89e3","text":"<p> \u7ea6 888 \u4e2a\u5b57  98 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 4 \u5206\u949f</p> <p>\u4e0a\u4e00\u7bc7\u6211\u4eec\u77e5\u9053\u4e86 call \u53ef\u4ee5\u5728\u4e0d\u77e5\u9053 ABI \u7684\u60c5\u51b5\u4e0b\u8c03\u7528\u5408\u7ea6\u3002\u672c\u7bc7\u6df1\u5165\u8bb2\u89e3 call \u7684\u5b8c\u6574\u7528\u6cd5\u3002</p>"},{"location":"web3/dapp/solidity_contract_call_part2_240523/#call","title":"call \u7684\u5b8c\u6574\u8bed\u6cd5","text":"<pre><code>(bool success, bytes memory data) = targetAddress.call{\n    value: 0.001 ether,  // \u9644\u5e26\u7684 ETH\uff08\u53ef\u9009\uff09\n    gas: 100000          // \u6307\u5b9a gas \u4e0a\u9650\uff08\u53ef\u9009\uff09\n}(\n    calldata              // \u8981\u53d1\u9001\u7684\u6570\u636e\n);\n</code></pre> <p>\u5404\u90e8\u5206\u542b\u4e49\uff1a</p> \u90e8\u5206 \u8bf4\u660e <code>targetAddress</code> \u76ee\u6807\u5408\u7ea6\u5730\u5740 <code>value</code> \u9644\u5e26\u7684 ETH\uff0c\u76ee\u6807\u51fd\u6570\u9700\u8981\u662f <code>payable</code> <code>gas</code> \u8f6c\u53d1\u7684 gas \u4e0a\u9650\uff0c\u4e0d\u5199\u5219\u8f6c\u53d1\u5927\u90e8\u5206\u5269\u4f59 gas <code>calldata</code> \u51fd\u6570\u9009\u62e9\u5668 + ABI \u7f16\u7801\u7684\u53c2\u6570 <code>success</code> \u8c03\u7528\u662f\u5426\u6210\u529f\uff08\u76ee\u6807\u6ca1\u6709 revert\uff09 <code>data</code> \u76ee\u6807\u51fd\u6570\u7684\u8fd4\u56de\u503c\uff08\u539f\u59cb bytes\uff09 <p>\u91cd\u8981\uff1a<code>call</code> \u6c38\u8fdc\u4e0d\u4f1a revert\u3002\u5373\u4f7f\u76ee\u6807\u5408\u7ea6\u51fa\u9519\uff0c\u4e5f\u53ea\u662f\u8fd4\u56de <code>success = false</code>\u3002\u4f60\u5fc5\u987b\u81ea\u5df1\u68c0\u67e5\u5e76\u5904\u7406\u5931\u8d25\u60c5\u51b5\u3002</p>"},{"location":"web3/dapp/solidity_contract_call_part2_240523/#calldata","title":"calldata \u662f\u4ec0\u4e48\uff1f","text":"<p>\u5f53\u4f60\u8c03\u7528 <code>token.transfer(to, amount)</code> \u65f6\uff0cEVM \u6536\u5230\u7684\u4e0d\u662f\u51fd\u6570\u540d\uff0c\u800c\u662f\u4e00\u4e32\u5b57\u8282\uff1a</p> <pre><code>0xa9059cbb                                                        \u2190 \u51fd\u6570\u9009\u62e9\u5668\uff084 \u5b57\u8282\uff09\n000000000000000000000000recipient_address_here                    \u2190 \u53c2\u65701: to\n0000000000000000000000000000000000000000000000000000000000000064  \u2190 \u53c2\u65702: amount\n</code></pre> <p>\u8fd9\u4e32\u5b57\u8282\u5c31\u662f calldata\uff0c\u7531\u4e24\u90e8\u5206\u7ec4\u6210\uff1a</p> <ol> <li>\u51fd\u6570\u9009\u62e9\u5668\uff084 \u5b57\u8282\uff09\uff1a<code>bytes4(keccak256(\"transfer(address,uint256)\"))</code></li> <li>ABI \u7f16\u7801\u7684\u53c2\u6570\uff1a\u6309\u987a\u5e8f\u7f16\u7801\u7684\u53c2\u6570\u503c</li> </ol>"},{"location":"web3/dapp/solidity_contract_call_part2_240523/#calldata_1","title":"\u4e09\u79cd\u6784\u9020 calldata \u7684\u65b9\u5f0f","text":""},{"location":"web3/dapp/solidity_contract_call_part2_240523/#1-abiencodewithsignature","title":"1. abi.encodeWithSignature","text":"<p>\u7528\u51fd\u6570\u7b7e\u540d\u5b57\u7b26\u4e32\u6784\u9020\uff1a</p> <pre><code>bytes memory data = abi.encodeWithSignature(\n    \"transfer(address,uint256)\",  // \u51fd\u6570\u7b7e\u540d\n    to,                           // \u53c2\u65701\n    amount                        // \u53c2\u65702\n);\n</code></pre> <p>\u6ce8\u610f\uff1a\u7b7e\u540d\u5b57\u7b26\u4e32\u4e2d\u53c2\u6570\u7c7b\u578b\u7528\u9017\u53f7\u5206\u9694\uff0c\u4e0d\u80fd\u6709\u7a7a\u683c\uff0c\u4e5f\u4e0d\u5305\u542b\u8fd4\u56de\u503c\u7c7b\u578b\u3002</p>"},{"location":"web3/dapp/solidity_contract_call_part2_240523/#2-abiencodewithselector","title":"2. abi.encodeWithSelector","text":"<p>\u7528\u51fd\u6570\u9009\u62e9\u5668\u6784\u9020\uff1a</p> <pre><code>bytes memory data = abi.encodeWithSelector(\n    IERC20.transfer.selector,  // 4 \u5b57\u8282\u9009\u62e9\u5668\n    to,\n    amount\n);\n</code></pre> <p>\u4e24\u8005\u672c\u8d28\u76f8\u540c\uff1a</p> <pre><code>abi.encodeWithSignature(sig, args...) \n\u2261 \nabi.encodeWithSelector(bytes4(keccak256(bytes(sig))), args...)\n</code></pre>"},{"location":"web3/dapp/solidity_contract_call_part2_240523/#3-abiencodecall","title":"3. abi.encodeCall\uff08\u63a8\u8350\uff09","text":"<p>Solidity 0.8.11 \u5f15\u5165\uff0c\u7c7b\u578b\u5b89\u5168\uff1a</p> <pre><code>bytes memory data = abi.encodeCall(\n    IERC20.transfer,    // \u51fd\u6570\u6307\u9488\uff0c\u901a\u5e38\u6765\u81ea\u63a5\u53e3\u3001\u5408\u7ea6\u540d\u7684\u51fd\u6570\u6210\u5458\n    (to, amount)        // \u53c2\u6570\u5143\u7ec4\n);\n</code></pre> <p>\u5173\u952e\u533a\u522b\uff1a\u7f16\u8bd1\u5668\u4f1a\u68c0\u67e5\u53c2\u6570\u7c7b\u578b\u662f\u5426\u5339\u914d\u51fd\u6570\u5b9a\u4e49\u3002\u5982\u679c\u4f60\u4f20\u9519\u7c7b\u578b\uff0c\u7f16\u8bd1\u65f6\u5c31\u4f1a\u62a5\u9519\u3002</p>"},{"location":"web3/dapp/solidity_contract_call_part2_240523/#_1","title":"\u4e09\u79cd\u65b9\u5f0f\u5bf9\u6bd4","text":"\u65b9\u5f0f \u7c7b\u578b\u68c0\u67e5 \u91cd\u6784\u53cb\u597d \u63a8\u8350\u573a\u666f <code>encodeWithSignature</code> \u274c \u274c \u5feb\u901f\u8c03\u8bd5\u3001\u5b9e\u9a8c <code>encodeWithSelector</code> \u274c \u274c \u53ea\u6709 selector \u65f6 <code>encodeCall</code> \u2705 \u2705 \u751f\u4ea7\u4ee3\u7801\u9996\u9009 <p>\u4e3a\u4ec0\u4e48 <code>encodeCall</code> \u66f4\u597d\uff1f</p> <pre><code>// \u5047\u8bbe\u63a5\u53e3\u6539\u4e86\uff1atransfer(address,uint256) \u2192 transfer(address,uint128)\n\n// encodeWithSignature\uff1a\u7f16\u8bd1\u901a\u8fc7\uff0c\u8fd0\u884c\u65f6\u9759\u9ed8\u5931\u8d25\nabi.encodeWithSignature(\"transfer(address,uint256)\", to, amount);\n\n// encodeCall\uff1a\u7f16\u8bd1\u62a5\u9519\uff0c\u7acb\u5373\u53d1\u73b0\u95ee\u9898\nabi.encodeCall(IERC20.transfer, (to, amount));\n</code></pre>"},{"location":"web3/dapp/solidity_contract_call_part2_240523/#_2","title":"\u5904\u7406\u8fd4\u56de\u503c","text":"<p><code>call</code> \u8fd4\u56de\u7684 <code>data</code> \u662f\u539f\u59cb bytes\uff0c\u9700\u8981\u7528 <code>abi.decode</code> \u89e3\u6790\uff1a</p> <pre><code>(bool success, bytes memory returnData) = token.call(data);\nrequire(success, \"Call failed\");\n\nbool result = abi.decode(returnData, (bool));\n</code></pre> <p>\u5b9e\u9645\u5f00\u53d1\u4e2d\u7684\u5751\uff1a\u6709\u4e9b\u975e\u6807\u51c6 ERC20 \u4ee3\u5e01\u7684 <code>transfer</code> \u4e0d\u8fd4\u56de\u503c\uff0c\u4f46\u6267\u884c\u6210\u529f\u3002\u76f4\u63a5 <code>abi.decode</code> \u4f1a\u5931\u8d25\u3002</p> <p>\u517c\u5bb9\u5199\u6cd5\uff1a</p> <pre><code>function _parseBoolReturn(bool success, bytes memory returnData) internal pure returns (bool) {\n    if (!success) return false;\n    if (returnData.length == 0) return true;  // \u517c\u5bb9\u975e\u6807\u51c6 ERC20\n    return abi.decode(returnData, (bool));\n}\n</code></pre>"},{"location":"web3/dapp/solidity_contract_call_part2_240523/#_3","title":"\u5904\u7406\u8c03\u7528\u5931\u8d25","text":"<p><code>call</code> \u8fd4\u56de <code>success = false</code> \u7684\u60c5\u51b5\uff1a</p> <ul> <li>\u76ee\u6807\u51fd\u6570 <code>revert</code></li> <li>gas \u4e0d\u8db3</li> <li>\u76ee\u6807\u5730\u5740\u6ca1\u6709\u4ee3\u7801</li> <li>\u5176\u4ed6\u6267\u884c\u9519\u8bef</li> </ul> <p>\u6ce8\u610f\uff1a\u8c03\u7528\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684\u51fd\u6570\uff0c\u5982\u679c\u76ee\u6807\u5408\u7ea6\u6709 <code>fallback</code>\uff0c<code>success</code> \u53ef\u80fd\u662f <code>true</code>\uff01</p> <p>\u6b63\u786e\u7684\u9519\u8bef\u5904\u7406\uff1a</p> <pre><code>(bool success, bytes memory returnData) = target.call(data);\n\nif (!success) {\n    if (returnData.length &gt; 0) {\n        // \u8f6c\u53d1 revert \u539f\u56e0\n        assembly {\n            revert(add(returnData, 32), mload(returnData))\n        }\n    } else {\n        revert(\"Call failed without reason\");\n    }\n}\n</code></pre>"},{"location":"web3/dapp/solidity_contract_call_part2_240523/#call-eth","title":"\u7528 call \u53d1\u9001 ETH","text":"<p>\u9664\u4e86\u8c03\u7528\u51fd\u6570\uff0c<code>call</code> \u4e5f\u662f\u53d1\u9001 ETH \u7684\u63a8\u8350\u65b9\u5f0f\uff1a</p> <pre><code>// \u7eaf\u8f6c\u8d26\uff0c\u4e0d\u8c03\u7528\u4efb\u4f55\u51fd\u6570\n(bool success, ) = recipient.call{value: 1 ether}(\"\");\nrequire(success, \"Transfer failed\");\n</code></pre> <p>\u4e3a\u4ec0\u4e48\u4e0d\u7528 <code>transfer</code> \u6216 <code>send</code>\uff1f\u56e0\u4e3a\u5b83\u4eec\u6709 2300 gas \u9650\u5236\uff0c\u53ef\u80fd\u5bfc\u81f4\u63a5\u6536\u65b9\u7684 <code>receive</code> \u51fd\u6570\u6267\u884c\u5931\u8d25\u3002</p>"},{"location":"web3/dapp/solidity_contract_call_part2_240523/#transferviacall","title":"\u52a8\u624b\u5b9e\u9a8c\uff1aTransferViaCall","text":"<p>\u4e0b\u9762\u8fd9\u4e2a\u5408\u7ea6\u5b8c\u6574\u6f14\u793a\u4e86\u56db\u79cd\u8f6c\u8d26\u65b9\u5f0f\uff0c\u53ef\u4ee5\u90e8\u7f72\u540e\u5b9e\u9645\u5bf9\u6bd4\uff1a</p> <pre><code>// SPDX-License-Identifier: MIT\npragma solidity ^0.8.28;\n\nimport \"./IERC20.sol\";\n\ncontract TransferViaCall {\n    event LowLevelCall(bool success, bytes returnData);\n\n    // 1\uff09\u63a5\u53e3\u76f4\u63a5\u8c03\u7528\n    function transferViaInterface(address token, address recipient, uint256 amount) external returns (bool) {\n        return IERC20(token).transfer(recipient, amount);\n    }\n\n    // 2\uff09encodeWithSignature\n    function transferViaSignature(address token, address recipient, uint256 amount) external returns (bool) {\n        bytes memory data = abi.encodeWithSignature(\"transfer(address,uint256)\", recipient, amount);\n        (bool success, bytes memory returnData) = token.call(data);\n        emit LowLevelCall(success, returnData);\n        return _parseBoolReturn(success, returnData);\n    }\n\n    // 3\uff09encodeWithSelector\n    function transferViaSelector(address token, address recipient, uint256 amount) external returns (bool) {\n        bytes memory data = abi.encodeWithSelector(IERC20.transfer.selector, recipient, amount);\n        (bool success, bytes memory returnData) = token.call(data);\n        emit LowLevelCall(success, returnData);\n        return _parseBoolReturn(success, returnData);\n    }\n\n    // 4\uff09encodeCall\uff08\u63a8\u8350\uff09\n    function transferViaEncodeCall(address token, address recipient, uint256 amount) external returns (bool) {\n        bytes memory data = abi.encodeCall(IERC20.transfer, (recipient, amount));\n        (bool success, bytes memory returnData) = token.call(data);\n        emit LowLevelCall(success, returnData);\n        return _parseBoolReturn(success, returnData);\n    }\n\n    /// @dev \u517c\u5bb9\u6807\u51c6\u548c\u975e\u6807\u51c6 ERC20\n    function _parseBoolReturn(bool success, bytes memory returnData) internal pure returns (bool) {\n        if (!success) return false;\n        if (returnData.length == 0) return true;  // \u975e\u6807\u51c6 ERC20\n        return abi.decode(returnData, (bool));\n    }\n}\n</code></pre>"},{"location":"web3/dapp/solidity_contract_call_part2_240523/#_4","title":"\u5b9e\u9a8c\u6b65\u9aa4","text":"<ol> <li>\u90e8\u7f72\u4e00\u4e2a ERC20 \u4ee3\u5e01\u5408\u7ea6\uff08\u5408\u7ea6\u53ef\u53c2\u8003\uff1aIERC20.sol\uff0cERC20.sol\uff09</li> <li>\u7ed9\u81ea\u5df1 mint \u4e00\u4e9b\u4ee3\u5e01</li> <li>\u5411 <code>TransferViaCall</code> \u5408\u7ea6\u8f6c\u4e00\u4e9b\u4ee3\u5e01</li> <li>\u8c03\u7528\u56db\u4e2a transfer \u51fd\u6570\uff0c\u89c2\u5bdf\u4e8b\u4ef6\u65e5\u5fd7\u4e2d\u7684 <code>returnData</code></li> </ol>"},{"location":"web3/dapp/solidity_contract_call_part2_240523/#_5","title":"\u89c2\u5bdf\u7ed3\u679c","text":"<ul> <li>\u6807\u51c6 ERC20\uff1a<code>returnData</code> \u662f 32 \u5b57\u8282\uff0c\u89e3\u7801\u540e\u4e3a <code>true</code></li> <li>\u975e\u6807\u51c6 ERC20\uff1a<code>returnData</code> \u53ef\u80fd\u4e3a\u7a7a\uff08\u957f\u5ea6\u4e3a 0\uff09\uff0c\u4f46 <code>success = true</code></li> </ul> <p>\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48 <code>_parseBoolReturn</code> \u8981\u5148\u68c0\u67e5\u957f\u5ea6\u2014\u2014\u76f4\u63a5 decode \u7a7a\u6570\u636e\u4f1a\u62a5\u9519\u3002</p>"},{"location":"web3/dapp/solidity_contract_call_part2_240523/#_6","title":"\u5c0f\u7ed3","text":"<p>\u672c\u7bc7\u6211\u4eec\u5b66\u4e60\u4e86\uff1a</p> <ol> <li><code>call</code> \u7684\u5b8c\u6574\u8bed\u6cd5\u548c\u5404\u53c2\u6570\u542b\u4e49</li> <li>calldata \u7684\u7ed3\u6784\uff1a\u9009\u62e9\u5668 + ABI \u7f16\u7801\u53c2\u6570</li> <li>\u4e09\u79cd\u6784\u9020 calldata \u7684\u65b9\u5f0f\uff0c\u63a8\u8350 <code>abi.encodeCall</code></li> <li>\u5982\u4f55\u6b63\u786e\u5904\u7406\u8fd4\u56de\u503c\u548c\u8c03\u7528\u5931\u8d25</li> <li>\u901a\u8fc7 <code>TransferViaCall</code> \u5b9e\u9a8c\u9a8c\u8bc1\u6240\u5b66</li> </ol> <p>\u4e0b\u4e00\u7bc7\uff0c\u6211\u4eec\u5b66\u4e60\u5982\u4f55\u521b\u5efa\u5408\u7ea6\uff1a<code>create</code> \u548c <code>create2</code> \u7684\u533a\u522b\uff0c\u4ee5\u53ca\u5982\u4f55\u9884\u6d4b\u5408\u7ea6\u5730\u5740\u3002</p> <p>\u7cfb\u5217\u5bfc\u822a</p> <ul> <li>\u7b2c\u4e00\u7bc7\uff1aSolidity \u5408\u7ea6\u95f4\u8c03\u7528\uff08\u4e00\uff09\uff1a\u56db\u79cd\u65b9\u5f0f\u8c03\u7528\u5df2\u90e8\u7f72\u5408\u7ea6</li> <li>\u7b2c\u4e8c\u7bc7\uff1aSolidity \u5408\u7ea6\u95f4\u8c03\u7528\uff08\u4e8c\uff09\uff1a\u5e95\u5c42\u8c03\u7528\u4e0e calldata \u8be6\u89e3\uff08\u672c\u7bc7\uff09</li> <li>\u7b2c\u4e09\u7bc7\uff1aSolidity \u5408\u7ea6\u95f4\u8c03\u7528\uff08\u4e09\uff09\uff1a\u521b\u5efa\u5408\u7ea6\u7684\u4e24\u79cd\u65b9\u5f0f\uff1acreate \u4e0e create2</li> </ul>"},{"location":"web3/dapp/solidity_contract_call_part3_240527/","title":"Solidity \u5408\u7ea6\u95f4\u8c03\u7528\uff08\u4e09\uff09\uff1a\u521b\u5efa\u5408\u7ea6\u7684\u4e24\u79cd\u65b9\u5f0f\uff1acreate \u4e0e create2","text":"<p> \u7ea6 1028 \u4e2a\u5b57  101 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 5 \u5206\u949f</p> <p>\u524d\u4e24\u7bc7\u8bb2\u4e86\u5982\u4f55\u8c03\u7528\u5408\u7ea6\uff0c\u672c\u7bc7\u8bb2\u5982\u4f55\u5728\u5408\u7ea6\u4e2d\u521b\u5efa\u65b0\u5408\u7ea6\u3002</p>"},{"location":"web3/dapp/solidity_contract_call_part3_240527/#_1","title":"\u4e24\u79cd\u521b\u5efa\u65b9\u5f0f","text":"<p>EVM \u63d0\u4f9b\u4e24\u4e2a\u64cd\u4f5c\u7801\u6765\u521b\u5efa\u5408\u7ea6\uff1a</p> \u64cd\u4f5c\u7801 \u5730\u5740\u8ba1\u7b97\u65b9\u5f0f \u7279\u70b9 <code>CREATE</code> \u90e8\u7f72\u8005\u5730\u5740 + nonce \u5730\u5740\u4e0d\u53ef\u9884\u6d4b <code>CREATE2</code> \u90e8\u7f72\u8005\u5730\u5740 + salt + initcode \u5730\u5740\u53ef\u9884\u6d4b"},{"location":"web3/dapp/solidity_contract_call_part3_240527/#create","title":"CREATE\uff1a\u57fa\u7840\u521b\u5efa","text":"<p>\u8bed\u6cd5\u5f88\u7b80\u5355\uff0c\u5c31\u662f <code>new</code> \u4e00\u4e2a\u5408\u7ea6\uff1a</p> <pre><code>Contract x = new Contract{value: _value}(params);\n</code></pre> <ul> <li><code>Contract</code>\uff1a\u8981\u521b\u5efa\u7684\u5408\u7ea6\u540d</li> <li><code>x</code>\uff1a\u8fd4\u56de\u7684\u5408\u7ea6\u5b9e\u4f8b\uff08\u672c\u8d28\u662f\u5730\u5740\uff09</li> <li><code>value</code>\uff1a\u9644\u5e26\u7684 ETH\uff08\u6784\u9020\u51fd\u6570\u9700\u8981\u662f <code>payable</code>\uff09</li> <li><code>params</code>\uff1a\u6784\u9020\u51fd\u6570\u53c2\u6570</li> </ul>"},{"location":"web3/dapp/solidity_contract_call_part3_240527/#pair","title":"\u793a\u4f8b\uff1a\u7b80\u6613 Pair \u5de5\u5382","text":"<pre><code>// Pair.sol\ncontract Pair {\n    address public factory;\n    address public token0;\n    address public token1;\n\n    constructor() {\n        factory = msg.sender;\n    }\n\n    function initialize(address _token0, address _token1) external {\n        require(msg.sender == factory, \"FORBIDDEN\");\n        token0 = _token0;\n        token1 = _token1;\n    }\n}\n</code></pre> <pre><code>// PairFactory.sol\nimport \"./Pair.sol\";\n\ncontract PairFactory {\n    mapping(address =&gt; mapping(address =&gt; address)) public getPair;\n\n    function createPair(address tokenA, address tokenB) external returns (address) {\n        Pair pair = new Pair();           // \u521b\u5efa\u65b0\u5408\u7ea6\n        pair.initialize(tokenA, tokenB);  // \u521d\u59cb\u5316\n\n        getPair[tokenA][tokenB] = address(pair);\n        getPair[tokenB][tokenA] = address(pair);\n\n        return address(pair);\n    }\n}\n</code></pre> <p>\u95ee\u9898\uff1a\u6bcf\u6b21\u8c03\u7528 <code>createPair</code>\uff0c\u5f97\u5230\u7684\u5730\u5740\u90fd\u4e0d\u540c\uff0c\u65e0\u6cd5\u63d0\u524d\u9884\u6d4b\u3002</p>"},{"location":"web3/dapp/solidity_contract_call_part3_240527/#create2","title":"CREATE2\uff1a\u786e\u5b9a\u6027\u521b\u5efa","text":"<p>CREATE2 \u7684\u5730\u5740\u7531\u56db\u4e2a\u56e0\u7d20\u51b3\u5b9a\uff1a</p> <pre><code>\u5730\u5740 = keccak256(0xff ++ deployer ++ salt ++ keccak256(initcode))[12:]\n</code></pre> \u56e0\u7d20 \u8bf4\u660e <code>0xff</code> \u56fa\u5b9a\u524d\u7f00 <code>deployer</code> \u90e8\u7f72\u8005\u5730\u5740\uff08\u901a\u5e38\u662f\u5de5\u5382\u5408\u7ea6\uff09 <code>salt</code> 32 \u5b57\u8282\u7684\u76d0\u503c\uff0c\u7531\u5f00\u53d1\u8005\u6307\u5b9a <code>initcode</code> \u521b\u5efa\u4ee3\u7801 + \u6784\u9020\u51fd\u6570\u53c2\u6570 <p>\u53ea\u8981\u8fd9\u56db\u4e2a\u56e0\u7d20\u76f8\u540c\uff0c\u5730\u5740\u5c31\u76f8\u540c\u2014\u2014\u53ef\u4ee5\u5728\u90e8\u7f72\u524d\u9884\u6d4b\u5730\u5740\u3002</p> <p>\u8bed\u6cd5</p> <pre><code>Contract x = new Contract{salt: salt}(params);\n</code></pre> <p>\u53ea\u9700\u52a0\u4e00\u4e2a <code>salt</code> \u53c2\u6570\u3002</p>"},{"location":"web3/dapp/solidity_contract_call_part3_240527/#pair_1","title":"\u793a\u4f8b\uff1a\u53ef\u9884\u6d4b\u5730\u5740\u7684 Pair \u5de5\u5382","text":"<pre><code>contract PairFactory {\n    mapping(address =&gt; mapping(address =&gt; address)) public getPair;\n\n    function createPair(address tokenA, address tokenB) external returns (address) {\n        // \u6392\u5e8f\uff0c\u786e\u4fdd\u540c\u4e00\u5bf9 token \u7684 salt \u4e00\u81f4\n        (address token0, address token1) = tokenA &lt; tokenB \n            ? (tokenA, tokenB) \n            : (tokenB, tokenA);\n\n        // \u7528 token \u5730\u5740\u751f\u6210 salt\n        bytes32 salt = keccak256(abi.encodePacked(token0, token1));\n\n        // \u4f7f\u7528 CREATE2 \u90e8\u7f72\n        Pair pair = new Pair{salt: salt}();\n        pair.initialize(tokenA, tokenB);\n\n        getPair[tokenA][tokenB] = address(pair);\n        getPair[tokenB][tokenA] = address(pair);\n\n        return address(pair);\n    }\n}\n</code></pre>"},{"location":"web3/dapp/solidity_contract_call_part3_240527/#_2","title":"\u9884\u6d4b\u5730\u5740","text":"<p>\u65e0\u9700\u8c03\u7528 <code>createPair</code>\uff0c\u5c31\u80fd\u8ba1\u7b97\u51fa Pair \u7684\u5730\u5740\uff1a</p> <pre><code>function predictPair(address tokenA, address tokenB) external view returns (address) {\n    (address token0, address token1) = tokenA &lt; tokenB \n        ? (tokenA, tokenB) \n        : (tokenB, tokenA);\n\n    bytes32 salt = keccak256(abi.encodePacked(token0, token1));\n\n    // initcode = \u521b\u5efa\u4ee3\u7801 + \u6784\u9020\u51fd\u6570\u53c2\u6570\n    bytes32 initCodeHash = keccak256(\n        abi.encodePacked(type(Pair).creationCode)  // Pair \u65e0\u6784\u9020\u53c2\u6570\n    );\n\n    // CREATE2 \u5730\u5740\u516c\u5f0f\n    return address(uint160(uint256(keccak256(abi.encodePacked(\n        bytes1(0xff),\n        address(this),  // deployer\n        salt,\n        initCodeHash\n    )))));\n}\n</code></pre> <p>\u4e3a\u4ec0\u4e48\u5730\u5740\u8f6c\u6362\u8981\u5199\u6210 <code>address(uint160(uint256(...)))</code>\uff1f</p> <p>CREATE2 \u8ba1\u7b97\u51fa\u7684\u662f 32 \u5b57\u8282\u54c8\u5e0c\uff08<code>bytes32</code>\uff09\uff0c\u4f46\u4ee5\u592a\u574a\u5730\u5740\u53ea\u6709 20 \u5b57\u8282\uff08160 bit\uff09\u3002\u5408\u7ea6\u5730\u5740\u53d6\u7684\u662f\u54c8\u5e0c\u7684\u4f4e 20 \u5b57\u8282\u3002</p> <p>Solidity \u4e0d\u5141\u8bb8\u76f4\u63a5\u628a <code>bytes32</code> \u5f3a\u8f6c\u6210 <code>address</code>\u2014\u2014\u8fd9\u6837\u505a\u4f1a\u6709\u6b67\u4e49\uff1a\u53d6\u9ad8 20 \u5b57\u8282\u8fd8\u662f\u4f4e 20 \u5b57\u8282\uff1f\u6240\u4ee5\u5fc5\u987b\u663e\u5f0f\u544a\u8bc9\u7f16\u8bd1\u5668\uff1a</p> <pre><code>bytes32 h = keccak256(...);\n\nuint256(h)              // \u7b2c\u4e00\u6b65\uff1a\u628a bytes32 \u5f53\u4f5c 256 \u4f4d\u6574\u6570\nuint160(uint256(h))     // \u7b2c\u4e8c\u6b65\uff1a\u622a\u65ad\u4e3a 160 \u4f4d\uff08\u81ea\u52a8\u4fdd\u7559\u4f4e 160 bit\uff09\naddress(uint160(...))   // \u7b2c\u4e09\u6b65\uff1a\u628a 160 \u4f4d\u6574\u6570\u89e3\u91ca\u4e3a address\n</code></pre> <p>\u8fd9\u662f Solidity \u4e2d\"\u622a\u65ad\u53d6\u4f4e\u4f4d\"\u7684\u6807\u51c6\u5199\u6cd5\uff0c\u5728\u5904\u7406\u54c8\u5e0c\u7ed3\u679c\u65f6\u7ecf\u5e38\u7528\u5230\u3002</p>"},{"location":"web3/dapp/solidity_contract_call_part3_240527/#initcode","title":"\u7406\u89e3 initcode","text":"<p>\u4e24\u4e2a\u5bb9\u6613\u6df7\u6dc6\u7684\u6982\u5ff5\uff1a</p> \u6982\u5ff5 \u8bf4\u660e \u83b7\u53d6\u65b9\u5f0f initcode \u90e8\u7f72\u65f6\u6267\u884c\u7684\u4ee3\u7801\uff0c\u5305\u542b\u6784\u9020\u51fd\u6570 <code>type(C).creationCode</code> runtime code \u90e8\u7f72\u540e\u5b58\u50a8\u5728\u94fe\u4e0a\u7684\u4ee3\u7801 <code>type(C).runtimeCode</code> <p>initcode \u6267\u884c\u5b8c\u6bd5\u540e\uff0c\u8fd4\u56de runtime code\uff0c\u540e\u8005\u624d\u662f\u7528\u6237\u5b9e\u9645\u8c03\u7528\u7684\u4ee3\u7801\u3002</p> <p>CREATE2 \u5730\u5740\u8ba1\u7b97\u7528\u7684\u662f initcode \u7684\u54c8\u5e0c\u3002</p> <p>\u5982\u679c\u5408\u7ea6\u6709\u6784\u9020\u51fd\u6570\u53c2\u6570\uff1a</p> <pre><code>bytes memory initcode = abi.encodePacked(\n    type(Pair).creationCode,\n    abi.encode(constructorArg1, constructorArg2)\n);\nbytes32 initCodeHash = keccak256(initcode);\n</code></pre>"},{"location":"web3/dapp/solidity_contract_call_part3_240527/#create2_1","title":"CREATE2 \u7684\u5e94\u7528\u573a\u666f","text":"<p>1.\u53cd\u4e8b\u5b9e\u90e8\u7f72</p> <p>\u5148\u8ba1\u7b97\u5730\u5740 \u2192 \u7528\u6237\u5411\u8be5\u5730\u5740\u8f6c\u8d26 \u2192 \u4e4b\u540e\u518d\u90e8\u7f72\u5408\u7ea6\u3002</p> <p>\u8d26\u6237\u62bd\u8c61\u94b1\u5305\u5e38\u7528\u8fd9\u79cd\u6a21\u5f0f\uff1a\u7528\u6237\u5148\u62ff\u5230\u94b1\u5305\u5730\u5740\u6536\u6b3e\uff0c\u771f\u6b63\u9700\u8981\u65f6\u624d\u90e8\u7f72\u94b1\u5305\u5408\u7ea6\u3002</p> <p>2.\u8de8\u94fe\u786e\u5b9a\u6027\u90e8\u7f72</p> <p>\u5728\u591a\u6761\u94fe\u4e0a\u7528\u76f8\u540c\u53c2\u6570\u90e8\u7f72\uff0c\u5f97\u5230\u76f8\u540c\u5730\u5740\u3002\u8de8\u94fe\u534f\u8bae\u9700\u8981\u8fd9\u4e2a\u7279\u6027\u3002</p> <p>3.\u5408\u7ea6\u91cd\u5efa</p> <p>\u9500\u6bc1\u5408\u7ea6\u540e\uff0c\u7528\u76f8\u540c\u53c2\u6570\u53ef\u4ee5\u5728\u540c\u4e00\u5730\u5740\u91cd\u65b0\u90e8\u7f72\uff08\u9700\u8981 <code>selfdestruct</code>\uff09\u3002</p>"},{"location":"web3/dapp/solidity_contract_call_part3_240527/#_3","title":"\u6ce8\u610f\u4e8b\u9879","text":"<p>1. \u540c\u5730\u5740\u53ea\u80fd\u90e8\u7f72\u4e00\u6b21</p> <p>\u540c\u6837\u7684 <code>deployer + salt + initcode</code> \u7ec4\u5408\uff0c\u7b2c\u4e8c\u6b21\u90e8\u7f72\u4f1a\u5931\u8d25\u3002</p> <p>2. value \u4e0d\u5f71\u54cd\u5730\u5740</p> <p><code>new Pair{salt: salt, value: 1 ether}()</code> \u4e2d\u7684 <code>value</code> \u4e0d\u53c2\u4e0e\u5730\u5740\u8ba1\u7b97\u3002</p> <p>3. deployer \u662f\u5de5\u5382\u5408\u7ea6</p> <p>\u5728 <code>PairFactory.createPair()</code> \u4e2d\u8c03\u7528 <code>new Pair{salt: ...}()</code>\uff0cdeployer \u662f <code>PairFactory</code> \u7684\u5730\u5740\uff0c\u800c\u4e0d\u662f\u8c03\u7528 <code>createPair</code> \u7684\u7528\u6237\u3002</p> <p>4. \u4efb\u4f55\u56e0\u7d20\u53d8\u5316\u90fd\u4f1a\u6539\u53d8\u5730\u5740</p> <p>\u5de5\u5382\u5730\u5740\u3001salt\u3001\u5408\u7ea6\u4ee3\u7801\u3001\u6784\u9020\u53c2\u6570\u2014\u2014\u4efb\u4f55\u4e00\u4e2a\u53d8\u5316\uff0c\u5730\u5740\u90fd\u4f1a\u4e0d\u540c\u3002</p>"},{"location":"web3/dapp/solidity_contract_call_part3_240527/#_4","title":"\u5e95\u5c42\u8c03\u7528\u65b9\u5f0f","text":"<p>\u5982\u679c\u9700\u8981\u90e8\u7f72\u4efb\u610f\u5b57\u8282\u7801\uff0c\u53ef\u4ee5\u7528 assembly\uff1a</p> <pre><code>// CREATE\nfunction rawCreate(bytes memory bytecode) external returns (address addr) {\n    assembly {\n        addr := create(0, add(bytecode, 0x20), mload(bytecode))\n        if iszero(addr) { revert(0, 0) }\n    }\n}\n\n// CREATE2\nfunction rawCreate2(bytes memory bytecode, bytes32 salt) external returns (address addr) {\n    assembly {\n        addr := create2(0, add(bytecode, 0x20), mload(bytecode), salt)\n        if iszero(addr) { revert(0, 0) }\n    }\n}\n</code></pre> <p>\u53c2\u6570\u542b\u4e49\uff1a<code>create(value, offset, size)</code> / <code>create2(value, offset, size, salt)</code></p>"},{"location":"web3/dapp/solidity_contract_call_part3_240527/#selfdestruct","title":"selfdestruct \u7684\u53d8\u5316","text":"<p>2024 \u5e74\u574e\u6606\u5347\u7ea7\uff08EIP-6780\uff09\u9650\u5236\u4e86 <code>selfdestruct</code>\uff1a</p> <ul> <li>\u540c\u4e00\u7b14\u4ea4\u6613\u5185\uff1a\u4ecd\u53ef\u5220\u9664\u4ee3\u7801\u548c\u5b58\u50a8</li> <li>\u4e4b\u540e\u7684\u4ea4\u6613\uff1a\u53ea\u8f6c\u79fb ETH\uff0c\u4ee3\u7801\u548c\u5b58\u50a8\u4fdd\u7559</li> </ul> <p>\u8fd9\u610f\u5473\u7740\"\u9500\u6bc1\u540e\u91cd\u5efa\"\u7684\u6a21\u5f0f\u57fa\u672c\u4e0d\u518d\u53ef\u884c\u3002</p>"},{"location":"web3/dapp/solidity_contract_call_part3_240527/#_5","title":"\u5c0f\u7ed3","text":"<p>\u672c\u7bc7\u6211\u4eec\u5b66\u4e60\u4e86\uff1a</p> <ol> <li><code>CREATE</code> \u548c <code>CREATE2</code> \u7684\u533a\u522b</li> <li>CREATE2 \u5730\u5740\u7684\u8ba1\u7b97\u516c\u5f0f</li> <li>\u5982\u4f55\u9884\u6d4b\u5408\u7ea6\u5730\u5740\uff08\u4ee5\u53ca\u4e3a\u4ec0\u4e48\u5730\u5740\u8f6c\u6362\u8981\u5199\u6210 <code>address(uint160(uint256(...)))</code>\uff09</li> </ol> <p>\u81f3\u6b64\uff0c\u5408\u7ea6\u95f4\u8c03\u7528\u7cfb\u5217\u5b8c\u7ed3\u3002\u4f60\u5df2\u7ecf\u638c\u63e1\u4e86\uff1a</p> <ul> <li>\u5982\u4f55\u8c03\u7528\u5176\u4ed6\u5408\u7ea6\uff08\u56db\u79cd\u65b9\u5f0f\uff09</li> <li>\u5e95\u5c42 call \u7684\u7528\u6cd5\u548c calldata \u6784\u9020</li> <li>\u5982\u4f55\u5728\u5408\u7ea6\u4e2d\u521b\u5efa\u65b0\u5408\u7ea6</li> </ul> <p>\u7cfb\u5217\u5bfc\u822a</p> <ul> <li>\u7b2c\u4e00\u7bc7\uff1aSolidity \u5408\u7ea6\u95f4\u8c03\u7528\uff08\u4e00\uff09\uff1a\u56db\u79cd\u65b9\u5f0f\u8c03\u7528\u5df2\u90e8\u7f72\u5408\u7ea6</li> <li>\u7b2c\u4e8c\u7bc7\uff1aSolidity \u5408\u7ea6\u95f4\u8c03\u7528\uff08\u4e8c\uff09\uff1a\u5e95\u5c42\u8c03\u7528\u4e0e calldata \u8be6\u89e3</li> <li>\u7b2c\u4e09\u7bc7\uff1aSolidity \u5408\u7ea6\u95f4\u8c03\u7528\uff08\u4e09\uff09\uff1a\u521b\u5efa\u5408\u7ea6\u7684\u4e24\u79cd\u65b9\u5f0f\uff1acreate \u4e0e create2\uff08\u672c\u7bc7\uff09</li> </ul>"},{"location":"web3/dapp/solidity_proxy_upgrade_series_part1/","title":"\u4ee3\u7406\u5408\u7ea6\u4e0e\u53ef\u5347\u7ea7\u5408\u7ea6\u7cfb\u5217\uff08\u4e00\uff09\uff1a\u4e3a\u4ec0\u4e48\u9700\u8981\u53ef\u5347\u7ea7\uff1f","text":"<p> \u7ea6 1777 \u4e2a\u5b57  136 \u884c\u4ee3\u7801  4 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 8 \u5206\u949f</p> <p>\u672c\u7cfb\u5217\u5171\u4e24\u7bc7\u6587\u7ae0\uff0c\u5c06\u5e26\u4f60\u4ece\u96f6\u5230\u4e00\u7406\u89e3 Solidity \u4ee3\u7406\u5408\u7ea6\u4e0e\u53ef\u5347\u7ea7\u5408\u7ea6\u7684\u6838\u5fc3\u539f\u7406\u3002</p>"},{"location":"web3/dapp/solidity_proxy_upgrade_series_part1/#_1","title":"\u5f15\u8a00\uff1a\u4e0d\u53ef\u53d8\u6027\u7684\u4e24\u96be","text":"<p>\u4ee5\u592a\u574a\u667a\u80fd\u5408\u7ea6\u6709\u4e00\u4e2a\u6838\u5fc3\u7279\u6027\uff1a\u4e0d\u53ef\u53d8\u6027\uff08Immutability\uff09\u3002\u4e00\u65e6\u90e8\u7f72\uff0c\u5408\u7ea6\u7684\u5b57\u8282\u7801\u5c31\u65e0\u6cd5\u4fee\u6539\u3002</p> <p>\u8fd9\u662f\u4e00\u628a\u53cc\u5203\u5251\uff1a</p> <ul> <li>\u4f18\u70b9\uff1a\u7528\u6237\u53ef\u4ee5\u4fe1\u4efb\u5408\u7ea6\u903b\u8f91\u4e0d\u4f1a\u88ab\u7be1\u6539\uff0c\u8fd9\u662f\u53bb\u4e2d\u5fc3\u5316\u548c\u5b89\u5168\u6027\u7684\u57fa\u77f3</li> <li>\u7f3a\u70b9\uff1a\u5982\u679c\u5408\u7ea6\u5b58\u5728 bug \u6216\u9700\u8981\u65b0\u529f\u80fd\uff0c\u5f00\u53d1\u8005\u675f\u624b\u65e0\u7b56</li> </ul> <p>\u60f3\u8c61\u4e00\u4e0b\uff1a\u4f60\u7684 DeFi \u534f\u8bae\u4e0a\u7ebf\u540e\u53d1\u73b0\u4e86\u4e00\u4e2a\u4e25\u91cd\u6f0f\u6d1e\uff0c\u4f46\u4f60\u65e0\u6cd5\u4fee\u590d\u5b83\u2014\u2014\u7528\u6237\u8d44\u91d1\u9762\u4e34\u98ce\u9669\uff0c\u800c\u4f60\u53ea\u80fd\u773c\u7741\u7741\u770b\u7740\u3002</p> <p>\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\u793e\u533a\u53d1\u660e\u4e86\u4ee3\u7406\u5408\u7ea6\uff08Proxy Contract\uff09\u548c\u53ef\u5347\u7ea7\u5408\u7ea6\uff08Upgradeable Contract\uff09\u6a21\u5f0f\u3002</p>"},{"location":"web3/dapp/solidity_proxy_upgrade_series_part1/#_2","title":"\u6838\u5fc3\u601d\u8def\uff1a\u6570\u636e\u4e0e\u903b\u8f91\u5206\u79bb","text":"<p>\u65e2\u7136\u5b57\u8282\u7801\u4e0d\u53ef\u53d8\uff0c\u90a3\u6211\u4eec\u6362\u4e2a\u601d\u8def\uff1a\u628a\u6570\u636e\u548c\u903b\u8f91\u5206\u5f00\u5b58\u50a8\u3002</p> <p></p> <p>\u7528\u6237\u59cb\u7ec8\u4e0e\u4ee3\u7406\u5408\u7ea6\u4ea4\u4e92\uff0c\u4ee3\u7406\u5408\u7ea6\u8d1f\u8d23\uff1a</p> <p>1.\u4fdd\u5b58\u6240\u6709\u72b6\u6001\u6570\u636e</p> <p>2.\u5c06\u51fd\u6570\u8c03\u7528\u8f6c\u53d1\u7ed9\u903b\u8f91\u5408\u7ea6\u6267\u884c</p> <p>\u5f53\u9700\u8981\u5347\u7ea7\u65f6\uff0c\u53ea\u9700\u90e8\u7f72\u65b0\u7684\u903b\u8f91\u5408\u7ea6\uff0c\u7136\u540e\u66f4\u65b0\u4ee3\u7406\u5408\u7ea6\u4e2d\u4fdd\u5b58\u7684\u903b\u8f91\u5408\u7ea6\u5730\u5740\u5373\u53ef\u3002\u7528\u6237\u65e0\u9700\u8fc1\u79fb\uff0c\u5730\u5740\u4e0d\u53d8\uff0c\u6570\u636e\u4fdd\u7559\u3002</p>"},{"location":"web3/dapp/solidity_proxy_upgrade_series_part1/#delegatecall","title":"delegatecall\uff1a\u4ee3\u7406\u6a21\u5f0f\u7684\u57fa\u77f3","text":"<p>\u8981\u7406\u89e3\u4ee3\u7406\u5408\u7ea6\uff0c\u5fc5\u987b\u5148\u7406\u89e3 delegatecall\u3002</p> <p>delegatecall \u4e0e call \u7c7b\u4f3c\uff0c\u662f Solidity \u4e2d\u5730\u5740\u7c7b\u578b\u7684\u4f4e\u7ea7\u6210\u5458\u51fd\u6570\uff0cdelegate \u662f\u59d4\u6258/\u4ee3\u8868\u7684\u610f\u601d\u3002</p> <p>delegatecall \u7684\u672c\u8d28\uff1a\u501f\u7528\u76ee\u6807\u5408\u7ea6\u7684\u4ee3\u7801\uff0c\u5728\u81ea\u5df1\u7684\u73af\u5883\u4e2d\u6267\u884c\u3002</p> <p>\u60f3\u8c61\u4e00\u4e0b\uff1a\u4f60\u8bf7\u4e86\u4e00\u4f4d\u53a8\u5e08\uff08\u903b\u8f91\u5408\u7ea6\uff09\u6765\u4f60\u5bb6\uff08\u4ee3\u7406\u5408\u7ea6\uff09\u505a\u996d\u3002\u53a8\u5e08\u7528\u7684\u662f\u4f60\u5bb6\u7684\u53a8\u623f\u3001\u4f60\u5bb6\u7684\u98df\u6750\u3001\u4f60\u5bb6\u7684\u9910\u5177\u3002\u505a\u5b8c\u996d\u540e\uff0c\u98df\u7269\u7559\u5728\u4f60\u5bb6\uff0c\u53a8\u5e08\u79bb\u5f00\u3002</p> <p>\u57fa\u672c\u5f62\u5f0f\uff1a</p> <pre><code>(bool success, bytes memory returnData) = implementation.delegatecall(calldata)\n</code></pre> <p>\u8fd9\u884c\u4ee3\u7801\u505a\u4e86\u4ec0\u4e48\uff1f</p> <ol> <li>\u53d6 <code>implementation</code> \u5730\u5740\u4e0a\u7684\u4ee3\u7801\uff08runtime bytecode\uff09</li> <li>\u7528\u4f60\u63d0\u4f9b\u7684 <code>calldata</code> \u4f5c\u4e3a\u8f93\u5165</li> <li>\u5728\u5f53\u524d\u5408\u7ea6\u7684\u4e0a\u4e0b\u6587\u4e2d\u6267\u884c\u90a3\u6bb5\u4ee3\u7801</li> <li>\u8fd4\u56de\u6267\u884c\u662f\u5426\u6210\u529f <code>success</code> \u4e0e\u8fd4\u56de\u6570\u636e <code>returnData</code></li> </ol> <p>\u300c\u5f53\u524d\u5408\u7ea6\u7684\u4e0a\u4e0b\u6587\u300d\u5177\u4f53\u6307\u4ec0\u4e48\uff1f</p> <ul> <li>\u5199\u5165/\u8bfb\u53d6\u7684 <code>storage</code> \u662f\u5f53\u524d\u5408\u7ea6\u7684 <code>storage</code></li> <li><code>address(this)</code> \u662f\u5f53\u524d\u5408\u7ea6\u5730\u5740</li> <li><code>balance</code> \u4e5f\u662f\u5f53\u524d\u5408\u7ea6\u7684\u4f59\u989d</li> <li>\u4e8b\u4ef6 <code>emit</code> \u7684\u53d1\u51fa\u8005\u5730\u5740\uff08log \u7684 address\uff09\u4e5f\u662f\u5f53\u524d\u5408\u7ea6</li> </ul>"},{"location":"web3/dapp/solidity_proxy_upgrade_series_part1/#call-vs-delegatecall","title":"call vs delegatecall \u5bf9\u6bd4","text":"call delegatecall \u4ee3\u7801\u6267\u884c\u4f4d\u7f6e \u88ab\u8c03\u7528\u5408\u7ea6 \u8c03\u7528\u65b9\uff08\u5373\u5f53\u524d\u5408\u7ea6\uff09 \u5b58\u50a8\u4fee\u6539\u4f4d\u7f6e \u88ab\u8c03\u7528\u5408\u7ea6\u7684 storage \u8c03\u7528\u65b9\uff08\u5373\u5f53\u524d\u5408\u7ea6\uff09\u7684 storage msg.sender \u8c03\u7528\u65b9\uff08\u5373\u5f53\u524d\u5408\u7ea6\uff09\u5730\u5740 \u539f\u59cb\u5916\u90e8\u8c03\u7528\u8005 msg.value \u4f1a\u628a value \u8f6c\u7ed9\u76ee\u6807\uff08\u5982\u679c\u8bbe\u7f6e {value: ...}\uff09 \u4e0d\u4f1a\u628a ETH \u8f6c\u5230\u5b9e\u73b0\u5408\u7ea6\uff1bvalue \u4ecd\u5728\u5f53\u524d\u5408\u7ea6\uff0c\u4f46\u5b9e\u73b0\u4ee3\u7801\u80fd\"\u770b\u5230\"\u8fd9\u7b14 msg.value address(this) \u88ab\u8c03\u7528\u5408\u7ea6\u5730\u5740 \u8c03\u7528\u65b9\uff08\u5373\u5f53\u524d\u5408\u7ea6\uff09\u5730\u5740 \u4e8b\u4ef6 emitter \u5730\u5740 \u88ab\u8c03\u7528\u5408\u7ea6\u5730\u5740 \u8c03\u7528\u65b9\uff08\u5373\u5f53\u524d\u5408\u7ea6\uff09\u5730\u5740"},{"location":"web3/dapp/solidity_proxy_upgrade_series_part1/#call-delegatecall","title":"\u52a8\u624b\u5b9e\u9a8c\uff1a\u9a8c\u8bc1 call \u4e0e delegatecall \u7684\u533a\u522b","text":"<p>\u4e0b\u9762\u7684\u5b9e\u9a8c\u5c06\u9a8c\u8bc1\uff1a</p> <ul> <li>call\uff1a\u4fee\u6539\u7684\u662f\u88ab\u8c03\u7528\u5408\u7ea6\uff08Logic\uff09\u7684\u5b58\u50a8\uff0c\u4e8b\u4ef6\u4ece Logic \u53d1\u51fa</li> <li>delegatecall\uff1a\u4fee\u6539\u7684\u662f\u8c03\u7528\u65b9\uff08Caller\uff09\u7684\u5b58\u50a8\uff0c\u4e8b\u4ef6\u4ece Caller \u53d1\u51fa</li> </ul> <p>Logic.sol - \u88ab\u8c03\u7528\u7684\u903b\u8f91\u5408\u7ea6\uff1a</p> <pre><code>// SPDX-License-Identifier: MIT\npragma solidity ^0.8.28;\n\ncontract Logic {\n    uint256 public value;\n\n    event ValueChanged(address indexed caller, uint256 indexed newValue);\n\n    function setValue(uint256 newValue) external returns (bool) {\n        value = newValue;\n        emit ValueChanged(msg.sender, value);\n        return true;\n    }\n}\n</code></pre> <p>Caller.sol - \u53d1\u8d77\u8c03\u7528\u7684\u5408\u7ea6\uff1a</p> <pre><code>// SPDX-License-Identifier: MIT\npragma solidity ^0.8.28;\n\nimport \"./Logic.sol\";\n\ncontract Caller {\n    uint256 public value;\n\n    event LowLevelCall(bool success, bytes returnData, bool parsedOk);\n\n    function callSetValue(address logic, uint256 _value) external {\n        (bool success, bytes memory returnData) = logic.call(\n            abi.encodeCall(Logic.setValue, (_value))\n        );\n        bool parsedOk = _parseBoolReturn(success, returnData);\n        emit LowLevelCall(success, returnData, parsedOk);\n        require(parsedOk, \"Call failed\");\n    }\n\n    function delegateSetValue(address logic, uint256 _value) external {\n        (bool success, bytes memory returnData) = logic.delegatecall(\n            abi.encodeCall(Logic.setValue, (_value))\n        );\n        bool parsedOk = _parseBoolReturn(success, returnData);\n        emit LowLevelCall(success, returnData, parsedOk);\n        require(parsedOk, \"Delegatecall failed\");\n    }\n\n    /// @dev \u517c\u5bb9\u4e24\u7c7b\u8fd4\u56de\uff1a\n    /// - \u65e0\u8fd4\u56de\u503c\uff1areturnData.length == 0\uff0c\u4f46 success == true\n    /// - \u8fd4\u56de bool\uff1areturnData \u7f16\u7801\u4e86 bool\uff0832 bytes\uff09\n    /// \u6ce8\u610f\uff1a\u5982\u679c\u76ee\u6807\u51fd\u6570\u8fd4\u56de\u7684\u662f\u5176\u4ed6\u7c7b\u578b\uff08\u4f8b\u5982 uint256\uff09\uff0c\u8fd9\u91cc\u4e0d\u9002\u7528\u3002\n    function _parseBoolReturn(bool success, bytes memory returnData) internal pure returns (bool) {\n        if (!success) return false;\n        // \u76ee\u6807\u51fd\u6570\u6ca1\u6709\u8fd4\u56de\u503c\u7684\u5e38\u89c1\u60c5\u51b5\uff1a\u6210\u529f\u65f6 returnData \u4e3a\u7a7a\n        if (returnData.length == 0) return true;\n        // \u5982\u679c\u786e\u5b9e\u8fd4\u56de\u4e86\u6570\u636e\uff0c\u4e14\u957f\u5ea6\u7b26\u5408 bool ABI \u7f16\u7801\uff0832 bytes\uff09\uff0c\u5c1d\u8bd5 decode\n        if (returnData.length == 32) {\n            return abi.decode(returnData, (bool));\n        }\n        // \u5176\u4ed6\u957f\u5ea6\uff1a\u65e0\u6cd5\u6309 bool \u89e3\u6790\uff0c\u4fdd\u5b88\u5904\u7406\u4e3a\u5931\u8d25\uff08\u4e5f\u53ef\u4ee5\u9009\u62e9\u76f4\u63a5 return true\uff09\n        return false;\n    }\n}\n</code></pre> <p>\u5b9e\u9a8c\u6b65\u9aa4\uff1a</p> <ol> <li>\u90e8\u7f72 Logic \u5408\u7ea6\uff0c\u8c03\u7528 setValue(123)\uff0c\u6b64\u65f6 Logic.value = 123</li> <li>\u90e8\u7f72 Caller \u5408\u7ea6</li> <li>\u8c03\u7528 Caller.callSetValue(Logic\u5730\u5740, 456)</li> <li>\u8c03\u7528 Caller.delegateSetValue(Logic\u5730\u5740, 789)</li> </ol> <p>\u9884\u671f\u7ed3\u679c\uff1a</p> \u64cd\u4f5c Logic.value Caller.value ValueChanged \u4e8b\u4ef6\u6765\u6e90 \u521d\u59cb 123 0 - callSetValue(456) 456 0 Logic \u5408\u7ea6 delegateSetValue(789) 456\uff08\u4e0d\u53d8\uff09 789 Caller \u5408\u7ea6 <p>\u8c03\u7528 callSetValue \u540e\uff0cLogic.value \u53d8\u6210 456\uff0c\u4e8b\u4ef6\u4ece Logic \u5408\u7ea6\u53d1\u51fa\uff1a</p> <p></p> <p>\u8c03\u7528 delegateSetValue \u540e\uff0cLogic.value \u4e0d\u53d8\uff0c\u4f46 Caller.value \u53d8\u6210 789\uff0c\u4e8b\u4ef6\u4ece Caller \u5408\u7ea6\u53d1\u51fa\uff1a</p> <p></p>"},{"location":"web3/dapp/solidity_proxy_upgrade_series_part1/#bug","title":"\u5b58\u50a8\u69fd\u51b2\u7a81\uff1a\u4e00\u4e2a\u707e\u96be\u6027\u7684 bug","text":"<p>delegatecall \u6709\u4e00\u4e2a\u5173\u952e\u7ec6\u8282\uff1a\u5b83\u6309\u5b58\u50a8\u69fd\u4f4d\u7f6e\u64cd\u4f5c\uff0c\u800c\u975e\u53d8\u91cf\u540d\u79f0\u3002</p> <p>\u770b\u8fd9\u4e2a\u6709\u95ee\u9898\u7684\u4f8b\u5b50\uff1a</p> <pre><code>contract Called {\n    uint256 public number;  // slot 0\n\n    function increment() public {\n        number++;\n    }\n}\n\ncontract Caller {\n    address public implementation;  // slot 0  \u2190 \u5371\u9669\uff01\n    uint256 public myNumber;        // slot 1\n\n    function callIncrement() public {\n        implementation.delegatecall(\n            abi.encodeWithSignature(\"increment()\")\n        );\n    }\n}\n</code></pre> <p>\u95ee\u9898\u5728\u4e8e\uff1aCalled.number \u548c Caller.implementation \u90fd\u5728 slot 0\u3002</p> <p>\u5f53\u6267\u884c increment() \u65f6\uff0c\u5b83\u4f1a\u9012\u589e slot 0 \u7684\u503c\u2014\u2014\u4f46\u5728 Caller \u4e2d\uff0cslot 0 \u5b58\u50a8\u7684\u662f implementation \u5730\u5740\uff0c\u800c\u4e0d\u662f <code>myNumber</code>\uff01</p> <p>\u7ed3\u679c\uff1a\u903b\u8f91\u5408\u7ea6\u5730\u5740\u88ab\u610f\u5916\u4fee\u6539\uff0c\u4ee3\u7406\u5408\u7ea6\u53ef\u80fd\u5f7b\u5e95\u635f\u574f\u3002</p>"},{"location":"web3/dapp/solidity_proxy_upgrade_series_part1/#_3","title":"\u5b58\u50a8\u69fd\u7684\u672c\u8d28","text":"<p>EVM \u7684\u5b58\u50a8\u662f\u4e00\u4e2a\u5de8\u5927\u7684 key-value \u6620\u5c04\uff1a</p> <ul> <li>key\uff1a0 \u5230 2\u00b2\u2075\u2076-1 \u7684\u6574\u6570\uff08\u5b58\u50a8\u69fd\u7f16\u53f7\uff09</li> <li>value\uff1a32 \u5b57\u8282\u7684\u6570\u636e</li> </ul> <p></p> <p>Solidity \u7f16\u8bd1\u5668\u9ed8\u8ba4\u4ece slot 0 \u5f00\u59cb\u5206\u914d\u53d8\u91cf\uff0c\u8fd9\u5c31\u662f\u51b2\u7a81\u7684\u6839\u6e90\u3002</p>"},{"location":"web3/dapp/solidity_proxy_upgrade_series_part1/#eip-1967","title":"\u89e3\u51b3\u65b9\u6848\uff1aEIP-1967","text":"<p>\u6838\u5fc3\u601d\u60f3\uff1a\u628a\u4ee3\u7406\u5408\u7ea6\u7684\u5173\u952e\u53d8\u91cf\u653e\u5230\u300c\u4e0d\u53ef\u80fd\u51b2\u7a81\u300d\u7684\u4f4d\u7f6e\u3002</p> <p>2\u00b2\u2075\u2076 \u662f\u4e00\u4e2a\u5929\u6587\u6570\u5b57\uff0c\u5982\u679c\u6211\u4eec\u968f\u673a\u9009\u4e00\u4e2a\u69fd\u4f4d\uff0c\u5b9e\u73b0\u5408\u7ea6\u51e0\u4e4e\u4e0d\u53ef\u80fd\u78b0\u5de7\u7528\u5230\u540c\u4e00\u4e2a\u69fd\u3002</p> <p>EIP-1967 \u5b9a\u4e49\u4e86\u4e24\u4e2a\u7279\u6b8a\u69fd\u4f4d\uff1a</p> <pre><code>// \u903b\u8f91\u5408\u7ea6\u5730\u5740\u5b58\u50a8\u69fd\nbytes32 constant IMPLEMENTATION_SLOT = \n    bytes32(uint256(keccak256(\"eip1967.proxy.implementation\")) - 1);\n// = 0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc\n\n// \u7ba1\u7406\u5458\u5730\u5740\u5b58\u50a8\u69fd  \nbytes32 constant ADMIN_SLOT = \n    bytes32(uint256(keccak256(\"eip1967.proxy.admin\")) - 1);\n// = 0xb53127684a568b3173ae13b9f8a6016e243e63b6e8ee1178d6a717850b5d6103\n</code></pre> <p>\u4e3a\u4ec0\u4e48\u8981\u51cf 1\uff1f</p> <p><code>keccak256(\"...\") - 1</code> \u7684\u8bbe\u8ba1\u5f88\u5de7\u5999\uff1a</p> <ul> <li><code>keccak256</code> \u751f\u6210\u4f2a\u968f\u673a\u6570</li> <li>\u51cf 1 \u4f7f\u5f97\u7ed3\u679c\u6ca1\u6709\u5df2\u77e5\u7684\u54c8\u5e0c\u539f\u50cf</li> </ul> <p>\u8fd9\u610f\u5473\u7740\u6ca1\u6709\u4efb\u4f55\u5408\u7ea6\u80fd\u901a\u8fc7 Solidity \u7684\u6b63\u5e38\u8bed\u6cd5\u300c\u7b97\u51fa\u300d\u8fd9\u4e2a\u69fd\u4f4d\u2014\u2014\u9664\u975e\u6545\u610f\u786c\u7f16\u7801\u3002</p> <p>EIP-1967 \u53ea\u89c4\u5b9a\u4e86\u4e24\u4ef6\u4e8b\uff1a</p> <ol> <li>\u5173\u952e\u53d8\u91cf\u5b58\u5728\u54ea\u91cc</li> <li>\u53d8\u91cf\u53d8\u5316\u65f6\u53d1\u51fa\u4ec0\u4e48\u4e8b\u4ef6</li> </ol> <p>\u5b83\u4e0d\u89c4\u5b9a\uff1a\u8c01\u80fd\u4fee\u6539\u8fd9\u4e9b\u53d8\u91cf\u3001\u5982\u4f55\u5347\u7ea7\u5408\u7ea6\u3001\u5982\u4f55\u5904\u7406\u51fd\u6570\u9009\u62e9\u5668\u51b2\u7a81\u3002\u8fd9\u4e9b\u95ee\u9898\u7531\u5176\u4ed6\u6807\u51c6\u89e3\u51b3\uff08\u900f\u660e\u4ee3\u7406\u3001UUPS \u7b49\uff09\u3002</p> <p>Etherscan \u5982\u4f55\u8bc6\u522b\u4ee3\u7406\uff1f</p> <p>\u5f53 Etherscan \u68c0\u6d4b\u5230\u5408\u7ea6\u5728 EIP-1967 \u69fd\u4f4d\u5b58\u6709\u975e\u96f6\u503c\u65f6\uff0c\u5b83\u4f1a\uff1a</p> <ol> <li>\u6807\u8bb0\u8be5\u5408\u7ea6\u4e3a\u4ee3\u7406\u5408\u7ea6</li> <li>\u663e\u793a\u5b9e\u73b0\u5408\u7ea6\u5730\u5740</li> <li>\u63d0\u4f9b\u300cRead as Proxy\u300d\u548c\u300cWrite as Proxy\u300d\u9009\u9879</li> </ol> <p>\u8fd9\u5c31\u662f EIP-1967 \u5e26\u6765\u7684\u6807\u51c6\u5316\u597d\u5904\u2014\u2014\u5de5\u5177\u94fe\u53ef\u4ee5\u81ea\u52a8\u8bc6\u522b\u4ee3\u7406\u6a21\u5f0f\u3002</p>"},{"location":"web3/dapp/solidity_proxy_upgrade_series_part1/#_4","title":"\u4e00\u4e2a\u6700\u7b80\u4ee3\u7406\u5408\u7ea6","text":"<p>\u7406\u89e3\u4e86\u539f\u7406\uff0c\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u57fa\u7840\u5b9e\u73b0\uff1a</p> <p>SimpleProxy.sol\uff1a</p> <pre><code>// SPDX-License-Identifier: MIT\npragma solidity ^0.8.20;\n\ncontract SimpleProxy {\n    bytes32 private constant IMPLEMENTATION_SLOT = \n        0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc;\n\n    constructor(address _implementation) {\n        assembly {\n            sstore(IMPLEMENTATION_SLOT, _implementation)\n        }\n    }\n\n    fallback(bytes calldata data) external payable returns (bytes memory) {\n        address impl;\n        assembly {\n            impl := sload(IMPLEMENTATION_SLOT)\n        }\n\n        (bool success, bytes memory result) = impl.delegatecall(data);\n        require(success, \"Delegatecall failed\");\n        return result;\n    }\n}\n</code></pre> <p>User.sol - \u6a21\u62df\u7528\u6237\u8c03\u7528\u6d41\u7a0b\u6838\u5fc3\u4ee3\u7801\uff1a</p> <pre><code>// SPDX-License-Identifier: MIT\npragma solidity ^0.8.28;\n\n/// @notice \u7528 Logic \u7684 ABI \u53bb\u8c03\u7528 Proxy\ninterface ILogic {\n    function setValue(uint256 newValue) external returns (bool);\n    function value() external view returns (uint256);\n}\n\n/// @notice \u6a21\u62df\u5b8c\u6574\u7684\u4ee3\u7406\u8c03\u7528\u6d41\u7a0b\ncontract User {\n    /// @notice \u6f14\u793a\uff1a\u7528\u6237 -&gt; Proxy -&gt; delegatecall -&gt; Logic \u4ee3\u7801 -&gt; \u5199 Proxy \u5b58\u50a8\n    function demo(address proxy, address logic, uint256 newValue) \n        public\n        returns (uint256 proxyValue, uint256 logicValue, bool success)\n    {\n        // \u901a\u8fc7 Proxy \u8c03\u7528 setValue\uff08\u4f1a\u89e6\u53d1 fallback -&gt; delegatecall\uff09\n        success = ILogic(proxy).setValue(newValue);\n\n        // \u8bfb\u53d6 Proxy \u7684 value\uff08delegatecall \u5199\u5165\u7684\u662f Proxy \u7684\u5b58\u50a8\uff09\n        proxyValue = ILogic(proxy).value();\n\n        // \u5bf9\u6bd4 Logic \u81ea\u8eab\u7684 value\uff08\u5e94\u8be5\u4e0d\u53d8\uff09\n        logicValue = ILogic(logic).value();\n    }\n}\n</code></pre> <p>\u5b8c\u6574\u4ee3\u7801\u5730\u5740\uff1a\u6700\u7b80\u4ee3\u7406\u5408\u7ea6\u6f14\u793a\u7a0b\u5e8f</p> <p>\u5de5\u4f5c\u6d41\u7a0b\uff1a</p> <ol> <li>\u7528\u6237\u8c03\u7528\u4ee3\u7406\u5408\u7ea6\u7684\u67d0\u4e2a\u51fd\u6570\uff08\u5982 <code>setValue()</code>\uff09</li> <li>\u4ee3\u7406\u5408\u7ea6\u6ca1\u6709\u8fd9\u4e2a\u51fd\u6570\uff0c\u89e6\u53d1 <code>fallback</code></li> <li><code>fallback</code> \u4ece EIP-1967 \u5b58\u50a8\u69fd\u8bfb\u53d6\u903b\u8f91\u5408\u7ea6\u5730\u5740</li> <li>\u4f7f\u7528 <code>delegatecall</code> \u5c06\u8c03\u7528\u8f6c\u53d1\u7ed9\u903b\u8f91\u5408\u7ea6</li> <li>\u903b\u8f91\u5408\u7ea6\u7684\u4ee3\u7801\u5728\u4ee3\u7406\u5408\u7ea6\u7684\u5b58\u50a8\u4e0a\u6267\u884c</li> </ol>"},{"location":"web3/dapp/solidity_proxy_upgrade_series_part1/#_5","title":"\u5c0f\u7ed3","text":"<p>\u672c\u7bc7\u6211\u4eec\u4ecb\u7ecd\u4e86\uff1a</p> <ol> <li>\u4e3a\u4ec0\u4e48\u9700\u8981\u53ef\u5347\u7ea7\u5408\u7ea6\uff1a\u5e73\u8861\u4e0d\u53ef\u53d8\u6027\u4e0e\u53ef\u7ef4\u62a4\u6027</li> <li>delegatecall \u7684\u5de5\u4f5c\u539f\u7406\uff1a\u501f\u7528\u4ee3\u7801\uff0c\u672c\u5730\u6267\u884c</li> <li>\u5b58\u50a8\u69fd\u51b2\u7a81\u95ee\u9898\uff1a\u4ee5\u53ca EIP-1967 \u7684\u89e3\u51b3\u65b9\u6848</li> <li>\u6700\u7b80\u4ee3\u7406\u5408\u7ea6\uff1a\u57fa\u7840\u5b9e\u73b0\u6846\u67b6</li> </ol> <p>\u4f46\u8fd9\u4e2a\u7b80\u5355\u5b9e\u73b0\u8fd8\u6709\u4e00\u4e2a\u4e25\u91cd\u95ee\u9898\uff1a\u51fd\u6570\u9009\u62e9\u5668\u51b2\u7a81\uff08Function Selector Clash\uff09\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff1a\u5982\u679c\u4ee3\u7406\u5408\u7ea6\u6709\u4e00\u4e2a <code>upgrade()</code> \u51fd\u6570\u7528\u4e8e\u5347\u7ea7\uff0c\u800c\u903b\u8f91\u5408\u7ea6\u6070\u597d\u4e5f\u6709\u4e1a\u52a1\u51fd\u6570\u53eb <code>upgrade()</code>\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f\u7528\u6237\u8c03\u7528\u65f6\uff0cEVM \u4f1a\u4f18\u5148\u5339\u914d\u4ee3\u7406\u5408\u7ea6\u7684\u51fd\u6570\uff0c\u903b\u8f91\u5408\u7ea6\u7684\u540c\u540d\u51fd\u6570\u5c06\u6c38\u8fdc\u65e0\u6cd5\u88ab\u8c03\u7528\uff01</p> <p>\u4e0b\u4e00\u7bc7\uff0c\u6211\u4eec\u5c06\u6df1\u5165\u63a2\u8ba8\u4e24\u5927\u4e3b\u6d41\u4ee3\u7406\u6a21\u5f0f\uff1a\u900f\u660e\u4ee3\u7406\uff08Transparent Proxy\uff09\u548c UUPS\uff0c\u770b\u5b83\u4eec\u5982\u4f55\u4f18\u96c5\u5730\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002</p> <p>\u7cfb\u5217\u5bfc\u822a</p> <ul> <li>\u7b2c\u4e00\u7bc7\uff1aSolidity \u4ee3\u7406\u5408\u7ea6\u4e0e\u53ef\u5347\u7ea7\u5408\u7ea6\u7cfb\u5217\uff08\u4e00\uff09\uff1a\u4e3a\u4ec0\u4e48\u9700\u8981\u53ef\u5347\u7ea7\uff1f\uff08\u672c\u7bc7\uff09</li> <li>\u7b2c\u4e8c\u7bc7\uff1aSolidity \u4ee3\u7406\u5408\u7ea6\u4e0e\u53ef\u5347\u7ea7\u5408\u7ea6\u7cfb\u5217\uff08\u4e8c\uff09\uff1a\u900f\u660e\u4ee3\u7406 vs UUPS</li> </ul>"},{"location":"web3/dapp/solidity_proxy_upgrade_series_part2/","title":"\u4ee3\u7406\u5408\u7ea6\u4e0e\u53ef\u5347\u7ea7\u5408\u7ea6\u7cfb\u5217\uff08\u4e8c\uff09\uff1a\u900f\u660e\u4ee3\u7406 vs UUPS","text":"<p> \u7ea6 1695 \u4e2a\u5b57  77 \u884c\u4ee3\u7801  4 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 7 \u5206\u949f</p> <p>\u4e0a\u4e00\u7bc7\u6211\u4eec\u7406\u89e3\u4e86 delegatecall \u548c\u5b58\u50a8\u69fd\u51b2\u7a81\u95ee\u9898\u3002\u672c\u7bc7\u5c06\u6df1\u5165\u4e24\u5927\u4e3b\u6d41\u4ee3\u7406\u6a21\u5f0f\u3002</p>"},{"location":"web3/dapp/solidity_proxy_upgrade_series_part2/#_1","title":"\u51fd\u6570\u9009\u62e9\u5668\u51b2\u7a81","text":"<p>\u5728\u5b9e\u73b0\u53ef\u5347\u7ea7\u4ee3\u7406\u65f6\uff0c\u6211\u4eec\u9047\u5230\u4e86\u65b0\u95ee\u9898\u3002</p> <p>\u5047\u8bbe\u4ee3\u7406\u5408\u7ea6\u9700\u8981\u4e00\u4e2a <code>upgrade()</code> \u51fd\u6570\u6765\u66f4\u65b0\u903b\u8f91\u5408\u7ea6\u5730\u5740\uff1a</p> <pre><code>contract Proxy {\n    address public implementation;\n\n    function upgrade(address newImpl) public {\n        implementation = newImpl;\n    }\n\n    fallback() external payable {\n        // delegatecall to implementation\n    }\n}\n</code></pre> <p>\u95ee\u9898\u6765\u4e86\uff1a\u5982\u679c\u903b\u8f91\u5408\u7ea6\u4e5f\u6709\u4e00\u4e2a <code>upgrade()</code> \u51fd\u6570\u5462\uff1f</p> <pre><code>contract Implementation {\n    function upgrade(address) public {\n        // \u4e1a\u52a1\u903b\u8f91...\n    }\n}\n</code></pre> <p>\u5f53\u7528\u6237\u8c03\u7528 <code>upgrade()</code> \u65f6\uff0cEVM \u4f1a\u5148\u68c0\u67e5\u4ee3\u7406\u5408\u7ea6\u662f\u5426\u6709\u5339\u914d\u7684\u51fd\u6570\u3002\u5982\u679c\u6709\uff0c\u5c31\u76f4\u63a5\u6267\u884c\u4ee3\u7406\u5408\u7ea6\u7684\u51fd\u6570\uff0c\u6c38\u8fdc\u4e0d\u4f1a\u89e6\u53d1 fallback\u3002</p> <p>\u7ed3\u679c\uff1a\u903b\u8f91\u5408\u7ea6\u7684 <code>upgrade()</code> \u51fd\u6570\u65e0\u6cd5\u88ab\u8c03\u7528\u3002</p> <p>\u66f4\u5371\u9669\u7684\u662f\uff1a\u4e0d\u540c\u51fd\u6570\u53ef\u80fd\u6709\u76f8\u540c\u7684\u51fd\u6570\u9009\u62e9\u5668\u3002\u51fd\u6570\u9009\u62e9\u5668\u53ea\u6709 4 \u5b57\u8282\uff0c\u5b58\u5728\u7ea6 1/43 \u4ebf\u7684\u78b0\u649e\u6982\u7387\u3002\u6bd4\u5982 <code>clash550254402()</code> \u548c <code>proxyAdmin()</code> \u7684\u9009\u62e9\u5668\u5b8c\u5168\u76f8\u540c\u3002</p>"},{"location":"web3/dapp/solidity_proxy_upgrade_series_part2/#transparent-proxy","title":"\u89e3\u51b3\u65b9\u6848\u4e00\uff1a\u900f\u660e\u4ee3\u7406\uff08Transparent Proxy\uff09","text":"<p>\u900f\u660e\u4ee3\u7406\u7684\u6838\u5fc3\u601d\u8def\u5f88\u7b80\u5355\uff1a\u4ee3\u7406\u5408\u7ea6\u9664\u4e86 fallback\uff0c\u4e0d\u66b4\u9732\u4efb\u4f55\u516c\u5f00\u51fd\u6570\u3002</p> <p>\u4f46\u6ca1\u6709\u516c\u5f00\u51fd\u6570\uff0c\u600e\u4e48\u5347\u7ea7\uff1f\u7b54\u6848\u662f\uff1a\u901a\u8fc7 msg.sender \u6765\u533a\u5206\u8c03\u7528\u8005\u3002</p> <p></p> <p>\u4e3a\u4ec0\u4e48\u53eb\u300c\u900f\u660e\u300d\uff1f</p> <p>\u5bf9\u4e8e\u666e\u901a\u7528\u6237\u6765\u8bf4\uff0c\u4ee3\u7406\u5408\u7ea6\u662f\u300c\u900f\u660e\u300d\u7684\u2014\u2014\u4ed6\u4eec\u770b\u4e0d\u5230\u4efb\u4f55\u4ee3\u7406\u76f8\u5173\u7684\u51fd\u6570\uff0c\u6240\u6709\u8c03\u7528\u90fd\u4f1a\u88ab\u8f6c\u53d1\u3002\u4ee3\u7406\u5408\u7ea6\u7684\u7ba1\u7406\u529f\u80fd\u53ea\u5bf9\u7ba1\u7406\u5458\u300c\u53ef\u89c1\u300d\u3002</p> <pre><code>contract TransparentProxy {\n    address immutable admin;\n\n    constructor(address _admin) {\n        admin = _admin;\n    }\n\n    fallback() external payable {\n        if (msg.sender == admin) {\n            // \u6267\u884c\u5347\u7ea7\u903b\u8f91\n        } else {\n            // delegatecall \u5230\u903b\u8f91\u5408\u7ea6\n        }\n    }\n}\n</code></pre> <p>\u89c4\u5219\uff1a - admin \u8c03\u7528\uff1a\u8def\u7531\u5230\u5347\u7ea7\u903b\u8f91 - \u666e\u901a\u7528\u6237\u8c03\u7528\uff1a\u8def\u7531\u5230\u903b\u8f91\u5408\u7ea6</p> <p>\u8fd9\u5b8c\u5168\u6d88\u9664\u4e86\u51fd\u6570\u9009\u62e9\u5668\u51b2\u7a81\u2014\u2014\u56e0\u4e3a\u4ee3\u7406\u5408\u7ea6\u6839\u672c\u6ca1\u6709\u516c\u5f00\u51fd\u6570\u3002</p>"},{"location":"web3/dapp/solidity_proxy_upgrade_series_part2/#openzeppelin","title":"OpenZeppelin \u7684\u5b9e\u73b0\u7ed3\u6784","text":"<p>\u4f46\u4e0a\u8ff0\u8bbe\u8ba1\u6709\u4e2a\u95ee\u9898\uff1aadmin \u65e0\u6cd5\u76f4\u63a5\u4f7f\u7528\u5408\u7ea6\u529f\u80fd\uff0c\u56e0\u4e3a\u5b83\u7684\u8c03\u7528\u4f1a\u88ab\u8def\u7531\u5230\u5347\u7ea7\u903b\u8f91\u3002</p> <p>OpenZeppelin \u7684\u89e3\u51b3\u65b9\u6848\u662f\u5f15\u5165 ProxyAdmin \u5408\u7ea6\uff1a</p> <p></p> <ul> <li>\u4ee3\u7406\u5408\u7ea6\u7684 admin \u662f ProxyAdmin \u5408\u7ea6\uff08\u5730\u5740\u56fa\u5b9a\uff09</li> <li>ProxyAdmin \u7684 owner \u662f\u771f\u6b63\u7684\u7ba1\u7406\u5458</li> <li>owner \u901a\u8fc7 ProxyAdmin \u95f4\u63a5\u5347\u7ea7\u4ee3\u7406</li> <li>owner \u4e5f\u53ef\u4ee5\u76f4\u63a5\u8c03\u7528\u4ee3\u7406\u4f7f\u7528\u5408\u7ea6\u529f\u80fd\uff08\u56e0\u4e3a msg.sender \u662f owner\uff0c\u4e0d\u662f admin\uff09</li> </ul> <p>OpenZeppelin \u5408\u7ea6\u7ee7\u627f\u7ed3\u6784\uff1a</p> <pre><code>Proxy.sol (\u62bd\u8c61\u57fa\u7c7b)\n    \u2502\n    \u2514\u2500\u2500 ERC1967Proxy.sol (\u5b9e\u73b0 EIP-1967 \u69fd\u4f4d)\n            \u2502\n            \u2514\u2500\u2500 TransparentUpgradeableProxy.sol\n                    \u2502\n                    \u2514\u2500\u2500 \u914d\u5408 ProxyAdmin.sol \u4f7f\u7528\n</code></pre> <pre><code>contract ProxyAdmin {\n    address public owner;\n\n    function upgradeAndCall(\n        ITransparentUpgradeableProxy proxy,\n        address implementation,\n        bytes memory data\n    ) public onlyOwner {\n        proxy.upgradeToAndCall(implementation, data);\n    }\n}\n</code></pre> <p>\u5173\u952e\u8bbe\u8ba1\uff1a</p> <ul> <li>\u4ee3\u7406\u5408\u7ea6\u53ea\u6709 <code>fallback()</code> \u51fd\u6570</li> <li>\u6240\u6709\u7ba1\u7406\u529f\u80fd\u901a\u8fc7 ProxyAdmin \u8c03\u7528</li> <li>\u7ba1\u7406\u5458\u5730\u5740\u5b58\u50a8\u5728 EIP-1967 \u69fd\u4f4d</li> </ul> <p>\u4f18\u70b9\uff1a</p> <ul> <li>\u5f7b\u5e95\u6d88\u9664\u51fd\u6570\u9009\u62e9\u5668\u51b2\u7a81</li> <li>\u5347\u7ea7\u903b\u8f91\u5728\u4ee3\u7406\u5408\u7ea6\u4e2d\uff0c\u903b\u8f91\u5408\u7ea6\u4e0d\u9700\u8981\u5305\u542b\u5347\u7ea7\u4ee3\u7801</li> </ul> <p>\u7f3a\u70b9\uff1a</p> <ul> <li>\u9700\u8981\u989d\u5916\u90e8\u7f72 ProxyAdmin \u5408\u7ea6</li> <li>\u6bcf\u6b21\u8c03\u7528\u90fd\u8981\u68c0\u67e5 <code>msg.sender == admin</code>\uff0c\u589e\u52a0 gas \u6d88\u8017</li> </ul>"},{"location":"web3/dapp/solidity_proxy_upgrade_series_part2/#uups","title":"\u89e3\u51b3\u65b9\u6848\u4e8c\uff1aUUPS\uff08\u901a\u7528\u53ef\u5347\u7ea7\u4ee3\u7406\u6807\u51c6\uff09","text":"<p>UUPS\uff08ERC-1822\uff09\u91c7\u7528\u4e86\u4e0d\u540c\u7684\u7b56\u7565\uff1a\u628a\u5347\u7ea7\u903b\u8f91\u653e\u5728\u903b\u8f91\u5408\u7ea6\u4e2d\u3002</p> <p></p>"},{"location":"web3/dapp/solidity_proxy_upgrade_series_part2/#_2","title":"\u5347\u7ea7\u662f\u5982\u4f55\u5de5\u4f5c\u7684\uff1f","text":"<p>UUPS \u7684\u5347\u7ea7\u8fc7\u7a0b\uff1a</p> <ol> <li>\u7ba1\u7406\u5458\u8c03\u7528 Proxy \u7684 <code>upgradeTo(newImpl)</code></li> <li>Proxy \u901a\u8fc7 <code>fallback()</code> \u5c06\u8c03\u7528 delegatecall \u7ed9\u5f53\u524d\u5b9e\u73b0\u5408\u7ea6</li> <li>\u5b9e\u73b0\u5408\u7ea6\u7684 <code>upgradeTo()</code> \u88ab\u6267\u884c</li> <li>\u7531\u4e8e\u662f delegatecall\uff0c\u4fee\u6539\u7684\u662f Proxy \u7684\u5b58\u50a8</li> <li>Proxy \u7684\u5b9e\u73b0\u5730\u5740\u88ab\u66f4\u65b0\u4e3a <code>newImpl</code></li> </ol> <pre><code>Admin \u2500\u2500upgradeTo(V2)\u2500\u2500\u25ba Proxy \u2500delegatecall\u2500\u25ba Impl V1\n                           \u2502                      \u2502\n                           \u2502    upgradeTo() \u4fee\u6539   \u2502\n                           \u2502    Proxy \u7684\u5b58\u50a8       \u2502\n                           \u25bc                      \u2502\n                    implementation = V2  \u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"web3/dapp/solidity_proxy_upgrade_series_part2/#_3","title":"\u4ee3\u7801\u7ed3\u6784","text":"<p>\u4ee3\u7406\u5408\u7ea6\u6781\u5176\u7b80\u5355\uff1a</p> <pre><code>contract UUPSProxy {\n    constructor(address _implementation) {\n        assembly {\n            sstore(\n                0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc,\n                _implementation\n            )\n        }\n    }\n\n    fallback() external payable {\n        // \u8bfb\u53d6\u5b9e\u73b0\u5730\u5740\u5e76 delegatecall\n    }\n}\n</code></pre> <p>\u903b\u8f91\u5408\u7ea6\u9700\u8981\u7ee7\u627f OpenZeppelin \u7684 <code>UUPSUpgradeable</code>\uff1a</p> <pre><code>import \"@openzeppelin/contracts-upgradeable/proxy/utils/UUPSUpgradeable.sol\";\n\ncontract MyContract is UUPSUpgradeable {\n    // \u4e1a\u52a1\u903b\u8f91...\n\n    function _authorizeUpgrade(address newImplementation) \n        internal \n        override \n        onlyOwner \n    {}\n}\n</code></pre>"},{"location":"web3/dapp/solidity_proxy_upgrade_series_part2/#proxiableuuid","title":"proxiableUUID\uff1a\u5b89\u5168\u68c0\u67e5","text":"<p>UUPS \u6709\u4e2a\u5de7\u5999\u7684\u5b89\u5168\u673a\u5236\uff1a\u5347\u7ea7\u524d\u4f1a\u68c0\u67e5\u65b0\u5408\u7ea6\u662f\u5426\u517c\u5bb9\u3002</p> <pre><code>function proxiableUUID() external view returns (bytes32) {\n    return IMPLEMENTATION_SLOT;\n}\n</code></pre> <p>\u5347\u7ea7\u65f6\uff0c\u4f1a\u8c03\u7528\u65b0\u5408\u7ea6\u7684 <code>proxiableUUID()</code>\uff1a - \u5982\u679c\u8fd4\u56de\u6b63\u786e\u7684\u5b58\u50a8\u69fd\u5730\u5740\uff0c\u8bf4\u660e\u65b0\u5408\u7ea6\u662f UUPS \u517c\u5bb9\u7684 - \u5982\u679c\u8c03\u7528\u5931\u8d25\u6216\u8fd4\u56de\u503c\u9519\u8bef\uff0c\u5347\u7ea7\u88ab\u62d2\u7edd</p> <p>\u8fd9\u9632\u6b62\u4e86\u610f\u5916\u5347\u7ea7\u5230\u4e00\u4e2a\u6ca1\u6709\u5347\u7ea7\u80fd\u529b\u7684\u5408\u7ea6\u2014\u2014\u90a3\u5c06\u5bfc\u81f4\u5408\u7ea6\u6c38\u8fdc\u65e0\u6cd5\u518d\u5347\u7ea7\u3002</p>"},{"location":"web3/dapp/solidity_proxy_upgrade_series_part2/#uups_1","title":"UUPS \u7684\u98ce\u9669","text":"<p>\u98ce\u9669\u4e00\uff1a\u5fd8\u8bb0\u5b9e\u73b0\u5347\u7ea7\u51fd\u6570</p> <p>\u5982\u679c\u65b0\u7248\u672c\u7684\u5b9e\u73b0\u5408\u7ea6\u6ca1\u6709 <code>upgradeTo()</code> \u51fd\u6570\uff0c\u5408\u7ea6\u5c06\u6c38\u4e45\u5931\u53bb\u5347\u7ea7\u80fd\u529b\uff1a</p> <pre><code>// \u274c \u707e\u96be\uff1a\u5fd8\u4e86\u7ee7\u627f UUPSUpgradeable\ncontract ImplV2 {\n    // \u6ca1\u6709 upgradeTo() \u51fd\u6570 \u2192 \u6c38\u8fdc\u65e0\u6cd5\u518d\u5347\u7ea7\uff01\n}\n</code></pre> <p>\u9632\u62a4\u63aa\u65bd\uff1aOpenZeppelin \u8981\u6c42\u5b9e\u73b0\u5408\u7ea6\u7ee7\u627f <code>UUPSUpgradeable</code>\uff0c\u5e76\u5b9e\u73b0 <code>_authorizeUpgrade()</code> \u94a9\u5b50\u3002</p> <p>\u98ce\u9669\u4e8c\uff1a\u672a\u521d\u59cb\u5316\u7684\u5b9e\u73b0\u5408\u7ea6</p> <p>\u5982\u679c\u6709\u4eba\u76f4\u63a5\u8c03\u7528\u5b9e\u73b0\u5408\u7ea6\u7684 <code>initialize()</code>\uff0c\u4ed6\u53ef\u4ee5\u6210\u4e3a\u5b9e\u73b0\u5408\u7ea6\u7684 owner\uff0c\u7136\u540e\u8c03\u7528 <code>upgradeTo()</code> \u6307\u5411\u4e00\u4e2a\u5305\u542b <code>selfdestruct</code> \u7684\u5408\u7ea6\u3002\u8fd9\u66fe\u7ecf\u662f\u771f\u5b9e\u7684\u653b\u51fb\u5411\u91cf\uff08Wormhole \u4e8b\u4ef6\uff09\u3002</p> <p>\u9632\u62a4\uff1a\u5728\u6784\u9020\u51fd\u6570\u4e2d\u8c03\u7528 <code>_disableInitializers()</code>\uff1a</p> <pre><code>constructor() {\n    _disableInitializers();\n}\n</code></pre>"},{"location":"web3/dapp/solidity_proxy_upgrade_series_part2/#vs-uups","title":"\u900f\u660e\u4ee3\u7406 vs UUPS\uff1a\u5982\u4f55\u9009\u62e9\uff1f","text":"\u7279\u6027 \u900f\u660e\u4ee3\u7406 UUPS \u5347\u7ea7\u903b\u8f91\u4f4d\u7f6e \u4ee3\u7406\u5408\u7ea6 \u903b\u8f91\u5408\u7ea6 Gas \u6210\u672c \u8f83\u9ad8\uff08\u6bcf\u6b21\u68c0\u67e5 admin\uff09 \u8f83\u4f4e \u4ee3\u7406\u5408\u7ea6\u5927\u5c0f \u8f83\u5927 \u6700\u5c0f \u903b\u8f91\u5408\u7ea6\u5927\u5c0f \u8f83\u5c0f \u8f83\u5927\uff08\u542b\u5347\u7ea7\u4ee3\u7801\uff09 \u98ce\u9669 \u8f83\u4f4e \u8f83\u9ad8\uff08\u53ef\u80fd\u4e22\u5931\u5347\u7ea7\u80fd\u529b\uff09 \u9002\u7528\u573a\u666f \u901a\u7528\u573a\u666f\u3001\u5b89\u5168\u4f18\u5148 \u9ad8\u9891\u8c03\u7528\u3001gas \u654f\u611f <p>\u9009\u62e9\u5efa\u8bae\uff1a</p> <ul> <li>\u903b\u8f91\u5408\u7ea6\u63a5\u8fd1 24KB \u9650\u5236 \u2192 \u900f\u660e\u4ee3\u7406</li> <li>\u9700\u8981\u6781\u81f4 gas \u4f18\u5316 \u2192 UUPS</li> <li>\u8ffd\u6c42\u7b80\u5355\u5b89\u5168 \u2192 \u900f\u660e\u4ee3\u7406</li> </ul> <p>OpenZeppelin \u5f53\u524d\u63a8\u8350\u4f7f\u7528 UUPS\uff0c\u56e0\u4e3a\u5b83\u66f4\u8f7b\u91cf\u4e14\u7075\u6d3b\u3002</p>"},{"location":"web3/dapp/solidity_proxy_upgrade_series_part2/#_4","title":"\u67b6\u6784\u5bf9\u6bd4\u56fe","text":""},{"location":"web3/dapp/solidity_proxy_upgrade_series_part2/#_5","title":"\u5176\u4ed6\u4ee3\u7406\u6a21\u5f0f\u7b80\u4ecb","text":"<p>\u9664\u4e86\u900f\u660e\u4ee3\u7406\u548c UUPS\uff0c\u8fd8\u6709\u51e0\u79cd\u5e38\u89c1\u6a21\u5f0f\uff0c\u8fd9\u91cc\u7b80\u5355\u4e86\u89e3\u5373\u53ef\uff1a</p>"},{"location":"web3/dapp/solidity_proxy_upgrade_series_part2/#beacon-proxy","title":"Beacon Proxy","text":"<p>\u591a\u4e2a\u4ee3\u7406\u5171\u4eab\u540c\u4e00\u4e2a\u903b\u8f91\u5408\u7ea6\u5730\u5740\uff0c\u901a\u8fc7 Beacon \u5408\u7ea6\u7edf\u4e00\u7ba1\u7406\u3002\u66f4\u65b0 Beacon \u4e00\u6b21\uff0c\u6240\u6709\u4ee3\u7406\u540c\u65f6\u5347\u7ea7\u3002</p> <p>\u9002\u7528\u573a\u666f\uff1a\u9700\u8981\u6279\u91cf\u90e8\u7f72\u548c\u6279\u91cf\u5347\u7ea7\uff0c\u5982 NFT \u5de5\u5382\u3002</p>"},{"location":"web3/dapp/solidity_proxy_upgrade_series_part2/#diamond-proxyeip-2535","title":"Diamond Proxy\uff08EIP-2535\uff09","text":"<p>\u4e00\u4e2a\u4ee3\u7406\u53ef\u4ee5\u6307\u5411\u591a\u4e2a\u903b\u8f91\u5408\u7ea6\uff0c\u901a\u8fc7\u51fd\u6570\u9009\u62e9\u5668\u8def\u7531\u5230\u4e0d\u540c\u7684 Facet\u3002</p> <p>\u9002\u7528\u573a\u666f\uff1a\u8d85\u5927\u578b\u5408\u7ea6\uff0c\u9700\u8981\u7a81\u7834 24KB \u9650\u5236\u3002</p>"},{"location":"web3/dapp/solidity_proxy_upgrade_series_part2/#minimal-proxyeip-1167","title":"Minimal Proxy\uff08EIP-1167\uff09","text":"<p>\u6781\u7b80\u514b\u9686\u6a21\u5f0f\uff0c\u6240\u6709\u514b\u9686\u5171\u4eab\u540c\u4e00\u4efd\u903b\u8f91\u4ee3\u7801\uff0c\u90e8\u7f72\u6210\u672c\u6781\u4f4e\uff08\u7ea6 45 \u5b57\u8282\uff09\uff0c\u4f46\u4e0d\u53ef\u5347\u7ea7\u3002</p> <p>\u9002\u7528\u573a\u666f\uff1a\u9700\u8981\u5927\u91cf\u90e8\u7f72\u76f8\u540c\u903b\u8f91\u7684\u5408\u7ea6\uff0c\u5982\u7528\u6237\u94b1\u5305\u3002</p>"},{"location":"web3/dapp/solidity_proxy_upgrade_series_part2/#_6","title":"\u5c0f\u7ed3","text":"<p>\u672c\u7bc7\u6211\u4eec\u5b66\u4e60\u4e86\uff1a</p> <ol> <li>\u51fd\u6570\u9009\u62e9\u5668\u51b2\u7a81\u95ee\u9898\uff1a\u4ee3\u7406\u5408\u7ea6\u7684\u516c\u5f00\u51fd\u6570\u4f1a\u906e\u853d\u903b\u8f91\u5408\u7ea6\u7684\u540c\u540d\u51fd\u6570</li> <li>\u900f\u660e\u4ee3\u7406\uff1a\u901a\u8fc7\u68c0\u67e5 msg.sender \u533a\u5206\u8c03\u7528\u8005\uff0c\u6d88\u9664\u51b2\u7a81</li> <li>UUPS\uff1a\u5c06\u5347\u7ea7\u903b\u8f91\u653e\u5165\u903b\u8f91\u5408\u7ea6\uff0c\u4ee3\u7406\u5408\u7ea6\u6781\u7b80\u5316</li> <li>\u5982\u4f55\u9009\u62e9\uff1a\u6839\u636e gas \u4f18\u5316\u9700\u6c42\u3001\u5408\u7ea6\u5927\u5c0f\u9650\u5236\u3001\u5b89\u5168\u6027\u9700\u6c42\u51b3\u5b9a</li> <li>\u5176\u4ed6\u4ee3\u7406\u6a21\u5f0f\uff1aBeacon\u3001Diamond\u3001Minimal Proxy</li> </ol> <p>\u6700\u540e\u7684\u5efa\u8bae\uff1a</p> <p>\u53ef\u5347\u7ea7\u5408\u7ea6\u662f\u4e00\u628a\u53cc\u5203\u5251\u3002\u5b83\u89e3\u51b3\u4e86\u4e0d\u53ef\u53d8\u6027\u7684\u56f0\u5883\uff0c\u4f46\u4e5f\u5f15\u5165\u4e86\u65b0\u7684\u4fe1\u4efb\u5047\u8bbe\u548c\u5b89\u5168\u98ce\u9669\u3002</p> <p>\u5728\u4f7f\u7528\u53ef\u5347\u7ea7\u6a21\u5f0f\u524d\uff0c\u8bf7\u8ba4\u771f\u601d\u8003\uff1a</p> <ul> <li>\u4f60\u7684\u5408\u7ea6\u771f\u7684\u9700\u8981\u5347\u7ea7\u80fd\u529b\u5417\uff1f</li> <li>\u7528\u6237\u662f\u5426\u4fe1\u4efb\u4f60\uff08\u6216 DAO\uff09\u4e0d\u4f1a\u6076\u610f\u5347\u7ea7\uff1f</li> <li>\u4f60\u662f\u5426\u6709\u5b8c\u5584\u7684\u5347\u7ea7\u6cbb\u7406\u6d41\u7a0b\uff1f</li> </ul> <p>\u5982\u679c\u7b54\u6848\u90fd\u662f\u80af\u5b9a\u7684\uff0c\u90a3\u4e48\u8bf7\u9009\u62e9\u9002\u5408\u7684\u6a21\u5f0f\uff0c\u9075\u5faa\u6700\u4f73\u5b9e\u8df5\uff0c\u8ba9\u53ef\u5347\u7ea7\u6027\u6210\u4e3a\u4f60\u7684\u4f18\u52bf\u800c\u975e\u8d1f\u62c5\u3002</p> <p>\u53c2\u8003\u8d44\u6599</p> <ul> <li>RareSkills: Book of Proxy Patterns</li> <li>Ethereum.org: \u5347\u7ea7\u667a\u80fd\u5408\u7ea6</li> <li>OpenZeppelin Upgrades Plugins</li> <li>EIP-1967: Standard Proxy Storage Slots</li> <li>EIP-1822: Universal Upgradeable Proxy Standard</li> </ul> <p>\u7cfb\u5217\u5bfc\u822a</p> <ul> <li>\u7b2c\u4e00\u7bc7\uff1aSolidity \u4ee3\u7406\u5408\u7ea6\u4e0e\u53ef\u5347\u7ea7\u5408\u7ea6\u7cfb\u5217\uff08\u4e00\uff09\uff1a\u4e3a\u4ec0\u4e48\u9700\u8981\u53ef\u5347\u7ea7\uff1f</li> <li>\u7b2c\u4e8c\u7bc7\uff1aSolidity \u4ee3\u7406\u5408\u7ea6\u4e0e\u53ef\u5347\u7ea7\u5408\u7ea6\u7cfb\u5217\uff08\u4e8c\uff09\uff1a\u900f\u660e\u4ee3\u7406 vs UUPS\uff08\u672c\u7bc7\uff09</li> </ul>"},{"location":"web3/defi/flash_loan_attack_260101/","title":"\u95ea\u7535\u8d37\uff1a\u4ece\u539f\u7406\u5230\u653b\u51fb\u6f14\u793a","text":"<p> \u7ea6 1399 \u4e2a\u5b57  49 \u884c\u4ee3\u7801  3 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 5 \u5206\u949f</p> <p>2020 \u5e74 2 \u6708\uff0c\u4e00\u4e2a\u533f\u540d\u653b\u51fb\u8005\u7528 0 \u672c\u91d1\uff0c\u5728 13 \u79d2\u5185\u4ece bZx \u534f\u8bae\"\u501f\"\u8d70\u4e86 35 \u4e07\u7f8e\u5143\u3002\u4ed6\u662f\u600e\u4e48\u505a\u5230\u7684\uff1f\u7b54\u6848\u662f\uff1a\u95ea\u7535\u8d37\u3002</p> <p>\u672c\u6587\u5c06\u5e26\u4f60\u4ece\u96f6\u7406\u89e3\u95ea\u7535\u8d37\uff0c\u5e76\u4eb2\u624b\u590d\u73b0\u4e00\u6b21\u653b\u51fb\u3002</p> <p>\u9605\u8bfb\u8def\u7ebf\uff1a\u6982\u5ff5 \u2192 \u6e90\u7801 \u2192 \u653b\u51fb\u6f14\u793a \u2192 \u9632\u5fa1\u65b9\u6848</p>"},{"location":"web3/defi/flash_loan_attack_260101/#_1","title":"\u4e00\u3001\u95ea\u7535\u8d37\u662f\u4ec0\u4e48\uff1f","text":"<p>\u4e00\u53e5\u8bdd\u5b9a\u4e49\uff1a\u95ea\u7535\u8d37 = \u65e0\u62b5\u62bc\u501f\u6b3e + \u540c\u4e00\u4ea4\u6613\u5185\u8fd8\u6b3e\u3002</p> <p>\u4f60\u53ef\u4ee5\u501f\u8d70\u6c60\u5b50\u91cc\u7684\u5168\u90e8\u8d44\u4ea7\uff0c\u53ea\u8981\u5728\u8fd9\u7b14\u4ea4\u6613\u7ed3\u675f\u524d\u8fd8\u56de\u6765\uff08\u5916\u52a0\u624b\u7eed\u8d39\uff09\uff0c\u5c31\u50cf\u4ec0\u4e48\u90fd\u6ca1\u53d1\u751f\u8fc7\u3002</p> <p>\u4f20\u7edf\u501f\u8d37 vs \u95ea\u7535\u8d37</p> \u5bf9\u6bd4\u9879 \u4f20\u7edf\u501f\u8d37 \u95ea\u7535\u8d37 \u62b5\u62bc\u54c1 \u5fc5\u987b \u4e0d\u9700\u8981 \u501f\u6b3e\u65f6\u957f \u51e0\u5929\u5230\u51e0\u5e74 \u7ea6 12 \u79d2\uff08\u4e00\u4e2a\u533a\u5757\uff09 \u4fe1\u7528\u5ba1\u6838 \u9700\u8981 \u4e0d\u9700\u8981 \u5931\u8d25\u540e\u679c \u4ea7\u751f\u503a\u52a1 \u4ea4\u6613\u56de\u6eda\uff0c\u65e0\u4efb\u4f55\u5f71\u54cd <p>\u4e3a\u4ec0\u4e48\u80fd\u65e0\u62b5\u62bc\uff1f</p> <p>\u4ee5\u592a\u574a\u4ea4\u6613\u5177\u6709\u539f\u5b50\u6027\uff1a\u8981\u4e48\u5168\u90e8\u6210\u529f\uff0c\u8981\u4e48\u5168\u90e8\u5931\u8d25\u3002</p> <p>\u501f\u4e86 100 \u4e07 DAI\uff0c\u505a\u4e86\u4e00\u7cfb\u5217\u64cd\u4f5c\uff0c\u6700\u540e\u8fd8\u4e0d\u4e0a\uff1f\u6574\u4e2a\u4ea4\u6613\u56de\u6eda\uff0c\u5c31\u50cf\u4f60\u4ece\u6ca1\u501f\u8fc7\u3002\u6280\u672f\u672c\u8eab\u5c31\u662f\u62c5\u4fdd\u3002</p>"},{"location":"web3/defi/flash_loan_attack_260101/#uniswap-v2","title":"\u4e8c\u3001Uniswap V2 \u5982\u4f55\u5b9e\u73b0\u95ea\u7535\u8d37\uff1f","text":"<p>\u4e00\u4e2a\u53cd\u76f4\u89c9\u7684\u4e8b\u5b9e\uff1a\u5728 Uniswap V2 \u4e2d\uff0c\u6240\u6709\u7684 swap \u672c\u8d28\u4e0a\u90fd\u662f\u95ea\u7535\u8d37\u3002</p> <ul> <li>\u666e\u901a\u4ea4\u6613\uff1a\u5148\u4ed8\u94b1 \u2192 \u518d\u6536\u8d27</li> <li>Uniswap V2\uff1a\u5148\u6536\u8d27 \u2192 \u518d\u4ed8\u94b1\uff08\u4e50\u89c2\u8f6c\u8d26\uff09</li> </ul> <p>\u65f6\u5e8f\u56fe</p> <p></p> <p>swap \u51fd\u6570\u6e90\u7801</p> <p>\u4ee5\u4e0b\u662f UniswapV2Pair.sol \u7684\u6838\u5fc3\u903b\u8f91\uff08\u6709\u7cbe\u7b80\uff09\uff1a</p> <pre><code>function swap(\n    uint amount0Out,    // \u501f\u51fa\u7684 token0 \u6570\u91cf\n    uint amount1Out,    // \u501f\u51fa\u7684 token1 \u6570\u91cf\n    address to,         // \u63a5\u6536\u5730\u5740\n    bytes calldata data // \u5173\u952e\uff1a\u8fd9\u4e2a\u53c2\u6570\u51b3\u5b9a\u662f\u5426\u89e6\u53d1\u56de\u8c03\n) external lock {\n    require(amount0Out &gt; 0 || amount1Out &gt; 0, \"INSUFFICIENT_OUTPUT_AMOUNT\");\n\n    (uint112 _reserve0, uint112 _reserve1,) = getReserves();\n    require(amount0Out &lt; _reserve0 &amp;&amp; amount1Out &lt; _reserve1, \"INSUFFICIENT_LIQUIDITY\");\n\n    // 1. \u4e50\u89c2\u8f6c\u8d26\uff1a\u5148\u628a\u4ee3\u5e01\u8f6c\u7ed9\u8c03\u7528\u8005\n    if (amount0Out &gt; 0) IERC20(token0).transfer(to, amount0Out);\n    if (amount1Out &gt; 0) IERC20(token1).transfer(to, amount1Out);\n\n    // 2. \u5982\u679c data \u975e\u7a7a\uff0c\u89e6\u53d1\u95ea\u7535\u8d37\u56de\u8c03\n    if (data.length &gt; 0) {\n        IUniswapV2Callee(to).uniswapV2Call(msg.sender, amount0Out, amount1Out, data);\n    }\n\n    // 3. \u83b7\u53d6\u56de\u8c03\u7ed3\u675f\u540e\u7684\u771f\u5b9e\u4f59\u989d\n    uint balance0 = IERC20(token0).balanceOf(address(this));\n    uint balance1 = IERC20(token1).balanceOf(address(this));\n\n    // 4. \u8ba1\u7b97\u5b9e\u9645\u8f6c\u5165\u91cf\uff08\u4f60\u5230\u5e95\u8fd8\u4e86\u591a\u5c11\uff1f\uff09\n    uint amount0In = balance0 &gt; _reserve0 - amount0Out ? balance0 - (_reserve0 - amount0Out) : 0;\n    uint amount1In = balance1 &gt; _reserve1 - amount1Out ? balance1 - (_reserve1 - amount1Out) : 0;\n    require(amount0In &gt; 0 || amount1In &gt; 0, \"INSUFFICIENT_INPUT_AMOUNT\");\n\n    // 5. K \u503c\u6821\u9a8c\uff08\u6263\u9664 0.3% \u624b\u7eed\u8d39\u540e\uff0c\u4e58\u79ef\u4e0d\u80fd\u53d8\u5c0f\uff09\n    uint balance0Adjusted = balance0 * 1000 - amount0In * 3;\n    uint balance1Adjusted = balance1 * 1000 - amount1In * 3;\n    require(balance0Adjusted * balance1Adjusted &gt;= uint(_reserve0) * uint(_reserve1) * 1000000, \"K\");\n\n    // 6. \u66f4\u65b0\u50a8\u5907\u91cf\n    _update();\n    emit Swap(msg.sender, amount0In, amount1In, amount0Out, amount1Out, to);\n}\n</code></pre> <p>\u5173\u952e\u70b9\u89e3\u91ca</p> <ol> <li>\u4e50\u89c2\u8f6c\u8d26\uff1a\u5148\u628a\u5e01\u8f6c\u7ed9\u4f60\uff0c\u8fd9\u5c31\u662f\"\u501f\"\u7684\u672c\u8d28\uff1b</li> <li>\u56de\u8c03\u673a\u5236\uff1a<code>data</code> \u975e\u7a7a\u65f6\u8c03\u7528 <code>uniswapV2Call()</code>\uff0c\u8ba9\u4f60\u5728\u56de\u8c03\u4e2d\u4f7f\u7528\u501f\u6765\u7684\u8d44\u91d1\uff1b</li> <li>\u4f59\u989d\u7ed3\u7b97\uff1a\u56de\u8c03\u7ed3\u675f\u540e\uff0c\u5408\u7ea6\u68c0\u67e5\"\u771f\u5b9e\u4f59\u989d\"\u6765\u63a8\u7b97\u4f60\u8fd8\u4e86\u591a\u5c11\uff0c\u800c\u4e0d\u662f\u76f8\u4fe1\u4f60\u58f0\u79f0\u7684\u6570\u5b57\uff1b</li> <li>K \u503c\u6821\u9a8c\uff1a\u6052\u5b9a\u4e58\u79ef\u516c\u5f0f <code>x \u00d7 y = k</code>\uff0c\u6263\u9664\u624b\u7eed\u8d39\u540e\u4e58\u79ef\u4e0d\u80fd\u53d8\u5c0f\uff0c\u5426\u5219\u6574\u7b14\u4ea4\u6613\u56de\u6eda\u3002</li> </ol> <p>\u666e\u901a\u4ea4\u6613 vs \u95ea\u7535\u8d37</p> <p>\u552f\u4e00\u533a\u522b\u662f <code>data</code> \u53c2\u6570\uff1a</p> \u573a\u666f data \u53c2\u6570 \u884c\u4e3a \u666e\u901a\u4ea4\u6613 \u7a7a <code>bytes(\"\")</code> \u4e0d\u89e6\u53d1\u56de\u8c03 \u95ea\u7535\u8d37 \u975e\u7a7a \u89e6\u53d1 <code>uniswapV2Call</code> \u56de\u8c03 <p>\u624b\u7eed\u8d39</p> <p>\u95ea\u7535\u8d37\u624b\u7eed\u8d39 \u2248 0.3%\uff0c\u516c\u5f0f\uff1a<code>fee = borrowAmount \u00d7 3 / 997</code></p> <p>\u4f8b\u5982\uff1a\u501f 1,000,000 DAI\uff0c\u9700\u8fd8\u7ea6 1,003,010 DAI\u3002</p>"},{"location":"web3/defi/flash_loan_attack_260101/#_2","title":"\u4e09\u3001\u95ea\u7535\u8d37\u653b\u51fb\u6f14\u793a","text":""},{"location":"web3/defi/flash_loan_attack_260101/#_3","title":"\u653b\u51fb\u539f\u7406","text":"<p>\u95ea\u7535\u8d37\u672c\u8eab\u4e0d\u662f\u6f0f\u6d1e\uff0c\u5b83\u53ea\u662f\u653e\u5927\u5668\u3002\u771f\u6b63\u7684\u6f0f\u6d1e\u662f\uff1a\u4f7f\u7528 DEX \u5373\u65f6\u4ef7\u683c\u4f5c\u4e3a\u9884\u8a00\u673a\u3002</p> <p>AMM\uff08\u81ea\u52a8\u505a\u5e02\u5546\uff09\u7684\u4ef7\u683c\u7531\u6c60\u5b50\u6bd4\u4f8b\u51b3\u5b9a\uff1a</p> <pre><code>\u4ef7\u683c = reserve1 / reserve0\n</code></pre> <p>\u5927\u989d\u4ea4\u6613\u4f1a\u7acb\u5373\u6539\u53d8\u8fd9\u4e2a\u6bd4\u4f8b\uff0c\u4ece\u800c\u64cd\u7eb5\u4ef7\u683c\u3002</p> <p>\u653b\u51fb\u56db\u6b65\u66f2</p> <p></p> <ol> <li>\u4ece Pool A \u95ea\u7535\u8d37\u501f\u5165\u5927\u91cf DAI\uff1b</li> <li>\u5728 Pool B \u7528 DAI \u4e70 WETH\uff0c\u62c9\u9ad8 WETH \u4ef7\u683c\uff1b</li> <li>\u5c06 WETH \u5b58\u5165 Lending \u4f5c\u62b5\u62bc\uff0c\u6309\u865a\u9ad8\u4ef7\u683c\u501f\u51fa\u8d85\u989d DAI\uff1b</li> <li>\u5f52\u8fd8\u95ea\u7535\u8d37\uff0c\u5269\u4f59\u5373\u4e3a\u5229\u6da6\u3002</li> </ol>"},{"location":"web3/defi/flash_loan_attack_260101/#_4","title":"\u4e3a\u4ec0\u4e48\u80fd\u6210\u529f\uff1f","text":"<p>\u653b\u51fb\u6210\u529f\u7684 3 \u4e2a\u6761\u4ef6\uff1a</p> <ol> <li>\u9884\u8a00\u673a\u4f7f\u7528\u5373\u65f6\u4ef7\u683c \u2014 \u53ef\u88ab\u5355\u7b14\u4ea4\u6613\u64cd\u7eb5\uff1b</li> <li>\u6d41\u52a8\u6027\u6c60\u8f83\u5c0f \u2014 \u5c0f\u8d44\u91d1\u5373\u53ef\u5927\u5e45\u79fb\u52a8\u4ef7\u683c\uff1b</li> <li>\u501f\u8d37\u534f\u8bae\u6709\u8db3\u591f\u8d44\u91d1 \u2014 \u5229\u6da6\u6765\u6e90\u3002</li> </ol> <p>\u7b80\u5355\u6570\u5b66\uff08\u4ee5\u672c\u6f14\u793a\u4e3a\u4f8b\uff09\uff1a</p> <pre><code>\u521d\u59cb\u72b6\u6001\uff1a\n  Pool B: 100 WETH + 300,000 DAI\uff0c\u4ef7\u683c = 3,000 DAI/WETH\n\n\u653b\u51fb\u8fc7\u7a0b\uff1a\n  1. \u4ece Pool A \u501f 1,500,000 DAI\n  2. \u7528 1,350,000 DAI \u5728 Pool B \u4e70 WETH\n     \u2192 \u83b7\u5f97\u7ea6 81 WETH\n     \u2192 Pool B \u65b0\u4ef7\u683c \u2248 86,842 DAI/WETH\uff08\u6da8\u4e86 29 \u500d\uff01\uff09\n  3. \u5b58 81 WETH \u5230 Lending\n     \u2192 \u6309\u865a\u9ad8\u4ef7\u683c\u8ba1\u7b97\u62b5\u62bc\u4ef7\u503c\uff1a81 \u00d7 86,842 \u2248 7,034,202 DAI\n     \u2192 \u53ef\u501f (80%)\uff1a\u7ea6 5,627,361 DAI\n  4. \u8fd8\u6b3e 1,504,514 DAI\n\n\u5229\u6da6\uff1a5,627,361 - 1,504,514 + 150,000 \u2248 4,272,847 DAI\n</code></pre>"},{"location":"web3/defi/flash_loan_attack_260101/#remix","title":"Remix \u90e8\u7f72\u6f14\u793a","text":"<p>\u5b8c\u6574\u6e90\u7801\uff1ahttps://github.com/lifefindsitsway/flash_loan_attack_demo</p> <p>\u6587\u4ef6\u7ed3\u6784</p> <pre><code>Flash_Loan_Attack_Demo/\n\u251c\u2500\u2500 interfaces/\n\u2502   \u251c\u2500\u2500 IERC20.sol           # ERC20 \u6807\u51c6\u63a5\u53e3\n\u2502   \u251c\u2500\u2500 ILending.sol         # \u501f\u8d37\u534f\u8bae\u63a5\u53e3\n\u2502   \u251c\u2500\u2500 IPair.sol            # \u4ea4\u6613\u5bf9\u63a5\u53e3\n\u2502   \u2514\u2500\u2500 IUniswapV2Callee.sol # \u95ea\u7535\u8d37\u56de\u8c03\u63a5\u53e3\n\u2502\n\u251c\u2500\u2500 Attacker.sol             # \u653b\u51fb\u5408\u7ea6\n\u251c\u2500\u2500 ERC20.sol                # \u6d4b\u8bd5\u4ee3\u5e01\n\u251c\u2500\u2500 Lending.sol              # \u6709\u6f0f\u6d1e\u7684\u501f\u8d37\u534f\u8bae\n\u2514\u2500\u2500 UniswapV2Pair.sol        # \u4ea4\u6613\u5bf9\uff08\u90e8\u7f72\u4e24\u6b21\uff09\n</code></pre> <p>\u90e8\u7f72\u6b65\u9aa4</p> <p>1.\u90e8\u7f72\u4ee3\u5e01</p> <ul> <li>\u90e8\u7f72 WETH\uff0cmint 20,000 \u4e2a</li> <li>\u90e8\u7f72 DAI\uff0cmint 60,000,000 \u4e2a</li> </ul> <p>2.\u90e8\u7f72\u4ea4\u6613\u5bf9</p> <ul> <li>Pool A\uff08\u5927\u6c60\uff09\uff1a10,000 WETH + 30,000,000 DAI</li> <li>Pool B\uff08\u5c0f\u6c60\uff09\uff1a100 WETH + 300,000 DAI</li> </ul> <p>3.\u90e8\u7f72 Lending</p> <ul> <li>\u6784\u9020\u51fd\u6570\u4f20\u5165 Pool B \u5730\u5740\uff08\u8bfb\u53d6 Pool B \u4ef7\u683c\uff09</li> <li>\u8f6c\u5165 20,000,000 DAI \u4f5c\u4e3a\u50a8\u5907</li> </ul> <p>4.\u90e8\u7f72 Attacker</p> <ul> <li>\u4f20\u5165 Pool A\u3001Pool B\u3001Lending\u3001WETH\u3001DAI \u5730\u5740</li> </ul> <p>5.\u6267\u884c\u653b\u51fb</p> <ul> <li>\u8c03\u7528 <code>Attacker.attack(1500000)</code></li> </ul> <p>\u653b\u51fb\u7ed3\u679c</p> <p></p> <p>\u4ece Attacker\u5408\u7ea6\u65e5\u5fd7 \u53ef\u4ee5\u770b\u5230\uff1a\u501f\u51fa 1,500,000 DAI\uff0c\u7528 1,350,000 DAI \u4e70\u5165\u7ea6 81 WETH\uff0c\u4ef7\u683c\u4ece 3,000 \u62c9\u5347\u81f3 86,842\uff0c\u6700\u7ec8\u5229\u6da6 4,272,847 DAI\u3002</p> <p>\u5e38\u89c1\u95ee\u9898</p> <p>Q\uff1a\u4e3a\u4ec0\u4e48\u9700\u8981\u4e24\u4e2a\u6c60\u5b50\uff1f</p> <p>Uniswap V2 \u7684 swap \u51fd\u6570\u6709\u91cd\u5165\u9501\uff0c\u56de\u8c03\u671f\u95f4\u65e0\u6cd5\u8c03\u7528\u540c\u6c60\u7684 swap\u3002\u8fd9\u4e5f\u89e3\u91ca\u4e86\u4e3a\u4ec0\u4e48\u771f\u5b9e\u653b\u51fb\u901a\u5e38\u6d89\u53ca\u591a\u4e2a\u534f\u8bae\u3002</p> <p>Q\uff1aPool B \u4e3a\u4ec0\u4e48\u8fd9\u4e48\u5c0f\uff1f</p> <p>\u6559\u5b66\u6f14\u793a\u7528\u3002\u771f\u5b9e\u573a\u666f\u4e2d\uff0c\u653b\u51fb\u8005\u4f1a\u5bfb\u627e\u6d41\u52a8\u6027\u8584\u5f31\u7684\u6c60\u5b50\u3002</p>"},{"location":"web3/defi/flash_loan_attack_260101/#_5","title":"\u56db\u3001\u5982\u4f55\u9632\u5fa1\uff1f","text":""},{"location":"web3/defi/flash_loan_attack_260101/#twap","title":"\u65b9\u6848\u4e00\uff1aTWAP\uff08\u65f6\u95f4\u52a0\u6743\u5e73\u5747\u4ef7\u683c\uff09","text":"<p>\u53d6\u591a\u4e2a\u533a\u5757\u7684\u5e73\u5747\u4ef7\u683c\uff0c\u653b\u51fb\u8005\u5fc5\u987b\u5728\u591a\u4e2a\u533a\u5757\u5185\u7ef4\u6301\u9ad8\u4ef7\uff0c\u6210\u672c\u6781\u9ad8\u3002</p> <pre><code>function getTWAP(uint period) external view returns (uint) {\n    uint currentCumulative = pair.price0CumulativeLast();\n    uint previousCumulative = observations[period];\n    return (currentCumulative - previousCumulative) / period;\n}\n</code></pre>"},{"location":"web3/defi/flash_loan_attack_260101/#chainlink","title":"\u65b9\u6848\u4e8c\uff1aChainlink \u9884\u8a00\u673a","text":"<p>\u4f7f\u7528\u53bb\u4e2d\u5fc3\u5316\u9884\u8a00\u673a\uff0c\u591a\u4e2a\u8282\u70b9\u805a\u5408\u6570\u636e\uff0c\u65e0\u6cd5\u88ab\u5355\u7b14\u4ea4\u6613\u64cd\u7eb5\u3002</p> <pre><code>import \"@chainlink/contracts/src/v0.8/interfaces/AggregatorV3Interface.sol\";\n\nfunction getPrice() public view returns (uint) {\n    (, int price,,,) = priceFeed.latestRoundData();\n    return uint(price);\n}\n</code></pre>"},{"location":"web3/defi/flash_loan_attack_260101/#_6","title":"\u5176\u4ed6\u65b9\u6848","text":"<ul> <li>\u591a\u9884\u8a00\u673a\u9a8c\u8bc1\uff1a\u540c\u65f6\u4f7f\u7528 TWAP \u548c Chainlink\uff0c\u504f\u5dee\u8fc7\u5927\u5219\u62d2\u7edd\u4ea4\u6613\uff1b</li> <li>\u5ef6\u8fdf\u6267\u884c\uff1a\u501f\u6b3e\u8bf7\u6c42\u9700\u7b49\u5f85\u81f3\u5c11 1 \u4e2a\u533a\u5757\u624d\u80fd\u6267\u884c\u3002</li> </ul>"},{"location":"web3/defi/flash_loan_attack_260101/#_7","title":"\u603b\u7ed3","text":"<p>3 \u6761 Key Takeaways\uff1a</p> <ol> <li>\u95ea\u7535\u8d37\u8ba9\u666e\u901a\u4eba\u4e5f\u80fd\u8fdb\u884c\u5927\u8d44\u91d1\u653b\u51fb\uff0c\u6210\u672c\u4ec5\u9700\u624b\u7eed\u8d39\u548c Gas\uff1b</li> <li>\u771f\u6b63\u7684\u6f0f\u6d1e\u662f\u4f7f\u7528 DEX \u5373\u65f6\u4ef7\u683c\u4f5c\u4e3a\u9884\u8a00\u673a\uff0c\u95ea\u7535\u8d37\u53ea\u662f\u653e\u5927\u5668\uff1b</li> <li>\u9632\u5fa1\u6838\u5fc3\uff1a\u6c38\u8fdc\u4e0d\u8981\u4fe1\u4efb\u53ef\u88ab\u5355\u7b14\u4ea4\u6613\u64cd\u7eb5\u7684\u4ef7\u683c\u6e90\u3002</li> </ol> <p>\u26a0\ufe0f \u672c\u6587\u4ec5\u4f9b\u5b66\u4e60\u7814\u7a76\uff0c\u8bf7\u52ff\u7528\u4e8e\u975e\u6cd5\u7528\u9014\u3002</p>"},{"location":"web3/defi/uniswap_v2_price_precision_240610/","title":"Uniswap V2 \u4ef7\u683c\u7cbe\u5ea6\u89e3\u6790","text":"<p> \u7ea6 2543 \u4e2a\u5b57  25 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 9 \u5206\u949f</p> <p>\u4ece DeFi \u5f00\u53d1\u8005\u7684\u89d2\u5ea6\uff0c\u6df1\u5165\u89e3\u6790 Uniswap V2 \u767d\u76ae\u4e66\u4e2d\u5173\u4e8e\u4ef7\u683c\u7cbe\u5ea6\u7684\u5185\u5bb9\u3002\u8fd9\u662f Uniswap V2 \u5de5\u7a0b\u8bbe\u8ba1\u7684\u7cbe\u534e\u4e4b\u4e00\uff0c\u4f53\u73b0\u4e86\u5728 EVM \u7ea6\u675f\u4e0b\u7684\u6781\u81f4\u4f18\u5316\u601d\u7ef4\u3002</p> <p>Uniswap V2 \u767d\u76ae\u4e66 2.2.1 \u8fd9\u7ae0\u8282\u4e3b\u8981\u5728\u56de\u7b54\u4e09\u4e2a\u95ee\u9898\uff1a</p> <ol> <li>\u94fe\u4e0a\u600e\u4e48\u8868\u793a\u201c\u4ef7\u683c\u201d\u8fd9\u79cd\u5c0f\u6570\uff1f</li> <li>\u4e3a\u4ec0\u4e48\u662f 112+112\uff0c\u8ddf 224 / 256 \u4f4d\u3001gas\u3001\u5b58\u50a8\u5e03\u5c40\u6709\u4ec0\u4e48\u5173\u7cfb\uff1f</li> <li>\u4e3a\u4ec0\u4e48\u8981\u628a\u65f6\u95f4\u6233\u538b\u6210 32 \u4f4d\u3001\u6ea2\u51fa\u4e4b\u540e\u600e\u4e48\u8fd8\u80fd\u6b63\u786e\u7b97 TWAP\uff1f</li> </ol>"},{"location":"web3/defi/uniswap_v2_price_precision_240610/#uq112112","title":"\u4e00\u3001UQ112.112 \u662f\u4ec0\u4e48\uff1f","text":""},{"location":"web3/defi/uniswap_v2_price_precision_240610/#11-q","title":"1.1 Q\u683c\u5f0f\u7684\u901a\u7528\u5b9a\u4e49","text":"<p><code>Qm.n</code> \u662f\u4e00\u79cd\u8868\u793a\u5b9a\u70b9\u6570\u7684\u683c\u5f0f\uff0c\u201cQ\u201d \u4ee3\u8868\u201c\u4e8c\u8fdb\u5236\u5c0f\u6570\u70b9\u4f4d\u7f6e\u201d\uff08binary point position\uff09\u3002\u5b83\u662f\u4e00\u79cd\u547d\u540d\u60ef\u4f8b\uff0c\u7528\u4e8e\u660e\u786e\u6307\u793a\u5728\u4e00\u4e2a\u6574\u6570\u4e2d\uff0c\u54ea\u91cc\u662f\u6574\u6570\u90e8\u5206\u548c\u5c0f\u6570\u90e8\u5206\u7684\u5206\u754c\u7ebf\u3002\u5176\u4e2d\uff1a</p> <ul> <li>m\uff1a\u4ee3\u8868\u6574\u6570\u90e8\u5206\uff08\u5728\u5c0f\u6570\u70b9\u5de6\u8fb9\uff09\u5360\u7528\u7684\u4f4d\u6570\uff1b</li> <li>n\uff1a\u4ee3\u8868\u5c0f\u6570\u90e8\u5206\uff08\u5728\u5c0f\u6570\u70b9\u53f3\u8fb9\uff09\u5360\u7528\u7684\u4f4d\u6570\uff1b</li> <li>\u603b\u6570\uff1a<code>m + n</code> \u4f4d\uff0c\u901a\u5e38\u5bf9\u5e94\u4e00\u4e2a\u6807\u51c6\u6574\u6570\u7c7b\u578b\uff08\u5982 int32, uint16 \u7b49\uff09\u3002</li> </ul>"},{"location":"web3/defi/uniswap_v2_price_precision_240610/#12","title":"1.2 \u4e3a\u4ec0\u4e48\u9700\u8981\u5b9a\u70b9\u6570\u683c\u5f0f\uff1f","text":"<p>Solidity\uff08\u4ee5\u53caEVM\uff09\u539f\u751f\u53ea\u652f\u6301\u6574\u6570\u8fd0\u7b97\uff0c\u6ca1\u6709\u6d6e\u70b9\u6570\u7c7b\u578b\uff0c\u4f46\u4ef7\u683c\u5929\u7136\u662f\u5c0f\u6570\uff0c\u4f8b\u5982\uff1a1 ETH = 3049.5 USDC\u3002</p> <p>\u4f20\u7edf\u65b9\u6848\u7684\u95ee\u9898\uff1a\u5982\u679c\u76f4\u63a5\u7528 <code>reserve_a / reserve_b</code> \u8ba1\u7b97\u4ef7\u683c\uff0cSolidity \u4f1a\u505a\u6574\u6570\u9664\u6cd5\uff0c\u4e22\u5931\u6240\u6709\u5c0f\u6570\u90e8\u5206\uff0c\u6bd4\u5982 <code>1 / 2000 = 0</code>\uff08\u6574\u6570\u9664\u6cd5\uff09\u3002</p> <p>Uniswap V2 \u7684\u89e3\u51b3\u65b9\u6848\uff1a\u4f7f\u7528\u5b9a\u70b9\u6570\uff08Fixed Point\uff09\u683c\u5f0f <code>UQ112.112</code>\u3002 <code>UQ112.112</code> \u662f<code>Qm.n</code> \u683c\u5f0f\u7684\u4e00\u4e2a\u53d8\u4f53\uff1a</p> <ul> <li>U\uff1a\u4ee3\u8868 Unsigned\uff08\u65e0\u7b26\u53f7\uff09\uff0c\u8fd9\u4e2a\u6570\u6c38\u8fdc\u662f\u6b63\u7684\uff0c\u56e0\u4e3a\u4ef7\u683c\u4e0d\u53ef\u80fd\u4e3a\u8d1f\uff1b</li> <li> <p>Q112.112\uff1a\u8868\u793a\u8fd9\u662f\u4e00\u4e2a\u5b9a\u70b9\u6570\uff0c\u5176\u4e2d\uff1a</p> </li> <li> <ul> <li>\u5c0f\u6570\u70b9\u5de6\u8fb9\u6709 112 \u4f4d\uff08\u7528\u4e8e\u8868\u793a\u6574\u6570\u90e8\u5206\uff09\uff1b</li> </ul> </li> <li>\u5c0f\u6570\u70b9\u53f3\u8fb9\u6709 112 \u4f4d\uff08\u7528\u4e8e\u8868\u793a\u5c0f\u6570\u90e8\u5206\uff09\uff1b</li> <li>\u603b\u8ba1 224 \u4f4d (<code>112 + 112</code>)\u3002</li> </ul> <p>Uniswap V2 \u767d\u76ae\u4e66\u539f\u6587\uff1a</p> <p>prices at a given moment are stored as UQ112.112 numbers, meaning that 112 fractional bits of precision are specified on either side of the decimal point, with no sign. These numbers have a range of [0, 2\u00b9\u00b9\u00b2 \u2212 1] and a precision of 1 / 2\u00b9\u00b9\u00b2. </p> <p>\u7ffb\u8bd1\u4e00\u4e0b\uff0c\u5c31\u662f\uff1a\u201c\u6211\u4eec\u6ca1\u6709\u6d6e\u70b9\u6570\uff0c\u53ea\u597d\u81ea\u5df1\u9020\u4e00\u4e2a\u4e8c\u8fdb\u5236\u5b9a\u70b9\u5c0f\u6570\u683c\u5f0f\uff1a\u628a\u4e00\u4e2a\u6570\u62c6\u6210\u4e24\u90e8\u5206\uff1a</p> <ul> <li>\u524d 112 \u4f4d\uff1a\u6574\u6570\u90e8\u5206\uff080 ~ 2\u00b9\u00b9\u00b2 \u2212 1\uff09</li> <li>\u540e 112 \u4f4d\uff1a\u5c0f\u6570\u90e8\u5206\uff08\u7cbe\u5ea6 2\u207b\u00b9\u00b9\u00b2\uff09</li> <li>\u4e0d\u5e26\u7b26\u53f7\uff08unsigned\uff09\uff0c\u53ea\u8868\u793a\u975e\u8d1f\u3002\u201d</li> </ul>"},{"location":"web3/defi/uniswap_v2_price_precision_240610/#13-0-2112-1","title":"1.3 \u8303\u56f4\u4e3a\u4ec0\u4e48\u662f [0, 2\u00b9\u00b9\u00b2 \u2212 1]\uff1f","text":"<p>\u8fd9\u91cc\u6307\u7684\u662f\u4ef7\u683c\u7684\u6574\u6570\u90e8\u5206\u7684\u8303\u56f4\uff0c\u4e0d\u662f\u6574\u4e2a 224 \u4f4d\u6570\u503c\u6574\u4f53\u7684\u8303\u56f4\u3002</p> <p>\u767d\u76ae\u4e66\u811a\u6ce8\u89e3\u91ca\u5f97\u5f88\u6e05\u695a\uff1aUniswap \u91cc\u8fd9\u4e2a UQ112.112 \u7684\u4ef7\u683c\u6c38\u8fdc\u6765\u81ea\u4e24\u4e2a uint112 \u50a8\u5907\u7684\u6bd4\u503c\uff1a</p> <p>UQ112.112 numbers in Uniswap are always generated from the ratio of two uint112s. The largest such ratio is (2\u00b9\u00b9\u00b2\u22121) / 1 = 2\u00b9\u00b9\u00b2 \u2212 1.</p> <p>\u5728 UniswapV2Pair.sol \u5408\u7ea6\u4e2d\uff0c<code>reserve0</code>\u3001<code>reserve1</code> \u88ab\u5b9a\u4e49\u4e3a <code>uint112</code> \u7c7b\u578b\uff0c\u6700\u5927\u4ef7\u683c\u60c5\u51b5\u662f\uff1a\u4e00\u8fb9\u50a8\u5907\u63a5\u8fd1 <code>2\u00b9\u00b9\u00b2\u22121</code>\uff0c\u53e6\u4e00\u8fb9\u63a5\u8fd1 1\uff0c\u6240\u4ee5\u4ef7\u683c\u6700\u5927 \u2248 <code>(2\u00b9\u00b9\u00b2\u22121) / 1 \u2248 2\u00b9\u00b9\u00b2\u22121</code>\u3002</p> <p>\u8865\u5145\uff1a\u50a8\u5907\u91d1 <code>reserve0</code>\u3001<code>reserve1</code> \u662f\u6574\u6570\u8ba1\u6570\uff08<code>uint112</code>\uff09\uff0c\u6ca1\u6709\u5c0f\u6570\u4f4d\uff0c\u8868\u793a\u6c60\u5b50\u91cc\u771f\u5b9e\u5b58\u5728\u7684 Token \u6570\u91cf\uff0c\u662f\u4e0d\u53ef\u518d\u7ec6\u5206\u7684\u6700\u5c0f\u5355\u4f4d\uff08wei\u3001\u6700\u5c0f ERC20 \u5355\u4f4d\uff09\uff0c\u7406\u8bba\u4e0a\u50a8\u5907\u6700\u5c0f\u80fd\u5230 1\uff0c\u6700\u5927\u4e3a <code>2\u00b9\u00b9\u00b2\u22121</code>\u3002</p> <p>\u8fd9\u4fdd\u8bc1\u4e86\u6574\u6570\u90e8\u5206\u6700\u591a\u9700\u8981 112 \u4f4d\u5c31\u591f\u4e86\uff080 ~ 2\u00b9\u00b9\u00b2\u22121\uff09\uff0c\u5c0f\u6570\u90e8\u5206\u518d\u7ed9 112 \u4f4d\uff0c\u6574\u4f53 224 \u4f4d\uff0c\u521a\u597d\u653e\u8fdb <code>uint224</code>\u3002</p> \u6982\u5ff5 \u503c\u8303\u56f4 \u6570\u636e\u7c7b\u578b \u7528\u9014 reserve0, reserve1 0 ~ 2\u00b9\u00b9\u00b2\u22121 uint112 \u50a8\u5907\u6570\u91cf\uff08\u6574\u6570\uff09 price = reserve1/reserve0 0 ~ 2\u00b9\u00b9\u00b2\u22121.xxx UQ112.112 \u4ef7\u683c\uff08\u5c0f\u6570 + \u9ad8\u7cbe\u5ea6\uff09 UQ112.112 \u5c0f\u6570\u4f4d 2\u207b\u00b9\u00b9\u00b2 \u5e95\u5c42\u4f4d\u79fb \u8868\u793a\u4ef7\u683c\u7684\u5c0f\u6570\u90e8\u5206 <p>\u7cbe\u5ea6\u4e0a\uff0c\u4e00\u4e2a UQ112.112 \u7684\u6700\u5c0f\u5355\u4f4d\u662f <code>1 / 2\u00b9\u00b9\u00b2</code>\uff0c\u5927\u7ea6 10\u207b\u00b3\u2074 \u91cf\u7ea7\uff0c\u8fdc\u8fdc\u6bd4 1e-18 \u8fd8\u7ec6\uff0c\u5bf9\u4e8e\u73b0\u5b9e\u4e2d token 18 decimals\u3001\u4ef7\u683c\u51e0\u4f4d\u5c0f\u6570\u7684\u5e94\u7528\uff0c\u8fd9\u4e2a\u7cbe\u5ea6\u5b8c\u5168\u591f\u7528\u4e14\u6d6a\u8d39\u4e00\u70b9\u6ca1\u5173\u7cfb\uff0c\u91cd\u70b9\u662f\u65b9\u4fbf\u6570\u5b66\u548c\u5b58\u50a8\u5e03\u5c40\u3002</p>"},{"location":"web3/defi/uniswap_v2_price_precision_240610/#112112","title":"\u4e8c\u3001 \u4e3a\u4ec0\u4e48\u662f 112+112\uff1f\u5b58\u50a8\u69fd\u7684\u7cbe\u5999\u8bbe\u8ba1","text":"<p>\u8fd9\u662f\u6574\u4e2a\u8bbe\u8ba1\u6700\u5de7\u5999\u7684\u5730\u65b9\uff0c\u6d89\u53ca\u5230Gas\u4f18\u5316\u548c\u5b58\u50a8\u5e03\u5c40\u3002</p> <p>EVM \u5b58\u50a8\u69fd\u57fa\u7840\uff1aEVM \u7684\u4e00\u4e2a\u5b58\u50a8\u69fd\uff08storage slot\uff09= 256\u4f4d\uff0c\u6bcf\u6b21 <code>SSTORE</code> \u64cd\u4f5c\uff08\u5199\u5165\u5b58\u50a8\uff09\u6d88\u8017\u5927\u91cf Gas\uff08~20,000 gas\uff09\uff0c\u6253\u5305\u5b58\u50a8\uff08packing\uff09\u53ef\u4ee5\u5728\u4e00\u4e2a\u69fd\u5185\u5b58\u591a\u4e2a\u53d8\u91cf\uff0c\u8282\u7701 Gas\u3002</p> <p>\u767d\u76ae\u4e66\u5173\u952e\u53e5\uff1a</p> <p>The UQ112.112 format was chosen for a pragmatic reason \u2014 because these numbers can be stored in a uint224, this leaves 32 bits of a 256 bit storage slot free. It also happens that the reserves, each stored in a uint112, also leave 32 bits free in a (packed) 256 bit storage slot.</p> <p>\u4ece\u4ee5\u592a\u574a\u5408\u7ea6\u5b58\u50a8\u89c6\u89d2\u6765\u770b\u5c31\u662f\uff1a</p> <ul> <li>\u50a8\u5907\u91d1\u5b58\u50a8\uff1a\u6bcf\u4e2a\u50a8\u5907\u91d1\uff08<code>uint112</code>\uff09\u7528\u4e86 112 \u4f4d\uff0c\u4e24\u4e2a <code>uint112</code> \u53ef\u4ee5\u7d27\u5bc6\u6253\u5305\u5728\u4e00\u4e2a 256 \u4f4d\u7684\u5b58\u50a8\u69fd\u91cc\uff0c\u7559\u4e0b <code>256 - 2*112 = 32</code> \u4f4d\u7a7a\u95f2\u3002</li> <li>\u4ef7\u683c\u5b58\u50a8\uff1a\u4ef7\u683c\u4f5c\u4e3a\u4e24\u4e2a <code>uint112</code> \u50a8\u5907\u91d1\u7684\u6bd4\u7387\uff0c\u81ea\u7136\u53ef\u4ee5\u8868\u793a\u4e3a\u4e00\u4e2a <code>UQ112.112</code> \u6570\uff0c\u5b83\u521a\u597d\u80fd\u88c5\u8fdb\u4e00\u4e2a <code>uint224</code>\uff08224\u4f4d\uff09\u3002</li> <li> <p>\u7a7a\u95f2\u4f4d\u7684\u5229\u7528\uff1a\u6838\u5fc3\u6765\u4e86\uff01\u90a3\u4e2a\u7a7a\u95f2\u7684 32 \u4f4d\uff08\u6765\u81ea\u50a8\u5907\u91d1\u5b58\u50a8\u69fd\uff09\u548c\u4ef7\u683c\u5b58\u50a8\u69fd\u672b\u5c3e\u7684 32 \u4f4d\uff0c\u88ab\u5de7\u5999\u5730\u7528\u6765\uff1a</p> </li> <li> <ul> <li>\u5b58\u50a8\u65f6\u95f4\u6233\uff08\u6a21 <code>2^32</code>\uff0c\u521a\u597d 32 \u4f4d\uff09\uff1b</li> </ul> </li> <li>\u5b58\u50a8\u4ef7\u683c\u7d2f\u52a0\u8fc7\u7a0b\u4e2d\u7684\u6ea2\u51fa\u4f4d\uff08\u56e0\u4e3a\u8fde\u7eed\u7d2f\u52a0\u53ef\u80fd\u8d85\u8fc7 224 \u4f4d\uff09\u3002</li> </ul> <p>\u5728\u4e0d\u652f\u6301\u6d6e\u70b9\u6570\u7684 EVM \u4e2d\uff0c\u7528\u6574\u6570\u8fd0\u7b97\u6765\u6a21\u62df\u9ad8\u7cbe\u5ea6\u7684\u5c0f\u6570\u8fd0\u7b97\uff0c\u540c\u65f6\u5b8c\u7f8e\u5951\u5408\u5b58\u50a8\u5e03\u5c40\uff0c\u5c06\u9884\u8a00\u673a\u66f4\u65b0\u7684 Gas \u6210\u672c\u964d\u81f3\u6700\u4f4e\uff08\u4ec5\u9996\u6b21\u4ea4\u6613\u589e\u52a0\u7ea6 15,000 gas\uff09\u3002</p>"},{"location":"web3/defi/uniswap_v2_price_precision_240610/#21-uniswap-v2","title":"2.1 Uniswap V2\u7684\u5b58\u50a8\u5e03\u5c40","text":"<p>\u5b9e\u9645\u4ee3\u7801\u7ed3\u6784\uff08\u7b80\u5316\u7248\uff09\uff1a</p> <pre><code>contract UniswapV2Pair {\n    uint112 private reserve0;           // 112\u4f4d\n    uint112 private reserve1;           // 112\u4f4d  \n    uint32  private blockTimestampLast; // 32\u4f4d\n    // \u603b\u5171: 112 + 112 + 32 = 256\u4f4d = 1\u4e2a\u5b58\u50a8\u69fd\uff01\n\n    uint224 public price0CumulativeLast; // 224\u4f4d\n    uint32  private overflowBits0;       // 32\u4f4d\uff08\u6ea2\u51fa\u90e8\u5206\uff09\n    // \u603b\u5171: 224 + 32 = 256\u4f4d = 1\u4e2a\u5b58\u50a8\u69fd\uff01\n\n    uint224 public price1CumulativeLast; // 224\u4f4d\n    uint32  private overflowBits1;       // 32\u4f4d\uff08\u6ea2\u51fa\u90e8\u5206\uff09\n    // \u603b\u5171: 224 + 32 = 256\u4f4d = 1\u4e2a\u5b58\u50a8\u69fd\uff01\n}\n</code></pre> <p>Solidity \u7684 storage packing \u89c4\u5219\uff1a\u5728\u540c\u4e00\u4e2a <code>slot(256bit)</code> \u91cc\u5c3d\u91cf\u585e\u6ee1\u7d27\u6328\u7740\u7684\u5c0f\u7c7b\u578b\uff1a</p> <ul> <li>112 + 112 + 32 = 256</li> <li>\u521a\u597d\u585e\u6ee1\u4e00\u4e2a 256 \u4f4d\u69fd\uff0c\u4e0d\u6d6a\u8d39\u3001\u4e0d\u591a\u7528 gas\u3002</li> </ul> <p>\u8fd9\u5c31\u662f\u201cpacked 256 bit storage slot\u201d\u7684\u542b\u4e49\uff1a\u4e24\u4e2a\u50a8\u5907 + 1 \u4e2a 32bit \u65f6\u95f4\u6233\uff0c\u6574\u6574\u9f50\u9f50\u653e\u5728\u4e00\u4e2a\u69fd\u91cc\u3002</p>"},{"location":"web3/defi/uniswap_v2_price_precision_240610/#22-32","title":"2.2 \u7d2f\u79ef\u4ef7\u683c\u5e03\u5c40\uff1a\u4e3a\u4ec0\u4e48\u9700\u8981\u989d\u5916\u768432\u4f4d\uff1f","text":"<p>\u767d\u76ae\u4e66\u63a5\u7740\u8bf4\uff1a</p> <p>although the price at any given moment (stored as a UQ112.112 number) is guaranteed to fit in 224 bits, the accumulation of this price over an interval is not. The extra 32 bits on the end of the storage slots for the accumulated price of A/B and B/A are used to store overflow bits resulting from repeated summations of prices.</p> <p>\u767d\u76ae\u4e66\u8bf4\uff1a\"\u867d\u7136\u4efb\u4f55\u7ed9\u5b9a\u65f6\u523b\u7684\u4ef7\u683c\u4fdd\u8bc1\u9002\u5408224\u4f4d\uff0c\u4f46\u8be5\u4ef7\u683c\u5728\u4e00\u4e2a\u533a\u95f4\u5185\u7684\u7d2f\u79ef\u5219\u4e0d\u7136\u3002\"</p> <ul> <li>\u77ac\u65f6\u4ef7\u683c\uff1aUQ112.112\uff0c\u7528 <code>uint224</code> \u5c31\u591f\u5b58\uff1b</li> <li>\u7d2f\u79ef\u4ef7\u683c\uff1a<code>priceCumulativeLast += price * timeElapsed</code>\uff0c<code>price</code> \u662f UQ112.112\uff08224 \u4f4d\uff09\uff0c<code>timeElapsed</code> \u662f <code>uint32</code> \u79d2\u6570\uff0c\u6bcf\u6b21\u4e58\u6cd5\u7ed3\u679c\u53ef\u80fd\u9700\u8981 224 + 32 = 256 \u4f4d\uff0c\u518d\u4e0d\u65ad\u7d2f\u52a0\uff0c\u80af\u5b9a\u4f1a\u201c\u7406\u8bba\u4e0a\u6ea2\u51fa 224 \u4f4d\u201d\u3002</li> </ul> <pre><code>if (timeElapsed &gt; 0 &amp;&amp; _reserve0 != 0 &amp;&amp; _reserve1 != 0) {\n    price0CumulativeLast += uint(\n        UQ112x112.encode(_reserve1).uqdiv(_reserve0)\n    ) * timeElapsed;\n    price1CumulativeLast += uint(\n        UQ112x112.encode(_reserve0).uqdiv(_reserve1)\n    ) * timeElapsed;\n}\n</code></pre> <p>\u6ce8\u610f\u51e0\u70b9\uff1a</p> <ul> <li><code>UQ112x112.encode(...).uqdiv(...)</code> \u8fd4\u56de\u7684\u662f\u4e00\u4e2a <code>uint224</code> \u7684 UQ112.112 \u6570\u3002</li> <li><code>uint(...)</code> \u8f6c\u6210 <code>uint256</code>\uff0c\u518d\u4e58 <code>timeElapsed (uint32)</code>\uff0c\u6574\u4f53\u7528 256 \u4f4d\u505a\u7b97\u672f\u3002</li> <li>\u6ea2\u51fa\u884c\u4e3a\u662f\u6309 <code>mod 2\u00b2\u2075\u2076</code> \u6765\u7684\uff08Solidity 0.5/0.6 \u4e0b\uff0c\u9ed8\u8ba4 wrap around\uff09\u3002</li> </ul> <p>\u76f4\u89c9\u7406\u89e3\uff1a\u201c\u6211\u7528 224 \u4f4d\u5b58\u4ef7\u683c\u5c0f\u6570\uff0c\u989d\u5916\u5f00\u4e86 32 \u4f4d\u5f53\u7f13\u51b2\u533a\uff0c\u7ed9\u957f\u671f\u7d2f\u52a0\u7559\u7a7a\u95f4\u3002\u771f\u6b63\u62ff\u6765\u7b97 TWAP \u662f\u7528\u5dee\u503c\u9664\u4ee5\u65f6\u95f4\u95f4\u9694\uff0c\u6240\u4ee5\u53ea\u8981\u4e0b\u6e38\u7528\u540c\u6837\u7684 \u2018\u53d6\u6a21 + \u6ea2\u51fa\u5b89\u5168\u7b97\u672f\u2019\uff0c\u5c31\u80fd\u6b63\u786e\u6062\u590d\u5e73\u5747\u503c\u3002\u201d</p>"},{"location":"web3/defi/uniswap_v2_price_precision_240610/#32","title":"\u4e09\u3001\u65f6\u95f4\u6233\u768432\u4f4d\u9650\u5236\u4e0e\u6ea2\u51fa\u5b89\u5168","text":"<p>\u767d\u76ae\u4e66\u8fd9\u6bb5\u8bdd\u662f\u5bb9\u6613\u7591\u60d1\u7684\u5730\u65b9\uff1a</p> <p>The primary downside is that 32 bits isn't quite enough to store timestamp values that will reasonably never overflow. In fact, the date when the Unix timestamp overflows a uint32 is 02/07/2106. To ensure that this system continues to function properly after this date, and every multiple of 2\u00b3\u00b2 - 1 seconds thereafter, oracles are simply required to check prices at least once per interval (approximately 136 years). This is because the core method of accumulation (and modding of timestamp), is actually overflow-safe, meaning that trades across overflow intervals can be appropriately accounted for given that oracles are using the proper (simple) overflow arithmetic to compute deltas.</p> <p>\u7ffb\u8bd1\u6210\u4e2d\u6587\u6765\u7406\u89e3\uff1a</p> <p>32 \u4f4d\u7684\u4e3b\u8981\u7f3a\u70b9\u5728\u4e8e\uff1a\u5b83\u4e0d\u8db3\u4ee5\u5b58\u50a8\u201c\u6c38\u8fdc\u4e0d\u4f1a\u6ea2\u51fa\u201d\u7684\u65f6\u95f4\u6233\u503c\u3002\u4e8b\u5b9e\u4e0a\uff0cUnix \u65f6\u95f4\u6233\u5728 <code>uint32</code> \u4e2d\u6ea2\u51fa\u7684\u65e5\u671f\u662f 2106 \u5e74 2 \u6708 7 \u65e5\u3002\u4e3a\u4e86\u786e\u4fdd\u8fd9\u4e2a\u7cfb\u7edf\u5728\u8be5\u65e5\u671f\u4e4b\u540e\u4ecd\u80fd\u6b63\u5e38\u8fd0\u884c\uff0c\u5e76\u5728\u4e4b\u540e\u6bcf\u7ecf\u8fc7 <code>2\u00b3\u00b2 - 1</code> \u79d2\uff08\u5927\u7ea6 136 \u5e74\uff09\u518d\u6b21\u6ea2\u51fa\u65f6\u7ee7\u7eed\u6b63\u5e38\u5de5\u4f5c\uff0c\u9884\u8a00\u673a\uff08oracles\uff09\u53ea\u9700\u8981\u505a\u5230\u4e00\u4ef6\u4e8b\uff1a\u5728\u6bcf\u4e2a\u5468\u671f\u91cc\u81f3\u5c11\u68c0\u67e5\u4e00\u6b21\u4ef7\u683c\uff08\u4e5f\u5c31\u662f\u5927\u7ea6\u6bcf 136 \u5e74\u68c0\u67e5\u4e00\u6b21\uff09\u3002</p> <p>\u8fd9\u662f\u56e0\u4e3a\u7d2f\u79ef\uff08accumulation\uff09\u4ee5\u53ca\u5bf9\u65f6\u95f4\u6233\u8fdb\u884c\u53d6\u6a21\uff08modding of timestamp\uff09\u7684\u6838\u5fc3\u65b9\u6cd5\u672c\u8eab\u662f\u6ea2\u51fa\u5b89\u5168\u7684\u3002\u53ea\u8981\u9884\u8a00\u673a\u5728\u8ba1\u7b97\u65f6\u95f4\u5dee\uff08delta\uff09\u65f6\u4f7f\u7528\u6b63\u786e\u7684\uff08\u7b80\u5355\u7684\uff09\u6ea2\u51fa\u7b97\u672f\uff0c\u5373\u4f7f\u4ea4\u6613\u8de8\u8d8a\u4e86\u65f6\u95f4\u6233\u6ea2\u51fa\u7684\u95f4\u9694\uff0c\u4e5f\u4ecd\u7136\u80fd\u591f\u88ab\u6b63\u786e\u8bb0\u8d26\u3002</p>"},{"location":"web3/defi/uniswap_v2_price_precision_240610/#31-mod-232","title":"3.1 \u4e3a\u4ec0\u4e48\u65f6\u95f4\u6233\u8981 mod 2\u00b3\u00b2\uff1f","text":"<p>\u8fd9\u8ddf\u524d\u9762\u8bf4\u7684\u201c\u4e24\u4e2a <code>uint112</code> + \u4e00\u4e2a <code>uint32</code> \u62fc\u5728\u540c\u4e00\u69fd\u201d\u662f\u540c\u4e00\u4e2a\u8bbe\u8ba1\uff1a</p> <p><code>block.timestamp</code> \u662f\u4e00\u4e2a\u4e0d\u65ad\u589e\u5927\u7684 Unix \u65f6\u95f4\u6233\uff08\u79d2\uff09\uff0c\u4e3a\u4e86\u585e\u8fdb 32 \u4f4d\uff0c\u8981\u505a\uff1a<code>uint32 blockTimestamp = uint32(block.timestamp % 2**32)</code>\uff0c\u5b58\u7684\u65f6\u5019\u53ea\u4fdd\u7559\u4f4e 32 \u4f4d\uff08\u5bf9 2\u00b3\u00b2 \u53d6\u6a21\uff09\u3002</p> <p>\u66f4\u65b0\u65f6 <code>_update()</code> \u7684\u6d41\u7a0b\uff08\u7b80\u5316\uff09\uff1a</p> <pre><code>uint32 blockTimestamp = uint32(block.timestamp % 2**32);\nuint32 timeElapsed = blockTimestamp - blockTimestampLast; // \u6ce8\u610f\uff1a\u8fd9\u662f uint32 \u51cf\u6cd5\n// timeElapsed \u5c31\u662f\u201c\u81ea\u4e0a\u6b21\u66f4\u65b0\u4ee5\u6765\u7ecf\u8fc7\u7684\u79d2\u6570\u201d\uff0c\u4f46\u6709\u6ea2\u51fa\u8bed\u4e49\n</code></pre> <p>\u8fd9\u4e00\u6b65\u7684\u5173\u952e\uff1a<code>uint32</code> \u7684\u51cf\u6cd5\u5728\u6ea2\u51fa\u65f6\u81ea\u52a8\u6309 2\u00b3\u00b2 \u53d6\u6a21\u3002</p> <p>\u5728\u6ca1\u6ea2\u51fa\u7684\u4e00\u822c\u60c5\u51b5\u4e0b\uff1a<code>timeElapsed = current - last</code></p> <p>\u5728\u7ecf\u5386\u8fc7\u4e00\u6b21 2\u00b3\u00b2 \u6ea2\u51fa\uff08\u65f6\u95f4\u6233\u7ed5\u4e86\u4e00\u5708\uff09\uff1a\u5047\u8bbe <code>last = 2\u00b3\u00b2 - 10</code>\uff0c<code>current = 5</code>\uff08\u7ed5\u4e86\u4e00\u5708 +5 \u79d2\uff09\uff0c<code>timeElapsed = 5 - (2\u00b3\u00b2 - 10)</code>\uff0c\u5728 <code>uint32</code> \u4e0b\u7b49\u4ef7\u4e8e\uff1a<code>timeElapsed = 5 + 10 = 15</code>\uff0c\u4e5f\u5c31\u662f\uff1a\u5b9e\u9645\u7ecf\u8fc7\u7684\u65f6\u95f4\uff0810 \u79d2\u5230\u5708\u5c3e + 5 \u79d2\u5230\u5f53\u524d\uff09\u3002</p> <p>\u8fd9\u5c31\u662f\u767d\u76ae\u4e66\u6240\u8bf4\u7684\u201coverflow-safe accumulation\u201d\uff1a\u53ea\u8981\u59cb\u7ec8\u7528\u540c\u6837\u7684 32 \u4f4d\u53d6\u6a21 + \u6ea2\u51fa\u8bed\u4e49\uff0c\u4e0d\u9700\u8981\u5173\u5fc3\u65f6\u95f4\u6233\u201c\u7ed5\u4e86\u51e0\u5708\u201d\uff0c\u6bcf\u6b21 delta \u90fd\u662f\u6b63\u786e\u7684\u3002</p>"},{"location":"web3/defi/uniswap_v2_price_precision_240610/#32_1","title":"3.2 \u4e3a\u4ec0\u4e48\u8bf4\u201c\u6ea2\u51fa\u5b89\u5168\u201d\uff1f","text":"<p>2\u00b3\u00b2 \u79d2 \u2248 4,294,967,296 \u79d2 \u2248 136 \u5e74\u3002</p> <p>\u6838\u5fc3\u95ee\u9898\u5728\u4e8e\uff1aTWAP \u7684\u8c03\u7528\u65b9\u4e5f\u8981\u7528\u540c\u6837\u7684\u6ea2\u51fa\u7b97\u672f\u3002</p> <p>\u8c03\u7528\u65b9\u901a\u5e38\u8fd9\u6837\u7b97\u4ef7\u683c\uff08\u6765\u81ea\u767d\u76ae\u4e66 2.2\uff09\uff1a</p> <ul> <li>\u5728 t1 \u65f6\u523b\u8bfb\u53d6\u4e00\u6b21 priceCumulativeLast\uff0c\u8bb0\u4f5c a1</li> <li>\u5728 t2 \u65f6\u523b\u518d\u8bfb\u4e00\u6b21 a2</li> <li>TWAP \u2248 (a2 - a1) / (t2 - t1)</li> </ul> <p>\u5982\u679c\uff1a</p> <ul> <li>t1 \u548c t2 \u4e4b\u95f4\u8de8\u8d8a\u4e86\u591a\u6b21 2\u00b3\u00b2 \u6ea2\u51fa\u5468\u671f\uff08\u6bd4\u5982\u9694\u4e86 300 \u5e74\uff0c\u7ed5\u4e86\u4e24\u5708\u591a\uff09\uff0c\u90a3\u4e48\u5355\u7eaf\u7528 32 \u4f4d\u65f6\u95f4\u6233\u5dee\u503c\u5c31\u4e0d\u591f\u533a\u5206\u4e86\u3002</li> <li>\u4f46\u53ea\u8981\u6bcf\u4e2a 2\u00b3\u00b2 \u79d2\uff08\u7ea6 136 \u5e74\uff09\u5185\u81f3\u5c11\u8bfb\u4e00\u6b21\uff0c\u4f60\u4e0d\u4f1a\u8de8\u8d8a\u8d85\u8fc7\u4e00\u5708\u7684\u6a21\u6570\uff0ct2 - t1 \u7684 32 \u4f4d\u6ea2\u51fa\u8bed\u4e49\u4ecd\u80fd\u6b63\u786e\u4ee3\u8868\u771f\u5b9e\u7ecf\u8fc7\u7684\u79d2\u6570\u3002</li> </ul> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff1a\u5047\u8bbe</p> <ul> <li>t1 =2^32-100\uff08\u6ea2\u51fa\u524d100\u79d2\uff09</li> <li>t2 =50\uff08\u6ea2\u51fa\u540e50\u79d2\uff0c\u5b9e\u9645\u65f6\u95f4\u6233\uff09</li> </ul> <p>\u76f4\u63a5\u76f8\u51cf\u4f1a\u51fa\u9519\uff1a<code>50 - (2^32 - 100) = \u8d1f\u6570</code>\uff0c\u4f46\u4f7f\u7528 <code>uint32</code> \u7684\u6a21\u8fd0\u7b97\uff1a</p> <p>\u65f6\u95f4\u5dee = <code>uint32(t2 - t1) = uint32(50-(2^32-100)) = uint32(-2^32+150)</code> = 150 \u79d2</p> <p>\u53ea\u8981\u4e24\u6b21\u91c7\u6837\u95f4\u9694 &lt; 2^32\u79d2\uff08136\u5e74\uff09\uff0c\u8ba1\u7b97\u5c31\u662f\u6b63\u786e\u7684\u3002</p>"}]}