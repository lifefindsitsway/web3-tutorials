<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="https://lifefindsitsway.wiki/web3/defi/defi_course_2024_edition_notes/" rel="canonical"/>
<link href="../../dapp/ethereum_address_size_240320/" rel="prev"/>
<link href="../uniswap_v2_price_precision_240610/" rel="next"/>
<link href="../../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.5.34" name="generator"/>
<title>《DeFi 课程（2024 版）》学习记录 - Life's Web3 开发指南</title>
<link href="../../../assets/stylesheets/main.35f28582.min.css" rel="stylesheet"/>
<link href="../../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto+Slab:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto Slab";--md-code-font:"Roboto Mono"}</style>
<link href="../../../css/heti.css" rel="stylesheet"/>
<link href="../../../assets/stylesheets/mathjax-custom.css" rel="stylesheet"/>
<link href="../../../assets/stylesheets/extra.css" rel="stylesheet"/>
<script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-KJB4RXSKZG"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-KJB4RXSKZG",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-KJB4RXSKZG",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
<script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
</head>
<body data-md-color-accent="deep-purple" data-md-color-primary="light-blue" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#defi-2024">
          跳转至
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="页眉" class="md-header__inner md-grid">
<a aria-label="Life's Web3 开发指南" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="Life's Web3 开发指南">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Life's Web3 开发指南
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              《DeFi 课程（2024 版）》学习记录
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="deep-purple" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="light-blue" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="deep-purple" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="black" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="搜索" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="搜索" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="查找" class="md-search__options">
<a aria-label="分享" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="分享">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
</a>
<button aria-label="清空当前内容" class="md-search__icon md-icon" tabindex="-1" title="清空当前内容" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/lifefindsitsway/web3-tutorials" title="前往仓库">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</div>
<div class="md-source__repository">
    web3-tutorials
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="导航栏" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Life's Web3 开发指南" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="Life's Web3 开发指南">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    Life's Web3 开发指南
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/lifefindsitsway/web3-tutorials" title="前往仓库">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</div>
<div class="md-source__repository">
    web3-tutorials
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../..">
<span class="md-ellipsis">
    Welcome to My Blog
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../changelog/">
<span class="md-ellipsis">
    更新日志
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    区块链基础
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            区块链基础
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../blockchain/the_evolution_of_bitcoin_240213/">
<span class="md-ellipsis">
    比特币的诞生历程
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../blockchain/blockchain_research_notes_2310/">
<span class="md-ellipsis">
    北京大学肖臻老师《区块链技术与应用》
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../blockchain/from_blockchain_to_the_metaverse_and_web3_220528/">
<span class="md-ellipsis">
    从区块链出发的元宇宙与Web3
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../blockchain/blockchain_and_innovative_thinking_notes_2101/">
<span class="md-ellipsis">
    南京大学公开课《区块链与创新思维》
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    Web3开发
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Web3开发
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../dapp/gas_optimization_guide_part1_gas_mechanism/">
<span class="md-ellipsis">
    Gas 优化指南（一）：Gas 机制原理
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../dapp/gas_optimization_guide_part2_eip1559_transaction_analysis/">
<span class="md-ellipsis">
    Gas 优化指南（二）：EIP-1559 交易解析
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../dapp/gas_optimization_guide_part3_storage_optimization/">
<span class="md-ellipsis">
    Gas 优化指南（三）：存储优化
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../dapp/gas_optimization_guide_part4_computation_optimization/">
<span class="md-ellipsis">
    Gas 优化指南（四）：计算优化
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../dapp/gas_optimization_guide_part5_gas_measurement/">
<span class="md-ellipsis">
    Gas 优化指南（五）：Gas 评估与测量
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../dapp/solidity_proxy_upgrade_series_part1/">
<span class="md-ellipsis">
    代理合约与可升级合约系列（一）：为什么需要可升级？
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../dapp/solidity_proxy_upgrade_series_part2/">
<span class="md-ellipsis">
    代理合约与可升级合约系列（二）：透明代理 vs UUPS
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../dapp/solidity_contract_call_part1_240521/">
<span class="md-ellipsis">
    Solidity 合约间调用（一）：四种方式调用已部署合约
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../dapp/solidity_contract_call_part2_240523/">
<span class="md-ellipsis">
    Solidity 合约间调用（二）：底层调用与 calldata 详解
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../dapp/solidity_contract_call_part3_240527/">
<span class="md-ellipsis">
    Solidity 合约间调用（三）：创建合约的两种方式：create 与 create2
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../dapp/nft_development/">
<span class="md-ellipsis">
    ERC-721 NFT 实战：合约编写、部署、Mint 全流程
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../dapp/hardhat_tutorial_240415/">
<span class="md-ellipsis">
    Hardhat 入门指南（25年更新版）
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../dapp/evm_fundamentals_part1_from_transactions_to_bytecode_240410/">
<span class="md-ellipsis">
    EVM 基础原理（一）：从交易到字节码
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../dapp/evm_fundamentals_part2_data_regions_and_contract_execution_240411/">
<span class="md-ellipsis">
    EVM 基础原理（二）：数据区域与合约执行
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../dapp/evm_fundamentals_part3_abi_encoding_and_low-level_calls_240413/">
<span class="md-ellipsis">
    EVM 基础原理（三）：ABI 编码与底层调用
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../dapp/address_240321/">
<span class="md-ellipsis">
    Solidity 地址类型 &amp; 常见用法全攻略
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../dapp/ethereum_address_size_240320/">
<span class="md-ellipsis">
    为什么以太坊地址是 20 字节？从私钥到地址的全解析
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    DeFi
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            DeFi
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    《DeFi 课程（2024 版）》学习记录
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    《DeFi 课程（2024 版）》学习记录
  </span>
</a>
<nav aria-label="目录" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      目录
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-defi">
<span class="md-ellipsis">
      第 1 课 - DeFi 课程简介
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-usdtusdcbusd">
<span class="md-ellipsis">
      第 2 课 - 稳定币：USDT/USDC/BUSD
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-daiampl">
<span class="md-ellipsis">
      第 3 课 - 稳定币：DAI/AMPL
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-erc4626">
<span class="md-ellipsis">
      第 4 课 - ERC4626
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#5-erc4626">
<span class="md-ellipsis">
      第 5 课 - ERC4626（二）
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#6-7-">
<span class="md-ellipsis">
      第 6 &amp; 7 课 - 去中心化交易所
    </span>
</a>
<nav aria-label="第 6 &amp; 7 课 - 去中心化交易所" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#chatgpt">
<span class="md-ellipsis">
      ChatGPT 补充：为什么需要链上自动做市商？
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#8-uniswap">
<span class="md-ellipsis">
      第 8 课 - Uniswap 简介
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#9-uniswap-v2">
<span class="md-ellipsis">
      第 9 课 - Uniswap V2 的手续费计算
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#10-uniswap-v2-twap">
<span class="md-ellipsis">
      第 10 课 - Uniswap V2 里的 TWAP
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11-uniswap-flash-swap">
<span class="md-ellipsis">
      第 11 课 - Uniswap 里的 Flash Swap
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#12-uniswap-v2">
<span class="md-ellipsis">
      第 12 课 - Uniswap V2 的无常损失计算
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#13-staking-reward">
<span class="md-ellipsis">
      第 13 课 - Staking Reward 原理及实现
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#14-uniswap-v3">
<span class="md-ellipsis">
      第 14 课 - Uniswap V3 简介
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#15-uniswap-v3">
<span class="md-ellipsis">
      第 15 课 - Uniswap V3 的集中流动性
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#16-uniswap-v3">
<span class="md-ellipsis">
      第 16 课 - Uniswap V3 的流动性计算
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#17-uniswap-v3">
<span class="md-ellipsis">
      第 17 课 - Uniswap V3 的无常损失计算
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#18-uniswap-v4">
<span class="md-ellipsis">
      第 18 课 - Uniswap V4 简介
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#19-">
<span class="md-ellipsis">
      第 19 课 - 去中心化借贷
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../uniswap_v2_price_precision_240610/">
<span class="md-ellipsis">
    Uniswap V2 价格精度解析
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../uniswap_v2_twap_oracle_240614/">
<span class="md-ellipsis">
    Uniswap V2 TWAP 预言机（数学推导 &amp; 源码解读）
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../flash_loan_attack_260101/">
<span class="md-ellipsis">
    闪电贷：从原理到攻击演示
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-ellipsis">
    合约审计
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            合约审计
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../audit/Heimdall-rs/">
<span class="md-ellipsis">
    Claude Code + Heimdall-rs 深度逆向 EVM 智能合约
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
<span class="md-ellipsis">
    Projects
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_7_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
            Projects
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../project/HybridRandomDiceGame/">
<span class="md-ellipsis">
    生产级骰子游戏（HybridRandomDiceGame）
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="目录" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      目录
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-defi">
<span class="md-ellipsis">
      第 1 课 - DeFi 课程简介
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-usdtusdcbusd">
<span class="md-ellipsis">
      第 2 课 - 稳定币：USDT/USDC/BUSD
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-daiampl">
<span class="md-ellipsis">
      第 3 课 - 稳定币：DAI/AMPL
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-erc4626">
<span class="md-ellipsis">
      第 4 课 - ERC4626
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#5-erc4626">
<span class="md-ellipsis">
      第 5 课 - ERC4626（二）
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#6-7-">
<span class="md-ellipsis">
      第 6 &amp; 7 课 - 去中心化交易所
    </span>
</a>
<nav aria-label="第 6 &amp; 7 课 - 去中心化交易所" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#chatgpt">
<span class="md-ellipsis">
      ChatGPT 补充：为什么需要链上自动做市商？
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#8-uniswap">
<span class="md-ellipsis">
      第 8 课 - Uniswap 简介
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#9-uniswap-v2">
<span class="md-ellipsis">
      第 9 课 - Uniswap V2 的手续费计算
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#10-uniswap-v2-twap">
<span class="md-ellipsis">
      第 10 课 - Uniswap V2 里的 TWAP
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11-uniswap-flash-swap">
<span class="md-ellipsis">
      第 11 课 - Uniswap 里的 Flash Swap
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#12-uniswap-v2">
<span class="md-ellipsis">
      第 12 课 - Uniswap V2 的无常损失计算
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#13-staking-reward">
<span class="md-ellipsis">
      第 13 课 - Staking Reward 原理及实现
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#14-uniswap-v3">
<span class="md-ellipsis">
      第 14 课 - Uniswap V3 简介
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#15-uniswap-v3">
<span class="md-ellipsis">
      第 15 课 - Uniswap V3 的集中流动性
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#16-uniswap-v3">
<span class="md-ellipsis">
      第 16 课 - Uniswap V3 的流动性计算
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#17-uniswap-v3">
<span class="md-ellipsis">
      第 17 课 - Uniswap V3 的无常损失计算
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#18-uniswap-v4">
<span class="md-ellipsis">
      第 18 课 - Uniswap V4 简介
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#19-">
<span class="md-ellipsis">
      第 19 课 - 去中心化借贷
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="defi-2024"><span>DeFi<span class="heti-spacing"> </span></span>课程（<span>2024<span class="heti-spacing"> </span></span>版）学习笔记<a class="headerlink" href="#defi-2024" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h1>
<div style="margin-top: -30px; font-size: 0.75em; opacity: 0.7;">
<p><span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10h-2a8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8zm6.78 1a.7.7 0 0 0-.48.2l-1.22 1.21 2.5 2.5L20.8 5.7c.26-.26.26-.7 0-.95L19.25 3.2c-.13-.13-.3-.2-.47-.2m-2.41 2.12L9 12.5V15h2.5l7.37-7.38z"></path></svg></span> 约<span class="heti-skip"><span class="heti-spacing"> </span>7744<span class="heti-spacing"> </span></span>个字 <span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21 17H7V3h14m0-2H7a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2M3 5H1v16a2 2 0 0 0 2 2h16v-2H3m12.96-10.71-2.75 3.54-1.96-2.36L8.5 15h11z"></path></svg></span> <span>59<span class="heti-spacing"> </span></span>张图片 <span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 20c4.42 0 8-3.58 8-8s-3.58-8-8-8-8 3.58-8 8 3.58 8 8 8m0-18c5.5 0 10 4.5 10 10s-4.5 10-10 10C6.47 22 2 17.5 2 12S6.5 2 12 2m.5 11H11V7h1.5v4.26l3.7-2.13.75 1.3z"></path></svg></span> 预计阅读时间<span class="heti-skip"><span class="heti-spacing"> </span>26<span class="heti-spacing"> </span></span>分钟</p>
</div>
<blockquote>
<p>本文是我<span class="heti-skip"><span class="heti-spacing"> </span>2024<span class="heti-spacing"> </span></span>年在<span class="heti-skip"><span class="heti-spacing"> </span>B<span class="heti-spacing"> </span></span>站学习梁培利老师的公开课程《<span>DeFi<span class="heti-spacing"> </span></span>课程（<span>2024<span class="heti-spacing"> </span></span>版<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>》时整理的学习笔记。课程以<span class="heti-skip"><span class="heti-spacing"> </span>Uniswap<span class="heti-spacing"> </span></span>为核心，系统梳理了<span class="heti-skip"><span class="heti-spacing"> </span>DeFi<span class="heti-spacing"> </span></span>领域的关键概念与协议原理，涵盖稳定币、去中心化交易所、借贷协议等主题。笔记中保留了课堂要点、案例分析以及我个人的一些补充说明，希望对同样在学习<span class="heti-skip"><span class="heti-spacing"> </span>DeFi<span class="heti-spacing"> </span></span>的朋友有所帮助。
</p>
</blockquote>
<p><strong>📢 课程更新提示</strong>：该课程<span class="heti-skip"><span class="heti-spacing"> </span>2025<span class="heti-spacing"> </span></span>年已推出最新版——<a href="https://space.bilibili.com/220951871/lists/5076602">《<span>Uniswap<span class="heti-spacing"> </span></span>专题：从<span class="heti-skip"><span class="heti-spacing"> </span>V1<span class="heti-spacing"> </span></span>到<span><span class="heti-spacing"> </span>V4</span><heti-adjacent class="heti-adjacent-half">》</heti-adjacent></a>，讲解内容更为详细，重点介绍了<span class="heti-skip"><span class="heti-spacing"> </span>Uniswap V3<span class="heti-spacing"> </span></span>的机制原理，推荐感兴趣的读者关注。</p>
<p>课程视频：<a href="https://space.bilibili.com/220951871/lists/2824381">https://space.bilibili.com/220951871/lists/2824381</a></p>
<p>课程幻灯片和讲义：<a href="https://github.com/liangpeili">https://github.com/liangpeili</a></p>
<h2 id="1-defi">第<span class="heti-skip"><span class="heti-spacing"> </span>1<span class="heti-spacing"> </span></span>课<span class="heti-skip"><span class="heti-spacing"> </span>- DeFi<span class="heti-spacing"> </span></span>课程简介<a class="headerlink" href="#1-defi" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<p><strong>区块链应用的常见分类：</strong></p>
<ul>
<li>DeFi：<span>Uniswap/AAVE/Curve/DAI/Compound<span class="heti-spacing"> </span></span>等；</li>
<li>GameFi：从<span class="heti-skip"><span class="heti-spacing"> </span>CryptoKitties<span class="heti-spacing"> </span></span>开始；</li>
<li>SocialFi：nostr/Damus/friend.tech；</li>
<li>国内目前政策：去<span class="heti-skip"><span class="heti-spacing"> </span>Fi<span class="heti-spacing"> </span></span>留<span><span class="heti-spacing"> </span>block</span>，服务实体经济；</li>
</ul>
<p><strong><span>CeFi<span class="heti-spacing"> </span></span>的主要组成机构与职能：</strong></p>
<ul>
<li>中央银行：发行法定货币；</li>
<li>商业银行：存款、结算、信贷等；</li>
<li>保险公司：风险转移与分散；</li>
<li>证券公司：证券买卖、交易，证券承销等；</li>
<li>银监会、证监会和保监会；</li>
<li>国家金融监督管理总局；</li>
</ul>
<p><strong><span>CeFi<span class="heti-spacing"> </span></span>的特点：</strong></p>
<ul>
<li>集中的账户管理；</li>
<li>交易审查与监控；</li>
<li>基于对机构的信任；</li>
<li>手续费作为主要利润来源；</li>
<li>不透明性<span class="heti-skip"><span class="heti-spacing"> </span>/<span class="heti-spacing"> </span></span>信息差；</li>
</ul>
<p>穷人死于<span><span class="heti-spacing"> </span>P2P</span>、中产死于理财，富人死于信托。</p>
<p><strong><span>DeFi<span class="heti-spacing"> </span></span>能做什么：</strong></p>
<ul>
<li>全球支付；</li>
<li>交易；</li>
<li>理财；</li>
<li>借款；</li>
<li>贷款；</li>
<li>衍生品；</li>
</ul>
<p><strong><span>DeFi<span class="heti-spacing"> </span></span>的特点：</strong></p>
<ul>
<li>账号个人管理：Not your keys, not your coins；</li>
<li>无需许可；</li>
<li>开源可验证；</li>
<li>可编程性；</li>
</ul>
<blockquote>
<p>注意：目前国内并没有做纯<span class="heti-skip"><span class="heti-spacing"> </span>DeFi<span class="heti-spacing"> </span></span>的政策空间。</p>
</blockquote>
<p><strong>课程安排：</strong></p>
<ul>
<li>以<span class="heti-skip"><span class="heti-spacing"> </span>Uniswap<span class="heti-spacing"> </span></span>为核心，梳理<span class="heti-skip"><span class="heti-spacing"> </span>DeFi<span class="heti-spacing"> </span></span>领域的上下游产品及其原理；</li>
<li>从稳定币入手，逐步介绍去中心化交易所<span class="heti-skip"><span class="heti-spacing"> </span>Uniswap<span class="heti-spacing"> </span></span>的核心逻辑，进而扩展到其他领域<span class="heti-skip"><span class="heti-spacing"> </span>DeFi<span class="heti-spacing"> </span></span>产品（如借贷等）和算法；</li>
<li>理论课<span class="heti-skip"><span class="heti-spacing"> </span>24<span class="heti-spacing"> </span></span>学时<span class="heti-skip"><span class="heti-spacing"> </span>+<span class="heti-spacing"> </span></span>实验课<span class="heti-skip"><span class="heti-spacing"> </span>8<span class="heti-spacing"> </span></span>学时；</li>
<li>《区块链应用系统开发实践》<span>32<span class="heti-spacing"> </span></span>学时；</li>
</ul>
<blockquote>
<p>梁老师的一个小野心：把这个课程做成中文圈里最好的。</p>
</blockquote>
<h2 id="2-usdtusdcbusd">第<span class="heti-skip"><span class="heti-spacing"> </span>2<span class="heti-spacing"> </span></span>课<span class="heti-skip"><span class="heti-spacing"> </span>-<span class="heti-spacing"> </span></span>稳定币：USDT/USDC/BUSD<a class="headerlink" href="#2-usdtusdcbusd" title="Permanent link">¶</a></h2>
<p><strong>货币的演化：</strong></p>
<ul>
<li>实物货币；</li>
<li>金属货币；</li>
<li>基于黄金等贵金属抵押的法定货币；</li>
<li>基于信用的法定货币；</li>
<li>电子货币；</li>
<li>数字货币？</li>
</ul>
<p>通货膨胀有利于经济发展，而通货紧缩不利于。</p>
<p><strong>稳定币：沟通赛博空间和现实世界的桥梁</strong></p>
<ul>
<li>加密货币的波动太大；</li>
<li>相比加密货币，人们更相信法币；</li>
<li>在加密货币世界，也需要价值锚定；</li>
</ul>
<p><strong>稳定币的类型：</strong></p>
<ul>
<li>基于法币锚定的稳定币：<span>USDT/USDC/BUSD<span class="heti-spacing"> </span></span>等；</li>
<li>基于加密资产超额抵押的稳定币：DAI；</li>
<li>基于算法的稳定币（算法稳定币<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>：<span>UST/Frax<span class="heti-spacing"> </span></span>等；</li>
</ul>
<p><strong>基于法币抵押的稳定币<span><span class="heti-spacing"> </span>-- USDT</span></strong></p>
<ul>
<li>稳定币市值排名第一；</li>
<li>由<span class="heti-skip"><span class="heti-spacing"> </span>Tether<span class="heti-spacing"> </span></span>发行；</li>
<li>中心化管理；</li>
</ul>
<p><a href="https://tether.to">https://tether.to</a></p>
<p>There are five steps in the lifecycle of Tether tokens：</p>
<ol>
<li>一个经过<span class="heti-skip"><span class="heti-spacing"> </span>KYC<span class="heti-spacing"> </span></span>认证的个人或机构可以充值法币到<span class="heti-skip"><span class="heti-spacing"> </span>Tether<span class="heti-spacing"> </span></span>公司持有的银行账户中；</li>
<li><span>Tether<span class="heti-spacing"> </span></span>公司发行<span class="heti-skip"><span class="heti-spacing"> </span>USDT<span class="heti-spacing"> </span></span>到这个用户或公司提供的地址，<span>Tether<span class="heti-spacing"> </span></span>公司转给用户的数量和用户充值给<span class="heti-skip"><span class="heti-spacing"> </span>Tether<span class="heti-spacing"> </span></span>公司银行账户的数量一样；</li>
<li>用户持有<span class="heti-skip"><span class="heti-spacing"> </span>USDT<span class="heti-spacing"> </span></span>就可以拿这个去参与链上产品，比如说存储、理财、交换等；</li>
<li>用户如果不想再持有<span class="heti-skip"><span class="heti-spacing"> </span>USDT<span class="heti-spacing"> </span></span>了，可以在<span class="heti-skip"><span class="heti-spacing"> </span>tether.to<span class="heti-spacing"> </span></span>上转回去；</li>
<li><span>Tether<span class="heti-spacing"> </span></span>公司把法币从自己公司转到用户的银行账户上，并销毁链上对应数量的<span><span class="heti-spacing"> </span>USDT</span>；</li>
</ol>
<blockquote>
<p>💡 <span>Tether<span class="heti-spacing"> </span></span>公司将近<span class="heti-skip"><span class="heti-spacing"> </span>100<span class="heti-spacing"> </span></span>人，<span>2023<span class="heti-spacing"> </span></span>年第四季度净利润近<span class="heti-skip"><span class="heti-spacing"> </span>200<span class="heti-spacing"> </span></span>亿人民币；同期的小米公司员工超过<span class="heti-skip"><span class="heti-spacing"> </span>3<span class="heti-spacing"> </span></span>万人，净利润近<span class="heti-skip"><span class="heti-spacing"> </span>49<span class="heti-spacing"> </span></span>亿人民币。</p>
</blockquote>
<p>区块链公司跟互联网公司的区别：区块链公司不需要很多人，那它需要什么样的人？在这个行业待下去的收益是互联网的很多倍。</p>
<p><img alt="https://www.techflowpost.com/newsletter/detail_45129.html" src="../../../assets/images/defi_course_2024_edition/1.png"/></p>
<p><img alt="img" src="../../../assets/images/defi_course_2024_edition/2.png"/></p>
<p><strong>基于法币抵押的稳定币<span><span class="heti-spacing"> </span>-- USDC</span></strong></p>
<ul>
<li>稳定币市值排名第二；</li>
<li>由<span class="heti-skip"><span class="heti-spacing"> </span>Circle<span class="heti-spacing"> </span></span>管理和发行；</li>
</ul>
<p><strong>基于法币抵押的稳定币<span><span class="heti-spacing"> </span>-- BUSD</span></strong></p>
<ul>
<li><span>Paxos<span class="heti-spacing"> </span></span>发行的美元稳定币；</li>
<li>受纽约金融服务局<span class="heti-skip"><span class="heti-spacing"> </span>NYDFS<span class="heti-spacing"> </span></span>的监管；</li>
<li>用了<span class="heti-skip"><span class="heti-spacing"> </span>Binance<span class="heti-spacing"> </span></span>的品牌；</li>
<li>可以<span class="heti-skip"><span class="heti-spacing"> </span>1:1<span class="heti-spacing"> </span></span>购买和赎回；</li>
<li><span>100%<span class="heti-spacing"> </span></span>的美元或者美元现金等价物支撑；</li>
<li>仅在以太坊发行；</li>
<li><span>2023<span class="heti-spacing"> </span></span>年<span class="heti-skip"><span class="heti-spacing"> </span>2<span class="heti-spacing"> </span></span>月份停止发行；</li>
</ul>
<h2 id="3-daiampl">第<span class="heti-skip"><span class="heti-spacing"> </span>3<span class="heti-spacing"> </span></span>课<span class="heti-skip"><span class="heti-spacing"> </span>-<span class="heti-spacing"> </span></span>稳定币：DAI/AMPL<a class="headerlink" href="#3-daiampl" title="Permanent link">¶</a></h2>
<p><strong>基于加密资产超额抵押的稳定币<span><span class="heti-spacing"> </span>-- DAI</span></strong></p>
<ul>
<li><span>DAI<span class="heti-spacing"> </span></span>是<span class="heti-skip"><span class="heti-spacing"> </span>Maker Protocol<span class="heti-spacing"> </span></span>的主要产品；</li>
<li><span>Maker Protocol<span class="heti-spacing"> </span></span>由<span class="heti-skip"><span class="heti-spacing"> </span>MakerDAO<span class="heti-spacing"> </span></span>管理；</li>
<li><span>MKR<span class="heti-spacing"> </span></span>是<span class="heti-skip"><span class="heti-spacing"> </span>MakerDAO<span class="heti-spacing"> </span></span>的治理代币；</li>
</ul>
<p><img alt="4" src="../../../assets/images/defi_course_2024_edition/3.png"/></p>
<p><img alt="img" src="../../../assets/images/defi_course_2024_edition/4.png"/></p>
<p><img alt="5" src="../../../assets/images/defi_course_2024_edition/5.png"/></p>
<p><strong><span>DAI<span class="heti-spacing"> </span></span>的供应量控制：</strong></p>
<ul>
<li>贷款利率：Stability Fee</li>
<li>存款利率：DAI Saving Rate（DSR）</li>
<li>如果<span><span class="heti-spacing"> </span>1 DAI = 0.99 USD</span>，提高利率；</li>
<li>如果<span><span class="heti-spacing"> </span>1 DAI = 1.01 USD</span>，降低利率；</li>
</ul>
<p><img alt="6" src="../../../assets/images/defi_course_2024_edition/6.png"/></p>
<blockquote>
<p><span>MakerDAO<span class="heti-spacing"> </span></span>的员工数比<span class="heti-skip"><span class="heti-spacing"> </span>Tether<span class="heti-spacing"> </span></span>更少。</p>
</blockquote>
<p>课后思考：研究<span class="heti-skip"><span class="heti-spacing"> </span>DAI<span class="heti-spacing"> </span></span>的盈利方式，为什么会有这么高的收入<heti-adjacent class="heti-adjacent-half">？</heti-adjacent>（这类问题是区块链项目创业一个比较好的思考切入点）</p>
<p><strong>案例分析</strong></p>
<ul>
<li>假设<span><span class="heti-spacing"> </span>1 ETH = 2000 USD</span>，质押了<span class="heti-skip"><span class="heti-spacing"> </span>5<span class="heti-spacing"> </span></span>个<span class="heti-skip"><span class="heti-spacing"> </span>ETH<span class="heti-spacing"> </span></span>到<span><span class="heti-spacing"> </span>Maker Vault</span>，按照<span class="heti-skip"><span class="heti-spacing"> </span>150%<span class="heti-spacing"> </span></span>的超额抵押率，最多可以借出<span class="heti-skip"><span class="heti-spacing"> </span>10000 / 150% = 6666.67<span class="heti-spacing"> </span></span>个<span><span class="heti-spacing"> </span>DAI</span>。保险起见，用户借出<span><span class="heti-spacing"> </span>5000 DAI</span>，其余<span class="heti-skip"><span class="heti-spacing"> </span>1666.67<span class="heti-spacing"> </span></span>为缓冲区。</li>
<li>情形<span><span class="heti-spacing"> </span>1</span>：<span>ETH<span class="heti-spacing"> </span></span>涨价到<span><span class="heti-spacing"> </span>3000 USD</span>。此时<span><span class="heti-spacing"> </span>5 ETH = 15000 USD</span>，基于<span class="heti-skip"><span class="heti-spacing"> </span>150%<span class="heti-spacing"> </span></span>的抵押率，用户最多可以借出<span><span class="heti-spacing"> </span>10000 DAI</span>。</li>
<li>情形<span><span class="heti-spacing"> </span>2</span>：<span>ETH<span class="heti-spacing"> </span></span>跌到<span><span class="heti-spacing"> </span>1500 USD</span>，此时<span><span class="heti-spacing"> </span>5 ETH = 7500 USD</span>，7500 USD / 5000 DAI = 150%。用户面临三个选择：<ul>
<li>往<span class="heti-skip"><span class="heti-spacing"> </span>Maker Vault<span class="heti-spacing"> </span></span>质押更多的<span><span class="heti-spacing"> </span>ETH</span>；</li>
<li>还回<span><span class="heti-spacing"> </span>5000 DAI + Stability Fee</span>，拿回<span class="heti-skip"><span class="heti-spacing"> </span>5<span class="heti-spacing"> </span></span>个<span><span class="heti-spacing"> </span>ETH</span>；</li>
<li>还回部分<span><span class="heti-spacing"> </span>DAI + Stability Fee</span>，增加自己的缓冲区；</li>
</ul>
</li>
</ul>
<p><strong><span>DAI<span class="heti-spacing"> </span></span>的防护网之一 ——Collateral Auction</strong></p>
<ul>
<li>情形<span><span class="heti-spacing"> </span>3</span>：<span>ETH<span class="heti-spacing"> </span></span>跌到<span><span class="heti-spacing"> </span>1200 USD</span>，此时<span><span class="heti-spacing"> </span>5 ETH = 6000 USD</span>，触发清算，<span>Keeper<span class="heti-spacing"> </span></span>介入清算流程；</li>
<li><span>5<span class="heti-spacing"> </span></span>个<span class="heti-skip"><span class="heti-spacing"> </span>ETH<span class="heti-spacing"> </span></span>按照市价折扣<span class="heti-skip"><span class="heti-spacing"> </span>3%<span class="heti-spacing"> </span></span>进行拍卖，每次增加<span><span class="heti-spacing"> </span>0.5%</span>，直到拍卖成功；</li>
<li><span>Keeper<span class="heti-spacing"> </span></span>使用<span class="heti-skip"><span class="heti-spacing"> </span>DAI<span class="heti-spacing"> </span></span>来竞拍，价高者得；</li>
<li>扣除<span class="heti-skip"><span class="heti-spacing"> </span>5000 DAI + Penalty Fee<span class="heti-spacing"> </span></span>等费用，其余<span class="heti-skip"><span class="heti-spacing"> </span>ETH<span class="heti-spacing"> </span></span>返回给用户；</li>
</ul>
<p><strong><span>DAI<span class="heti-spacing"> </span></span>的防护网之二——Maker Buffer</strong></p>
<ul>
<li><span>Stability Fee / Penalty Fee<span class="heti-spacing"> </span></span>等缓慢积攒；</li>
<li>情形<span><span class="heti-spacing"> </span>4</span>：<span>ETH<span class="heti-spacing"> </span></span>跌到<span><span class="heti-spacing"> </span>900 USD</span>，此时<span><span class="heti-spacing"> </span>5 ETH = 4500 USD</span>，拍卖后的缺口为<span><span class="heti-spacing"> </span>500 USD</span>；</li>
<li>从<span class="heti-skip"><span class="heti-spacing"> </span>Maker Buffer<span class="heti-spacing"> </span></span>支付<span><span class="heti-spacing"> </span>500 DAI</span>，弥补缺口；</li>
</ul>
<p><strong><span>DAI<span class="heti-spacing"> </span></span>的防护网之三——Debt Auction</strong></p>
<ul>
<li>情形<span><span class="heti-spacing"> </span>5</span>：<span>ETH<span class="heti-spacing"> </span></span>跌到<span><span class="heti-spacing"> </span>900 USD</span>，此时<span><span class="heti-spacing"> </span>5 ETH = 4500 USD</span>，拍卖后的缺口为<span><span class="heti-spacing"> </span>500 USD</span>，而<span class="heti-skip"><span class="heti-spacing"> </span>Maker Buffer<span class="heti-spacing"> </span></span>里只有<span><span class="heti-spacing"> </span>100 DAI</span>，资金缺口为<span><span class="heti-spacing"> </span>400 USD</span>。</li>
<li>增发<span class="heti-skip"><span class="heti-spacing"> </span>MKR<span class="heti-spacing"> </span></span>进行拍卖；</li>
<li>用户使用<span class="heti-skip"><span class="heti-spacing"> </span>DAI<span class="heti-spacing"> </span></span>参与拍卖，拍卖得到的<span class="heti-skip"><span class="heti-spacing"> </span>DAI<span class="heti-spacing"> </span></span>来弥补缺口；</li>
<li>这是一种对社区治理的惩罚方式；</li>
</ul>
<p>增发<span class="heti-skip"><span class="heti-spacing"> </span>MKR<span class="heti-spacing"> </span></span>使得币的价值被稀释。</p>
<p><strong>Decentralized Autonomous Organization (DAO)</strong></p>
<ul>
<li>一种新型的组织形式</li>
<li>发行治理<span><span class="heti-spacing"> </span>Token</span></li>
<li>治理<span class="heti-skip"><span class="heti-spacing"> </span>Token<span class="heti-spacing"> </span></span>代表投票权</li>
<li>社区共治、共建、共享</li>
</ul>
<p><strong><span>MakerDAO<span class="heti-spacing"> </span></span>的运行机制</strong></p>
<ul>
<li>
<p>提案阶段</p>
<ul>
<li>
<ol>
<li>发起提案：任何<span class="heti-skip"><span class="heti-spacing"> </span>MKR<span class="heti-spacing"> </span></span>持有人都可以发起新提案；</li>
</ol>
</li>
<li>
<ol start="2">
<li>在<span class="heti-skip"><span class="heti-spacing"> </span>MakerDAO<span class="heti-spacing"> </span></span>社区讨论；</li>
</ol>
</li>
<li>
<ol start="3">
<li>提交优化后的提案；</li>
</ol>
</li>
<li>
<ol start="4">
<li><span>Risk Team<span class="heti-spacing"> </span></span>对其进行风险评估；</li>
</ol>
</li>
</ul>
</li>
<li>
<p>投票阶段</p>
<ul>
<li>一个<span class="heti-skip"><span class="heti-spacing"> </span>MKR Token<span class="heti-spacing"> </span></span>表示一个投票权，可以代理；</li>
<li>投票期一般持续<span class="heti-skip"><span class="heti-spacing"> </span>7<span class="heti-spacing"> </span></span>天；</li>
<li>根据投票结果决定是否通过<heti-adjacent class="heti-adjacent-half">；</heti-adjacent>（<span>4%<span class="heti-spacing"> </span></span>同意）</li>
</ul>
</li>
</ul>
<p><strong>Surplus Auction</strong></p>
<ul>
<li>Maker Buffer Limit</li>
<li>超出限制后的<span class="heti-skip"><span class="heti-spacing"> </span>DAI<span class="heti-spacing"> </span></span>用来拍卖购买<span><span class="heti-spacing"> </span>MKR</span></li>
<li>销毁<span><span class="heti-spacing"> </span>MKR</span></li>
<li>一种社区治理的奖励方式</li>
</ul>
<p>用户参与一些协议的质押，可以用来加杠杆，例如有<span><span class="heti-spacing"> </span>1 ETH</span>，借出来一些币拿来买<span><span class="heti-spacing"> </span>ETH</span>，再把买来的<span class="heti-skip"><span class="heti-spacing"> </span>ETH<span class="heti-spacing"> </span></span>放进去借钱，依次重复。</p>
<blockquote>
<p>💡 在学习一种新的协议时，都要思考一个问题：为什么别人愿意来参与你的协议？</p>
</blockquote>
<p><img alt="7" src="../../../assets/images/defi_course_2024_edition/7.png"/></p>
<p><strong>总结：</strong></p>
<ul>
<li>稳定币诞生的原因；</li>
<li>稳定币的类型：USDT/USDC/BUSD/DAI/AMPL；</li>
<li><span>USDT<span class="heti-spacing"> </span></span>的中心性；</li>
<li><span>DAI<span class="heti-spacing"> </span></span>的运行原理；</li>
<li><span>Maker Protocol<span class="heti-spacing"> </span></span>中的清算；</li>
<li><span>AMPL<span class="heti-spacing"> </span></span>的运行原理；</li>
</ul>
<h2 id="4-erc4626">第<span class="heti-skip"><span class="heti-spacing"> </span>4<span class="heti-spacing"> </span></span>课<span><span class="heti-spacing"> </span>- ERC4626</span><a class="headerlink" href="#4-erc4626" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<p><strong>Vault</strong></p>
<ul>
<li>资产的管理、分红</li>
<li>用户充值某项资产，获取某个凭证</li>
<li>该凭证作为分红、退出的依据</li>
<li><span>Yield Farming /<span class="heti-spacing"> </span></span>借贷<span class="heti-skip"><span class="heti-spacing"> </span>/<span class="heti-spacing"> </span></span>质押等</li>
</ul>
<p><a href="https://eips.ethereum.org/EIPS/eip-4626">https://eips.ethereum.org/EIPS/eip-4626</a></p>
<blockquote>
<p>💡 建议研究<span class="heti-skip"><span class="heti-spacing"> </span>ERC20<span class="heti-spacing"> </span></span>提案的原始内容。</p>
</blockquote>
<p><span>EIP<span class="heti-spacing"> </span></span>从想法到落地的流程：</p>
<ol>
<li>产生一个想法；</li>
<li>提出<span><span class="heti-spacing"> </span>Proposal</span>；</li>
<li>讨论通过后正式成为标准；</li>
<li>第三方库（例如<span><span class="heti-spacing"> </span>OpenZeppelin</span>）根据这个标准去实现；</li>
<li>开发者使用。</li>
</ol>
<h2 id="5-erc4626">第<span class="heti-skip"><span class="heti-spacing"> </span>5<span class="heti-spacing"> </span></span>课<span><span class="heti-spacing"> </span>- ERC4626</span>（二）<a class="headerlink" href="#5-erc4626" title="Permanent link">¶</a></h2>
<p>本节课简略过了一遍<span class="heti-skip"><span class="heti-spacing"> </span>ERC4626<span class="heti-spacing"> </span></span>的实现细节，此处省略。</p>
<h2 id="6-7-">第<span class="heti-skip"><span class="heti-spacing"> </span>6 &amp; 7<span class="heti-spacing"> </span></span>课<span class="heti-skip"><span class="heti-spacing"> </span>-<span class="heti-spacing"> </span></span>去中心化交易所<a class="headerlink" href="#6-7-" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<p><span>DeFi<span class="heti-spacing"> </span></span>领域的三大支柱：稳定币、交易所、借贷。</p>
<p><strong>交易所：</strong></p>
<ul>
<li>证券交易所</li>
<li>期货交易所</li>
<li>
<p>加密资产交易所</p>
<ul>
<li>中心化交易所</li>
<li>去中心化交易所</li>
</ul>
</li>
</ul>
<p><span>2017<span class="heti-spacing"> </span></span>年<span class="heti-skip"><span class="heti-spacing"> </span>9<span class="heti-spacing"> </span></span>月<span class="heti-skip"><span class="heti-spacing"> </span>4<span class="heti-spacing"> </span></span>日，七部门联合发布《关于防范代币发行融资风险的公告<heti-adjacent class="heti-adjacent-half">》</heti-adjacent>，然后<span class="heti-skip"><span class="heti-spacing"> </span>Binance<span class="heti-spacing"> </span></span>出海了，但是<span class="heti-skip"><span class="heti-spacing"> </span>OKX<span class="heti-spacing"> </span></span>总部却还在北京，甚至发行了<span><span class="heti-spacing"> </span>OKX token</span>。</p>
<p>从<span class="heti-skip"><span class="heti-spacing"> </span>2020<span class="heti-spacing"> </span></span>年开始有<span class="heti-skip"><span class="heti-spacing"> </span>DEX<span class="heti-spacing"> </span></span>这个赛道。</p>
<p><strong>中心化交易所的业务模式——以币安为例</strong></p>
<ul>
<li><strong>交易费</strong>：交易所通过提供买卖加密货币的平台来收取交易费用。有些交易所还提供高级交易选项，如杠杆交易，这通常会带来更高的费用；</li>
<li><strong>上币费</strong>：项目方团队后面都会去找交易所上币，然而上币需要缴纳一笔数额不小的上币费；</li>
<li><strong>量化交易</strong>：用户在交易所中，一般数字资产都是暂时存放在交易所，基本上交易所掌握所有筹码可以选择做多或者做空，交易所可以去赚取差价，而用户提币出去也能赚取手续费；</li>
<li><strong>原生代币</strong>；</li>
</ul>
<blockquote>
<p>💡 梁老师举了个例子：自己了解到的一个项目，<span>2017<span class="heti-spacing"> </span></span>年左右为了上前三的交易所，上币费为<span class="heti-skip"><span class="heti-spacing"> </span>1100<span class="heti-spacing"> </span></span>万人民币（购买交易所发行的原生代币，参与投票竞选<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>。项目方安全审计要花钱，上交易所也要花钱，而且还得通过内部关系，熟人才行。交易所特别赚钱。</p>
</blockquote>
<p><img alt="8" src="../../../assets/images/defi_course_2024_edition/8.png"/></p>
<p><strong>中心化交易所的交易模式——订单簿模式</strong></p>
<ul>
<li>中央限价订单簿（CLOB）就是一本由出价和报价组成的完全透明账本，从最优价开始依次排序（两边分别是参与者愿意买<span class="heti-skip"><span class="heti-spacing"> </span>/<span class="heti-spacing"> </span></span>卖的价格<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>。</li>
<li>所有的参与者都能看到所有的报价和出价，他们也可以参与其中。</li>
<li>订单簿中两边的第一行，即是最优的报价<span class="heti-skip"><span class="heti-spacing"> </span>/<span class="heti-spacing"> </span></span>出价。</li>
</ul>
<p><strong>订单簿模式的优劣</strong></p>
<p>优势：</p>
<ul>
<li>透明的流动性</li>
<li>做市商可自由出入</li>
<li>做市商可以自由决定价格与数量</li>
</ul>
<p>劣势：</p>
<ul>
<li>冷启动问题（很难给出初始流动性）</li>
<li>对非流动性资产不利</li>
<li>如果是链上交易所，则对链的<span class="heti-skip"><span class="heti-spacing"> </span>TPS<span class="heti-spacing"> </span></span>的要求很高</li>
</ul>
<p>交易所刚开始的时候需要很大的资金量，用户玩的顺畅，才会吸引更多用户过来。</p>
<p>早期去中心化交易所使用订单簿的模式，但由于链上<span class="heti-skip"><span class="heti-spacing"> </span>TPS<span class="heti-spacing"> </span></span>太低，没有发展起来。</p>
<p><img alt="9" src="../../../assets/images/defi_course_2024_edition/9.png"/></p>
<p><strong>链上交易方案：自动做市商</strong></p>
<ul>
<li>出现原因：以太坊的<span class="heti-skip"><span class="heti-spacing"> </span>TPS<span class="heti-spacing"> </span></span>对于支撑链上订单簿的实时更新来说太低了。反面案例：<span>Solana<span class="heti-spacing"> </span></span>链由于其<span class="heti-skip"><span class="heti-spacing"> </span>60K<span class="heti-spacing"> </span></span>的<span><span class="heti-spacing"> </span>TPS</span>，其上有许多订单簿模式的交易所。</li>
<li>交易所里没有订单簿，只有一系列预设的函数，为各类货币的互相交换来定价。</li>
<li>这些预设的函数（例如<span><span class="heti-spacing"> </span>x*y=k</span>）基于两种货币在各自流动性池中的供给变化率来设定价格。在某个货币的流动性池内，任何人都能够提供该种货币以增加其流动性，从而获得收益。</li>
</ul>
<p><img alt="10" src="../../../assets/images/defi_course_2024_edition/10.png"/></p>
<p>两个代币数量的乘积等于一个常量。</p>
<p>Vault：放一些币进去，返回一个<span><span class="heti-spacing"> </span>share</span>，表示放进去的凭证。</p>
<p>用户将流动性放到一个交易池里，交易池会给用户发行一个新的<span><span class="heti-spacing"> </span>Token</span>，叫<span><span class="heti-spacing"> </span>Liquidity Provider Token</span>（LPT<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>。</p>
<p>只要有价差，就有套利空间，就会被套利机器人吃掉。</p>
<p><img alt="11" src="../../../assets/images/defi_course_2024_edition/11.png"/></p>
<p><img alt="12" src="../../../assets/images/defi_course_2024_edition/12.png"/></p>
<p><strong><span>DEX<span class="heti-spacing"> </span></span>的去中心化：</strong></p>
<ul>
<li>任何人都可以添加流动性，成为<span><span class="heti-spacing"> </span>LP</span>，并拿到<span><span class="heti-spacing"> </span>LP Token</span>；</li>
<li><span>LP<span class="heti-spacing"> </span></span>在任意时间可以移除流动性并销毁<span><span class="heti-spacing"> </span>LP Token</span>，拿回自己添加的<span><span class="heti-spacing"> </span>Token</span>；</li>
<li>用户可以使用非官方的前端页面来进行交易；</li>
<li>交易时收取一定手续费，并且分配给<span><span class="heti-spacing"> </span>LPT Holder</span>；</li>
</ul>
<p>提供<span class="heti-skip"><span class="heti-spacing"> </span>LP<span class="heti-spacing"> </span></span>可能亏损，需要承担无常损失的风险。</p>
<p><strong>自动化做市模式的优劣：</strong></p>
<ul>
<li>
<p><strong>优势：</strong></p>
<ul>
<li>对于新的代币，可以很方便地冷启动</li>
<li>去中心化</li>
<li>代币交换可组合性很高</li>
</ul>
</li>
<li>
<p><strong>劣势：</strong></p>
<ul>
<li>所有价格点的统一流动性（在<span class="heti-skip"><span class="heti-spacing"> </span>Uniswap V3<span class="heti-spacing"> </span></span>中已解决）</li>
<li>滑点频繁</li>
<li>波动性大，经常有很大的无常损失（流动性提供者在平均表现上是盈利的）</li>
</ul>
</li>
</ul>
<p><img alt="13" src="../../../assets/images/defi_course_2024_edition/13.png"/></p>
<p>需要理解的是，如何基于<span class="heti-skip"><span class="heti-spacing"> </span>x*y=k<span class="heti-spacing"> </span></span>这个公式来完成添加流动性、Swap、移除流动性这三个操作以及里面的一些计算细节。写一个<span class="heti-skip"><span class="heti-spacing"> </span>CPAMM<span class="heti-spacing"> </span></span>合约，<span>Token<span class="heti-spacing"> </span></span>如何提供，提供<span class="heti-skip"><span class="heti-spacing"> </span>Token<span class="heti-spacing"> </span></span>之后如何把<span class="heti-skip"><span class="heti-spacing"> </span>share<span class="heti-spacing"> </span></span>返回给用户，具体怎么计算，<span>swap<span class="heti-spacing"> </span></span>是怎么算的，移除流动性是怎么算的。</p>
<p>添加流动性会不会影响价格？</p>
<p><img alt="14" src="../../../assets/images/defi_course_2024_edition/14.png"/></p>
<p><img alt="15" src="../../../assets/images/defi_course_2024_edition/15.png"/></p>
<p><img alt="16" src="../../../assets/images/defi_course_2024_edition/16.png"/></p>
<p>我们希望流动性的体现和添加的数量成一个线性关系。</p>
<p><img alt="17" src="../../../assets/images/defi_course_2024_edition/17.png"/></p>
<p><img alt="18" src="../../../assets/images/defi_course_2024_edition/18.png"/></p>
<p><img alt="19" src="../../../assets/images/defi_course_2024_edition/19.png"/></p>
<p><img alt="20" src="../../../assets/images/defi_course_2024_edition/20.png"/></p>
<p>如果池子很浅，就会产生很高的滑点。</p>
<h3 id="chatgpt"><span>ChatGPT<span class="heti-spacing"> </span></span>补充：为什么需要链上自动做市商？<a class="headerlink" href="#chatgpt" title="Permanent link">¶</a></h3>
<p>在中心化交易所（Binance、<span>Coinbase<span class="heti-spacing"> </span></span>等）中使用订单簿模式，这种模式需要：</p>
<ul>
<li><strong>高频订单更新</strong>：买方和卖方不断地挂出买入和卖出订单；</li>
<li><strong>强大的撮合引擎</strong>：一个高速、中心化的服务器来实时匹配这些买单和卖单；</li>
<li><strong>做市商</strong>：专业的机构或个人提供流动性，通过不断报价来缩小买卖价差，让市场更高效；</li>
</ul>
<p>如果直接把订单簿搬到区块链上（即链上订单簿<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，会遇到一些问题：</p>
<p>（1）性能瓶颈与高昂成本：区块链（尤其是早期的以太坊）速度慢、吞吐量低，每一笔挂单、撤单、匹配交易都需要支付<span class="heti-skip"><span class="heti-spacing"> </span>Gas<span class="heti-spacing"> </span></span>费，并需要全网节点确认。订单簿需要不断地挂单、撤单、修改订单、撮合交易，每一笔交易都需要支付<span class="heti-skip"><span class="heti-spacing"> </span>Gas<span class="heti-spacing"> </span></span>费，一旦网络拥堵，<span>Gas<span class="heti-spacing"> </span></span>费飙升；</p>
<p>（2）区块链延迟高：中心化交易所的撮合延迟是微秒级，而链上的交易延迟远无法达到<span class="heti-skip"><span class="heti-spacing"> </span>CEX<span class="heti-spacing"> </span></span>水平，高延迟<span class="heti-skip"><span class="heti-spacing"> </span>+<span class="heti-spacing"> </span></span>无法实时撮合 → 订单深度会变得非常差；</p>
<p>（3）链上订单簿易被<span class="heti-skip"><span class="heti-spacing"> </span>MEV<span class="heti-spacing"> </span></span>抢跑：链上订单簿的订单都是公开的，<span>MEV bot<span class="heti-spacing"> </span></span>可以看到你的订单并直接抢跑，导致用户持续受到损失，这会让订单簿体验极差；</p>
<p>（4）小型长尾代币没有做市商：在中心化交易中，专业做市商负责挂买单<span class="heti-skip"><span class="heti-spacing"> </span>/<span class="heti-spacing"> </span></span>卖单维持深度，依赖于高频交易和复杂的算法。链上操作成本高，没有人会主动给新代币挂单做深度，导致深度差、滑点巨大、无法交易，无法实现<span class="heti-skip"><span class="heti-spacing"> </span>"<span class="heti-spacing"> </span></span>人人可发币<span class="heti-skip"><span class="heti-spacing"> </span>"<span class="heti-spacing"> </span></span>的去中心化生态。</p>
<p>直接将传统金融的订单簿模式复制到区块链上，在技术和经济上都是不可行的。因此，我们需要一个全新的、为区块链原生设计的交易模式。</p>
<p><span>AMM<span class="heti-spacing"> </span></span>的理念非常简单但革命性：<strong>让流动性池（Liquidity Pool）自动报价，无需订单簿或做市商。</strong></p>
<p>例如<span class="heti-skip"><span class="heti-spacing"> </span>Uniswap<span class="heti-spacing"> </span></span>的<span class="heti-skip"><span class="heti-spacing"> </span>x*y=k<span class="heti-spacing"> </span></span>模型：</p>
<ul>
<li>用户把<span class="heti-skip"><span class="heti-spacing"> </span>Token A<span class="heti-spacing"> </span></span>和<span class="heti-skip"><span class="heti-spacing"> </span>Token B<span class="heti-spacing"> </span></span>存进池子</li>
<li>池子用公式自动给出价格</li>
<li>和池子交易即可，不需要对手盘</li>
</ul>
<p><span>AMM<span class="heti-spacing"> </span></span>本质上：</p>
<ul>
<li><strong>用算法提供流动性</strong></li>
<li><strong>用代币池子替代订单簿</strong></li>
<li><strong>用<span><span class="heti-spacing"> </span>LP</span>（流动性提供者）替代专业做市商</strong></li>
</ul>
<h2 id="8-uniswap">第<span class="heti-skip"><span class="heti-spacing"> </span>8<span class="heti-spacing"> </span></span>课<span class="heti-skip"><span class="heti-spacing"> </span>- Uniswap<span class="heti-spacing"> </span></span>简介<a class="headerlink" href="#8-uniswap" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<p><img alt="21" src="../../../assets/images/defi_course_2024_edition/21.png"/></p>
<p>On Path Independence：<a href="https://vitalik.eth.limo/general/2017/06/22/marketmakers.html">https://vitalik.eth.limo/general/2017/06/22/marketmakers.html</a></p>
<p>A Short History of Uniswap：<a href="https://blog.uniswap.org/uniswap-history">https://blog.uniswap.org/uniswap-history</a></p>
<p>Uniswap Whitepaper V1：<a href="https://hackmd.io/@HaydenAdams/HJ9jLsfTz">https://hackmd.io/@HaydenAdams/HJ9jLsfTz</a></p>
<p><strong>Uniswap V1：</strong></p>
<ul>
<li><span>2018<span class="heti-spacing"> </span></span>年<span class="heti-skip"><span class="heti-spacing"> </span>11<span class="heti-spacing"> </span></span>月<span class="heti-skip"><span class="heti-spacing"> </span>2<span class="heti-spacing"> </span></span>日发布；</li>
<li>使用<span class="heti-skip"><span class="heti-spacing"> </span>Vyper<span class="heti-spacing"> </span></span>语言编写；</li>
<li>仅支持<span class="heti-skip"><span class="heti-spacing"> </span>ERC20-ETH<span class="heti-spacing"> </span></span>直接互换或者通过<span class="heti-skip"><span class="heti-spacing"> </span>ETH<span class="heti-spacing"> </span></span>进行互换（Chained-swap<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>；</li>
<li>合约地址：<a href="https://github.com/Uniswap/v1-contracts/tree/master/contracts">https://github.com/Uniswap/v1-contracts/tree/master/contracts</a></li>
</ul>
<p><img alt="22" src="../../../assets/images/defi_course_2024_edition/22.png"/></p>
<p><span>Vitalik<span class="heti-spacing"> </span></span>的<span class="heti-skip"><span class="heti-spacing"> </span>"On Path Independence"<span class="heti-spacing"> </span></span>是<span class="heti-skip"><span class="heti-spacing"> </span>2017<span class="heti-spacing"> </span></span>年<span class="heti-skip"><span class="heti-spacing"> </span>6<span class="heti-spacing"> </span></span>月份发表的，<span>2018<span class="heti-spacing"> </span></span>年<span class="heti-skip"><span class="heti-spacing"> </span>11<span class="heti-spacing"> </span></span>月才有人正式地用五六百行代码把文章的主要思想实现出来。现在觉得很简单，但回头看的话，也不太容易。好比万有引力公式，现在看很简单，但前人发现这个公式用了几百年。</p>
<p>Uniswap v2 Overview：<a href="https://blog.uniswap.org/uniswap-v2">https://blog.uniswap.org/uniswap-v2</a>【March 23, 2020】</p>
<p><strong>Uniswap V2：</strong></p>
<ul>
<li><span>2020<span class="heti-spacing"> </span></span>年<span class="heti-skip"><span class="heti-spacing"> </span>5<span class="heti-spacing"> </span></span>月发布；</li>
<li>增加<span class="heti-skip"><span class="heti-spacing"> </span>ERC20 - ERC20<span class="heti-spacing"> </span></span>直接互换；</li>
<li>增加<span><span class="heti-spacing"> </span>Flash Swap</span>；</li>
<li>增加<span><span class="heti-spacing"> </span>Oracle</span>；</li>
<li>改进手续费收取方式；</li>
<li>引爆了<span class="heti-skip"><span class="heti-spacing"> </span>DeFi<span class="heti-spacing"> </span></span>赛道；</li>
<li><span>2020<span class="heti-spacing"> </span></span>年<span class="heti-skip"><span class="heti-spacing"> </span>9<span class="heti-spacing"> </span></span>月，发行治理代币<span><span class="heti-spacing"> </span>UNI</span>；</li>
</ul>
<p><span>2020<span class="heti-spacing"> </span></span>年<span class="heti-skip"><span class="heti-spacing"> </span>5<span class="heti-spacing"> </span></span>月份<span class="heti-skip"><span class="heti-spacing"> </span>Uniswap V2<span class="heti-spacing"> </span></span>发布，引爆了<span class="heti-skip"><span class="heti-spacing"> </span>DeFi<span class="heti-spacing"> </span></span>赛道。</p>
<p><span>Sushi<span class="heti-spacing"> </span></span>克隆<span class="heti-skip"><span class="heti-spacing"> </span>Uniswap<span class="heti-spacing"> </span></span>源码，Yield Farming，吸血攻击，导致<span class="heti-skip"><span class="heti-spacing"> </span>Uniswap<span class="heti-spacing"> </span></span>空投<span><span class="heti-spacing"> </span>UNI</span>。</p>
<blockquote>
<p>💡 区块链圈，不要光关注技术和产品逻辑，仅仅只是八卦就可以发现很多素材，每一个新闻背后都有故事。</p>
</blockquote>
<p><strong><span>Uniswap V2<span class="heti-spacing"> </span></span>的核心合约</strong></p>
<ul>
<li>
<p>Uniswap V2 Core</p>
<ul>
<li>UniswapV2Pair.sol</li>
<li>UniswapV2Factory.sol</li>
</ul>
</li>
<li>
<p>Uniswap V2 Periphery</p>
<ul>
<li>Router contract</li>
<li>Library contract</li>
</ul>
</li>
</ul>
<p><strong>Uniswap vs SushiSwap</strong></p>
<ul>
<li><span>2020<span class="heti-spacing"> </span></span>年<span class="heti-skip"><span class="heti-spacing"> </span>8<span class="heti-spacing"> </span></span>月<span class="heti-skip"><span class="heti-spacing"> </span>28<span class="heti-spacing"> </span></span>日，<span>SushiSwap<span class="heti-spacing"> </span></span>发布；</li>
<li><span>SushiSwap fork<span class="heti-spacing"> </span></span>了<span><span class="heti-spacing"> </span>Uniswap</span>，并且做了一些改进；</li>
<li><span>SushiSwap<span class="heti-spacing"> </span></span>增加了奖励系统，从<span class="heti-skip"><span class="heti-spacing"> </span>Uniswap<span class="heti-spacing"> </span></span>吸引走许多流动性；</li>
<li>作为回击，<span>2020<span class="heti-spacing"> </span></span>年<span class="heti-skip"><span class="heti-spacing"> </span>9<span class="heti-spacing"> </span></span>月<span class="heti-skip"><span class="heti-spacing"> </span>Uniswap<span class="heti-spacing"> </span></span>宣布发行<span class="heti-skip"><span class="heti-spacing"> </span>UNI<span class="heti-spacing"> </span></span>作为治理代币；</li>
</ul>
<p>Introducing Uniswap v3：<a href="https://blog.uniswap.org/uniswap-v3">https://blog.uniswap.org/uniswap-v3</a>【March 23, 2021】</p>
<p><strong>Uniswap V3</strong></p>
<ul>
<li><span>2021<span class="heti-spacing"> </span></span>年<span class="heti-skip"><span class="heti-spacing"> </span>3<span class="heti-spacing"> </span></span>月，<span>Uniswap V3<span class="heti-spacing"> </span></span>发布；</li>
<li>
<p>主要特性：</p>
<ul>
<li>增加集中流动性；</li>
<li>优化手续费设置；</li>
<li><span>LPT<span class="heti-spacing"> </span></span>改成基于<span class="heti-skip"><span class="heti-spacing"> </span>NFT<span class="heti-spacing"> </span></span>的<span><span class="heti-spacing"> </span>Liquidity Token</span>；</li>
<li>改进开源协议；</li>
</ul>
</li>
</ul>
<p><span>V2<span class="heti-spacing"> </span></span>的流动性没有集中，任何价格都覆盖，但其实一个<span class="heti-skip"><span class="heti-spacing"> </span>Token<span class="heti-spacing"> </span></span>的波动通常只局限于一个范围，在范围之外做流动性是浪费的。</p>
<p><span>V2<span class="heti-spacing"> </span></span>中添加流动性获得的<span class="heti-skip"><span class="heti-spacing"> </span>share<span class="heti-spacing"> </span></span>是<span class="heti-skip"><span class="heti-spacing"> </span>ERC20<span class="heti-spacing"> </span></span>版本，在<span class="heti-skip"><span class="heti-spacing"> </span>V3<span class="heti-spacing"> </span></span>中是<span><span class="heti-spacing"> </span>NFT</span>。有了集中流动性后，每个人添加的价格范围可能不一样，例如<span class="heti-skip"><span class="heti-spacing"> </span>A<span class="heti-spacing"> </span></span>添加<span class="heti-skip"><span class="heti-spacing"> </span>ETH<span class="heti-spacing"> </span></span>流动性的区间是<span><span class="heti-spacing"> </span>2800~3200$</span>，而<span class="heti-skip"><span class="heti-spacing"> </span>B<span class="heti-spacing"> </span></span>是<span><span class="heti-spacing"> </span>3600~4000$</span>。</p>
<p><span>V2<span class="heti-spacing"> </span></span>源码被克隆抄袭，<span>V3<span class="heti-spacing"> </span></span>源码协议不允许克隆商用，有效期<span class="heti-skip"><span class="heti-spacing"> </span>2<span class="heti-spacing"> </span></span>年。</p>
<p>Our Vision for Uniswap v4：<a href="https://blog.uniswap.org/uniswap-v4">https://blog.uniswap.org/uniswap-v4</a>【June 13, 2023】</p>
<p>【补充】UNIfication：<a href="https://blog.uniswap.org/unification">https://blog.uniswap.org/unification</a>【November 10, 2025】</p>
<p><strong>Uniswap V4</strong></p>
<ul>
<li><span>2023<span class="heti-spacing"> </span></span>年<span class="heti-skip"><span class="heti-spacing"> </span>6<span class="heti-spacing"> </span></span>月<span class="heti-skip"><span class="heti-spacing"> </span>23<span class="heti-spacing"> </span></span>日发布代码草案；</li>
<li>
<p>新增主要特性：</p>
<ul>
<li>Hook</li>
<li>Singleton Pool Manager Design</li>
<li>Reintroduction of Native ETH</li>
<li>Flash Accounting</li>
</ul>
</li>
<li>
<p>目标：更快、更省<span><span class="heti-spacing"> </span>Gas Fee</span>，容易集成；成为<span class="heti-skip"><span class="heti-spacing"> </span>DeFi<span class="heti-spacing"> </span></span>领域的基础设施；</p>
</li>
</ul>
<p><span>Hook<span class="heti-spacing"> </span></span>的应用举例：在每一次<span class="heti-skip"><span class="heti-spacing"> </span>swap<span class="heti-spacing"> </span></span>前验证<span><span class="heti-spacing"> </span>KYC</span>；像股票交易所一样设置交易时间限制（节假日、周末停盘<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>。</p>
<p>在<span class="heti-skip"><span class="heti-spacing"> </span>V2<span class="heti-spacing"> </span></span>中只支持<span class="heti-skip"><span class="heti-spacing"> </span>ERC20<span class="heti-spacing"> </span></span>之间的转换，<span>ETH<span class="heti-spacing"> </span></span>与其他<span class="heti-skip"><span class="heti-spacing"> </span>ERC20 Token<span class="heti-spacing"> </span></span>的转换都需要先换成<span><span class="heti-spacing"> </span>WETH</span>（即<span class="heti-skip"><span class="heti-spacing"> </span>ETH<span class="heti-spacing"> </span></span>的<span class="heti-skip"><span class="heti-spacing"> </span>ERC20<span class="heti-spacing"> </span></span>版本<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，<span>V4<span class="heti-spacing"> </span></span>中把原生<span class="heti-skip"><span class="heti-spacing"> </span>ETH<span class="heti-spacing"> </span></span>拉回来了。</p>
<p><span>DeFi<span class="heti-spacing"> </span></span>领域有很多东西可以像搭积木一样叠加，把别人做好的东西作为自己应用的一个模块。<span>Uniswap V4<span class="heti-spacing"> </span></span>就想往这方面发展，成为<span class="heti-skip"><span class="heti-spacing"> </span>DeFi<span class="heti-spacing"> </span></span>领域的基础设施。</p>
<p><span>Pancakeswap<span class="heti-spacing"> </span></span>是<span class="heti-skip"><span class="heti-spacing"> </span>BSC<span class="heti-spacing"> </span></span>上最大的<span><span class="heti-spacing"> </span>DEX</span>。</p>
<p><strong>Uniswap VS Binance</strong></p>
<ul>
<li>无须实名认证</li>
<li>代码开源</li>
<li>上币不收费</li>
<li>用户自己管理资金，不用托管到交易所</li>
<li>社区治理</li>
</ul>
<p>Not your keys, not your coins.</p>
<h2 id="9-uniswap-v2">第<span class="heti-skip"><span class="heti-spacing"> </span>9<span class="heti-spacing"> </span></span>课<span class="heti-skip"><span class="heti-spacing"> </span>- Uniswap V2<span class="heti-spacing"> </span></span>的手续费计算<a class="headerlink" href="#9-uniswap-v2" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<p>Uniswap V2 Whitepaper：<a href="https://uniswap.org/whitepaper.pdf">https://uniswap.org/whitepaper.pdf</a></p>
<p>在<span class="heti-skip"><span class="heti-spacing"> </span>Uniswap V1<span class="heti-spacing"> </span></span>中，每一笔交易就扣一个手续费。</p>
<blockquote>
<p>💡 梁老师提到白皮书中的<span class="heti-skip"><span class="heti-spacing"> </span>Chapter 2.4<span class="heti-spacing"> </span></span>节有点难理解。</p>
</blockquote>
<p><strong>通过增发<span class="heti-skip"><span class="heti-spacing"> </span>share<span class="heti-spacing"> </span></span>的方式把手续费给项目方</strong></p>
<p><img alt="23" src="../../../assets/images/defi_course_2024_edition/23.png"/></p>
<p>通过使<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(S_1\)</span><span class="heti-spacing"> </span></span>增值的方式把手续费给<span><span class="heti-spacing"> </span>LP</span></p>
<p><img alt="24" src="../../../assets/images/defi_course_2024_edition/24.png"/></p>
<p><strong>项目方想分走手续费里的一定比例</strong></p>
<p><img alt="25" src="../../../assets/images/defi_course_2024_edition/25.png"/></p>
<p><img alt="26" src="../../../assets/images/defi_course_2024_edition/26.png"/></p>
<table>
<thead>
<tr>
<th>方式</th>
<th>谁拿走<span class="heti-skip"><span class="heti-spacing"> </span>swap<span class="heti-spacing"> </span></span>产生的价值增加？</th>
<th><span>share<span class="heti-spacing"> </span></span>是否增发？</th>
<th><span>Uniswap<span class="heti-spacing"> </span></span>是否采用？</th>
</tr>
</thead>
<tbody>
<tr>
<td><span>1.<span class="heti-spacing"> </span></span>增发<span><span class="heti-spacing"> </span>share</span> → 给项目方</td>
<td>项目方拿手续费（protocol fee）</td>
<td>是，mint LPT</td>
<td>✔（<span>V2 feeTo<span class="heti-spacing"> </span></span>模式）</td>
</tr>
<tr>
<td>2. S₁ 增值 → 给<span><span class="heti-spacing"> </span>LP</span></td>
<td>全部手续费给<span><span class="heti-spacing"> </span>LP</span></td>
<td>否</td>
<td>✔（默认无<span><span class="heti-spacing"> </span>protocol fee</span>）</td>
</tr>
<tr>
<td><span>3.<span class="heti-spacing"> </span></span>抽走<span class="heti-skip"><span class="heti-spacing"> </span>φ<span class="heti-spacing"> </span></span>比例</td>
<td><span>φ<span class="heti-spacing"> </span></span>给项目方，1−<span>φ<span class="heti-spacing"> </span></span>给<span><span class="heti-spacing"> </span>LP</span></td>
<td>是</td>
<td>✔（<span>V2<span class="heti-spacing"> </span></span>支持<span><span class="heti-spacing"> </span>φ = 1/6</span>）</td>
</tr>
</tbody>
</table>
<p>三者是同一套数学，用不同视角表达。</p>
<p>参考资料：<a href="https://www.rareskills.io/post/uniswap-v2-mintfee">How Uniswap V2 computes the mintFee</a></p>
<blockquote>
<p>💡 收取手续费不是在<span class="heti-skip"><span class="heti-spacing"> </span>swap<span class="heti-spacing"> </span></span>时收，而是在添加和移除流动性时收，带来<span class="heti-skip"><span class="heti-spacing"> </span>shares<span class="heti-spacing"> </span></span>总量的<span class="heti-skip"><span class="heti-spacing"> </span>mint<span class="heti-spacing"> </span></span>或者<span><span class="heti-spacing"> </span>burn</span>。</p>
</blockquote>
<h2 id="10-uniswap-v2-twap">第<span class="heti-skip"><span class="heti-spacing"> </span>10<span class="heti-spacing"> </span></span>课<span class="heti-skip"><span class="heti-spacing"> </span>- Uniswap V2<span class="heti-spacing"> </span></span>里的<span><span class="heti-spacing"> </span>TWAP</span><a class="headerlink" href="#10-uniswap-v2-twap" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<blockquote>
<p>本节课程包含较多代码演示。</p>
</blockquote>
<p><span>Uniswap V2<span class="heti-spacing"> </span></span>链上价格预言机</p>
<p>【GPT-4o】TWAP（Time-Weighted Average Price，时间加权平均价格）是<span class="heti-skip"><span class="heti-spacing"> </span>Uniswap V2<span class="heti-spacing"> </span></span>中引入的一种机制，为了解决去中心化交易所中瞬时价格易受操纵的安全隐患，通过时间加权平均价格来提供更稳定的价格数据。它大大降低了短期价格操纵的风险，并为<span class="heti-skip"><span class="heti-spacing"> </span>DeFi<span class="heti-spacing"> </span></span>协议提供了一个更加可靠的价格预言机。</p>
<p><strong><span>(1)<span class="heti-spacing"> </span></span>为什么要引入<span><span class="heti-spacing"> </span>TWAP</span>？</strong></p>
<p>在去中心化交易所（如<span><span class="heti-spacing"> </span>Uniswap</span>）上，瞬时价格是由流动性池中代币的供需关系决定的。因此，在没有<span class="heti-skip"><span class="heti-spacing"> </span>TWAP<span class="heti-spacing"> </span></span>之前，这种瞬时价格可以在短时间内被操纵者影响，使得<span class="heti-skip"><span class="heti-spacing"> </span>DeFi<span class="heti-spacing"> </span></span>协议在依赖<span class="heti-skip"><span class="heti-spacing"> </span>Uniswap<span class="heti-spacing"> </span></span>的价格预言机时存在安全隐患。</p>
<p>例如，如果某个协议基于<span class="heti-skip"><span class="heti-spacing"> </span>Uniswap<span class="heti-spacing"> </span></span>上的即时价格来清算借款或执行套利交易，那么攻击者可能通过一个短暂的、大规模的交易瞬间改变池中的价格，从而使协议误以为价格发生了大幅波动，这种攻击被称为<span class="heti-skip"><span class="heti-spacing"> </span>"<span class="heti-spacing"> </span></span>闪电贷价格操纵攻击<span><span class="heti-spacing"> </span>"</span>（flash loan price manipulation<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>。</p>
<p>为了防止这种问题，<span>Uniswap V2<span class="heti-spacing"> </span></span>引入了<span class="heti-skip"><span class="heti-spacing"> </span>TWAP<span class="heti-spacing"> </span></span>机制，通过计算一个时间段内的平均价格来提供更可靠的价格信息。这样，协议可以依赖这个平均价格，而不是瞬时的市场价格，从而大大减少了短时间内价格波动带来的风险。</p>
<p><strong><span>(2) TWAP<span class="heti-spacing"> </span></span>工作原理</strong></p>
<p><span>Uniswap V2<span class="heti-spacing"> </span></span>的<span class="heti-skip"><span class="heti-spacing"> </span>TWAP<span class="heti-spacing"> </span></span>是基于累积价格的机制来实现的。每个交易对的价格会在每个区块内更新一次，这个价格基于池中的代币数量（<span>X<span class="heti-spacing"> </span></span>和<span><span class="heti-spacing"> </span>Y</span>）的比值。</p>
<p>具体来说，<span>Uniswap V2<span class="heti-spacing"> </span></span>追踪两个代币对之间价格的累积值：</p>
<ol>
<li>每个区块结束时，<span>Uniswap<span class="heti-spacing"> </span></span>会记录当前的价格乘以自上次更新以来经过的时间，并将其累积。</li>
<li>累积价格随着每个区块不断增长，因此计算价格的时间越长，累积的价格值就越大。</li>
</ol>
<p>为了计算某一时间段的平均价格（即<span><span class="heti-spacing"> </span>TWAP</span><heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，可以通过以下步骤：</p>
<ol>
<li>记录开始时间的累积价格。</li>
<li>记录结束时间的累积价格。</li>
<li>用结束时间的累积价格减去开始时间的累积价格，然后除以时间差（区块数<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，得出这段时间内的平均价格。</li>
</ol>
<p>通过这种方式，<span>Uniswap V2<span class="heti-spacing"> </span></span>让用户能够基于区块链的历史数据计算任意时间段的加权平均价格，而不是依赖瞬时价格。</p>
<p>示例：假设某个交易对是<span><span class="heti-spacing"> </span>ETH/DAI</span>，我们想要在过去<span class="heti-skip"><span class="heti-spacing"> </span>6<span class="heti-spacing"> </span></span>小时内计算<span class="heti-skip"><span class="heti-spacing"> </span>ETH<span class="heti-spacing"> </span></span>的时间加权平均价格。假设每个区块的平均出块时间为<span class="heti-skip"><span class="heti-spacing"> </span>15<span class="heti-spacing"> </span></span>秒，因此<span class="heti-skip"><span class="heti-spacing"> </span>6<span class="heti-spacing"> </span></span>小时大约包含<span class="heti-skip"><span class="heti-spacing"> </span>1440<span class="heti-spacing"> </span></span>个区块。</p>
<ol>
<li>在区块高度 <code>N</code> 处，我们记录下<span class="heti-skip"><span class="heti-spacing"> </span>ETH/DAI<span class="heti-spacing"> </span></span>的累积价格 <code>P1</code>。</li>
<li><span>6<span class="heti-spacing"> </span></span>小时后，在区块高度 <code>N + 1440</code> 处，我们记录下新的累积价格 <code>P2</code>。</li>
<li><span>TWAP<span class="heti-spacing"> </span></span>的计算公式为：<span class="arithmatex">\(TWAP = \frac{P2 - P1}{1440}\)</span> </li>
</ol>
<p>这个结果就是过去<span class="heti-skip"><span class="heti-spacing"> </span>6<span class="heti-spacing"> </span></span>小时内<span class="heti-skip"><span class="heti-spacing"> </span>ETH/DAI<span class="heti-spacing"> </span></span>的时间加权平均价格。</p>
<p><strong><span>(3)<span class="heti-spacing"> </span></span>可能导致的问题</strong></p>
<ol>
<li><strong>延迟性</strong>：<span>TWAP<span class="heti-spacing"> </span></span>是一个历史价格的平均值，因此它无法快速反映出市场的瞬时变化。在价格剧烈波动时（如市场突然崩盘或大幅上涨<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，<span>TWAP<span class="heti-spacing"> </span></span>可能无法提供及时的市场价格。这意味着依赖<span class="heti-skip"><span class="heti-spacing"> </span>TWAP<span class="heti-spacing"> </span></span>的协议可能在极端情况下做出错误决策，因为价格滞后。</li>
<li><strong>计算复杂度</strong>：对于较长时间的<span class="heti-skip"><span class="heti-spacing"> </span>TWAP<span class="heti-spacing"> </span></span>计算，尤其是当需要跨越多个区块时，可能需要读取大量的链上数据，增加了计算成本。这对于高频交易或依赖频繁价格更新的协议来说，可能并不适用。</li>
<li><strong>攻击可能性</strong>：虽然<span class="heti-skip"><span class="heti-spacing"> </span>TWAP<span class="heti-spacing"> </span></span>解决了短期内的价格操纵问题，但攻击者仍可能通过长时间的资金操控影响<span><span class="heti-spacing"> </span>TWAP</span>。例如，攻击者可以在多个区块内不断调整池中的代币数量，影响累积价格，从而逐步改变<span class="heti-skip"><span class="heti-spacing"> </span>TWAP<span class="heti-spacing"> </span></span>值。这种攻击需要更大的资本和更长的时间，但并不是不可能。</li>
<li><strong>价格操控的潜在窗口</strong>：<span>TWAP<span class="heti-spacing"> </span></span>虽然能防止单个瞬间的价格操控，但在一定时间窗口内，攻击者仍有可能影响价格。例如，如果攻击者知道某个协议将在未来某个时间点依赖<span class="heti-skip"><span class="heti-spacing"> </span>TWAP<span class="heti-spacing"> </span></span>进行结算或清算操作，他们可以在<span class="heti-skip"><span class="heti-spacing"> </span>TWAP<span class="heti-spacing"> </span></span>计算的关键时间窗口内影响价格，造成一定时间段内的价格偏差，从而实现利益最大化。</li>
</ol>
<p><img alt="27" src="../../../assets/images/defi_course_2024_edition/27.png"/></p>
<p><img alt="28" src="../../../assets/images/defi_course_2024_edition/28.png"/></p>
<p><img alt="29" src="../../../assets/images/defi_course_2024_edition/29.png"/></p>
<p><a href="https://github.com/Uniswap/v2-core/blob/master/contracts/UniswapV2Pair.sol">https://github.com/Uniswap/v2-core/blob/master/contracts/UniswapV2Pair.sol</a></p>
<p><img alt="https://docs.uniswap.org/contracts/v2/concepts/core-concepts/oracles" src="../../../assets/images/defi_course_2024_edition/30.png"/></p>
<blockquote>
<p>💡 <span>Uniswap V2<span class="heti-spacing"> </span></span>是使用<span class="heti-skip"><span class="heti-spacing"> </span>Solidity 0.6.6<span class="heti-spacing"> </span></span>版本编写的。</p>
</blockquote>
<p><span>Uniswap<span class="heti-spacing"> </span></span>中没有实现上面计算<span class="heti-skip"><span class="heti-spacing"> </span>"<span class="arithmatex">\(T_k\)</span> -&gt; <span class="arithmatex">\(T_n\)</span><span class="heti-spacing"> </span></span>的<span class="heti-skip"><span class="heti-spacing"> </span>AP"<span class="heti-spacing"> </span></span>公式中的分母部分，因为不可能记住过去所有时间的<span><span class="heti-spacing"> </span>price</span>（每次更新都需要花<span><span class="heti-spacing"> </span>Gas</span>，<span>Uniswap<span class="heti-spacing"> </span></span>不会去记录这个事情<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，如果需要<span><span class="heti-spacing"> </span>TWAP</span>，那就需要自己做一个快照（snapshot<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>。</p>
<p>（课堂代码演示部分省略）<span>v2-twap.sol<span class="heti-spacing"> </span></span>大概<span class="heti-skip"><span class="heti-spacing"> </span>90<span class="heti-spacing"> </span></span>行代码，TokenA.sol、TokenB.sol</p>
<p><strong>【课程实验】<span>TWAP<span class="heti-spacing"> </span></span>实验</strong>：自己部署<span class="heti-skip"><span class="heti-spacing"> </span>Uniswap V2<span class="heti-spacing"> </span></span>合约，实现<span><span class="heti-spacing"> </span>TWAP</span>。</p>
<blockquote>
<p>💡 <span>Fixed Point<span class="heti-spacing"> </span></span>是<span class="heti-skip"><span class="heti-spacing"> </span>Uniswap<span class="heti-spacing"> </span></span>自己独创的一个数据类型，<span>UQ112.112<span class="heti-spacing"> </span></span>格式。</p>
</blockquote>
<p>分别部署<span><span class="heti-spacing"> </span>TokenA</span>、TokenB，各自发行<span class="heti-skip"><span class="heti-spacing"> </span>1e26<span class="heti-spacing"> </span></span>个，通过<span class="heti-skip"><span class="heti-spacing"> </span>UniswapV2Router02.sol<span class="heti-spacing"> </span></span>合约操作。</p>
<h2 id="11-uniswap-flash-swap">第<span class="heti-skip"><span class="heti-spacing"> </span>11<span class="heti-spacing"> </span></span>课<span class="heti-skip"><span class="heti-spacing"> </span>- Uniswap<span class="heti-spacing"> </span></span>里的<span><span class="heti-spacing"> </span>Flash Swap</span><a class="headerlink" href="#11-uniswap-flash-swap" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<p><img alt="31" src="../../../assets/images/defi_course_2024_edition/31.png"/></p>
<blockquote>
<p>💡 <span>Flash Swap<span class="heti-spacing"> </span></span>是<span class="heti-skip"><span class="heti-spacing"> </span>DeFi<span class="heti-spacing"> </span></span>才有的东西，传统金融没有这类机制。</p>
</blockquote>
<p>【GPT-4o】<span>Flash Swap<span class="heti-spacing"> </span></span>允许用户<span class="heti-skip"><span class="heti-spacing"> </span>"<span class="heti-spacing"> </span></span>先借代币再付款<span><span class="heti-spacing"> </span>"</span>，而这笔付款只在交易的最后时刻进行。如果用户无法偿还借出的代币，那么交易将回滚，之前发生的所有操作都将被撤销。</p>
<p>核心代码位于<a href="https://github.com/Uniswap/v2-core/blob/master/contracts/UniswapV2Pair.sol"><span class="heti-skip"><span class="heti-spacing"> </span>https://github.com/Uniswap/v2-core/blob/master/contracts/UniswapV2Pair.sol<span class="heti-spacing"> </span></span></a>合约的 <code>swap()</code> 函数。</p>
<p>课堂演示的<span><span class="heti-spacing"> </span>FlashSwap.sol</span>：<a href="https://github.com/liangpeili/defi-2024/tree/main/Flash_swap">https://github.com/liangpeili/defi-2024/tree/main/Flash_swap</a></p>
<p>课外阅读：<a href="https://www.rareskills.io/post/erc-3156">Flash Loans and how to hack them: a walk through of ERC 3156</a></p>
<p><span>Flash Loan<span class="heti-spacing"> </span></span>和<span class="heti-skip"><span class="heti-spacing"> </span>Flash Swap<span class="heti-spacing"> </span></span>本质上是一回事（在一笔交易里完成借和还<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>。</p>
<h2 id="12-uniswap-v2">第<span class="heti-skip"><span class="heti-spacing"> </span>12<span class="heti-spacing"> </span></span>课<span class="heti-skip"><span class="heti-spacing"> </span>- Uniswap V2<span class="heti-spacing"> </span></span>的无常损失计算<a class="headerlink" href="#12-uniswap-v2" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<p><img alt="32" src="../../../assets/images/defi_course_2024_edition/32.png"/></p>
<p><img alt="33" src="../../../assets/images/defi_course_2024_edition/33.png"/></p>
<p><img alt="34" src="../../../assets/images/defi_course_2024_edition/34.png"/></p>
<p>做<span><span class="heti-spacing"> </span>LP</span>，无论<span class="heti-skip"><span class="heti-spacing"> </span>Token<span class="heti-spacing"> </span></span>是涨价还是降价都会导致资产比不做<span class="heti-skip"><span class="heti-spacing"> </span>LP<span class="heti-spacing"> </span></span>要少一些，这个就叫无常损失（Impermanent Loss<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>。那为什么还要做<span class="heti-skip"><span class="heti-spacing"> </span>LP<span class="heti-spacing"> </span></span>呢？</p>
<p><img alt="35" src="../../../assets/images/defi_course_2024_edition/35.png"/></p>
<p><img alt="36" src="../../../assets/images/defi_course_2024_edition/36.png"/></p>
<p><img alt="https://docs.uniswap.org/contracts/v2/concepts/advanced-topics/understanding-returns" src="../../../assets/images/defi_course_2024_edition/37.png"/></p>
<blockquote>
<p>Ivan Kuznetsov《Programming DeFi: Uniswap V2》 系列教程：</p>
<p><a href="https://jeiwan.net/posts/programming-defi-uniswapv2-1/">https://jeiwan.net/posts/programming-defi-uniswapv2-1/</a></p>
<p><a href="https://jeiwan.net/posts/programming-defi-uniswapv2-2/">https://jeiwan.net/posts/programming-defi-uniswapv2-2/</a></p>
<p><a href="https://jeiwan.net/posts/programming-defi-uniswapv2-3/">https://jeiwan.net/posts/programming-defi-uniswapv2-3/</a></p>
<p><a href="https://jeiwan.net/posts/programming-defi-uniswapv2-4/">https://jeiwan.net/posts/programming-defi-uniswapv2-4/</a>
</p>
</blockquote>
<h2 id="13-staking-reward">第<span class="heti-skip"><span class="heti-spacing"> </span>13<span class="heti-spacing"> </span></span>课<span class="heti-skip"><span class="heti-spacing"> </span>- Staking Reward<span class="heti-spacing"> </span></span>原理及实现<a class="headerlink" href="#13-staking-reward" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<blockquote>
<p>这堂课质量很高，需要用心去理解。</p>
</blockquote>
<p><img alt="38" src="../../../assets/images/defi_course_2024_edition/38.png"/></p>
<p>项目方设定好时间周期以及奖励总量。</p>
<p><img alt="39" src="../../../assets/images/defi_course_2024_edition/39.png"/></p>
<p><img alt="40" src="../../../assets/images/defi_course_2024_edition/40.png"/></p>
<p><img alt="41" src="../../../assets/images/defi_course_2024_edition/41.png"/></p>
<p><img alt="42" src="../../../assets/images/defi_course_2024_edition/42.png"/></p>
<p>如果有一万个用户，用智能合约来表示之后，不可能每秒钟更新一次余额。质押和解除质押操作都不是高频操作，关键在于能否写成时间复杂度为线性的智能合约算法。</p>
<p><img alt="43" src="../../../assets/images/defi_course_2024_edition/43.png"/></p>
<p>某个时间段内，单位<span class="heti-skip"><span class="heti-spacing"> </span>Token<span class="heti-spacing"> </span></span>质押得到的奖励——即<span><span class="heti-spacing"> </span>Reward Per Token</span>。</p>
<p>用户<span class="heti-skip"><span class="heti-spacing"> </span>u<span class="heti-spacing"> </span></span>从第<span class="heti-skip"><span class="heti-spacing"> </span>k<span class="heti-spacing"> </span></span>到<span class="heti-skip"><span class="heti-spacing"> </span>n<span class="heti-spacing"> </span></span>秒之间得到的奖励<span class="heti-skip"><span class="heti-spacing"> </span>=<span class="heti-spacing"> </span></span>质押的数量<span><span class="heti-spacing"> </span>×</span>（单位数量从<span class="heti-skip"><span class="heti-spacing"> </span>0<span class="heti-spacing"> </span></span>到<span class="heti-skip"><span class="heti-spacing"> </span>n<span class="heti-spacing"> </span></span>的奖励<span class="heti-skip"><span class="heti-spacing"> </span>-<span class="heti-spacing"> </span></span>单位数量从<span class="heti-skip"><span class="heti-spacing"> </span>0<span class="heti-spacing"> </span></span>到<span class="heti-skip"><span class="heti-spacing"> </span>k<span class="heti-spacing"> </span></span>的奖励）</p>
<p><img alt="44" src="../../../assets/images/defi_course_2024_edition/44.png"/></p>
<p>能否化简<span><span class="heti-spacing"> </span>rn</span>？</p>
<p><img alt="45" src="../../../assets/images/defi_course_2024_edition/45.png"/></p>
<p><img alt="46" src="../../../assets/images/defi_course_2024_edition/46.png"/></p>
<p>对整个项目来说，只需要记录几个值就行了。</p>
<p><img alt="47" src="../../../assets/images/defi_course_2024_edition/47.png"/></p>
<p>图片来源：<a href="https://www.youtube.com/watch?v=iNZWMj4USUM">Staking Rewards - Math, Examples and Algorithm | DeFi</a></p>
<p>推荐<span class="heti-skip"><span class="heti-spacing"> </span>Youtuber @smartcontractprogrammer<span class="heti-spacing"> </span></span>的<a href="https://www.youtube.com/playlist?list=PLO5VPQH6OWdX-Rh7RonjZhOd9pb9zOnHW"><span class="heti-skip"><span class="heti-spacing"> </span>DeFi<span class="heti-spacing"> </span></span>系列视频</a>，是很赞的一个英文视频讲解系列。</p>
<p>计算<span class="heti-skip"><span class="heti-spacing"> </span>r(B, 5, 11)<span class="heti-spacing"> </span></span>和<span><span class="heti-spacing"> </span>r(C, 6, 13)</span></p>
<p><img alt="48" src="../../../assets/images/defi_course_2024_edition/48.png"/></p>
<p><span>StakingReward.sol<span class="heti-spacing"> </span></span>代码演示（约一百来行代码<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>。</p>
<h2 id="14-uniswap-v3">第<span class="heti-skip"><span class="heti-spacing"> </span>14<span class="heti-spacing"> </span></span>课<span class="heti-skip"><span class="heti-spacing"> </span>- Uniswap V3<span class="heti-spacing"> </span></span>简介<a class="headerlink" href="#14-uniswap-v3" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<p><span>Uniswap V3<span class="heti-spacing"> </span></span>白皮书：<a href="https://app.uniswap.org/whitepaper-v3.pdf">https://app.uniswap.org/whitepaper-v3.pdf</a></p>
<p>Introducing Uniswap v3：<a href="https://blog.uniswap.org/uniswap-v3">https://blog.uniswap.org/uniswap-v3</a>【March 23, 2021】</p>
<p><span>2021<span class="heti-spacing"> </span></span>年<span class="heti-skip"><span class="heti-spacing"> </span>5<span class="heti-spacing"> </span></span>月，<span>Uniswap V3<span class="heti-spacing"> </span></span>发布，主要特性：</p>
<ul>
<li>增加集中流动性</li>
<li>优化手续费设置</li>
<li><span>TWAP<span class="heti-spacing"> </span></span>优化</li>
<li>改进开源协议</li>
</ul>
<p><span>V3<span class="heti-spacing"> </span></span>开源许可证要求的两年代码保护期在<span class="heti-skip"><span class="heti-spacing"> </span>2023<span class="heti-spacing"> </span></span>年到期了。</p>
<p><span>Uniswap V2<span class="heti-spacing"> </span></span>资金利用效率低，做<span class="heti-skip"><span class="heti-spacing"> </span>LP<span class="heti-spacing"> </span></span>风险很大。</p>
<p>如果代币价格剧烈波动，用户承受无常损失的风险较大，所以对于波动剧烈的<span class="heti-skip"><span class="heti-spacing"> </span>Token<span class="heti-spacing"> </span></span>来说，应该收取更高的手续费来弥补<span class="heti-skip"><span class="heti-spacing"> </span>LP<span class="heti-spacing"> </span></span>的损失。</p>
<p><span>V3<span class="heti-spacing"> </span></span>的核心改进：在某个价格范围之内去做流动性。</p>
<p><img alt="49" src="../../../assets/images/defi_course_2024_edition/49.png"/></p>
<p><span>Uniswap<span class="heti-spacing"> </span></span>查看流动性地址：<a href="https://app.uniswap.org/explore/pools">https://app.uniswap.org/explore/pools</a></p>
<p><span>Uniswap V3<span class="heti-spacing"> </span></span>因为有集中流动性的引入，每个用户可以选择在自己认可的一个价格区间去做流动性，最后综合的结果就如下所示：</p>
<p><img alt="50" src="../../../assets/images/defi_course_2024_edition/50.png"/></p>
<p>很多用户认为以太坊还会再涨，所以就提前到未来这个价格区间内去做流动性。用户做流动性被交易使用到了才能赚手续费。</p>
<p>思考问题：</p>
<p>（1）在<span class="heti-skip"><span class="heti-spacing"> </span>ETH<span class="heti-spacing"> </span></span>价格高的位置埋伏了一个单子，只需要提供<span><span class="heti-spacing"> </span>ETH</span>，为什么？</p>
<p>（2）在<span class="heti-skip"><span class="heti-spacing"> </span>ETH<span class="heti-spacing"> </span></span>价格低的位置埋伏了一个单子，只需要提供<span><span class="heti-spacing"> </span>USDT</span>，为什么？</p>
<p>（3）<span>Uniswap V3<span class="heti-spacing"> </span></span>因为提供了<span class="heti-skip"><span class="heti-spacing"> </span>Range Order<span class="heti-spacing"> </span></span>订单，用户可以把它作为限价订单去使用，怎么理解？</p>
<p><span>Uniswap V3<span class="heti-spacing"> </span></span>可以在同一个<span class="heti-skip"><span class="heti-spacing"> </span>Pool<span class="heti-spacing"> </span></span>中提供多个价格范围之内的流动性。</p>
<p><img alt="以太坊官方给的案例" src="../../../assets/images/defi_course_2024_edition/51.png"/></p>
<p><img alt="52" src="../../../assets/images/defi_course_2024_edition/52.png"/></p>
<p>手续费的收取：</p>
<ul>
<li>针对不同的交易对，设置不同的梯度</li>
<li><span>0.01%, 0.05%, 0.30%<span class="heti-spacing"> </span></span>和<span><span class="heti-spacing"> </span>1.00%</span></li>
<li>管理费可以收取手续费的<span><span class="heti-spacing"> </span>10%-25%</span></li>
</ul>
<p><a href="https://docs.uniswap.org/concepts/protocol/range-orders">https://docs.uniswap.org/concepts/protocol/range-orders</a></p>
<p>【<span>GPT-4o<span class="heti-spacing"> </span></span>补充】</p>
<p>区间订单（Range Orders）是<span class="heti-skip"><span class="heti-spacing"> </span>Uniswap V3<span class="heti-spacing"> </span></span>中的一种新型交易方式，允许流动性提供者（LP）通过在特定价格区间内提供流动性来实现类似限价单（Limit Order）的效果。</p>
<p>传统的限价单<span class="heti-skip"><span class="heti-spacing"> </span>vs<span class="heti-spacing"> </span></span>区间订单：</p>
<ul>
<li><strong>传统限价单</strong>：比如你想以某个特定的价格买入或卖出某个资产，你设置一个限价单，当市场价格达到你的限价时，交易会自动完成。</li>
<li><strong><span>Uniswap V3<span class="heti-spacing"> </span></span>的区间订单</strong>：用户将待交易资产设置在特定的价格区间内，当市场价格达到该区间时自动完成交换，类似限价单的效果。而且<span class="heti-skip"><span class="heti-spacing"> </span>Uniswap V3<span class="heti-spacing"> </span></span>的区间订单不需要等待另一方来下单交易，而是直接与流动性池（AMM）进行交易。</li>
</ul>
<p><span>Uniswap V3<span class="heti-spacing"> </span></span>通过引入区间订单和集中流动性，使得用户能够像在传统交易所中设置限价单一样，实现特定价格区间内的资产交易。</p>
<h2 id="15-uniswap-v3">第<span class="heti-skip"><span class="heti-spacing"> </span>15<span class="heti-spacing"> </span></span>课<span class="heti-skip"><span class="heti-spacing"> </span>- Uniswap V3<span class="heti-spacing"> </span></span>的集中流动性<a class="headerlink" href="#15-uniswap-v3" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<p>实际上只需要提供<span class="heti-skip"><span class="heti-spacing"> </span>x_real<span class="heti-spacing"> </span></span>和<span class="heti-skip"><span class="heti-spacing"> </span>y_real<span class="heti-spacing"> </span></span>的两个<span><span class="heti-spacing"> </span>Token</span>，就可以维持价格<span class="heti-skip"><span class="heti-spacing"> </span>Pc<span class="heti-spacing"> </span></span>在<span class="heti-skip"><span class="heti-spacing"> </span>Pa<span class="heti-spacing"> </span></span>和<span class="heti-skip"><span class="heti-spacing"> </span>Pb<span class="heti-spacing"> </span></span>之间波动。</p>
<p>虚拟流动性：限定范围后，通过提供更少的<span><span class="heti-spacing"> </span>LP</span>，就可以达到在<span class="heti-skip"><span class="heti-spacing"> </span>Uniswap V2<span class="heti-spacing"> </span></span>里面更多的<span class="heti-skip"><span class="heti-spacing"> </span>LP<span class="heti-spacing"> </span></span>的效果。</p>
<p><img alt="53" src="../../../assets/images/defi_course_2024_edition/53.png"/></p>
<p><img alt="54" src="../../../assets/images/defi_course_2024_edition/54.png"/></p>
<p><img alt="55" src="../../../assets/images/defi_course_2024_edition/55.png"/></p>
<p><span>Uniswap V3<span class="heti-spacing"> </span></span>的模拟器：可以模拟不同的价格流动性、不同价格范围，和<span class="heti-skip"><span class="heti-spacing"> </span>V2<span class="heti-spacing"> </span></span>进行对比。</p>
<p><a href="https://www.desmos.com/calculator/6si0vmgwhc?lang=zh-CN">https://www.desmos.com/calculator/6si0vmgwhc?lang=zh-CN</a></p>
<p><img alt="56" src="../../../assets/images/defi_course_2024_edition/56.png"/></p>
<p><img alt="57" src="../../../assets/images/defi_course_2024_edition/57.png"/></p>
<p><img alt="58" src="../../../assets/images/defi_course_2024_edition/58.png"/></p>
<h2 id="16-uniswap-v3">第<span class="heti-skip"><span class="heti-spacing"> </span>16<span class="heti-spacing"> </span></span>课<span class="heti-skip"><span class="heti-spacing"> </span>- Uniswap V3<span class="heti-spacing"> </span></span>的流动性计算<a class="headerlink" href="#16-uniswap-v3" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<p><img alt="59" src="../../../assets/images/defi_course_2024_edition/59.png"/></p>
<h2 id="17-uniswap-v3">第<span class="heti-skip"><span class="heti-spacing"> </span>17<span class="heti-spacing"> </span></span>课<span class="heti-skip"><span class="heti-spacing"> </span>- Uniswap V3<span class="heti-spacing"> </span></span>的无常损失计算<a class="headerlink" href="#17-uniswap-v3" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<p>（本节笔记待补充）</p>
<h2 id="18-uniswap-v4">第<span class="heti-skip"><span class="heti-spacing"> </span>18<span class="heti-spacing"> </span></span>课<span class="heti-skip"><span class="heti-spacing"> </span>- Uniswap V4<span class="heti-spacing"> </span></span>简介<a class="headerlink" href="#18-uniswap-v4" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<p>（本节笔记待补充）</p>
<h2 id="19-">第<span class="heti-skip"><span class="heti-spacing"> </span>19<span class="heti-spacing"> </span></span>课<span class="heti-skip"><span class="heti-spacing"> </span>-<span class="heti-spacing"> </span></span>去中心化借贷<a class="headerlink" href="#19-" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<p>（本节笔记待补充）</p>
<aside class="md-source-file">
<span class="md-source-file__fact">
<span class="md-icon" title="最后更新">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg>
</span>
<span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">2026年2月6日 15:08:26</span>
</span>
</aside>
<!-- Insert generated snippet here -->
<script async="" crossorigin="anonymous" data-category="Comments" data-category-id="DIC_kwDOMt1b5c4CiWjc" data-emit-metadata="1" data-input-position="top" data-lang="zh-CN" data-loading="lazy" data-mapping="title" data-reactions-enabled="1" data-repo="lifefindsitsway/web3-tutorials" data-repo-id="R_kgDOMt1b5Q" data-strict="0" data-theme="light_protanopia" src="https://giscus.app/client.js">
</script>
<!-- Synchronize Giscus theme with palette -->
<script>
var giscus = document.querySelector("script[src*=giscus]")

// Set palette on initial load
var palette = __md_get("__palette")
if (palette && typeof palette.color === "object") {
    var theme = palette.color.scheme === "slate"
    ? "dark_protanopia"
    : "light_protanopia"

    // Instruct Giscus to set theme
    giscus.setAttribute("data-theme", theme) 
}

// Register event handlers after documented loaded
document.addEventListener("DOMContentLoaded", function() {
    var ref = document.querySelector("[data-md-component=palette]")
    ref.addEventListener("change", function() {
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
        var theme = palette.color.scheme === "slate"
        ? "dark_protanopia"
        : "light_protanopia"

        // Instruct Giscus to change theme
        var frame = document.querySelector(".giscus-frame")
        frame.contentWindow.postMessage(
        { giscus: { setConfig: { theme } } },
        "https://giscus.app"
        )
    }
    })
})
</script>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  回到页面顶部
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright © 2024 ~ present by <a href="https://github.com/lifefindsitsway" rel="noopener noreferrer" target="_blank">Lifefindsitsway</a>
</div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/lifefindsitsway/web3-tutorials/" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../..", "features": ["header.autohide", "navigation.tracking", "navigation.top", "search.highlight", "search.share", "search.suggest", "content.code.copy", "content.code.annotate"], "search": "../../../assets/javascripts/workers/search.07f07601.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
<script src="../../../assets/javascripts/bundle.56dfad97.min.js"></script>
<script src="../../../assets/javascripts/mathjax-config.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</body>
</html>